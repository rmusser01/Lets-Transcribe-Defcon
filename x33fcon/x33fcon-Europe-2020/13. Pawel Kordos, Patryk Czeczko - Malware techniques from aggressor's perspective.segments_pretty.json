{
  "segments": [
    {
      "Time_Start": 0.0,
      "Time_End": 12.0,
      "Text": "This text was transcribed using whisper model: large-v2\n\n Welcome, welcome everybody."
    },
    {
      "Time_Start": 12.0,
      "Time_End": 15.0,
      "Text": " Hello, so hopefully you will enjoy this."
    },
    {
      "Time_Start": 15.0,
      "Time_End": 20.0,
      "Text": " Okay, so we would like to talk about malware development,"
    },
    {
      "Time_Start": 20.0,
      "Time_End": 24.0,
      "Text": " a quite an interesting topic we've been recently browsing with Pawe\u0142."
    },
    {
      "Time_Start": 24.0,
      "Time_End": 28.0,
      "Text": " So let us start with introduction."
    },
    {
      "Time_Start": 28.0,
      "Time_End": 32.0,
      "Text": " Can we change slides here?"
    },
    {
      "Time_Start": 32.0,
      "Time_End": 35.0,
      "Text": " Okay, so my name is Patryk Czesko."
    },
    {
      "Time_Start": 35.0,
      "Time_End": 39.0,
      "Text": " I currently work at Purple Team in Standard Chartered Bank."
    },
    {
      "Time_Start": 39.0,
      "Time_End": 45.0,
      "Text": " Previously, I worked at Deloitte, Red Team Deloitte together with Pawe\u0142."
    },
    {
      "Time_Start": 45.0,
      "Time_End": 48.0,
      "Text": " And that's my short story."
    },
    {
      "Time_Start": 48.0,
      "Time_End": 49.0,
      "Text": " Yeah, my name is Pawe\u0142 Gordos."
    },
    {
      "Time_Start": 49.0,
      "Time_End": 51.0,
      "Text": " I work as a penetration tester in KND"
    },
    {
      "Time_Start": 51.0,
      "Time_End": 54.0,
      "Text": " and previously we've been working with Patryk in Red Team Deloitte."
    },
    {
      "Time_Start": 54.0,
      "Time_End": 56.0,
      "Text": " I was a senior consultant here."
    },
    {
      "Time_Start": 56.0,
      "Time_End": 58.0,
      "Text": " We've done a couple of interesting engagements."
    },
    {
      "Time_Start": 58.0,
      "Time_End": 66.0,
      "Text": " We've gained some knowledge and we'd like to share it with you today."
    },
    {
      "Time_Start": 66.0,
      "Time_End": 68.0,
      "Text": " Yes, that's it."
    },
    {
      "Time_Start": 68.0,
      "Time_End": 71.0,
      "Text": " So about this presentation,"
    },
    {
      "Time_Start": 71.0,
      "Time_End": 74.0,
      "Text": " we are going to focus on malicious code development"
    },
    {
      "Time_Start": 74.0,
      "Time_End": 78.0,
      "Text": " and mainly on Windows platforms"
    },
    {
      "Time_Start": 78.0,
      "Time_End": 80.0,
      "Text": " because during Red Team engagements,"
    },
    {
      "Time_Start": 80.0,
      "Time_End": 83.0,
      "Text": " we usually exploit post-exploit to Windows environments,"
    },
    {
      "Time_Start": 83.0,
      "Time_End": 84.0,
      "Text": " Active Directory domains."
    },
    {
      "Time_Start": 84.0,
      "Time_End": 88.0,
      "Text": " So that's our main area of interest."
    },
    {
      "Time_Start": 88.0,
      "Time_End": 93.0,
      "Text": " And we are using C++ because it gives us direct access to Windows API"
    },
    {
      "Time_Start": 93.0,
      "Time_End": 96.0,
      "Text": " since it's harder to reverse than, for example,"
    },
    {
      "Time_Start": 96.0,
      "Time_End": 99.0,
      "Text": " PowerShell script or .NET application."
    },
    {
      "Time_Start": 99.0,
      "Time_End": 103.0,
      "Text": " So we're sticking with pure C++ for C."
    },
    {
      "Time_Start": 103.0,
      "Time_End": 108.0,
      "Text": " We will talk about bypassing modern defenses like antiviruses,"
    },
    {
      "Time_Start": 108.0,
      "Time_End": 113.0,
      "Text": " ADRs or sandboxes, virtualized environments,"
    },
    {
      "Time_Start": 113.0,
      "Time_End": 120.0,
      "Text": " but also some techniques to make malware analysis harder,"
    },
    {
      "Time_Start": 120.0,
      "Time_End": 124.0,
      "Text": " to obfuscate code, hinder debugging,"
    },
    {
      "Time_Start": 124.0,
      "Time_End": 131.0,
      "Text": " and also a few words about hiding malicious code in legitimate apps."
    },
    {
      "Time_Start": 131.0,
      "Time_End": 136.0,
      "Text": " So this includes both code injection and backdooring."
    },
    {
      "Time_Start": 136.0,
      "Time_End": 140.0,
      "Text": " So Pawe\u0142 will tell more about backdoors later."
    },
    {
      "Time_Start": 140.0,
      "Time_End": 146.0,
      "Text": " So let me start with basic information"
    },
    {
      "Time_Start": 146.0,
      "Time_End": 151.0,
      "Text": " on how detection mechanisms work now."
    },
    {
      "Time_Start": 151.0,
      "Time_End": 155.0,
      "Text": " So we can say we have three types of detections."
    },
    {
      "Time_Start": 155.0,
      "Time_End": 159.0,
      "Text": " First one is basic signature-based detection."
    },
    {
      "Time_Start": 159.0,
      "Time_End": 164.0,
      "Text": " So files are analyzed for checksums,"
    },
    {
      "Time_Start": 164.0,
      "Time_End": 170.0,
      "Text": " for known strings, characters inside the executable, for example,"
    },
    {
      "Time_Start": 170.0,
      "Time_End": 176.0,
      "Text": " and known byte sequences associated with some malicious opcodes,"
    },
    {
      "Time_Start": 176.0,
      "Time_End": 179.0,
      "Text": " malicious assembly instructions, for example."
    },
    {
      "Time_Start": 179.0,
      "Time_End": 182.0,
      "Text": " Then we have heuristic detection."
    },
    {
      "Time_Start": 182.0,
      "Time_End": 185.0,
      "Text": " So it's basically an analysis of application behavior."
    },
    {
      "Time_Start": 185.0,
      "Time_End": 191.0,
      "Text": " It can be, for example, based on import table in Windows executables."
    },
    {
      "Time_Start": 191.0,
      "Time_End": 196.0,
      "Text": " So antivirus can analyze or analyst can analyze the file"
    },
    {
      "Time_Start": 196.0,
      "Time_End": 200.0,
      "Text": " to understand what action is it going to perform on the system"
    },
    {
      "Time_Start": 200.0,
      "Time_End": 204.0,
      "Text": " based on functions it's importing from the system,"
    },
    {
      "Time_Start": 204.0,
      "Time_End": 206.0,
      "Text": " from Windows DLLs, for example."
    },
    {
      "Time_Start": 206.0,
      "Time_End": 210.0,
      "Text": " And the third kind is sandboxing,"
    },
    {
      "Time_Start": 210.0,
      "Time_End": 214.0,
      "Text": " which is dynamic analysis when the sample is executed"
    },
    {
      "Time_Start": 214.0,
      "Time_End": 219.0,
      "Text": " or as it's called, detonated in the controlled environment."
    },
    {
      "Time_Start": 219.0,
      "Time_End": 224.0,
      "Text": " And as the application is executed,"
    },
    {
      "Time_Start": 224.0,
      "Time_End": 228.0,
      "Text": " it's analyzed by this, for example, the sandbox"
    },
    {
      "Time_Start": 228.0,
      "Time_End": 233.0,
      "Text": " to see exactly what is it performing during runtime"
    },
    {
      "Time_Start": 233.0,
      "Time_End": 240.0,
      "Text": " and actions are monitored to better understand this malicious application."
    },
    {
      "Time_Start": 240.0,
      "Time_End": 245.0,
      "Text": " So how are we going to fight those detections?"
    },
    {
      "Time_Start": 245.0,
      "Time_End": 247.0,
      "Text": " So for signature-based detection,"
    },
    {
      "Time_Start": 247.0,
      "Time_End": 253.0,
      "Text": " the simplest thing to do is to recompile the executable."
    },
    {
      "Time_Start": 253.0,
      "Time_End": 256.0,
      "Text": " That's how we can get a different checksum each time."
    },
    {
      "Time_Start": 256.0,
      "Time_End": 261.0,
      "Text": " So we fight this basic, very basic IOC,"
    },
    {
      "Time_Start": 261.0,
      "Time_End": 265.0,
      "Text": " which is md5 or SHA signature."
    },
    {
      "Time_Start": 265.0,
      "Time_End": 271.0,
      "Text": " We can also do something more difficult and a little bit sophisticated,"
    },
    {
      "Time_Start": 271.0,
      "Time_End": 273.0,
      "Text": " which is polymorphism."
    },
    {
      "Time_Start": 273.0,
      "Time_End": 277.0,
      "Text": " So it's basically the code that modifies itself."
    },
    {
      "Time_Start": 277.0,
      "Time_End": 282.0,
      "Text": " Actually, it's maybe quite easy to add some garbage data"
    },
    {
      "Time_Start": 282.0,
      "Time_End": 285.0,
      "Text": " to an executable every time it's run,"
    },
    {
      "Time_Start": 285.0,
      "Time_End": 289.0,
      "Text": " so the checksum is changed."
    },
    {
      "Time_Start": 289.0,
      "Time_End": 294.0,
      "Text": " Resources encryption is valid for signature-based detection"
    },
    {
      "Time_Start": 294.0,
      "Time_End": 296.0,
      "Text": " and heuristic detection,"
    },
    {
      "Time_Start": 296.0,
      "Time_End": 301.0,
      "Text": " so it's commonly used in malware malicious code."
    },
    {
      "Time_Start": 301.0,
      "Time_End": 304.0,
      "Text": " So any data stored in the executable,"
    },
    {
      "Time_Start": 304.0,
      "Time_End": 308.0,
      "Text": " strings, configurations, so it's executed and it's encrypted"
    },
    {
      "Time_Start": 308.0,
      "Time_End": 312.0,
      "Text": " and it's only decrypted during runtime."
    },
    {
      "Time_Start": 312.0,
      "Time_End": 316.0,
      "Text": " So for heuristic detection, for combating those detections,"
    },
    {
      "Time_Start": 316.0,
      "Time_End": 321.0,
      "Text": " we can also implement some code obfuscation."
    },
    {
      "Time_Start": 321.0,
      "Time_End": 325.0,
      "Text": " For example, low-level virtual machine obfuscation"
    },
    {
      "Time_Start": 326.0,
      "Time_End": 331.0,
      "Text": " or anything else that makes the code harder to analyze."
    },
    {
      "Time_Start": 331.0,
      "Time_End": 338.0,
      "Text": " Dynamic code, which means loading functions during runtime"
    },
    {
      "Time_Start": 338.0,
      "Time_End": 344.0,
      "Text": " and maybe changing the code using reflection on the shellcode level."
    },
    {
      "Time_Start": 344.0,
      "Time_End": 349.0,
      "Text": " And for sandboxing, we can use simple environment checks"
    },
    {
      "Time_Start": 349.0,
      "Time_End": 352.0,
      "Text": " and ifs, for example, if the machine,"
    },
    {
      "Time_Start": 352.0,
      "Time_End": 357.0,
      "Text": " the sample is executed on is constrained with resources,"
    },
    {
      "Time_Start": 357.0,
      "Time_End": 360.0,
      "Text": " for example, it has only one or two gigabytes of RAM,"
    },
    {
      "Time_Start": 360.0,
      "Time_End": 367.0,
      "Text": " it's probably some sandbox and we can terminate our process here."
    },
    {
      "Time_Start": 367.0,
      "Time_End": 370.0,
      "Text": " So starting with the basics,"
    },
    {
      "Time_Start": 370.0,
      "Time_End": 375.0,
      "Text": " we have like this malware primitive,"
    },
    {
      "Time_Start": 375.0,
      "Time_End": 377.0,
      "Text": " primitive, which is a shellcode."
    },
    {
      "Time_Start": 377.0,
      "Time_End": 378.0,
      "Text": " And what is a shellcode?"
    },
    {
      "Time_Start": 378.0,
      "Time_End": 381.0,
      "Text": " A shellcode is some kind of position-independent code,"
    },
    {
      "Time_Start": 381.0,
      "Time_End": 388.0,
      "Text": " which, for example, may be injected during binary exploitation"
    },
    {
      "Time_Start": 388.0,
      "Time_End": 394.0,
      "Text": " of an application or injected in some process."
    },
    {
      "Time_Start": 394.0,
      "Time_End": 400.0,
      "Text": " And it usually bootstraps itself to find specific memory structures"
    },
    {
      "Time_Start": 400.0,
      "Time_End": 404.0,
      "Text": " and functions in memory and use those functions, for example,"
    },
    {
      "Time_Start": 404.0,
      "Time_End": 410.0,
      "Text": " to open a bind shell or reverse shell or anything."
    },
    {
      "Time_Start": 410.0,
      "Time_End": 413.0,
      "Text": " Shellcode by design contains some clever features,"
    },
    {
      "Time_Start": 413.0,
      "Time_End": 415.0,
      "Text": " which we will discuss briefly."
    },
    {
      "Time_Start": 415.0,
      "Time_End": 422.0,
      "Text": " And shellcodes are like ultimate reflective code"
    },
    {
      "Time_Start": 422.0,
      "Time_End": 425.0,
      "Text": " because it can change itself very easily."
    },
    {
      "Time_Start": 425.0,
      "Time_End": 427.0,
      "Text": " So that's why there are a lot of, for example,"
    },
    {
      "Time_Start": 427.0,
      "Time_End": 433.0,
      "Text": " just those simple XOR encryptors that shellcode decrypts itself"
    },
    {
      "Time_Start": 433.0,
      "Time_End": 435.0,
      "Text": " on the runtime and then executes."
    },
    {
      "Time_Start": 435.0,
      "Time_End": 442.0,
      "Text": " So it's some anti-analysis mechanism implemented in shellcode, usually."
    },
    {
      "Time_Start": 442.0,
      "Time_End": 447.0,
      "Text": " So how Windows shellcode works?"
    },
    {
      "Time_Start": 447.0,
      "Time_End": 451.0,
      "Text": " First, process environment block is located memory."
    },
    {
      "Time_Start": 451.0,
      "Time_End": 453.0,
      "Text": " It's quite easy to locate it."
    },
    {
      "Time_Start": 453.0,
      "Time_End": 459.0,
      "Text": " Then process environment block has the links to loader data,"
    },
    {
      "Time_Start": 459.0,
      "Time_End": 462.0,
      "Text": " which has information about loaded modules"
    },
    {
      "Time_Start": 462.0,
      "Time_End": 470.0,
      "Text": " and every application has those Windows libraries loaded at runtime,"
    },
    {
      "Time_Start": 470.0,
      "Time_End": 472.0,
      "Text": " like kernel32 or RTDLL."
    },
    {
      "Time_Start": 472.0,
      "Time_End": 475.0,
      "Text": " And we can browse those libraries in memory"
    },
    {
      "Time_Start": 475.0,
      "Time_End": 477.0,
      "Text": " to find the functions that we need."
    },
    {
      "Time_Start": 477.0,
      "Time_End": 482.0,
      "Text": " And mainly these are get process address and get module handle"
    },
    {
      "Time_Start": 482.0,
      "Time_End": 484.0,
      "Text": " and load library."
    },
    {
      "Time_Start": 484.0,
      "Time_End": 486.0,
      "Text": " And shellcode can use those specific functions"
    },
    {
      "Time_Start": 486.0,
      "Time_End": 491.0,
      "Text": " to find any other function, for example,"
    },
    {
      "Time_Start": 491.0,
      "Time_End": 497.0,
      "Text": " load socket library and call functions to, in this example,"
    },
    {
      "Time_Start": 497.0,
      "Time_End": 502.0,
      "Text": " create process and assign the standard input and output"
    },
    {
      "Time_Start": 502.0,
      "Time_End": 503.0,
      "Text": " to create socket."
    },
    {
      "Time_Start": 503.0,
      "Time_End": 507.0,
      "Text": " So it's a very basic reverse shell, for example,"
    },
    {
      "Time_Start": 507.0,
      "Time_End": 510.0,
      "Text": " generated by Metasploit."
    },
    {
      "Time_Start": 510.0,
      "Time_End": 515.0,
      "Text": " And here is example of basic injection."
    },
    {
      "Time_Start": 515.0,
      "Time_End": 520.0,
      "Text": " For example, when we implement some loader in C++,"
    },
    {
      "Time_Start": 520.0,
      "Time_End": 523.0,
      "Text": " which injects our shellcode, whatever it is,"
    },
    {
      "Time_Start": 523.0,
      "Time_End": 525.0,
      "Text": " for example, Cobalt Strike shellcode"
    },
    {
      "Time_Start": 525.0,
      "Time_End": 531.0,
      "Text": " or shellcode from any command and control tool or whatever,"
    },
    {
      "Time_Start": 531.0,
      "Time_End": 536.0,
      "Text": " the basic technique is to allocate virtual memory in the process"
    },
    {
      "Time_Start": 536.0,
      "Time_End": 538.0,
      "Text": " and then create a new thread."
    },
    {
      "Time_Start": 538.0,
      "Time_End": 544.0,
      "Text": " And note a few things here that when data execution prevention is enabled,"
    },
    {
      "Time_Start": 544.0,
      "Time_End": 547.0,
      "Text": " which is common nowadays,"
    },
    {
      "Time_Start": 547.0,
      "Time_End": 552.0,
      "Text": " we need to give proper permissions to the memory."
    },
    {
      "Time_Start": 552.0,
      "Time_End": 556.0,
      "Text": " So this second code snippet,"
    },
    {
      "Time_Start": 556.0,
      "Time_End": 561.0,
      "Text": " like casting shellcode to function pointer and executing it,"
    },
    {
      "Time_Start": 561.0,
      "Time_End": 566.0,
      "Text": " won't work because we need to have memory with read-write permissions,"
    },
    {
      "Time_Start": 566.0,
      "Time_End": 569.0,
      "Text": " as you can see on the second line of code."
    },
    {
      "Time_Start": 569.0,
      "Time_End": 573.0,
      "Text": " So it's a very rudimentary technique of injection,"
    },
    {
      "Time_Start": 573.0,
      "Time_End": 576.0,
      "Text": " but sometimes it's used."
    },
    {
      "Time_Start": 576.0,
      "Time_End": 581.0,
      "Text": " Okay, so we have this basic proof of concept,"
    },
    {
      "Time_Start": 581.0,
      "Time_End": 584.0,
      "Text": " which injects our Metasploit shellcode in the process."
    },
    {
      "Time_Start": 584.0,
      "Time_End": 586.0,
      "Text": " Let's test it against VirusTotal."
    },
    {
      "Time_Start": 586.0,
      "Time_End": 591.0,
      "Text": " So after uploading the raw shellcode,"
    },
    {
      "Time_Start": 591.0,
      "Time_End": 596.0,
      "Text": " we get such detection, like 23 or 50."
    },
    {
      "Time_Start": 596.0,
      "Time_End": 601.0,
      "Text": " And this injector compiled in the C application"
    },
    {
      "Time_Start": 601.0,
      "Time_End": 607.0,
      "Text": " is also pretty much detected by antiviruses."
    },
    {
      "Time_Start": 607.0,
      "Time_End": 614.0,
      "Text": " And we can implement some very basic things here"
    },
    {
      "Time_Start": 614.0,
      "Time_End": 618.0,
      "Text": " to hinder the analysis on VirusTotal,"
    },
    {
      "Time_Start": 618.0,
      "Time_End": 621.0,
      "Text": " to obfuscate the code a little bit."
    },
    {
      "Time_Start": 621.0,
      "Time_End": 625.0,
      "Text": " So first thing is XOR encryption."
    },
    {
      "Time_Start": 625.0,
      "Time_End": 631.0,
      "Text": " Very simple, we just XOR every byte with some value."
    },
    {
      "Time_Start": 631.0,
      "Time_End": 637.0,
      "Text": " Then a great thing to do is to create some fake,"
    },
    {
      "Time_Start": 637.0,
      "Time_End": 643.0,
      "Text": " well, just some software certificate and use it to sign."
    },
    {
      "Time_Start": 643.0,
      "Time_End": 646.0,
      "Text": " It doesn't need to be in any certificate path,"
    },
    {
      "Time_Start": 646.0,
      "Time_End": 652.0,
      "Text": " just any code signing certificate will do here."
    },
    {
      "Time_Start": 652.0,
      "Time_End": 654.0,
      "Text": " And we can drop the detection rate"
    },
    {
      "Time_Start": 654.0,
      "Time_End": 658.0,
      "Text": " when the executable is signed."
    },
    {
      "Time_Start": 658.0,
      "Time_End": 663.0,
      "Text": " And other thing is to switch to x64 architecture"
    },
    {
      "Time_Start": 663.0,
      "Time_End": 668.0,
      "Text": " and using those three basic, very basic techniques."
    },
    {
      "Time_Start": 668.0,
      "Time_End": 671.0,
      "Text": " So in XOR encryption, code signing certificate"
    },
    {
      "Time_Start": 671.0,
      "Time_End": 677.0,
      "Text": " and 64-bit architecture allowed us to drop the detection rate"
    },
    {
      "Time_Start": 677.0,
      "Time_End": 687.0,
      "Text": " to only three from 20-something that was before."
    },
    {
      "Time_Start": 687.0,
      "Time_End": 688.0,
      "Text": " Yeah, all right."
    },
    {
      "Time_Start": 688.0,
      "Time_End": 692.0,
      "Text": " And now we'd like to focus more about the anti-VM solutions"
    },
    {
      "Time_Start": 692.0,
      "Time_End": 694.0,
      "Text": " because the two main threats"
    },
    {
      "Time_Start": 694.0,
      "Time_End": 698.0,
      "Text": " which we will be actually fighting in our development is,"
    },
    {
      "Time_Start": 698.0,
      "Time_End": 700.0,
      "Text": " first, this is antivirus solution,"
    },
    {
      "Time_Start": 700.0,
      "Time_End": 703.0,
      "Text": " but probably we'd like not to get catched so easy."
    },
    {
      "Time_Start": 703.0,
      "Time_End": 706.0,
      "Text": " So we also have to face malware analysts,"
    },
    {
      "Time_Start": 706.0,
      "Time_End": 709.0,
      "Text": " which probably will receive malware for further analysts."
    },
    {
      "Time_Start": 709.0,
      "Time_End": 715.0,
      "Text": " And we'd like also to make some security measures against them."
    },
    {
      "Time_Start": 715.0,
      "Time_End": 718.0,
      "Text": " So as a first step, both sandboxes"
    },
    {
      "Time_Start": 718.0,
      "Time_End": 723.0,
      "Text": " and analyst virtualizers OS usually can 100% emulate"
    },
    {
      "Time_Start": 723.0,
      "Time_End": 726.0,
      "Text": " the actual execution machine like a workstation."
    },
    {
      "Time_Start": 726.0,
      "Time_End": 728.0,
      "Text": " And they usually are simplified machines"
    },
    {
      "Time_Start": 728.0,
      "Time_End": 730.0,
      "Text": " with limited resources."
    },
    {
      "Time_Start": 730.0,
      "Time_End": 734.0,
      "Text": " And there are some other things which may be in our indicators"
    },
    {
      "Time_Start": 734.0,
      "Time_End": 737.0,
      "Text": " to verify whether we are facing a virtual machine"
    },
    {
      "Time_Start": 737.0,
      "Time_End": 740.0,
      "Text": " or a physical one, like for example, device name"
    },
    {
      "Time_Start": 740.0,
      "Time_End": 743.0,
      "Text": " or some USB information."
    },
    {
      "Time_Start": 743.0,
      "Time_End": 746.0,
      "Text": " Also MAC address of the network cards is useful here."
    },
    {
      "Time_Start": 746.0,
      "Time_End": 749.0,
      "Text": " And let's go through a couple of these."
    },
    {
      "Time_Start": 749.0,
      "Time_End": 753.0,
      "Text": " So as I told, the first thing are the limited resources."
    },
    {
      "Time_Start": 753.0,
      "Time_End": 759.0,
      "Text": " Sandboxes may not be able to 100% simulate the physical machine."
    },
    {
      "Time_Start": 759.0,
      "Time_End": 762.0,
      "Text": " Therefore, we can simply check the number"
    },
    {
      "Time_Start": 762.0,
      "Time_End": 765.0,
      "Text": " of processor cores on the system."
    },
    {
      "Time_Start": 765.0,
      "Time_End": 768.0,
      "Text": " Most, maybe not most, some of the AP products cannot afford"
    },
    {
      "Time_Start": 768.0,
      "Time_End": 771.0,
      "Text": " allocating too much resource from a host computer"
    },
    {
      "Time_Start": 771.0,
      "Time_End": 773.0,
      "Text": " in order not to slow it down too much."
    },
    {
      "Time_Start": 773.0,
      "Time_End": 778.0,
      "Text": " So we can first check how much core is on the machine"
    },
    {
      "Time_Start": 778.0,
      "Time_End": 780.0,
      "Text": " we are currently running."
    },
    {
      "Time_Start": 780.0,
      "Time_End": 786.0,
      "Text": " And if less than, for example, two, we can shut our program."
    },
    {
      "Time_Start": 786.0,
      "Time_End": 791.0,
      "Text": " Second is check amount of the memory system."
    },
    {
      "Time_Start": 791.0,
      "Time_End": 793.0,
      "Text": " Same story as before."
    },
    {
      "Time_Start": 793.0,
      "Time_End": 796.0,
      "Text": " Sandboxes cannot allocate too much memory."
    },
    {
      "Time_Start": 796.0,
      "Time_End": 799.0,
      "Text": " And we can check how much memory is available"
    },
    {
      "Time_Start": 799.0,
      "Time_End": 801.0,
      "Text": " on the production system."
    },
    {
      "Time_Start": 801.0,
      "Time_End": 804.0,
      "Text": " In this particular example, we are assuming that a minimum"
    },
    {
      "Time_Start": 804.0,
      "Time_End": 808.0,
      "Text": " of two gigs of RAM will be on our target."
    },
    {
      "Time_Start": 808.0,
      "Time_End": 810.0,
      "Text": " But we can modify that if we know that, for example,"
    },
    {
      "Time_Start": 810.0,
      "Time_End": 813.0,
      "Text": " this company is using machines like a developer unit"
    },
    {
      "Time_Start": 813.0,
      "Time_End": 816.0,
      "Text": " with 32 gigs, we can increase that."
    },
    {
      "Time_Start": 816.0,
      "Time_End": 819.0,
      "Text": " So if it's less, our program will not run."
    },
    {
      "Time_Start": 819.0,
      "Time_End": 823.0,
      "Text": " And I assume that none of the antivirus solution"
    },
    {
      "Time_Start": 823.0,
      "Time_End": 827.0,
      "Text": " or the malware analyst will have such a big amount of memory"
    },
    {
      "Time_Start": 827.0,
      "Time_End": 831.0,
      "Text": " shared with the virtual machine."
    },
    {
      "Time_Start": 831.0,
      "Time_End": 834.0,
      "Text": " Other things which we can do,"
    },
    {
      "Time_Start": 834.0,
      "Time_End": 836.0,
      "Text": " we can make a huge memory allocation."
    },
    {
      "Time_Start": 836.0,
      "Time_End": 839.0,
      "Text": " This one is pretty much just like 10 gigs,"
    },
    {
      "Time_Start": 839.0,
      "Time_End": 841.0,
      "Text": " probably too much because it may actually crash"
    },
    {
      "Time_Start": 841.0,
      "Time_End": 843.0,
      "Text": " on the target machine."
    },
    {
      "Time_Start": 843.0,
      "Time_End": 847.0,
      "Text": " But we can try to allocate around one gig of RAM."
    },
    {
      "Time_Start": 847.0,
      "Time_End": 850.0,
      "Text": " So antivirus probably will not be able to allocate"
    },
    {
      "Time_Start": 850.0,
      "Time_End": 853.0,
      "Text": " that much of memory for obvious reasons."
    },
    {
      "Time_Start": 853.0,
      "Time_End": 854.0,
      "Text": " So we can do that."
    },
    {
      "Time_Start": 854.0,
      "Time_End": 856.0,
      "Text": " Then we can free this memory."
    },
    {
      "Time_Start": 856.0,
      "Time_End": 859.0,
      "Text": " And one interesting trick to fool the machine"
    },
    {
      "Time_Start": 859.0,
      "Time_End": 861.0,
      "Text": " is to try to load a library."
    },
    {
      "Time_Start": 861.0,
      "Time_End": 865.0,
      "Text": " So loading a library may be useful,"
    },
    {
      "Time_Start": 865.0,
      "Time_End": 868.0,
      "Text": " but try to load a library called, for example, fake DLL."
    },
    {
      "Time_Start": 868.0,
      "Time_End": 872.0,
      "Text": " And probably fake DLL would not exist on our target machine."
    },
    {
      "Time_Start": 872.0,
      "Time_End": 875.0,
      "Text": " And this is what we actually will suspect."
    },
    {
      "Time_Start": 875.0,
      "Time_End": 878.0,
      "Text": " And normally when we try to load a non-existing DLL,"
    },
    {
      "Time_Start": 878.0,
      "Time_End": 881.0,
      "Text": " probably the function should return null."
    },
    {
      "Time_Start": 881.0,
      "Time_End": 884.0,
      "Text": " But some dynamic analysis mechanism in antivirus solutions"
    },
    {
      "Time_Start": 884.0,
      "Time_End": 887.0,
      "Text": " allows such cases in order to further investigate"
    },
    {
      "Time_Start": 887.0,
      "Time_End": 889.0,
      "Text": " at the execution of the flow."
    },
    {
      "Time_Start": 889.0,
      "Time_End": 895.0,
      "Text": " So we can make use of that and try to load an existing DLL."
    },
    {
      "Time_Start": 895.0,
      "Time_End": 899.0,
      "Text": " The next thing which Patrick previously mentioned"
    },
    {
      "Time_Start": 899.0,
      "Time_End": 901.0,
      "Text": " is multi-threading."
    },
    {
      "Time_Start": 901.0,
      "Time_End": 905.0,
      "Text": " So automated analysis is performed"
    },
    {
      "Time_Start": 905.0,
      "Time_End": 907.0,
      "Text": " in a simplified sandbox environment."
    },
    {
      "Time_Start": 907.0,
      "Time_End": 910.0,
      "Text": " And sometimes it may not be able to enumerate"
    },
    {
      "Time_Start": 910.0,
      "Time_End": 912.0,
      "Text": " the nuances of the real environment,"
    },
    {
      "Time_Start": 912.0,
      "Time_End": 914.0,
      "Text": " such as, for example, multi-threading."
    },
    {
      "Time_Start": 914.0,
      "Time_End": 916.0,
      "Text": " And it's always harder to reverse engineer"
    },
    {
      "Time_Start": 916.0,
      "Time_End": 919.0,
      "Text": " a multi-threaded file."
    },
    {
      "Time_Start": 919.0,
      "Time_End": 923.0,
      "Text": " And it's also challenging for AV products."
    },
    {
      "Time_Start": 923.0,
      "Time_End": 926.0,
      "Text": " So this multi-threading approach can be used"
    },
    {
      "Time_Start": 926.0,
      "Time_End": 930.0,
      "Text": " with all of the other execution methods."
    },
    {
      "Time_Start": 930.0,
      "Time_End": 937.0,
      "Text": " So we will just create a new thread with our shellcode."
    },
    {
      "Time_Start": 937.0,
      "Time_End": 941.0,
      "Text": " And I've mentioned before that virtual machine can be supported"
    },
    {
      "Time_Start": 941.0,
      "Time_End": 945.0,
      "Text": " because they make use of similar computer names"
    },
    {
      "Time_Start": 945.0,
      "Time_End": 948.0,
      "Text": " and such a thing like this."
    },
    {
      "Time_Start": 948.0,
      "Time_End": 950.0,
      "Text": " So we can also check the computer name."
    },
    {
      "Time_Start": 950.0,
      "Time_End": 953.0,
      "Text": " Probably your workstation in a corporate environment"
    },
    {
      "Time_Start": 953.0,
      "Time_End": 957.0,
      "Text": " would not be called admin or desktop."
    },
    {
      "Time_Start": 957.0,
      "Time_End": 961.0,
      "Text": " This pattern actually differs from a different engagement."
    },
    {
      "Time_Start": 961.0,
      "Time_End": 965.0,
      "Text": " If we have a knowledge of a target environment,"
    },
    {
      "Time_Start": 965.0,
      "Time_End": 969.0,
      "Text": " we can, for example, try if the computer actually matches"
    },
    {
      "Time_Start": 969.0,
      "Time_End": 970.0,
      "Text": " our pattern."
    },
    {
      "Time_Start": 970.0,
      "Time_End": 975.0,
      "Text": " But if not, we can just try to avoid machines"
    },
    {
      "Time_Start": 975.0,
      "Time_End": 977.0,
      "Text": " like admin or desktop."
    },
    {
      "Time_Start": 977.0,
      "Time_End": 980.0,
      "Text": " So if it matches this pattern,"
    },
    {
      "Time_Start": 980.0,
      "Time_End": 982.0,
      "Text": " our malware will simply not run."
    },
    {
      "Time_Start": 982.0,
      "Time_End": 985.0,
      "Text": " And we can also check the username"
    },
    {
      "Time_Start": 985.0,
      "Time_End": 990.0,
      "Text": " because probably most of you do not work on a username account"
    },
    {
      "Time_Start": 990.0,
      "Time_End": 993.0,
      "Text": " with a username admin or a user."
    },
    {
      "Time_Start": 993.0,
      "Time_End": 997.0,
      "Text": " And some of the antivirus solutions,"
    },
    {
      "Time_Start": 997.0,
      "Time_End": 1002.0,
      "Text": " they just simulate things like this."
    },
    {
      "Time_Start": 1002.0,
      "Time_End": 1005.0,
      "Text": " So we can check that."
    },
    {
      "Time_Start": 1005.0,
      "Time_End": 1008.0,
      "Text": " And since we will be targeting a corporate environment,"
    },
    {
      "Time_Start": 1008.0,
      "Time_End": 1011.0,
      "Text": " we can assume that the computer is actually a member of a domain."
    },
    {
      "Time_Start": 1011.0,
      "Time_End": 1014.0,
      "Text": " So we can check the domain membership status."
    },
    {
      "Time_Start": 1014.0,
      "Time_End": 1018.0,
      "Text": " And if the computer which runs the malware is not a member of the domain,"
    },
    {
      "Time_Start": 1018.0,
      "Time_End": 1021.0,
      "Text": " our malware will simply not run."
    },
    {
      "Time_Start": 1021.0,
      "Time_End": 1025.0,
      "Text": " I assume that most of the malware analysis have the lab,"
    },
    {
      "Time_Start": 1025.0,
      "Time_End": 1030.0,
      "Text": " but for sure not always they run our malware in a domain environment."
    },
    {
      "Time_Start": 1030.0,
      "Time_End": 1035.0,
      "Text": " So we can also make use of that."
    },
    {
      "Time_Start": 1035.0,
      "Time_End": 1042.0,
      "Text": " Some of the environments which are used by both sandboxes"
    },
    {
      "Time_Start": 1042.0,
      "Time_End": 1045.0,
      "Text": " and for malware analysis purposes,"
    },
    {
      "Time_Start": 1045.0,
      "Time_End": 1047.0,
      "Text": " they are usually a fresh Windows installation"
    },
    {
      "Time_Start": 1047.0,
      "Time_End": 1049.0,
      "Text": " or at least looks like a fresh installation."
    },
    {
      "Time_Start": 1049.0,
      "Time_End": 1052.0,
      "Text": " And they may lack some artifacts"
    },
    {
      "Time_Start": 1052.0,
      "Time_End": 1055.0,
      "Text": " that appear over a time on a typical workstation."
    },
    {
      "Time_Start": 1055.0,
      "Time_End": 1058.0,
      "Text": " So one of the good examples in this"
    },
    {
      "Time_Start": 1058.0,
      "Time_End": 1062.0,
      "Text": " is the number of USB storage devices mounted in the system,"
    },
    {
      "Time_Start": 1062.0,
      "Time_End": 1064.0,
      "Text": " which is stored in the registry."
    },
    {
      "Time_Start": 1064.0,
      "Time_End": 1068.0,
      "Text": " So we can check if a user USB device has ever been mounted on the system."
    },
    {
      "Time_Start": 1069.0,
      "Time_End": 1072.0,
      "Text": " And it will probably give us some interesting knowledge"
    },
    {
      "Time_Start": 1072.0,
      "Time_End": 1078.0,
      "Text": " whether this machine has actually been used in reality or not."
    },
    {
      "Time_Start": 1078.0,
      "Time_End": 1081.0,
      "Text": " There are also some other artifacts,"
    },
    {
      "Time_Start": 1081.0,
      "Time_End": 1084.0,
      "Text": " which are typical for a virtual machine,"
    },
    {
      "Time_Start": 1084.0,
      "Time_End": 1087.0,
      "Text": " like for example, virtual box guest additions,"
    },
    {
      "Time_Start": 1087.0,
      "Time_End": 1090.0,
      "Text": " or some registry entries."
    },
    {
      "Time_Start": 1090.0,
      "Time_End": 1092.0,
      "Text": " And we probably would like to check that"
    },
    {
      "Time_Start": 1092.0,
      "Time_End": 1095.0,
      "Text": " and verify whether we are facing a virtual machine"
    },
    {
      "Time_Start": 1095.0,
      "Time_End": 1097.0,
      "Text": " or a physical device."
    },
    {
      "Time_Start": 1097.0,
      "Time_End": 1098.0,
      "Text": " So on a physical device,"
    },
    {
      "Time_Start": 1098.0,
      "Time_End": 1106.0,
      "Text": " you probably will not have a regular virtual box"
    },
    {
      "Time_Start": 1106.0,
      "Time_End": 1107.0,
      "Text": " and other guest additions."
    },
    {
      "Time_Start": 1107.0,
      "Time_End": 1112.0,
      "Text": " We can also check if some of the programs are running on a machine."
    },
    {
      "Time_Start": 1112.0,
      "Time_End": 1117.0,
      "Text": " So for example, a regular user, such a corporate worker,"
    },
    {
      "Time_Start": 1117.0,
      "Time_End": 1120.0,
      "Text": " would not make use of a wireframe on its device."
    },
    {
      "Time_Start": 1120.0,
      "Time_End": 1124.0,
      "Text": " So that may be actually a good indicator for us"
    },
    {
      "Time_Start": 1124.0,
      "Time_End": 1128.0,
      "Text": " whether to verify if we are facing a real machine."
    },
    {
      "Time_Start": 1128.0,
      "Time_End": 1132.0,
      "Text": " And usually when it comes to the network devices"
    },
    {
      "Time_Start": 1132.0,
      "Time_End": 1134.0,
      "Text": " for any virtual machine,"
    },
    {
      "Time_Start": 1134.0,
      "Time_End": 1137.0,
      "Text": " they have to be simulated for most of the cases, of course."
    },
    {
      "Time_Start": 1137.0,
      "Time_End": 1141.0,
      "Text": " And especially you should pay attention to those network devices"
    },
    {
      "Time_Start": 1141.0,
      "Time_End": 1144.0,
      "Text": " because as probably most of you know,"
    },
    {
      "Time_Start": 1144.0,
      "Time_End": 1147.0,
      "Text": " the MAC address can indicate the presence of a virtual environment"
    },
    {
      "Time_Start": 1147.0,
      "Time_End": 1150.0,
      "Text": " since the first three bytes of the MAC address"
    },
    {
      "Time_Start": 1150.0,
      "Time_End": 1154.0,
      "Text": " are actually a manufacturer identification number."
    },
    {
      "Time_Start": 1154.0,
      "Time_End": 1157.0,
      "Text": " So we can alliterate all of the available network devices"
    },
    {
      "Time_Start": 1157.0,
      "Time_End": 1161.0,
      "Text": " and compare those first bytes with well-known values."
    },
    {
      "Time_Start": 1161.0,
      "Time_End": 1163.0,
      "Text": " Of course, you can also simulate that,"
    },
    {
      "Time_Start": 1163.0,
      "Time_End": 1168.0,
      "Text": " but it works for some of the antivirus solutions"
    },
    {
      "Time_Start": 1168.0,
      "Time_End": 1173.0,
      "Text": " and probably a vast majority of malware analysts"
    },
    {
      "Time_Start": 1173.0,
      "Time_End": 1177.0,
      "Text": " won't make use of a real MAC address."
    },
    {
      "Time_Start": 1177.0,
      "Time_End": 1182.0,
      "Text": " And we would like also to focus on some anti-debugging features"
    },
    {
      "Time_Start": 1182.0,
      "Time_End": 1185.0,
      "Text": " because our malware may be then debugged"
    },
    {
      "Time_Start": 1185.0,
      "Time_End": 1188.0,
      "Text": " and there are some specific characteristics indicating"
    },
    {
      "Time_Start": 1188.0,
      "Time_End": 1192.0,
      "Text": " that the application is being manually inspected by a malware analyst."
    },
    {
      "Time_Start": 1192.0,
      "Time_End": 1195.0,
      "Text": " And we can then set some traps"
    },
    {
      "Time_Start": 1195.0,
      "Time_End": 1199.0,
      "Text": " and make it harder for an analyst to reverse our code."
    },
    {
      "Time_Start": 1199.0,
      "Time_End": 1202.0,
      "Text": " So first thing we want to do is probably to check"
    },
    {
      "Time_Start": 1202.0,
      "Time_End": 1205.0,
      "Text": " if the application is executed with a debugger attached."
    },
    {
      "Time_Start": 1205.0,
      "Time_End": 1209.0,
      "Text": " So there's a simple function, isDebuggerPresent,"
    },
    {
      "Time_Start": 1209.0,
      "Time_End": 1212.0,
      "Text": " so we can just check that."
    },
    {
      "Time_Start": 1212.0,
      "Time_End": 1214.0,
      "Text": " And there are some other specific flags,"
    },
    {
      "Time_Start": 1214.0,
      "Time_End": 1216.0,
      "Text": " for example, set in the process address space"
    },
    {
      "Time_Start": 1216.0,
      "Time_End": 1219.0,
      "Text": " when it's being debugged, like anti-global flag."
    },
    {
      "Time_Start": 1219.0,
      "Time_End": 1222.0,
      "Text": " It's a collection of flags located in the PEB,"
    },
    {
      "Time_Start": 1222.0,
      "Time_End": 1225.0,
      "Text": " which may indicate the debugger presence."
    },
    {
      "Time_Start": 1225.0,
      "Time_End": 1228.0,
      "Text": " Of course, there are a couple more debugging techniques."
    },
    {
      "Time_Start": 1228.0,
      "Time_End": 1230.0,
      "Text": " Those are just two of those,"
    },
    {
      "Time_Start": 1230.0,
      "Time_End": 1234.0,
      "Text": " but it mostly depends on what kind of software we are actually facing."
    },
    {
      "Time_Start": 1234.0,
      "Time_End": 1236.0,
      "Text": " And one more tip."
    },
    {
      "Time_Start": 1236.0,
      "Time_End": 1239.0,
      "Text": " If you try to place such a trap in your code,"
    },
    {
      "Time_Start": 1239.0,
      "Time_End": 1243.0,
      "Text": " just make sure that you are not actually trapping for you."
    },
    {
      "Time_Start": 1243.0,
      "Time_End": 1246.0,
      "Text": " So if you are using, for example, Virtual Studio Debugger,"
    },
    {
      "Time_Start": 1246.0,
      "Time_End": 1249.0,
      "Text": " try not to bypass this debugger"
    },
    {
      "Time_Start": 1249.0,
      "Time_End": 1252.0,
      "Text": " because you may have some problems with debugging your own code."
    },
    {
      "Time_Start": 1252.0,
      "Time_End": 1256.0,
      "Text": " And we have done some basic steps"
    },
    {
      "Time_Start": 1256.0,
      "Time_End": 1258.0,
      "Text": " and those are the actual steps done"
    },
    {
      "Time_Start": 1258.0,
      "Time_End": 1262.0,
      "Text": " in a piece of the shell called Patrick presented before."
    },
    {
      "Time_Start": 1262.0,
      "Time_End": 1266.0,
      "Text": " And I think that this may be enough."
    },
    {
      "Time_Start": 1266.0,
      "Time_End": 1270.0,
      "Text": " And let's check if it actually did something to our code."
    },
    {
      "Time_Start": 1272.0,
      "Time_End": 1274.0,
      "Text": " And was it magic? No."
    },
    {
      "Time_Start": 1274.0,
      "Time_End": 1279.0,
      "Text": " It's a score on this malware.executable file"
    },
    {
      "Time_Start": 1279.0,
      "Time_End": 1281.0,
      "Text": " and it actually wasn't detected on the VirusTotal."
    },
    {
      "Time_Start": 1281.0,
      "Time_End": 1283.0,
      "Text": " Well, VirusTotal is not a perfect solution"
    },
    {
      "Time_Start": 1283.0,
      "Time_End": 1287.0,
      "Text": " because even though there are some sandboxes inside of it,"
    },
    {
      "Time_Start": 1287.0,
      "Time_End": 1291.0,
      "Text": " those are the simplified sandboxes of a simplified environment."
    },
    {
      "Time_Start": 1291.0,
      "Time_End": 1293.0,
      "Text": " So probably this is not 100% sure."
    },
    {
      "Time_Start": 1293.0,
      "Time_End": 1296.0,
      "Text": " But anyway, we tricked the VirusTotal."
    },
    {
      "Time_Start": 1296.0,
      "Time_End": 1297.0,
      "Text": " We've got zero score."
    },
    {
      "Time_Start": 1297.0,
      "Time_End": 1301.0,
      "Text": " So malware is definitely a legitimate file"
    },
    {
      "Time_Start": 1301.0,
      "Time_End": 1304.0,
      "Text": " and recommended to open in a real environment."
    },
    {
      "Time_Start": 1304.0,
      "Time_End": 1308.0,
      "Text": " And there's one big thing"
    },
    {
      "Time_Start": 1308.0,
      "Time_End": 1311.0,
      "Text": " regarding the evading of the antivirus solution."
    },
    {
      "Time_Start": 1311.0,
      "Time_End": 1315.0,
      "Text": " As usual, the most valuable thing in the world is time."
    },
    {
      "Time_Start": 1315.0,
      "Time_End": 1317.0,
      "Text": " So it is in a malware development."
    },
    {
      "Time_Start": 1317.0,
      "Time_End": 1319.0,
      "Text": " So the clock is ticking"
    },
    {
      "Time_Start": 1319.0,
      "Time_End": 1321.0,
      "Text": " and Patrick."
    },
    {
      "Time_Start": 1321.0,
      "Time_End": 1322.0,
      "Text": " Okay."
    },
    {
      "Time_Start": 1322.0,
      "Time_End": 1325.0,
      "Text": " So there is a thing with delaying execution"
    },
    {
      "Time_Start": 1325.0,
      "Time_End": 1328.0,
      "Text": " because for example, to evade the sandbox analysis,"
    },
    {
      "Time_Start": 1328.0,
      "Time_End": 1332.0,
      "Text": " we could just sleep our application for a few minutes,"
    },
    {
      "Time_Start": 1332.0,
      "Time_End": 1335.0,
      "Text": " but sandboxes are wise now"
    },
    {
      "Time_Start": 1335.0,
      "Time_End": 1340.0,
      "Text": " and they can just fast forward those sleeps"
    },
    {
      "Time_Start": 1340.0,
      "Time_End": 1343.0,
      "Text": " by hooking Windows API functions."
    },
    {
      "Time_Start": 1343.0,
      "Time_End": 1348.0,
      "Text": " So here you see the execution flow of sleeping"
    },
    {
      "Time_Start": 1349.0,
      "Time_End": 1353.0,
      "Text": " finally and delay execution is called"
    },
    {
      "Time_Start": 1353.0,
      "Time_End": 1358.0,
      "Text": " and this empty delay execution function"
    },
    {
      "Time_Start": 1358.0,
      "Time_End": 1364.0,
      "Text": " can be hooked by some EDR or Cuckoo sandbox, whatever."
    },
    {
      "Time_Start": 1364.0,
      "Time_End": 1370.0,
      "Text": " And some long sleeps called by us on the code"
    },
    {
      "Time_Start": 1370.0,
      "Time_End": 1372.0,
      "Text": " can be bypassed simply,"
    },
    {
      "Time_Start": 1372.0,
      "Time_End": 1376.0,
      "Text": " fast forwarded by analysis environment."
    },
    {
      "Time_Start": 1376.0,
      "Time_End": 1382.0,
      "Text": " And it might not be that easy to actually delay"
    },
    {
      "Time_Start": 1382.0,
      "Time_End": 1385.0,
      "Text": " our code execution for a few minutes."
    },
    {
      "Time_Start": 1385.0,
      "Time_End": 1393.0,
      "Text": " And we can use sleep or empty delay execution function,"
    },
    {
      "Time_Start": 1393.0,
      "Time_End": 1399.0,
      "Text": " but it may both be hooked."
    },
    {
      "Time_Start": 1400.0,
      "Time_End": 1409.0,
      "Text": " And what we can do to avoid this detection"
    },
    {
      "Time_Start": 1409.0,
      "Time_End": 1412.0,
      "Text": " is to, for example, use getTickCount function,"
    },
    {
      "Time_Start": 1412.0,
      "Time_End": 1415.0,
      "Text": " which gives us time in processor ticks"
    },
    {
      "Time_Start": 1415.0,
      "Time_End": 1419.0,
      "Text": " or 100 nanoseconds intervals"
    },
    {
      "Time_Start": 1419.0,
      "Time_End": 1422.0,
      "Text": " from when the computer was started,"
    },
    {
      "Time_Start": 1422.0,
      "Time_End": 1424.0,
      "Text": " but this function also could be hooked,"
    },
    {
      "Time_Start": 1424.0,
      "Time_End": 1427.0,
      "Text": " but there is some cool thing,"
    },
    {
      "Time_Start": 1427.0,
      "Time_End": 1432.0,
      "Text": " which is kernel user shared data"
    },
    {
      "Time_Start": 1432.0,
      "Time_End": 1437.0,
      "Text": " and it's some read-only data available from a URL"
    },
    {
      "Time_Start": 1437.0,
      "Time_End": 1444.0,
      "Text": " and on specific offsets, it stores this tick count"
    },
    {
      "Time_Start": 1444.0,
      "Time_End": 1450.0,
      "Text": " and we can, for example, read the time from there."
    },
    {
      "Time_Start": 1450.0,
      "Time_End": 1452.0,
      "Text": " So for example, when we sleep our application"
    },
    {
      "Time_Start": 1452.0,
      "Time_End": 1456.0,
      "Text": " for a few minutes and then the sleep was fast forwarded,"
    },
    {
      "Time_Start": 1456.0,
      "Time_End": 1459.0,
      "Text": " we can use getTickCount or read the tick count"
    },
    {
      "Time_Start": 1459.0,
      "Time_End": 1462.0,
      "Text": " from kernel user shared data to validate"
    },
    {
      "Time_Start": 1462.0,
      "Time_End": 1469.0,
      "Text": " if the tick count is bigger than before sleep"
    },
    {
      "Time_Start": 1469.0,
      "Time_End": 1471.0,
      "Text": " for the specific value."
    },
    {
      "Time_Start": 1471.0,
      "Time_End": 1475.0,
      "Text": " And if not, if this analysis was fast forwarded,"
    },
    {
      "Time_Start": 1475.0,
      "Time_End": 1477.0,
      "Text": " our delay was fast forwarded,"
    },
    {
      "Time_Start": 1477.0,
      "Time_End": 1481.0,
      "Text": " we will get a discrepancy in tick count."
    },
    {
      "Time_Start": 1481.0,
      "Time_End": 1485.0,
      "Text": " So for us, it's an indicator that the sleeping function"
    },
    {
      "Time_Start": 1485.0,
      "Time_End": 1491.0,
      "Text": " was hooked and some analysis environment"
    },
    {
      "Time_Start": 1491.0,
      "Time_End": 1494.0,
      "Text": " fast forwarded our execution delay."
    },
    {
      "Time_Start": 1494.0,
      "Time_End": 1499.0,
      "Text": " So it's a good idea to terminate the application here."
    },
    {
      "Time_Start": 1499.0,
      "Time_End": 1501.0,
      "Text": " So that was a thing about sleeping"
    },
    {
      "Time_Start": 1501.0,
      "Time_End": 1505.0,
      "Text": " and now into function hooking and unhooking."
    },
    {
      "Time_Start": 1505.0,
      "Time_End": 1510.0,
      "Text": " So as I said in the before example,"
    },
    {
      "Time_Start": 1510.0,
      "Time_End": 1515.0,
      "Text": " crucial system functions may be hooked by EDRs"
    },
    {
      "Time_Start": 1515.0,
      "Time_End": 1519.0,
      "Text": " or antiviruses or any sandbox environments"
    },
    {
      "Time_Start": 1519.0,
      "Time_End": 1523.0,
      "Text": " to monitor and combat our malicious behavior."
    },
    {
      "Time_Start": 1523.0,
      "Time_End": 1528.0,
      "Text": " So for example, thread creation or process creation"
    },
    {
      "Time_Start": 1528.0,
      "Time_End": 1531.0,
      "Text": " or memory allocation functions can be hooked"
    },
    {
      "Time_Start": 1531.0,
      "Time_End": 1538.0,
      "Text": " to intercept and investigate actions"
    },
    {
      "Time_Start": 1538.0,
      "Time_End": 1542.0,
      "Text": " that our code is performing."
    },
    {
      "Time_Start": 1542.0,
      "Time_End": 1545.0,
      "Text": " So what can we do about it?"
    },
    {
      "Time_Start": 1545.0,
      "Time_End": 1548.0,
      "Text": " We can just find those hooks in memory"
    },
    {
      "Time_Start": 1548.0,
      "Time_End": 1552.0,
      "Text": " by loading specific functions in memory"
    },
    {
      "Time_Start": 1552.0,
      "Time_End": 1557.0,
      "Text": " and then comparing the opcodes with assembly"
    },
    {
      "Time_Start": 1557.0,
      "Time_End": 1559.0,
      "Text": " in the library on a disk."
    },
    {
      "Time_Start": 1559.0,
      "Time_End": 1562.0,
      "Text": " Because when the DLL was loaded from a disk"
    },
    {
      "Time_Start": 1562.0,
      "Time_End": 1566.0,
      "Text": " and modified by some EDR solution,"
    },
    {
      "Time_Start": 1566.0,
      "Time_End": 1569.0,
      "Text": " the first opcodes, first instructions"
    },
    {
      "Time_Start": 1569.0,
      "Time_End": 1572.0,
      "Text": " will be different than in the original library"
    },
    {
      "Time_Start": 1572.0,
      "Time_End": 1574.0,
      "Text": " because there probably will be some call"
    },
    {
      "Time_Start": 1574.0,
      "Time_End": 1578.0,
      "Text": " to external function located in, for example,"
    },
    {
      "Time_Start": 1578.0,
      "Time_End": 1580.0,
      "Text": " antivirus module."
    },
    {
      "Time_Start": 1580.0,
      "Time_End": 1585.0,
      "Text": " So we can compare the opcodes to find hooks"
    },
    {
      "Time_Start": 1585.0,
      "Time_End": 1587.0,
      "Text": " if there are any."
    },
    {
      "Time_Start": 1587.0,
      "Time_End": 1592.0,
      "Text": " We can unhook functions by overwriting"
    },
    {
      "Time_Start": 1592.0,
      "Time_End": 1595.0,
      "Text": " those opcodes with original code."
    },
    {
      "Time_Start": 1595.0,
      "Time_End": 1599.0,
      "Text": " So like restore the original assembly"
    },
    {
      "Time_Start": 1599.0,
      "Time_End": 1604.0,
      "Text": " and that way the functions will be unhooked"
    },
    {
      "Time_Start": 1604.0,
      "Time_End": 1607.0,
      "Text": " because they will be executed as normal."
    },
    {
      "Time_Start": 1613.0,
      "Time_End": 1618.0,
      "Text": " And we can try to completely bypass function hooks"
    },
    {
      "Time_Start": 1618.0,
      "Time_End": 1622.0,
      "Text": " by issuing syscalls directed to the kernel."
    },
    {
      "Time_Start": 1623.0,
      "Time_End": 1627.0,
      "Text": " So here is an example of createThread function execution."
    },
    {
      "Time_Start": 1627.0,
      "Time_End": 1631.0,
      "Text": " When we call createThread from kernel 32,"
    },
    {
      "Time_Start": 1631.0,
      "Time_End": 1635.0,
      "Text": " like in this trial code injection proof of concept,"
    },
    {
      "Time_Start": 1635.0,
      "Time_End": 1637.0,
      "Text": " several functions are called"
    },
    {
      "Time_Start": 1637.0,
      "Time_End": 1641.0,
      "Text": " and then antiCreateThreadExternal is called"
    },
    {
      "Time_Start": 1641.0,
      "Time_End": 1644.0,
      "Text": " and then this antiCreateThread function"
    },
    {
      "Time_Start": 1644.0,
      "Time_End": 1646.0,
      "Text": " is basically a wrapper to a syscall."
    },
    {
      "Time_Start": 1646.0,
      "Time_End": 1649.0,
      "Text": " And syscall works like this."
    },
    {
      "Time_Start": 1649.0,
      "Time_End": 1653.0,
      "Text": " Syscall ID is pushed to EIX register"
    },
    {
      "Time_Start": 1653.0,
      "Time_End": 1657.0,
      "Text": " and then the execution is switched to kernel mode"
    },
    {
      "Time_Start": 1657.0,
      "Time_End": 1659.0,
      "Text": " by the syscall instruction."
    },
    {
      "Time_Start": 1659.0,
      "Time_End": 1662.0,
      "Text": " And you can see on the process monitor excerpt here"
    },
    {
      "Time_Start": 1662.0,
      "Time_End": 1670.0,
      "Text": " that at some point execution is switched to kernel."
    },
    {
      "Time_Start": 1670.0,
      "Time_End": 1674.0,
      "Text": " So to bypass syscall function hooking,"
    },
    {
      "Time_Start": 1674.0,
      "Time_End": 1677.0,
      "Text": " we could just issue those syscalls"
    },
    {
      "Time_Start": 1677.0,
      "Time_End": 1679.0,
      "Text": " directed to the kernel."
    },
    {
      "Time_Start": 1683.0,
      "Time_End": 1687.0,
      "Text": " So for example, that's how I implemented it."
    },
    {
      "Time_Start": 1687.0,
      "Time_End": 1691.0,
      "Text": " We can write some simple assembly"
    },
    {
      "Time_Start": 1691.0,
      "Time_End": 1696.0,
      "Text": " to call the issue to syscall"
    },
    {
      "Time_Start": 1696.0,
      "Time_End": 1701.0,
      "Text": " and then call this assembly function"
    },
    {
      "Time_Start": 1701.0,
      "Time_End": 1705.0,
      "Text": " but as a pointer to create antiCreateThread function."
    },
    {
      "Time_Start": 1705.0,
      "Time_End": 1709.0,
      "Text": " So specific parameter will be passed to register"
    },
    {
      "Time_Start": 1709.0,
      "Time_End": 1710.0,
      "Text": " and to the stack."
    },
    {
      "Time_Start": 1710.0,
      "Time_End": 1717.0,
      "Text": " And then the function from antiDLL library won't be called"
    },
    {
      "Time_Start": 1717.0,
      "Time_End": 1721.0,
      "Text": " but we'll call the kernel directly"
    },
    {
      "Time_Start": 1721.0,
      "Time_End": 1725.0,
      "Text": " to, for example, allocate memory for us"
    },
    {
      "Time_Start": 1725.0,
      "Time_End": 1728.0,
      "Text": " or here create a thread in the process for us."
    },
    {
      "Time_Start": 1728.0,
      "Time_End": 1733.0,
      "Text": " So it's a good technique to bypass those function hooks."
    },
    {
      "Time_Start": 1736.0,
      "Time_End": 1740.0,
      "Text": " Yeah, in the previous part, we always created a new file"
    },
    {
      "Time_Start": 1740.0,
      "Time_End": 1744.0,
      "Text": " which really means that it actually has to force our victim"
    },
    {
      "Time_Start": 1744.0,
      "Time_End": 1746.0,
      "Text": " to use this file."
    },
    {
      "Time_Start": 1746.0,
      "Time_End": 1750.0,
      "Text": " And we can also make use of already existing file"
    },
    {
      "Time_Start": 1750.0,
      "Time_End": 1752.0,
      "Text": " of the target machine."
    },
    {
      "Time_Start": 1752.0,
      "Time_End": 1757.0,
      "Text": " So this is really focused on executable file"
    },
    {
      "Time_Start": 1757.0,
      "Time_End": 1760.0,
      "Text": " and we like to backdoor some portable executable file."
    },
    {
      "Time_Start": 1760.0,
      "Time_End": 1764.0,
      "Text": " And unless we are forced to use a specific binary"
    },
    {
      "Time_Start": 1764.0,
      "Time_End": 1766.0,
      "Text": " backdooring this file, there are some points"
    },
    {
      "Time_Start": 1766.0,
      "Time_End": 1768.0,
      "Text": " which actually should be kept in mind."
    },
    {
      "Time_Start": 1768.0,
      "Time_End": 1771.0,
      "Text": " There are, however, not required to be followed"
    },
    {
      "Time_Start": 1771.0,
      "Time_End": 1774.0,
      "Text": " but preferred because they will help reducing"
    },
    {
      "Time_Start": 1774.0,
      "Time_End": 1776.0,
      "Text": " the antivirus detection rate"
    },
    {
      "Time_Start": 1776.0,
      "Time_End": 1779.0,
      "Text": " and probably making the product more feasible."
    },
    {
      "Time_Start": 1779.0,
      "Time_End": 1784.0,
      "Text": " So first of all, is try to make a look at the file size."
    },
    {
      "Time_Start": 1784.0,
      "Time_End": 1787.0,
      "Text": " Smaller files are easier to transfer, of course"
    },
    {
      "Time_Start": 1787.0,
      "Time_End": 1792.0,
      "Text": " and usually it's easier to debug them in case of issues."
    },
    {
      "Time_Start": 1792.0,
      "Time_End": 1797.0,
      "Text": " And it's a good idea to backdoor a well-known product"
    },
    {
      "Time_Start": 1797.0,
      "Time_End": 1800.0,
      "Text": " for example, a program which actually our victim uses"
    },
    {
      "Time_Start": 1800.0,
      "Time_End": 1803.0,
      "Text": " and using this known portable executable file"
    },
    {
      "Time_Start": 1803.0,
      "Time_End": 1805.0,
      "Text": " is actually not required"
    },
    {
      "Time_Start": 1805.0,
      "Time_End": 1811.0,
      "Text": " but there are some chances that antivirus will be more inclined"
    },
    {
      "Time_Start": 1811.0,
      "Time_End": 1813.0,
      "Text": " to execute a known program."
    },
    {
      "Time_Start": 1813.0,
      "Time_End": 1819.0,
      "Text": " And it's always a good idea to use a C or C++ native binaries"
    },
    {
      "Time_Start": 1819.0,
      "Time_End": 1823.0,
      "Text": " and try to use the file that legitimate feature"
    },
    {
      "Time_Start": 1823.0,
      "Time_End": 1824.0,
      "Text": " is using a network."
    },
    {
      "Time_Start": 1824.0,
      "Time_End": 1828.0,
      "Text": " Because if we use, for example, a paint application"
    },
    {
      "Time_Start": 1828.0,
      "Time_End": 1831.0,
      "Text": " it probably won't be using network"
    },
    {
      "Time_Start": 1831.0,
      "Time_End": 1837.0,
      "Text": " and it's more likely to be detected by a blue team."
    },
    {
      "Time_Start": 1837.0,
      "Time_End": 1843.0,
      "Text": " So we won't be so easy cached."
    },
    {
      "Time_Start": 1843.0,
      "Time_End": 1847.0,
      "Text": " And the last thing is avoid using a files"
    },
    {
      "Time_Start": 1847.0,
      "Time_End": 1851.0,
      "Text": " that are not protected using a security features"
    },
    {
      "Time_Start": 1851.0,
      "Time_End": 1855.0,
      "Text": " such as ASLR or deep execution prevention."
    },
    {
      "Time_Start": 1855.0,
      "Time_End": 1860.0,
      "Text": " And let's go and verify that."
    },
    {
      "Time_Start": 1860.0,
      "Time_End": 1864.0,
      "Text": " So there are some techniques like ASLR"
    },
    {
      "Time_Start": 1864.0,
      "Time_End": 1866.0,
      "Text": " and deep execution prevention"
    },
    {
      "Time_Start": 1866.0,
      "Time_End": 1871.0,
      "Text": " which actually prevents us from hijacking our code"
    },
    {
      "Time_Start": 1871.0,
      "Time_End": 1875.0,
      "Text": " like for example, randomizing the memory"
    },
    {
      "Time_Start": 1875.0,
      "Time_End": 1880.0,
      "Text": " and preventing from running other code from memory."
    },
    {
      "Time_Start": 1880.0,
      "Time_End": 1885.0,
      "Text": " And there's an interesting script called getPsecurity"
    },
    {
      "Time_Start": 1885.0,
      "Time_End": 1888.0,
      "Text": " which actually gives you an idea"
    },
    {
      "Time_Start": 1888.0,
      "Time_End": 1890.0,
      "Text": " what the program has been"
    },
    {
      "Time_Start": 1890.0,
      "Time_End": 1894.0,
      "Text": " or what the features the program has been compiled with."
    },
    {
      "Time_Start": 1894.0,
      "Time_End": 1896.0,
      "Text": " And we can make a look, for example"
    },
    {
      "Time_Start": 1896.0,
      "Time_End": 1899.0,
      "Text": " we've had two different versions of a 7zip file"
    },
    {
      "Time_Start": 1899.0,
      "Time_End": 1902.0,
      "Text": " one of which consists of a depth protection"
    },
    {
      "Time_Start": 1902.0,
      "Time_End": 1903.0,
      "Text": " and one not."
    },
    {
      "Time_Start": 1903.0,
      "Time_End": 1906.0,
      "Text": " So probably the most we will be trusting"
    },
    {
      "Time_Start": 1906.0,
      "Time_End": 1908.0,
      "Text": " this one that did not have,"
    },
    {
      "Time_Start": 1908.0,
      "Time_End": 1912.0,
      "Text": " do not have this protection."
    },
    {
      "Time_Start": 1912.0,
      "Time_End": 1913.0,
      "Text": " Okay."
    },
    {
      "Time_Start": 1913.0,
      "Time_End": 1917.0,
      "Text": " And once we found our target"
    },
    {
      "Time_Start": 1917.0,
      "Time_End": 1920.0,
      "Text": " we probably would like to make some static analysis of it"
    },
    {
      "Time_Start": 1920.0,
      "Time_End": 1924.0,
      "Text": " and we will make use of in this case on a PuTTY file."
    },
    {
      "Time_Start": 1924.0,
      "Time_End": 1926.0,
      "Text": " So PuTTY is an interesting file"
    },
    {
      "Time_Start": 1926.0,
      "Time_End": 1928.0,
      "Text": " because it's a native C++ project."
    },
    {
      "Time_Start": 1928.0,
      "Time_End": 1931.0,
      "Text": " So which include, which uses a multiple libraries"
    },
    {
      "Time_Start": 1931.0,
      "Time_End": 1933.0,
      "Text": " and windows APIs."
    },
    {
      "Time_Start": 1933.0,
      "Time_End": 1936.0,
      "Text": " And it's also a network program"
    },
    {
      "Time_Start": 1936.0,
      "Time_End": 1939.0,
      "Text": " that use a network for a normal activity."
    },
    {
      "Time_Start": 1939.0,
      "Time_End": 1942.0,
      "Text": " So we probably won't be attracting so much attention"
    },
    {
      "Time_Start": 1942.0,
      "Time_End": 1944.0,
      "Text": " when it comes to the network monitoring."
    },
    {
      "Time_Start": 1944.0,
      "Time_End": 1949.0,
      "Text": " So the blue team won't probably be suspicious about this"
    },
    {
      "Time_Start": 1949.0,
      "Time_End": 1951.0,
      "Text": " and what we're gonna do"
    },
    {
      "Time_Start": 1951.0,
      "Time_End": 1955.0,
      "Text": " we're gonna actually inject our code."
    },
    {
      "Time_Start": 1955.0,
      "Time_End": 1958.0,
      "Text": " And there are two actually approaches"
    },
    {
      "Time_Start": 1958.0,
      "Time_End": 1961.0,
      "Text": " to this Portable Executable File Exploitation."
    },
    {
      "Time_Start": 1961.0,
      "Time_End": 1966.0,
      "Text": " One of which the main diverse is to add a new section"
    },
    {
      "Time_Start": 1966.0,
      "Time_End": 1967.0,
      "Text": " in the memory"
    },
    {
      "Time_Start": 1967.0,
      "Time_End": 1970.0,
      "Text": " or to find an available space for a share code."
    },
    {
      "Time_Start": 1970.0,
      "Time_End": 1972.0,
      "Text": " It's called, which is called a code cave."
    },
    {
      "Time_Start": 1972.0,
      "Time_End": 1974.0,
      "Text": " Then the flow is pretty the same."
    },
    {
      "Time_Start": 1974.0,
      "Time_End": 1976.0,
      "Text": " So we copy the help codes from the stack"
    },
    {
      "Time_Start": 1976.0,
      "Time_End": 1977.0,
      "Text": " at the beginning of the programs"
    },
    {
      "Time_Start": 1977.0,
      "Time_End": 1979.0,
      "Text": " then replace those instructions with our own up codes"
    },
    {
      "Time_Start": 1979.0,
      "Time_End": 1981.0,
      "Text": " to hijack the execution flow."
    },
    {
      "Time_Start": 1981.0,
      "Time_End": 1983.0,
      "Text": " Once we hijack the execution flow"
    },
    {
      "Time_Start": 1983.0,
      "Time_End": 1985.0,
      "Text": " we inject our shell code"
    },
    {
      "Time_Start": 1985.0,
      "Time_End": 1988.0,
      "Text": " and we set the registers back."
    },
    {
      "Time_Start": 1988.0,
      "Time_End": 1991.0,
      "Text": " So we will allow the normal execution flow"
    },
    {
      "Time_Start": 1991.0,
      "Time_End": 1993.0,
      "Text": " of the application."
    },
    {
      "Time_Start": 1993.0,
      "Time_End": 1998.0,
      "Text": " So the first one would be adding a new section."
    },
    {
      "Time_Start": 1998.0,
      "Time_End": 2002.0,
      "Text": " So we will be going to add a new section."
    },
    {
      "Time_Start": 2002.0,
      "Time_End": 2004.0,
      "Text": " In this case, I've added ZipCon section"
    },
    {
      "Time_Start": 2004.0,
      "Time_End": 2007.0,
      "Text": " and just to remember, just to remember"
    },
    {
      "Time_Start": 2007.0,
      "Time_End": 2009.0,
      "Text": " not only when you're using, for example"
    },
    {
      "Time_Start": 2009.0,
      "Time_End": 2012.0,
      "Text": " CFF Explorer, add a new section"
    },
    {
      "Time_Start": 2012.0,
      "Time_End": 2014.0,
      "Text": " with the empty data in it."
    },
    {
      "Time_Start": 2014.0,
      "Time_End": 2016.0,
      "Text": " In case you add only a header"
    },
    {
      "Time_Start": 2016.0,
      "Time_End": 2018.0,
      "Text": " you need to fill it, fill the section"
    },
    {
      "Time_Start": 2018.0,
      "Time_End": 2019.0,
      "Text": " before running the program"
    },
    {
      "Time_Start": 2019.0,
      "Time_End": 2021.0,
      "Text": " because it will probably crash."
    },
    {
      "Time_Start": 2021.0,
      "Time_End": 2024.0,
      "Text": " And once we do that"
    },
    {
      "Time_Start": 2024.0,
      "Time_End": 2029.0,
      "Text": " we need to change the flags on this section"
    },
    {
      "Time_Start": 2029.0,
      "Time_End": 2031.0,
      "Text": " in order to make it executable."
    },
    {
      "Time_Start": 2031.0,
      "Time_End": 2035.0,
      "Text": " So we can execute our code from the section."
    },
    {
      "Time_Start": 2035.0,
      "Time_End": 2037.0,
      "Text": " And that's what we did."
    },
    {
      "Time_Start": 2037.0,
      "Time_End": 2039.0,
      "Text": " We placed an empty section"
    },
    {
      "Time_Start": 2039.0,
      "Time_End": 2041.0,
      "Text": " which now has zero"
    },
    {
      "Time_Start": 2041.0,
      "Time_End": 2044.0,
      "Text": " and this one has a full permission"
    },
    {
      "Time_Start": 2044.0,
      "Time_End": 2047.0,
      "Text": " and we are ready to proceed."
    },
    {
      "Time_Start": 2047.0,
      "Time_End": 2050.0,
      "Text": " But actually proceeding is not so easy"
    },
    {
      "Time_Start": 2050.0,
      "Time_End": 2052.0,
      "Text": " because once we do that"
    },
    {
      "Time_Start": 2052.0,
      "Time_End": 2053.0,
      "Text": " probably Windows Defender"
    },
    {
      "Time_Start": 2053.0,
      "Time_End": 2056.0,
      "Text": " or maybe what kind of antivirus do you use"
    },
    {
      "Time_Start": 2056.0,
      "Time_End": 2059.0,
      "Text": " will probably at the moment eat this file"
    },
    {
      "Time_Start": 2059.0,
      "Time_End": 2061.0,
      "Text": " because even when adding an empty section"
    },
    {
      "Time_Start": 2061.0,
      "Time_End": 2063.0,
      "Text": " with a full permissions to an executable file"
    },
    {
      "Time_Start": 2063.0,
      "Time_End": 2065.0,
      "Text": " antivirus solution may consider this file"
    },
    {
      "Time_Start": 2065.0,
      "Time_End": 2067.0,
      "Text": " as suspicious."
    },
    {
      "Time_Start": 2067.0,
      "Time_End": 2069.0,
      "Text": " So Defender do that"
    },
    {
      "Time_Start": 2069.0,
      "Time_End": 2071.0,
      "Text": " and we have a problem."
    },
    {
      "Time_Start": 2071.0,
      "Time_End": 2074.0,
      "Text": " Let's try what VirusTotal says"
    },
    {
      "Time_Start": 2074.0,
      "Time_End": 2078.0,
      "Text": " and it says that there is relatively high score"
    },
    {
      "Time_Start": 2078.0,
      "Time_End": 2081.0,
      "Text": " and we literally didn't start it"
    },
    {
      "Time_Start": 2081.0,
      "Time_End": 2083.0,
      "Text": " even placing our shellcode"
    },
    {
      "Time_Start": 2083.0,
      "Time_End": 2085.0,
      "Text": " and the file is already executed."
    },
    {
      "Time_Start": 2085.0,
      "Time_End": 2087.0,
      "Text": " So maybe this is already cached."
    },
    {
      "Time_Start": 2087.0,
      "Time_End": 2089.0,
      "Text": " So maybe it's not a great idea"
    },
    {
      "Time_Start": 2089.0,
      "Time_End": 2091.0,
      "Text": " to follow this step."
    },
    {
      "Time_Start": 2091.0,
      "Time_End": 2092.0,
      "Text": " As a short summary"
    },
    {
      "Time_Start": 2092.0,
      "Time_End": 2095.0,
      "Text": " we can see pros and cons of this method."
    },
    {
      "Time_Start": 2095.0,
      "Time_End": 2098.0,
      "Text": " Of course, we can move forward with that"
    },
    {
      "Time_Start": 2098.0,
      "Time_End": 2101.0,
      "Text": " but the chances that we are going to"
    },
    {
      "Time_Start": 2101.0,
      "Time_End": 2103.0,
      "Text": " make the detection rate slower"
    },
    {
      "Time_Start": 2103.0,
      "Time_End": 2105.0,
      "Text": " are very unlikely"
    },
    {
      "Time_Start": 2105.0,
      "Time_End": 2109.0,
      "Text": " or not so high as the other methods."
    },
    {
      "Time_Start": 2109.0,
      "Time_End": 2111.0,
      "Text": " So the biggest problem is"
    },
    {
      "Time_Start": 2111.0,
      "Time_End": 2113.0,
      "Text": " that we don't need to worry about space"
    },
    {
      "Time_Start": 2113.0,
      "Time_End": 2115.0,
      "Text": " for our shellcode."
    },
    {
      "Time_Start": 2116.0,
      "Time_End": 2119.0,
      "Text": " So this is really useful."
    },
    {
      "Time_Start": 2119.0,
      "Time_End": 2122.0,
      "Text": " We can also place our own encoders"
    },
    {
      "Time_Start": 2122.0,
      "Time_End": 2124.0,
      "Text": " because there's plenty of space"
    },
    {
      "Time_Start": 2124.0,
      "Time_End": 2126.0,
      "Text": " but actually as we've seen before"
    },
    {
      "Time_Start": 2126.0,
      "Time_End": 2127.0,
      "Text": " adding a new section header"
    },
    {
      "Time_Start": 2127.0,
      "Time_End": 2129.0,
      "Text": " and assigning an execution flag"
    },
    {
      "Time_Start": 2129.0,
      "Time_End": 2132.0,
      "Text": " will most likely alert an antivirus solution"
    },
    {
      "Time_Start": 2132.0,
      "Time_End": 2135.0,
      "Text": " and we also increase the size of the file"
    },
    {
      "Time_Start": 2135.0,
      "Time_End": 2138.0,
      "Text": " not so much but still."
    },
    {
      "Time_Start": 2138.0,
      "Time_End": 2141.0,
      "Text": " There's a better solution."
    },
    {
      "Time_Start": 2141.0,
      "Time_End": 2145.0,
      "Text": " This is called a code cave."
    },
    {
      "Time_Start": 2145.0,
      "Time_End": 2147.0,
      "Text": " So what are the code caves?"
    },
    {
      "Time_Start": 2147.0,
      "Time_End": 2149.0,
      "Text": " Code caves are dead or empty blocks"
    },
    {
      "Time_Start": 2149.0,
      "Time_End": 2150.0,
      "Text": " in memory of a program"
    },
    {
      "Time_Start": 2150.0,
      "Time_End": 2153.0,
      "Text": " which can be used to inject our own code."
    },
    {
      "Time_Start": 2153.0,
      "Time_End": 2155.0,
      "Text": " So instead of creating a new section"
    },
    {
      "Time_Start": 2155.0,
      "Time_End": 2158.0,
      "Text": " we will make use of an existing one"
    },
    {
      "Time_Start": 2158.0,
      "Time_End": 2163.0,
      "Text": " and to find an existing one"
    },
    {
      "Time_Start": 2163.0,
      "Time_End": 2164.0,
      "Text": " in our memory"
    },
    {
      "Time_Start": 2164.0,
      "Time_End": 2166.0,
      "Text": " of course we want to do it by our hand."
    },
    {
      "Time_Start": 2166.0,
      "Time_End": 2167.0,
      "Text": " There are a couple of scripts"
    },
    {
      "Time_Start": 2167.0,
      "Time_End": 2169.0,
      "Text": " and tools to do that."
    },
    {
      "Time_Start": 2169.0,
      "Time_End": 2171.0,
      "Text": " I prefer using CaveMiner"
    },
    {
      "Time_Start": 2171.0,
      "Time_End": 2174.0,
      "Text": " so we can use the CaveMiner"
    },
    {
      "Time_Start": 2174.0,
      "Time_End": 2178.0,
      "Text": " to find shellcode in our file."
    },
    {
      "Time_Start": 2178.0,
      "Time_End": 2180.0,
      "Text": " CaveMiner is really interesting"
    },
    {
      "Time_Start": 2180.0,
      "Time_End": 2182.0,
      "Text": " because it also gives you an ability"
    },
    {
      "Time_Start": 2182.0,
      "Time_End": 2184.0,
      "Text": " to check whether the inappropriate flags"
    },
    {
      "Time_Start": 2184.0,
      "Time_End": 2187.0,
      "Text": " has been used in this file"
    },
    {
      "Time_Start": 2187.0,
      "Time_End": 2189.0,
      "Text": " and as we can see"
    },
    {
      "Time_Start": 2189.0,
      "Time_End": 2191.0,
      "Text": " the input only which we need to provide"
    },
    {
      "Time_Start": 2191.0,
      "Time_End": 2196.0,
      "Text": " is a desired size of a shellcode."
    },
    {
      "Time_Start": 2196.0,
      "Time_End": 2198.0,
      "Text": " We can go then once we find"
    },
    {
      "Time_Start": 2198.0,
      "Time_End": 2200.0,
      "Text": " an appropriate code cave"
    },
    {
      "Time_Start": 2200.0,
      "Time_End": 2204.0,
      "Text": " we need to check which section does it exist in"
    },
    {
      "Time_Start": 2204.0,
      "Time_End": 2205.0,
      "Text": " and we know there's a data section"
    },
    {
      "Time_Start": 2205.0,
      "Time_End": 2207.0,
      "Text": " we need to make it executable"
    },
    {
      "Time_Start": 2207.0,
      "Time_End": 2209.0,
      "Text": " in order to work"
    },
    {
      "Time_Start": 2209.0,
      "Time_End": 2212.0,
      "Text": " and once we do that"
    },
    {
      "Time_Start": 2212.0,
      "Time_End": 2215.0,
      "Text": " we probably would like to hide"
    },
    {
      "Time_Start": 2215.0,
      "Time_End": 2216.0,
      "Text": " behind the user action"
    },
    {
      "Time_Start": 2216.0,
      "Time_End": 2221.0,
      "Text": " because the way we want to run our code"
    },
    {
      "Time_Start": 2221.0,
      "Time_End": 2224.0,
      "Text": " is to hide the execution flow"
    },
    {
      "Time_Start": 2224.0,
      "Time_End": 2225.0,
      "Text": " straight after the user interaction"
    },
    {
      "Time_Start": 2225.0,
      "Time_End": 2228.0,
      "Text": " because it is not a suspicious action then"
    },
    {
      "Time_Start": 2228.0,
      "Time_End": 2231.0,
      "Text": " and we need to find some action"
    },
    {
      "Time_Start": 2231.0,
      "Time_End": 2232.0,
      "Text": " so in this example"
    },
    {
      "Time_Start": 2232.0,
      "Time_End": 2235.0,
      "Text": " we will probably use"
    },
    {
      "Time_Start": 2235.0,
      "Time_End": 2237.0,
      "Text": " the main feature of a PuTTY"
    },
    {
      "Time_Start": 2237.0,
      "Time_End": 2238.0,
      "Text": " which is clicking open button"
    },
    {
      "Time_Start": 2238.0,
      "Time_End": 2240.0,
      "Text": " and once we click open button"
    },
    {
      "Time_Start": 2240.0,
      "Time_End": 2242.0,
      "Text": " connecting to a legitimate server"
    },
    {
      "Time_Start": 2242.0,
      "Time_End": 2245.0,
      "Text": " we probably see the string login as."
    },
    {
      "Time_Start": 2245.0,
      "Time_End": 2247.0,
      "Text": " So the first step would be to look"
    },
    {
      "Time_Start": 2247.0,
      "Time_End": 2249.0,
      "Text": " for a test string references"
    },
    {
      "Time_Start": 2249.0,
      "Time_End": 2251.0,
      "Text": " in our PE file"
    },
    {
      "Time_Start": 2251.0,
      "Time_End": 2253.0,
      "Text": " then place a breakpoint there"
    },
    {
      "Time_Start": 2253.0,
      "Time_End": 2254.0,
      "Text": " because there may be a couple"
    },
    {
      "Time_Start": 2254.0,
      "Time_End": 2257.0,
      "Text": " of different strings in this file"
    },
    {
      "Time_Start": 2257.0,
      "Time_End": 2259.0,
      "Text": " good idea is to put a breakpoint"
    },
    {
      "Time_Start": 2259.0,
      "Time_End": 2263.0,
      "Text": " at each existing string reference"
    },
    {
      "Time_Start": 2263.0,
      "Time_End": 2264.0,
      "Text": " and then run the program"
    },
    {
      "Time_Start": 2264.0,
      "Time_End": 2267.0,
      "Text": " and verify if we do the desired action"
    },
    {
      "Time_Start": 2267.0,
      "Time_End": 2270.0,
      "Text": " and do we hit our breakpoint"
    },
    {
      "Time_Start": 2270.0,
      "Time_End": 2271.0,
      "Text": " and that's what we actually did"
    },
    {
      "Time_Start": 2271.0,
      "Time_End": 2273.0,
      "Text": " we hit the breakpoint"
    },
    {
      "Time_Start": 2273.0,
      "Time_End": 2276.0,
      "Text": " and this will be our injection"
    },
    {
      "Time_Start": 2276.0,
      "Time_End": 2279.0,
      "Text": " starting point of our injection"
    },
    {
      "Time_Start": 2279.0,
      "Time_End": 2281.0,
      "Text": " so we actually need to do"
    },
    {
      "Time_Start": 2281.0,
      "Time_End": 2283.0,
      "Text": " how much space do we need"
    },
    {
      "Time_Start": 2283.0,
      "Time_End": 2284.0,
      "Text": " for our shellcode"
    },
    {
      "Time_Start": 2284.0,
      "Time_End": 2287.0,
      "Text": " so let's generate our payload"
    },
    {
      "Time_Start": 2287.0,
      "Time_End": 2288.0,
      "Text": " and as we can see"
    },
    {
      "Time_Start": 2288.0,
      "Time_End": 2291.0,
      "Text": " we need as much as 324 bytes"
    },
    {
      "Time_Start": 2291.0,
      "Time_End": 2293.0,
      "Text": " for our shellcode"
    },
    {
      "Time_Start": 2293.0,
      "Time_End": 2295.0,
      "Text": " let's go back to a cave miner"
    },
    {
      "Time_Start": 2295.0,
      "Time_End": 2298.0,
      "Text": " we got a couple of"
    },
    {
      "Time_Start": 2298.0,
      "Time_End": 2300.0,
      "Text": " two different cave codes"
    },
    {
      "Time_Start": 2300.0,
      "Time_End": 2301.0,
      "Text": " let's lose the second one"
    },
    {
      "Time_Start": 2301.0,
      "Time_End": 2303.0,
      "Text": " change the appropriate flags"
    },
    {
      "Time_Start": 2303.0,
      "Time_End": 2306.0,
      "Text": " and we can proceed"
    },
    {
      "Time_Start": 2306.0,
      "Time_End": 2308.0,
      "Text": " as we can see"
    },
    {
      "Time_Start": 2308.0,
      "Time_End": 2310.0,
      "Text": " the cave looks pretty nice"
    },
    {
      "Time_Start": 2310.0,
      "Time_End": 2311.0,
      "Text": " it's empty"
    },
    {
      "Time_Start": 2311.0,
      "Time_End": 2313.0,
      "Text": " and it looks like a perfect place"
    },
    {
      "Time_Start": 2313.0,
      "Time_End": 2314.0,
      "Text": " for our shellcode"
    },
    {
      "Time_Start": 2314.0,
      "Time_End": 2316.0,
      "Text": " but it's always a good idea"
    },
    {
      "Time_Start": 2316.0,
      "Time_End": 2317.0,
      "Text": " to run a program"
    },
    {
      "Time_Start": 2317.0,
      "Time_End": 2318.0,
      "Text": " and verify whether"
    },
    {
      "Time_Start": 2318.0,
      "Time_End": 2319.0,
      "Text": " and it actually changes"
    },
    {
      "Time_Start": 2319.0,
      "Time_End": 2320.0,
      "Text": " during the program run"
    },
    {
      "Time_Start": 2320.0,
      "Time_End": 2322.0,
      "Text": " and it happened in this case"
    },
    {
      "Time_Start": 2322.0,
      "Time_End": 2323.0,
      "Text": " the program"
    },
    {
      "Time_Start": 2323.0,
      "Time_End": 2325.0,
      "Text": " the space get mangled"
    },
    {
      "Time_Start": 2325.0,
      "Time_End": 2326.0,
      "Text": " and some of the instructions"
    },
    {
      "Time_Start": 2326.0,
      "Time_End": 2327.0,
      "Text": " were changed"
    },
    {
      "Time_Start": 2327.0,
      "Time_End": 2328.0,
      "Text": " so we need to find"
    },
    {
      "Time_Start": 2328.0,
      "Time_End": 2329.0,
      "Text": " another code cave"
    },
    {
      "Time_Start": 2329.0,
      "Time_End": 2330.0,
      "Text": " which was relatively close"
    },
    {
      "Time_Start": 2330.0,
      "Time_End": 2334.0,
      "Text": " like 20 bytes further"
    },
    {
      "Time_Start": 2334.0,
      "Time_End": 2337.0,
      "Text": " so we will use this one"
    },
    {
      "Time_Start": 2338.0,
      "Time_End": 2340.0,
      "Text": " and we would like to"
    },
    {
      "Time_Start": 2340.0,
      "Time_End": 2342.0,
      "Text": " hijack the program execution flow"
    },
    {
      "Time_Start": 2342.0,
      "Time_End": 2344.0,
      "Text": " starting from this entry point"
    },
    {
      "Time_Start": 2344.0,
      "Time_End": 2345.0,
      "Text": " which we set previously"
    },
    {
      "Time_Start": 2345.0,
      "Time_End": 2346.0,
      "Text": " as a breakpoint"
    },
    {
      "Time_Start": 2346.0,
      "Time_End": 2348.0,
      "Text": " to this empty section"
    },
    {
      "Time_Start": 2348.0,
      "Time_End": 2350.0,
      "Text": " we've done that"
    },
    {
      "Time_Start": 2350.0,
      "Time_End": 2351.0,
      "Text": " and we can now"
    },
    {
      "Time_Start": 2351.0,
      "Time_End": 2352.0,
      "Text": " proceed to a placing"
    },
    {
      "Time_Start": 2352.0,
      "Time_End": 2353.0,
      "Text": " of our shellcode"
    },
    {
      "Time_Start": 2353.0,
      "Time_End": 2355.0,
      "Text": " in this particular code cave"
    },
    {
      "Time_Start": 2355.0,
      "Time_End": 2357.0,
      "Text": " which is really simple"
    },
    {
      "Time_Start": 2357.0,
      "Time_End": 2359.0,
      "Text": " we can use this piece of code"
    },
    {
      "Time_Start": 2359.0,
      "Time_End": 2360.0,
      "Text": " first we need to save the register"
    },
    {
      "Time_Start": 2360.0,
      "Time_End": 2361.0,
      "Text": " save the flags"
    },
    {
      "Time_Start": 2361.0,
      "Time_End": 2363.0,
      "Text": " then put our modified shellcode"
    },
    {
      "Time_Start": 2363.0,
      "Time_End": 2365.0,
      "Text": " I will talk about modified"
    },
    {
      "Time_Start": 2365.0,
      "Time_End": 2366.0,
      "Text": " in a second"
    },
    {
      "Time_Start": 2366.0,
      "Time_End": 2368.0,
      "Text": " then we need to restore the flags"
    },
    {
      "Time_Start": 2368.0,
      "Time_End": 2369.0,
      "Text": " restore the registers"
    },
    {
      "Time_Start": 2369.0,
      "Time_End": 2371.0,
      "Text": " and make a stack alignment"
    },
    {
      "Time_Start": 2371.0,
      "Time_End": 2373.0,
      "Text": " and that will be enough"
    },
    {
      "Time_Start": 2373.0,
      "Time_End": 2376.0,
      "Text": " and this little modification"
    },
    {
      "Time_Start": 2376.0,
      "Time_End": 2378.0,
      "Text": " which we need to do"
    },
    {
      "Time_Start": 2378.0,
      "Time_End": 2380.0,
      "Text": " is because due to the"
    },
    {
      "Time_Start": 2380.0,
      "Time_End": 2382.0,
      "Text": " our Metasploit payload"
    },
    {
      "Time_Start": 2382.0,
      "Time_End": 2384.0,
      "Text": " because at the end of the shellcode"
    },
    {
      "Time_Start": 2384.0,
      "Time_End": 2386.0,
      "Text": " we see there's an opcode"
    },
    {
      "Time_Start": 2386.0,
      "Time_End": 2387.0,
      "Text": " called call EBP"
    },
    {
      "Time_Start": 2387.0,
      "Time_End": 2389.0,
      "Text": " which actually terminates"
    },
    {
      "Time_Start": 2389.0,
      "Time_End": 2392.0,
      "Text": " the execution of the program"
    },
    {
      "Time_Start": 2392.0,
      "Time_End": 2394.0,
      "Text": " right after the shellcode is executed"
    },
    {
      "Time_Start": 2394.0,
      "Time_End": 2396.0,
      "Text": " we don't want the program"
    },
    {
      "Time_Start": 2396.0,
      "Time_End": 2397.0,
      "Text": " to terminate"
    },
    {
      "Time_Start": 2397.0,
      "Time_End": 2398.0,
      "Text": " once the shellcode is executed"
    },
    {
      "Time_Start": 2398.0,
      "Time_End": 2400.0,
      "Text": " so we would like to change that"
    },
    {
      "Time_Start": 2400.0,
      "Time_End": 2402.0,
      "Text": " to an opcode"
    },
    {
      "Time_Start": 2402.0,
      "Time_End": 2403.0,
      "Text": " no operation"
    },
    {
      "Time_Start": 2403.0,
      "Time_End": 2405.0,
      "Text": " and because the call EBP"
    },
    {
      "Time_Start": 2405.0,
      "Time_End": 2406.0,
      "Text": " is two bytes long"
    },
    {
      "Time_Start": 2406.0,
      "Time_End": 2407.0,
      "Text": " we actually need to"
    },
    {
      "Time_Start": 2407.0,
      "Time_End": 2409.0,
      "Text": " use two no operations"
    },
    {
      "Time_Start": 2409.0,
      "Time_End": 2410.0,
      "Text": " and inside of it"
    },
    {
      "Time_Start": 2410.0,
      "Time_End": 2413.0,
      "Text": " there's another place"
    },
    {
      "Time_Start": 2413.0,
      "Time_End": 2414.0,
      "Text": " we need to change to NOP"
    },
    {
      "Time_Start": 2414.0,
      "Time_End": 2416.0,
      "Text": " it's the EC ink"
    },
    {
      "Time_Start": 2416.0,
      "Time_End": 2418.0,
      "Text": " which actually is a feature"
    },
    {
      "Time_Start": 2418.0,
      "Time_End": 2422.0,
      "Text": " that once the program is running"
    },
    {
      "Time_Start": 2422.0,
      "Time_End": 2423.0,
      "Text": " the shellcode is running"
    },
    {
      "Time_Start": 2423.0,
      "Time_End": 2424.0,
      "Text": " it waits for the user input"
    },
    {
      "Time_Start": 2424.0,
      "Time_End": 2425.0,
      "Text": " we don't want to wait"
    },
    {
      "Time_Start": 2425.0,
      "Time_End": 2426.0,
      "Text": " for the user input"
    },
    {
      "Time_Start": 2426.0,
      "Time_End": 2428.0,
      "Text": " so we need to change"
    },
    {
      "Time_Start": 2428.0,
      "Time_End": 2430.0,
      "Text": " this EC ink"
    },
    {
      "Time_Start": 2430.0,
      "Time_End": 2433.0,
      "Text": " for NOP2"
    },
    {
      "Time_Start": 2433.0,
      "Time_End": 2436.0,
      "Text": " and once we place that"
    },
    {
      "Time_Start": 2436.0,
      "Time_End": 2437.0,
      "Text": " inside of the code cave"
    },
    {
      "Time_Start": 2437.0,
      "Time_End": 2438.0,
      "Text": " we can run the program"
    },
    {
      "Time_Start": 2438.0,
      "Time_End": 2439.0,
      "Text": " and we can see"
    },
    {
      "Time_Start": 2439.0,
      "Time_End": 2441.0,
      "Text": " there's a shell coming to us"
    },
    {
      "Time_Start": 2441.0,
      "Time_End": 2442.0,
      "Text": " lucky us"
    },
    {
      "Time_Start": 2442.0,
      "Time_End": 2444.0,
      "Text": " and see whether"
    },
    {
      "Time_Start": 2444.0,
      "Time_End": 2448.0,
      "Text": " it actually was usable"
    },
    {
      "Time_Start": 2448.0,
      "Time_End": 2449.0,
      "Text": " in this case"
    },
    {
      "Time_Start": 2449.0,
      "Time_End": 2452.0,
      "Text": " and well"
    },
    {
      "Time_Start": 2452.0,
      "Time_End": 2455.0,
      "Text": " it actually is not the perfect one"
    },
    {
      "Time_Start": 2455.0,
      "Time_End": 2458.0,
      "Text": " it's still high detection rate"
    },
    {
      "Time_Start": 2458.0,
      "Time_End": 2460.0,
      "Text": " why detection rate is so high?"
    },
    {
      "Time_Start": 2460.0,
      "Time_End": 2461.0,
      "Text": " maybe because we used"
    },
    {
      "Time_Start": 2461.0,
      "Time_End": 2463.0,
      "Text": " a raw shellcode"
    },
    {
      "Time_Start": 2463.0,
      "Time_End": 2466.0,
      "Text": " from Metapreter"
    },
    {
      "Time_Start": 2466.0,
      "Time_End": 2467.0,
      "Text": " so we probably"
    },
    {
      "Time_Start": 2467.0,
      "Time_End": 2468.0,
      "Text": " what we're gonna do"
    },
    {
      "Time_Start": 2468.0,
      "Time_End": 2470.0,
      "Text": " we're gonna use the method"
    },
    {
      "Time_Start": 2470.0,
      "Time_End": 2472.0,
      "Text": " previously mentioned by Patrick"
    },
    {
      "Time_Start": 2472.0,
      "Time_End": 2474.0,
      "Text": " we use XOR encryption"
    },
    {
      "Time_Start": 2474.0,
      "Time_End": 2476.0,
      "Text": " nobody and no solution"
    },
    {
      "Time_Start": 2476.0,
      "Time_End": 2478.0,
      "Text": " will try to break our code"
    },
    {
      "Time_Start": 2479.0,
      "Time_End": 2481.0,
      "Text": " our encryption at this point"
    },
    {
      "Time_Start": 2481.0,
      "Time_End": 2482.0,
      "Text": " because it's not"
    },
    {
      "Time_Start": 2482.0,
      "Time_End": 2488.0,
      "Text": " what is going in the memory"
    },
    {
      "Time_Start": 2488.0,
      "Time_End": 2491.0,
      "Text": " and we will like to"
    },
    {
      "Time_Start": 2491.0,
      "Time_End": 2493.0,
      "Text": " encrypt that"
    },
    {
      "Time_Start": 2493.0,
      "Time_End": 2495.0,
      "Text": " and the shellcode"
    },
    {
      "Time_Start": 2495.0,
      "Time_End": 2496.0,
      "Text": " in the code cave"
    },
    {
      "Time_Start": 2496.0,
      "Time_End": 2497.0,
      "Text": " will look pretty the same"
    },
    {
      "Time_Start": 2497.0,
      "Time_End": 2499.0,
      "Text": " but just before the shellcode"
    },
    {
      "Time_Start": 2499.0,
      "Time_End": 2500.0,
      "Text": " we need to place"
    },
    {
      "Time_Start": 2500.0,
      "Time_End": 2502.0,
      "Text": " our encoder and decoder"
    },
    {
      "Time_Start": 2502.0,
      "Time_End": 2504.0,
      "Text": " which will decode"
    },
    {
      "Time_Start": 2504.0,
      "Time_End": 2507.0,
      "Text": " our shellcode"
    },
    {
      "Time_Start": 2507.0,
      "Time_End": 2508.0,
      "Text": " to avoid static analysis"
    },
    {
      "Time_Start": 2508.0,
      "Time_End": 2510.0,
      "Text": " and decoder is right there"
    },
    {
      "Time_Start": 2510.0,
      "Time_End": 2512.0,
      "Text": " decoder is relatively simple"
    },
    {
      "Time_Start": 2512.0,
      "Time_End": 2513.0,
      "Text": " because first we need to place"
    },
    {
      "Time_Start": 2513.0,
      "Time_End": 2514.0,
      "Text": " shellcode start address"
    },
    {
      "Time_Start": 2514.0,
      "Time_End": 2516.0,
      "Text": " in a EBX register"
    },
    {
      "Time_Start": 2516.0,
      "Time_End": 2518.0,
      "Text": " then we would like to XOR"
    },
    {
      "Time_Start": 2518.0,
      "Time_End": 2520.0,
      "Text": " the content of the EBX register"
    },
    {
      "Time_Start": 2520.0,
      "Time_End": 2522.0,
      "Text": " using our own key"
    },
    {
      "Time_Start": 2522.0,
      "Time_End": 2524.0,
      "Text": " then increase the EBX"
    },
    {
      "Time_Start": 2524.0,
      "Time_End": 2525.0,
      "Text": " and check whether"
    },
    {
      "Time_Start": 2525.0,
      "Time_End": 2526.0,
      "Text": " we already reached"
    },
    {
      "Time_Start": 2526.0,
      "Time_End": 2528.0,
      "Text": " the last address of the shellcode"
    },
    {
      "Time_Start": 2528.0,
      "Time_End": 2529.0,
      "Text": " and if not"
    },
    {
      "Time_Start": 2529.0,
      "Time_End": 2531.0,
      "Text": " jump back to our XOR command"
    },
    {
      "Time_Start": 2531.0,
      "Time_End": 2532.0,
      "Text": " until we reach the end"
    },
    {
      "Time_Start": 2532.0,
      "Time_End": 2533.0,
      "Text": " of the shellcode"
    },
    {
      "Time_Start": 2533.0,
      "Time_End": 2536.0,
      "Text": " and was it a success?"
    },
    {
      "Time_Start": 2536.0,
      "Time_End": 2537.0,
      "Text": " well, as we look"
    },
    {
      "Time_Start": 2537.0,
      "Time_End": 2539.0,
      "Text": " we can place a breakpoint"
    },
    {
      "Time_Start": 2539.0,
      "Time_End": 2540.0,
      "Text": " just in the end of the decoder"
    },
    {
      "Time_Start": 2540.0,
      "Time_End": 2542.0,
      "Text": " and as we can see"
    },
    {
      "Time_Start": 2542.0,
      "Time_End": 2543.0,
      "Text": " the rest of the shellcode"
    },
    {
      "Time_Start": 2543.0,
      "Time_End": 2547.0,
      "Text": " has been changed"
    },
    {
      "Time_Start": 2547.0,
      "Time_End": 2549.0,
      "Text": " we can now save this file"
    },
    {
      "Time_Start": 2549.0,
      "Time_End": 2550.0,
      "Text": " as it is"
    },
    {
      "Time_Start": 2550.0,
      "Time_End": 2551.0,
      "Text": " because encoder already"
    },
    {
      "Time_Start": 2551.0,
      "Time_End": 2552.0,
      "Text": " encoded our payload"
    },
    {
      "Time_Start": 2552.0,
      "Time_End": 2554.0,
      "Text": " and once we run it again"
    },
    {
      "Time_Start": 2554.0,
      "Time_End": 2555.0,
      "Text": " it will work"
    },
    {
      "Time_Start": 2555.0,
      "Time_End": 2557.0,
      "Text": " and the detection rate"
    },
    {
      "Time_Start": 2557.0,
      "Time_End": 2559.0,
      "Text": " is relatively slow"
    },
    {
      "Time_Start": 2559.0,
      "Time_End": 2560.0,
      "Text": " we managed to get five"
    },
    {
      "Time_Start": 2560.0,
      "Time_End": 2562.0,
      "Text": " and a virus total"
    },
    {
      "Time_Start": 2562.0,
      "Time_End": 2564.0,
      "Text": " so it's a good starting point"
    },
    {
      "Time_Start": 2564.0,
      "Time_End": 2565.0,
      "Text": " there are a couple more options"
    },
    {
      "Time_Start": 2565.0,
      "Time_End": 2567.0,
      "Text": " to make it really low"
    },
    {
      "Time_Start": 2567.0,
      "Time_End": 2568.0,
      "Text": " for example"
    },
    {
      "Time_Start": 2568.0,
      "Time_End": 2570.0,
      "Text": " we can chunk our shellcode"
    },
    {
      "Time_Start": 2570.0,
      "Time_End": 2571.0,
      "Text": " into multiple code caves"
    },
    {
      "Time_Start": 2571.0,
      "Time_End": 2573.0,
      "Text": " so it will be even harder"
    },
    {
      "Time_Start": 2573.0,
      "Time_End": 2575.0,
      "Text": " to do static analysis"
    },
    {
      "Time_Start": 2575.0,
      "Time_End": 2577.0,
      "Text": " for antivirus solutions"
    },
    {
      "Time_Start": 2577.0,
      "Time_End": 2578.0,
      "Text": " but this is a story"
    },
    {
      "Time_Start": 2578.0,
      "Time_End": 2580.0,
      "Text": " for a completely new presentation"
    },
    {
      "Time_Start": 2580.0,
      "Time_End": 2582.0,
      "Text": " and we think we can"
    },
    {
      "Time_Start": 2582.0,
      "Time_End": 2584.0,
      "Text": " go to the last section"
    },
    {
      "Time_Start": 2584.0,
      "Time_End": 2585.0,
      "Text": " which is hiding imports"
    },
    {
      "Time_Start": 2585.0,
      "Time_End": 2588.0,
      "Text": " by Patrick"
    },
    {
      "Time_Start": 2588.0,
      "Time_End": 2590.0,
      "Text": " Patrick, microphone"
    },
    {
      "Time_Start": 2590.0,
      "Time_End": 2592.0,
      "Text": " you have a muted microphone"
    },
    {
      "Time_Start": 2592.0,
      "Time_End": 2593.0,
      "Text": " thanks"
    },
    {
      "Time_Start": 2593.0,
      "Time_End": 2594.0,
      "Text": " so we are running out of time"
    },
    {
      "Time_Start": 2594.0,
      "Time_End": 2596.0,
      "Text": " so let's quickly discuss"
    },
    {
      "Time_Start": 2596.0,
      "Time_End": 2598.0,
      "Text": " this import table"
    },
    {
      "Time_Start": 2598.0,
      "Time_End": 2600.0,
      "Text": " and hiding function from there"
    },
    {
      "Time_Start": 2600.0,
      "Time_End": 2601.0,
      "Text": " so when we compile"
    },
    {
      "Time_Start": 2601.0,
      "Time_End": 2603.0,
      "Text": " a Windows executable"
    },
    {
      "Time_Start": 2603.0,
      "Time_End": 2605.0,
      "Text": " and we are using some API functions"
    },
    {
      "Time_Start": 2605.0,
      "Time_End": 2608.0,
      "Text": " or any functions from external libraries"
    },
    {
      "Time_Start": 2608.0,
      "Time_End": 2610.0,
      "Text": " the information is placed"
    },
    {
      "Time_Start": 2610.0,
      "Time_End": 2612.0,
      "Text": " in import table of the executable"
    },
    {
      "Time_Start": 2612.0,
      "Time_End": 2615.0,
      "Text": " and one simple thing"
    },
    {
      "Time_Start": 2615.0,
      "Time_End": 2617.0,
      "Text": " to bypass this"
    },
    {
      "Time_Start": 2617.0,
      "Time_End": 2619.0,
      "Text": " is to load the functions"
    },
    {
      "Time_Start": 2619.0,
      "Time_End": 2621.0,
      "Text": " dynamically during runtime"
    },
    {
      "Time_Start": 2621.0,
      "Time_End": 2623.0,
      "Text": " using get process address"
    },
    {
      "Time_Start": 2623.0,
      "Time_End": 2624.0,
      "Text": " get model handle"
    },
    {
      "Time_Start": 2624.0,
      "Time_End": 2626.0,
      "Text": " or load library"
    },
    {
      "Time_Start": 2626.0,
      "Time_End": 2628.0,
      "Text": " so we can hide"
    },
    {
      "Time_Start": 2628.0,
      "Time_End": 2630.0,
      "Text": " those sensitive functions"
    },
    {
      "Time_Start": 2630.0,
      "Time_End": 2631.0,
      "Text": " like create thread"
    },
    {
      "Time_Start": 2631.0,
      "Time_End": 2632.0,
      "Text": " create process"
    },
    {
      "Time_Start": 2632.0,
      "Time_End": 2633.0,
      "Text": " allocate memory"
    },
    {
      "Time_Start": 2633.0,
      "Time_End": 2635.0,
      "Text": " or whatever"
    },
    {
      "Time_Start": 2635.0,
      "Time_End": 2637.0,
      "Text": " so only"
    },
    {
      "Time_Start": 2637.0,
      "Time_End": 2639.0,
      "Text": " get process address function"
    },
    {
      "Time_Start": 2639.0,
      "Time_End": 2640.0,
      "Text": " is visible in the import table"
    },
    {
      "Time_Start": 2640.0,
      "Time_End": 2642.0,
      "Text": " but those"
    },
    {
      "Time_Start": 2642.0,
      "Time_End": 2643.0,
      "Text": " library loading"
    },
    {
      "Time_Start": 2643.0,
      "Time_End": 2645.0,
      "Text": " and process locating functions"
    },
    {
      "Time_Start": 2645.0,
      "Time_End": 2647.0,
      "Text": " are also"
    },
    {
      "Time_Start": 2647.0,
      "Time_End": 2649.0,
      "Text": " an indicator of"
    },
    {
      "Time_Start": 2649.0,
      "Time_End": 2650.0,
      "Text": " some malware"
    },
    {
      "Time_Start": 2650.0,
      "Time_End": 2652.0,
      "Text": " especially packers"
    },
    {
      "Time_Start": 2652.0,
      "Time_End": 2654.0,
      "Text": " like UPX"
    },
    {
      "Time_Start": 2654.0,
      "Time_End": 2656.0,
      "Text": " use those functions often"
    },
    {
      "Time_Start": 2656.0,
      "Time_End": 2658.0,
      "Text": " so we can take some measures"
    },
    {
      "Time_Start": 2658.0,
      "Time_End": 2661.0,
      "Text": " to hide those imports too"
    },
    {
      "Time_Start": 2661.0,
      "Time_End": 2663.0,
      "Text": " and to do this"
    },
    {
      "Time_Start": 2663.0,
      "Time_End": 2665.0,
      "Text": " we can use the algorithm"
    },
    {
      "Time_Start": 2665.0,
      "Time_End": 2667.0,
      "Text": " used by shellcodes"
    },
    {
      "Time_Start": 2667.0,
      "Time_End": 2668.0,
      "Text": " so we are locating"
    },
    {
      "Time_Start": 2668.0,
      "Time_End": 2670.0,
      "Text": " process environment block"
    },
    {
      "Time_Start": 2670.0,
      "Time_End": 2671.0,
      "Text": " in memory"
    },
    {
      "Time_Start": 2671.0,
      "Time_End": 2673.0,
      "Text": " and then finding loader data"
    },
    {
      "Time_Start": 2673.0,
      "Time_End": 2674.0,
      "Text": " and modules"
    },
    {
      "Time_Start": 2674.0,
      "Time_End": 2676.0,
      "Text": " and kernel32 module"
    },
    {
      "Time_Start": 2676.0,
      "Time_End": 2679.0,
      "Text": " and browse for function addresses"
    },
    {
      "Time_Start": 2679.0,
      "Time_End": 2681.0,
      "Text": " so"
    },
    {
      "Time_Start": 2681.0,
      "Time_End": 2683.0,
      "Text": " it's quite"
    },
    {
      "Time_Start": 2683.0,
      "Time_End": 2685.0,
      "Text": " long code snippet here"
    },
    {
      "Time_Start": 2685.0,
      "Time_End": 2687.0,
      "Text": " so"
    },
    {
      "Time_Start": 2687.0,
      "Time_End": 2688.0,
      "Text": " to briefly show"
    },
    {
      "Time_Start": 2688.0,
      "Time_End": 2690.0,
      "Text": " what's going on"
    },
    {
      "Time_Start": 2690.0,
      "Time_End": 2691.0,
      "Text": " in the debugger we can see"
    },
    {
      "Time_Start": 2691.0,
      "Time_End": 2692.0,
      "Text": " process environment block"
    },
    {
      "Time_Start": 2692.0,
      "Time_End": 2694.0,
      "Text": " and"
    },
    {
      "Time_Start": 2694.0,
      "Time_End": 2696.0,
      "Text": " among other things"
    },
    {
      "Time_Start": 2696.0,
      "Time_End": 2697.0,
      "Text": " there are"
    },
    {
      "Time_Start": 2697.0,
      "Time_End": 2699.0,
      "Text": " there is loader data"
    },
    {
      "Time_Start": 2699.0,
      "Time_End": 2701.0,
      "Text": " and information about"
    },
    {
      "Time_Start": 2701.0,
      "Time_End": 2702.0,
      "Text": " loaded modules"
    },
    {
      "Time_Start": 2702.0,
      "Time_End": 2703.0,
      "Text": " so we can locate"
    },
    {
      "Time_Start": 2703.0,
      "Time_End": 2705.0,
      "Text": " kernel32 address in memory"
    },
    {
      "Time_Start": 2705.0,
      "Time_End": 2707.0,
      "Text": " and then find"
    },
    {
      "Time_Start": 2707.0,
      "Time_End": 2709.0,
      "Text": " in its export table"
    },
    {
      "Time_Start": 2709.0,
      "Time_End": 2711.0,
      "Text": " get process address function"
    },
    {
      "Time_Start": 2711.0,
      "Time_End": 2713.0,
      "Text": " and any other functions"
    },
    {
      "Time_Start": 2713.0,
      "Time_End": 2715.0,
      "Text": " and we then can basically"
    },
    {
      "Time_Start": 2715.0,
      "Time_End": 2717.0,
      "Text": " load any function"
    },
    {
      "Time_Start": 2717.0,
      "Time_End": 2719.0,
      "Text": " from memory"
    },
    {
      "Time_Start": 2719.0,
      "Time_End": 2720.0,
      "Text": " and that's why"
    },
    {
      "Time_Start": 2720.0,
      "Time_End": 2721.0,
      "Text": " nothing is visible"
    },
    {
      "Time_Start": 2721.0,
      "Time_End": 2723.0,
      "Text": " in the import table"
    },
    {
      "Time_Start": 2725.0,
      "Time_End": 2727.0,
      "Text": " and another thing"
    },
    {
      "Time_Start": 2727.0,
      "Time_End": 2729.0,
      "Text": " is API hashing"
    },
    {
      "Time_Start": 2729.0,
      "Time_End": 2730.0,
      "Text": " so for example"
    },
    {
      "Time_Start": 2730.0,
      "Time_End": 2732.0,
      "Text": " if we don't want to use"
    },
    {
      "Time_Start": 2732.0,
      "Time_End": 2733.0,
      "Text": " function names"
    },
    {
      "Time_Start": 2733.0,
      "Time_End": 2735.0,
      "Text": " in plain strings"
    },
    {
      "Time_Start": 2735.0,
      "Time_End": 2736.0,
      "Text": " in executable"
    },
    {
      "Time_Start": 2736.0,
      "Time_End": 2737.0,
      "Text": " which are then"
    },
    {
      "Time_Start": 2737.0,
      "Time_End": 2739.0,
      "Text": " located in"
    },
    {
      "Time_Start": 2739.0,
      "Time_End": 2740.0,
      "Text": " memory"
    },
    {
      "Time_Start": 2740.0,
      "Time_End": 2741.0,
      "Text": " we can use"
    },
    {
      "Time_Start": 2741.0,
      "Time_End": 2742.0,
      "Text": " hashes of those names"
    },
    {
      "Time_Start": 2742.0,
      "Time_End": 2743.0,
      "Text": " so for example"
    },
    {
      "Time_Start": 2743.0,
      "Time_End": 2744.0,
      "Text": " we can use"
    },
    {
      "Time_Start": 2744.0,
      "Time_End": 2746.0,
      "Text": " djb2 simple hash"
    },
    {
      "Time_Start": 2746.0,
      "Time_End": 2747.0,
      "Text": " function"
    },
    {
      "Time_Start": 2747.0,
      "Time_End": 2748.0,
      "Text": " and pre-calculate"
    },
    {
      "Time_Start": 2748.0,
      "Time_End": 2749.0,
      "Text": " hashes of function names"
    },
    {
      "Time_Start": 2749.0,
      "Time_End": 2750.0,
      "Text": " and then"
    },
    {
      "Time_Start": 2750.0,
      "Time_End": 2752.0,
      "Text": " just browse the"
    },
    {
      "Time_Start": 2752.0,
      "Time_End": 2753.0,
      "Text": " exports of library"
    },
    {
      "Time_Start": 2753.0,
      "Time_End": 2755.0,
      "Text": " and find"
    },
    {
      "Time_Start": 2755.0,
      "Time_End": 2756.0,
      "Text": " and find names"
    },
    {
      "Time_Start": 2756.0,
      "Time_End": 2757.0,
      "Text": " hash those names"
    },
    {
      "Time_Start": 2757.0,
      "Time_End": 2758.0,
      "Text": " and compare hashes"
    },
    {
      "Time_Start": 2758.0,
      "Time_End": 2759.0,
      "Text": " with our functions"
    },
    {
      "Time_Start": 2759.0,
      "Time_End": 2760.0,
      "Text": " and that's how we can"
    },
    {
      "Time_Start": 2760.0,
      "Time_End": 2761.0,
      "Text": " locate needed functions"
    },
    {
      "Time_Start": 2761.0,
      "Time_End": 2763.0,
      "Text": " and"
    },
    {
      "Time_Start": 2763.0,
      "Time_End": 2764.0,
      "Text": " during static analysis"
    },
    {
      "Time_Start": 2764.0,
      "Time_End": 2766.0,
      "Text": " an analyst won't see"
    },
    {
      "Time_Start": 2766.0,
      "Time_End": 2767.0,
      "Text": " those function names"
    },
    {
      "Time_Start": 2767.0,
      "Time_End": 2768.0,
      "Text": " and will need to"
    },
    {
      "Time_Start": 2768.0,
      "Time_End": 2769.0,
      "Text": " run the executable"
    },
    {
      "Time_Start": 2769.0,
      "Time_End": 2770.0,
      "Text": " to actually find out"
    },
    {
      "Time_Start": 2770.0,
      "Time_End": 2772.0,
      "Text": " what's"
    },
    {
      "Time_Start": 2772.0,
      "Time_End": 2774.0,
      "Text": " what functions are used"
    },
    {
      "Time_Start": 2774.0,
      "Time_End": 2776.0,
      "Text": " or just calculate"
    },
    {
      "Time_Start": 2776.0,
      "Time_End": 2777.0,
      "Text": " those hashes"
    },
    {
      "Time_Start": 2777.0,
      "Time_End": 2778.0,
      "Text": " so it's"
    },
    {
      "Time_Start": 2778.0,
      "Time_End": 2779.0,
      "Text": " one of many"
    },
    {
      "Time_Start": 2779.0,
      "Time_End": 2780.0,
      "Text": " many ways"
    },
    {
      "Time_Start": 2780.0,
      "Time_End": 2781.0,
      "Text": " and ideas"
    },
    {
      "Time_Start": 2781.0,
      "Time_End": 2782.0,
      "Text": " to obfuscate"
    },
    {
      "Time_Start": 2782.0,
      "Time_End": 2783.0,
      "Text": " the code"
    },
    {
      "Time_Start": 2783.0,
      "Time_End": 2785.0,
      "Text": " so"
    },
    {
      "Time_Start": 2785.0,
      "Time_End": 2787.0,
      "Text": " that's it"
    },
    {
      "Time_Start": 2787.0,
      "Time_End": 2788.0,
      "Text": " you can find a lot more"
    },
    {
      "Time_Start": 2788.0,
      "Time_End": 2789.0,
      "Text": " of samples"
    },
    {
      "Time_Start": 2789.0,
      "Time_End": 2790.0,
      "Text": " on my blog"
    },
    {
      "Time_Start": 2790.0,
      "Time_End": 2791.0,
      "Text": " and I'm"
    },
    {
      "Time_Start": 2791.0,
      "Time_End": 2792.0,
      "Text": " trying to"
    },
    {
      "Time_Start": 2792.0,
      "Time_End": 2793.0,
      "Text": " regularly post"
    },
    {
      "Time_Start": 2793.0,
      "Time_End": 2794.0,
      "Text": " some new articles"
    },
    {
      "Time_Start": 2794.0,
      "Time_End": 2795.0,
      "Text": " regarding that"
    },
    {
      "Time_Start": 2795.0,
      "Time_End": 2796.0,
      "Text": " I hope you found"
    },
    {
      "Time_Start": 2796.0,
      "Time_End": 2797.0,
      "Text": " this interesting"
    },
    {
      "Time_Start": 2797.0,
      "Time_End": 2799.0,
      "Text": " and"
    },
    {
      "Time_Start": 2799.0,
      "Time_End": 2800.0,
      "Text": " maybe"
    },
    {
      "Time_Start": 2800.0,
      "Time_End": 2801.0,
      "Text": " someone would be"
    },
    {
      "Time_Start": 2801.0,
      "Time_End": 2802.0,
      "Text": " interested in some"
    },
    {
      "Time_Start": 2802.0,
      "Time_End": 2803.0,
      "Text": " longer workshop"
    },
    {
      "Time_Start": 2803.0,
      "Time_End": 2804.0,
      "Text": " because it's"
    },
    {
      "Time_Start": 2804.0,
      "Time_End": 2805.0,
      "Text": " there is a material"
    },
    {
      "Time_Start": 2805.0,
      "Time_End": 2806.0,
      "Text": " for I think"
    },
    {
      "Time_Start": 2806.0,
      "Time_End": 2808.0,
      "Text": " two or three days"
    },
    {
      "Time_Start": 2808.0,
      "Time_End": 2809.0,
      "Text": " workshop"
    },
    {
      "Time_Start": 2809.0,
      "Time_End": 2810.0,
      "Text": " not for a"
    },
    {
      "Time_Start": 2810.0,
      "Time_End": 2811.0,
      "Text": " short presentation"
    },
    {
      "Time_Start": 2811.0,
      "Time_End": 2812.0,
      "Text": " so anyway"
    },
    {
      "Time_Start": 2812.0,
      "Time_End": 2813.0,
      "Text": " we try to"
    },
    {
      "Time_Start": 2815.0,
      "Time_End": 2816.0,
      "Text": " we hope you enjoy"
    },
    {
      "Time_Start": 2816.0,
      "Time_End": 2817.0,
      "Text": " the rest of"
    },
    {
      "Time_Start": 2817.0,
      "Time_End": 2819.0,
      "Text": " the rest of the conference"
    },
    {
      "Time_Start": 2819.0,
      "Time_End": 2820.0,
      "Text": " and I think"
    },
    {
      "Time_Start": 2822.0,
      "Time_End": 2823.0,
      "Text": " and I think"
    },
    {
      "Time_Start": 2823.0,
      "Time_End": 2824.0,
      "Text": " thank you for"
    },
    {
      "Time_Start": 2824.0,
      "Time_End": 2825.0,
      "Text": " for watching us"
    },
    {
      "Time_Start": 2826.0,
      "Time_End": 2827.0,
      "Text": " bye"
    }
  ]
}