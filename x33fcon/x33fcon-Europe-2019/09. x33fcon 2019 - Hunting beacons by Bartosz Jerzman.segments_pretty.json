{
  "segments": [
    {
      "Time_Start": 0.0,
      "Time_End": 14.24,
      "Text": "This text was transcribed using whisper model: large-v2\n\n Good morning everyone, first of all I would like to say that I'm very glad to be here"
    },
    {
      "Time_Start": 14.24,
      "Time_End": 16.28,
      "Text": " and present in front of you."
    },
    {
      "Time_Start": 16.28,
      "Time_End": 23.080000000000002,
      "Text": " On the other hand, it's a pity that I had to substitute Khalid, I hope that next year"
    },
    {
      "Time_Start": 23.080000000000002,
      "Time_End": 28.36,
      "Text": " we can meet him and listen to his talk during ZipCon, I hope he recovers quickly."
    },
    {
      "Time_Start": 28.36,
      "Time_End": 36.24,
      "Text": " So today I prepared a topic on hunting beacons, that's the general agenda for today, I divided"
    },
    {
      "Time_Start": 36.24,
      "Time_End": 43.519999999999996,
      "Text": " this presentation into three parts, part one more generic on hunting the HTTP beacon, second"
    },
    {
      "Time_Start": 43.519999999999996,
      "Time_End": 51.44,
      "Text": " part focusing on HTTPS, but actually I lied here, it will be a very specific case of a"
    },
    {
      "Time_Start": 51.44,
      "Time_End": 58.68,
      "Text": " protocol that was invented for the North Korean APT Lazarus and was actually very interesting"
    },
    {
      "Time_Start": 58.68,
      "Time_End": 62.879999999999995,
      "Text": " protocol for connecting to C2, it's a fake DLS."
    },
    {
      "Time_Start": 62.879999999999995,
      "Time_End": 69.12,
      "Text": " And part three, very quick introduction to do something else, to hunt the C2 servers"
    },
    {
      "Time_Start": 69.12,
      "Time_End": 74.72,
      "Text": " early, so to detect not the beaconing characteristic, but the C2 servers."
    },
    {
      "Time_Start": 74.72,
      "Time_End": 80.88,
      "Text": " So short introduction about myself, for most of my career I worked as a network defender"
    },
    {
      "Time_Start": 80.88,
      "Time_End": 87.56,
      "Text": " and as a sysadmin also for the Polish Navy, mostly on the incident response side, but"
    },
    {
      "Time_Start": 87.56,
      "Time_End": 95.03999999999999,
      "Text": " also as a pentester of different naval systems, currently working mostly on the threat intel"
    },
    {
      "Time_Start": 95.03999999999999,
      "Time_End": 97.47999999999999,
      "Text": " part."
    },
    {
      "Time_Start": 97.47999999999999,
      "Time_End": 101.19999999999999,
      "Text": " So let's begin with the part one."
    },
    {
      "Time_Start": 101.19999999999999,
      "Time_End": 107.64,
      "Text": " So beaconing over HTTP, let's begin with a kind of a definition, what is beaconing?"
    },
    {
      "Time_Start": 107.64,
      "Time_End": 113.28,
      "Text": " So generally speaking, the beaconing characteristic for the malware is a type of communication"
    },
    {
      "Time_Start": 113.28,
      "Time_End": 119.96000000000001,
      "Text": " where the malware does not keep a one long connection to C2, but instead the malware"
    },
    {
      "Time_Start": 119.96000000000001,
      "Time_End": 122.96000000000001,
      "Text": " connects to C2 periodically."
    },
    {
      "Time_Start": 122.96000000000001,
      "Time_End": 130.76,
      "Text": " And those beaconings can occur regularly at constant intervals, but more frequently they"
    },
    {
      "Time_Start": 130.76,
      "Time_End": 133.76,
      "Text": " occur at pseudorandom moments of time."
    },
    {
      "Time_Start": 133.76,
      "Time_End": 138.35999999999999,
      "Text": " You can compare it to the communications from the submarines."
    },
    {
      "Time_Start": 138.35999999999999,
      "Time_End": 142.0,
      "Text": " Submarines do not keep the constant communications with their headquarters."
    },
    {
      "Time_Start": 142.0,
      "Time_End": 147.67999999999998,
      "Text": " They surface, they go to the periscope depth only on the specific times, just to send and"
    },
    {
      "Time_Start": 147.67999999999998,
      "Time_End": 149.44,
      "Text": " receive the messages."
    },
    {
      "Time_Start": 149.44,
      "Time_End": 155.16,
      "Text": " Then when they receive the communication, then go deep into the sea and operate."
    },
    {
      "Time_Start": 155.16,
      "Time_End": 160.84,
      "Text": " So it's a kind of a naval comparison."
    },
    {
      "Time_Start": 160.92000000000002,
      "Time_End": 167.48000000000002,
      "Text": " Probably the most popular meme during this edition of ZIFCon, how to detect the beaconing?"
    },
    {
      "Time_Start": 167.48000000000002,
      "Time_End": 173.12,
      "Text": " Can we prepare the signatures, the snort rules, for example, for beaconing?"
    },
    {
      "Time_Start": 173.12,
      "Time_End": 181.88,
      "Text": " Probably it's very, very hard, almost impossible, because this can be one example of the beaconing."
    },
    {
      "Time_Start": 181.88,
      "Time_End": 186.88,
      "Text": " Can we prepare signature matching for such a communication?"
    },
    {
      "Time_Start": 186.92,
      "Time_End": 193.51999999999998,
      "Text": " When the payload is hidden, it's very often obfuscated, encoded, and additionally encrypted."
    },
    {
      "Time_Start": 193.51999999999998,
      "Time_End": 200.32,
      "Text": " This is an example from Cobalt Strike, but many other malwares in the world use such"
    },
    {
      "Time_Start": 200.32,
      "Time_End": 202.12,
      "Text": " similar characteristics."
    },
    {
      "Time_Start": 202.12,
      "Time_End": 208.6,
      "Text": " So it's very difficult to prepare one signature to detect it and trigger an alert that it"
    },
    {
      "Time_Start": 208.6,
      "Time_End": 210.68,
      "Text": " is that kind of communication."
    },
    {
      "Time_Start": 210.68,
      "Time_End": 213.8,
      "Text": " We can, for example, alert that it is Cobalt Strike."
    },
    {
      "Time_Start": 214.04000000000002,
      "Time_End": 217.48000000000002,
      "Text": " So it is almost impossible."
    },
    {
      "Time_Start": 217.48000000000002,
      "Time_End": 226.24,
      "Text": " On the other hand, sometimes your rules, even the simple ones, maybe you wouldn't expect them."
    },
    {
      "Time_Start": 226.24,
      "Time_End": 230.52,
      "Text": " Sometimes they trigger if the adversary makes a mistake."
    },
    {
      "Time_Start": 230.52,
      "Time_End": 236.96,
      "Text": " This is kind of a mistake when the adversary prepared a little bit wrong profile for his"
    },
    {
      "Time_Start": 236.96,
      "Time_End": 239.04000000000002,
      "Text": " beaconing malware."
    },
    {
      "Time_Start": 239.04,
      "Time_End": 250.23999999999998,
      "Text": " In this case, there is an alert from Suricata that the idea detected that HTTP response"
    },
    {
      "Time_Start": 250.23999999999998,
      "Time_End": 260.0,
      "Text": " body is not gzipped, but it was declared that the whole body is compressed."
    },
    {
      "Time_Start": 260.0,
      "Time_End": 261.59999999999997,
      "Text": " This is this kind of mistake."
    },
    {
      "Time_Start": 261.59999999999997,
      "Time_End": 268.92,
      "Text": " You can see that the content encoding is gzipped, but actually the body, so in this case, the"
    },
    {
      "Time_Start": 268.92,
      "Time_End": 277.52000000000004,
      "Text": " acorn put in the beacon is not in the real format of the gzip."
    },
    {
      "Time_Start": 277.52000000000004,
      "Time_End": 285.6,
      "Text": " So let's go to the real detection of the behaviors of the beaconing."
    },
    {
      "Time_Start": 285.6,
      "Time_End": 287.76,
      "Text": " These are the examples I prepared for today."
    },
    {
      "Time_Start": 287.76,
      "Time_End": 294.76,
      "Text": " So four hypotheses, and let's check them if we can try to detect the beaconing characteristics"
    },
    {
      "Time_Start": 294.76,
      "Time_End": 296.72,
      "Text": " with those four hypotheses."
    },
    {
      "Time_Start": 296.72,
      "Time_End": 302.88000000000005,
      "Text": " So first one is focused on the analysis of the intervals of connections, and the last"
    },
    {
      "Time_Start": 302.88000000000005,
      "Time_End": 311.44000000000005,
      "Text": " three are more focused on the HTTP headers that are configured for the beaconing malware."
    },
    {
      "Time_Start": 311.44000000000005,
      "Time_End": 320.28000000000003,
      "Text": " So the data set that I used for this presentation is mainly from the cyber defense exercise."
    },
    {
      "Time_Start": 320.28000000000003,
      "Time_End": 326.40000000000003,
      "Text": " It's from actually the Lock and Shields exercise that's carried out by NATO every year."
    },
    {
      "Time_Start": 327.08000000000004,
      "Time_End": 333.56000000000006,
      "Text": " So generally, the pickup from this exercise was processed by BroIDS, nowadays it was renamed"
    },
    {
      "Time_Start": 333.56000000000006,
      "Time_End": 341.92,
      "Text": " to Zeek, and we used the HTTP log from this IDS."
    },
    {
      "Time_Start": 341.92,
      "Time_End": 344.8,
      "Text": " What are the alternative data sources?"
    },
    {
      "Time_Start": 344.8,
      "Time_End": 349.48,
      "Text": " It could be also the flows, if you would like to analyze the intervals of connections, but"
    },
    {
      "Time_Start": 349.48,
      "Time_End": 352.28000000000003,
      "Text": " it can also be the web proxy logs."
    },
    {
      "Time_Start": 352.28000000000003,
      "Time_End": 359.44000000000005,
      "Text": " You can see in the table what kind of information you can get from one line of the HTTP log."
    },
    {
      "Time_Start": 359.44000000000005,
      "Time_End": 365.36,
      "Text": " So you can see that you can have some information from the HTTP request, but also from the HTTP"
    },
    {
      "Time_Start": 365.36,
      "Time_End": 366.36,
      "Text": " body."
    },
    {
      "Time_Start": 366.36,
      "Time_End": 370.40000000000003,
      "Text": " So you've got information from the flow, like source IP, source port."
    },
    {
      "Time_Start": 370.40000000000003,
      "Time_End": 376.76000000000005,
      "Text": " You can have some HTTP requests, like cookie or user agent, but you also have information"
    },
    {
      "Time_Start": 376.88,
      "Time_End": 382.28,
      "Text": " from the body, like the respond body length, and all those things can be also used to prepare"
    },
    {
      "Time_Start": 382.28,
      "Time_End": 384.88,
      "Text": " the detections of the beaconing."
    },
    {
      "Time_Start": 384.88,
      "Time_End": 390.92,
      "Text": " So let's go to hypothesis one, how to analyze the connections intervals."
    },
    {
      "Time_Start": 390.92,
      "Time_End": 396.4,
      "Text": " This hypothesis is based on the assumption that connection intervals from malware to"
    },
    {
      "Time_Start": 396.4,
      "Time_End": 405.68,
      "Text": " C2 are distributed around some average value, that they are not pseudorandom."
    },
    {
      "Time_Start": 405.68,
      "Time_End": 407.6,
      "Text": " Why do we assume that?"
    },
    {
      "Time_Start": 407.6,
      "Time_End": 413.44,
      "Text": " Because often the malware in the configuration has such options like sleep or jitter."
    },
    {
      "Time_Start": 413.44,
      "Time_End": 419.2,
      "Text": " It's also an example from the Cobalt Strike, but many other malware in the wild also use"
    },
    {
      "Time_Start": 419.2,
      "Time_End": 421.64,
      "Text": " similar configuration options."
    },
    {
      "Time_Start": 421.64,
      "Time_End": 428.2,
      "Text": " So in this configuration, the operator put the malware into sleep for 60 seconds, and"
    },
    {
      "Time_Start": 428.2,
      "Time_End": 434.72,
      "Text": " they put a kind of a jitter, so the pseudorandom value of 20%, just to make it more random,"
    },
    {
      "Time_Start": 435.72,
      "Time_End": 441.56,
      "Text": " just to make it not connect at constant values, like every 60 seconds, but for example in"
    },
    {
      "Time_Start": 441.56,
      "Time_End": 447.12,
      "Text": " the interval between 48 and 72 seconds in this example."
    },
    {
      "Time_Start": 447.12,
      "Time_End": 448.96000000000004,
      "Text": " How to detect that?"
    },
    {
      "Time_Start": 448.96000000000004,
      "Time_End": 455.20000000000005,
      "Text": " So maybe let's go back to school and use some, sorry for that, we have to go back to school"
    },
    {
      "Time_Start": 455.20000000000005,
      "Time_End": 461.28000000000003,
      "Text": " and remind ourselves some statistics metrics, but let's try."
    },
    {
      "Time_Start": 461.28000000000003,
      "Time_End": 467.00000000000006,
      "Text": " We would like to generally find that this type of characteristics, when the connections"
    },
    {
      "Time_Start": 467.00000000000006,
      "Time_End": 475.6,
      "Text": " and the intervals of connections are distributed around some average value, more or less."
    },
    {
      "Time_Start": 475.6,
      "Time_End": 479.96000000000004,
      "Text": " So what kind of example data do we have here?"
    },
    {
      "Time_Start": 479.96000000000004,
      "Time_End": 484.6,
      "Text": " We have example of the beacon A, which is a Cobalt Strike payload with configuration"
    },
    {
      "Time_Start": 484.6,
      "Time_End": 492.32000000000005,
      "Text": " of 60 seconds and jitter of 20%, and the beacon B of the Cobalt Strike when the operator"
    },
    {
      "Time_Start": 492.32000000000005,
      "Time_End": 495.68,
      "Text": " puts the beacon into sleep mode manually."
    },
    {
      "Time_Start": 495.68,
      "Time_End": 502.16,
      "Text": " So as we see in the table, we've got six samples of such connections."
    },
    {
      "Time_Start": 502.16,
      "Time_End": 509.24,
      "Text": " For the beacon B, the values are more random, and for beacon A, they are more or less distributed"
    },
    {
      "Time_Start": 509.24,
      "Time_End": 511.76000000000005,
      "Text": " around this average value."
    },
    {
      "Time_Start": 511.76,
      "Time_End": 518.56,
      "Text": " I put also the other statistics metrics like standard deviation and also the variation"
    },
    {
      "Time_Start": 518.56,
      "Time_End": 524.64,
      "Text": " coefficient, and this is a very simple math because the coefficient of variation is just"
    },
    {
      "Time_Start": 524.64,
      "Time_End": 530.3199999999999,
      "Text": " the standard deviation divided by the average as a percentage of it."
    },
    {
      "Time_Start": 530.3199999999999,
      "Time_End": 538.92,
      "Text": " So we can find if the data are diverse, more or less extent."
    },
    {
      "Time_Start": 538.92,
      "Time_End": 544.04,
      "Text": " So in the case of the beacon B, when the operator is manually putting the beacon into"
    },
    {
      "Time_Start": 544.04,
      "Time_End": 553.3199999999999,
      "Text": " sleep mode, we can see that those intervals are very diverse, and for automatically beaconing"
    },
    {
      "Time_Start": 553.3199999999999,
      "Time_End": 561.4,
      "Text": " malware, those values are not that diverse, and the coefficient of variation is quite"
    },
    {
      "Time_Start": 561.4,
      "Time_End": 562.4,
      "Text": " small."
    },
    {
      "Time_Start": 562.4,
      "Time_End": 566.92,
      "Text": " It's even very close to the jitter value."
    },
    {
      "Time_Start": 566.92,
      "Time_End": 572.4,
      "Text": " As the Splunk search, sorry for that, maybe it looks quite terrible, but I will focus"
    },
    {
      "Time_Start": 572.4,
      "Time_End": 576.9599999999999,
      "Text": " on some of the details of this search."
    },
    {
      "Time_Start": 576.9599999999999,
      "Time_End": 582.5999999999999,
      "Text": " In this case, we generally try to aggregate the connections by three things, like source"
    },
    {
      "Time_Start": 582.5999999999999,
      "Time_End": 589.4799999999999,
      "Text": " IP, destination IP, and the user agent, and in the second option, we try to prepare the"
    },
    {
      "Time_Start": 589.4799999999999,
      "Time_End": 592.24,
      "Text": " detection threshold."
    },
    {
      "Time_Start": 592.24,
      "Time_End": 598.6,
      "Text": " So in this case, I detected that the coefficient of variation should be less than 100%."
    },
    {
      "Time_Start": 598.6,
      "Time_End": 604.84,
      "Text": " I should get at least 10 connections and the average beacon time should be over one second."
    },
    {
      "Time_Start": 604.84,
      "Time_End": 614.28,
      "Text": " This query was also inspired, like in this link here, by the Splunk team."
    },
    {
      "Time_Start": 614.28,
      "Time_End": 620.5600000000001,
      "Text": " I recommend you go to their blog because they have very interesting hunting methods using"
    },
    {
      "Time_Start": 620.5600000000001,
      "Time_End": 622.2800000000001,
      "Text": " Splunk."
    },
    {
      "Time_Start": 622.2800000000001,
      "Time_End": 628.36,
      "Text": " In their case, they tried to hunt the beaconing over DNS, they used different statistics metrics,"
    },
    {
      "Time_Start": 628.36,
      "Time_End": 636.36,
      "Text": " they used variation, which is also okay."
    },
    {
      "Time_Start": 636.36,
      "Time_End": 641.8000000000001,
      "Text": " And excuse me for that, so this is the result of this query."
    },
    {
      "Time_Start": 641.8000000000001,
      "Time_End": 646.5200000000001,
      "Text": " In this case, we detected from this dataset, from the cyber defence exercise, one of the"
    },
    {
      "Time_Start": 646.52,
      "Time_End": 652.76,
      "Text": " C2 servers, we can see that the characteristics, that the average beacon time was seven seconds,"
    },
    {
      "Time_Start": 652.76,
      "Time_End": 656.12,
      "Text": " and the standard deviation was plus minus three seconds."
    },
    {
      "Time_Start": 656.12,
      "Time_End": 662.36,
      "Text": " So we can say it was a very interactive session and the operator had hands on keyboard when"
    },
    {
      "Time_Start": 662.36,
      "Time_End": 665.12,
      "Text": " interacting with this beacon."
    },
    {
      "Time_Start": 665.12,
      "Time_End": 672.4,
      "Text": " On the other hand, this kind of method and this attitude can also help us detect maybe"
    },
    {
      "Time_Start": 672.4,
      "Time_End": 676.28,
      "Text": " a kind of a long-term operation of a beaconing."
    },
    {
      "Time_Start": 676.28,
      "Time_End": 682.56,
      "Text": " In this case, we detected another C2 server, but the beacon time, average beacon time is"
    },
    {
      "Time_Start": 682.56,
      "Time_End": 686.76,
      "Text": " about half an hour, 28 minutes, plus minus seven minutes."
    },
    {
      "Time_Start": 686.76,
      "Time_End": 691.0,
      "Text": " So we can see that it wasn't a very interactive session."
    },
    {
      "Time_Start": 691.0,
      "Time_End": 697.62,
      "Text": " Probably it was used for keeping and maintaining the access, maybe kind of backup channel."
    },
    {
      "Time_Start": 697.62,
      "Time_End": 706.66,
      "Text": " But this kind of approach for detection can help us also detect such a beaconing with"
    },
    {
      "Time_Start": 706.66,
      "Time_End": 709.96,
      "Text": " a low frequency of occurrence."
    },
    {
      "Time_Start": 709.96,
      "Time_End": 716.62,
      "Text": " So this was the hypothesis one, which I hope it proved that it is possible, it is doable"
    },
    {
      "Time_Start": 716.62,
      "Time_End": 724.26,
      "Text": " to detect such beaconing characteristic using these statistics metrics, very simple ones."
    },
    {
      "Time_Start": 724.3,
      "Time_End": 727.66,
      "Text": " Let's go to the hypothesis one."
    },
    {
      "Time_Start": 727.66,
      "Time_End": 732.7,
      "Text": " So in this hypothesis, we try to analyze the URI."
    },
    {
      "Time_Start": 732.7,
      "Time_End": 741.18,
      "Text": " For example, we assume that adversary is using a backdoor that has several C2 backup domains"
    },
    {
      "Time_Start": 741.18,
      "Time_End": 742.78,
      "Text": " included."
    },
    {
      "Time_Start": 742.78,
      "Time_End": 744.1,
      "Text": " Do we find such malware?"
    },
    {
      "Time_Start": 744.1,
      "Time_End": 746.58,
      "Text": " Yes, it is."
    },
    {
      "Time_Start": 746.58,
      "Time_End": 752.1,
      "Text": " In this example of the Cobblestrike beacon, there's also such an option to put several"
    },
    {
      "Time_Start": 752.14,
      "Time_End": 757.3000000000001,
      "Text": " domains, C2 domains into one configuration, into one of the beacons."
    },
    {
      "Time_Start": 757.3000000000001,
      "Time_End": 764.5,
      "Text": " So there is a possibility that one type of malware is going to connect with the same"
    },
    {
      "Time_Start": 764.5,
      "Time_End": 768.16,
      "Text": " URI to different host names."
    },
    {
      "Time_Start": 768.16,
      "Time_End": 774.1800000000001,
      "Text": " This is a kind of a Splunk query to implement this hypothesis."
    },
    {
      "Time_Start": 774.1800000000001,
      "Time_End": 779.1,
      "Text": " So let's focus on the most important details of this query."
    },
    {
      "Time_Start": 779.1,
      "Time_End": 782.22,
      "Text": " We just use the HTTP log from Zeek."
    },
    {
      "Time_Start": 782.22,
      "Time_End": 786.58,
      "Text": " So we analyze the request and the response data."
    },
    {
      "Time_Start": 786.58,
      "Time_End": 795.1,
      "Text": " We try to exclude several false positives, like favicon, ico, admin, because those URI"
    },
    {
      "Time_Start": 795.1,
      "Time_End": 799.74,
      "Text": " can really be on different host names."
    },
    {
      "Time_Start": 799.74,
      "Time_End": 805.94,
      "Text": " And we aggregate with the logic of this one is to ask how many different hosts have requested"
    },
    {
      "Time_Start": 805.94,
      "Time_End": 812.2600000000001,
      "Text": " with the same URI."
    },
    {
      "Time_Start": 812.2600000000001,
      "Time_End": 814.34,
      "Text": " This is the aggregation part."
    },
    {
      "Time_Start": 814.34,
      "Time_End": 816.0200000000001,
      "Text": " This is the detection part."
    },
    {
      "Time_Start": 816.0200000000001,
      "Time_End": 820.0200000000001,
      "Text": " In this case, I chose the threshold of three different hosts."
    },
    {
      "Time_Start": 820.0200000000001,
      "Time_End": 826.1,
      "Text": " It's because of the characteristics of this dataset."
    },
    {
      "Time_Start": 826.1,
      "Time_End": 837.7,
      "Text": " So we detected five unique C2 domains discovered for two similar, yet different URI requests."
    },
    {
      "Time_Start": 837.7,
      "Time_End": 845.7,
      "Text": " And going to the third hypothesis, which is also based on the URI analysis, but focusing"
    },
    {
      "Time_Start": 845.7,
      "Time_End": 850.1,
      "Text": " on another aspect of the HTTP header, so the referrer."
    },
    {
      "Time_Start": 850.1,
      "Time_End": 855.14,
      "Text": " So generally, when the normal user, when the typical behavior of the user which is browsing"
    },
    {
      "Time_Start": 855.14,
      "Time_End": 861.86,
      "Text": " the web page, is when he goes to another URI, then the referrer of the last visited"
    },
    {
      "Time_Start": 861.86,
      "Time_End": 864.22,
      "Text": " web page changes."
    },
    {
      "Time_Start": 864.22,
      "Time_End": 867.38,
      "Text": " Malware usually does not implement such a behavior."
    },
    {
      "Time_Start": 867.38,
      "Time_End": 871.98,
      "Text": " So it's a kind of weakness or the characteristics of the malware."
    },
    {
      "Time_Start": 871.98,
      "Time_End": 877.06,
      "Text": " So we can try to use it for detection."
    },
    {
      "Time_Start": 877.06,
      "Time_End": 884.26,
      "Text": " If we are countering the referrers on single destination, and we try to aggregate it, and"
    },
    {
      "Time_Start": 884.26,
      "Time_End": 890.62,
      "Text": " we put some detection thresholds, we can find such new C2 servers."
    },
    {
      "Time_Start": 890.62,
      "Time_End": 895.38,
      "Text": " And in this case, those URIs were related to the first stage malware."
    },
    {
      "Time_Start": 895.38,
      "Time_End": 903.78,
      "Text": " For C2, we can see that on one single destination with none or same referrer, we can find various"
    },
    {
      "Time_Start": 903.78,
      "Time_End": 913.9,
      "Text": " URIs, and this method was also useful for us."
    },
    {
      "Time_Start": 914.54,
      "Time_End": 920.8199999999999,
      "Text": " Hypothesis four, we discovered another C2 domain using another approach."
    },
    {
      "Time_Start": 920.8199999999999,
      "Time_End": 928.34,
      "Text": " So we tried to look for different URIs, but the length is constant."
    },
    {
      "Time_Start": 928.34,
      "Time_End": 933.76,
      "Text": " Very often, when the malware is trying to put the payload into the URI, the encoded"
    },
    {
      "Time_Start": 933.76,
      "Time_End": 940.1999999999999,
      "Text": " encrypted payload into the URI, usually the length of the URI is constant."
    },
    {
      "Time_Start": 940.32,
      "Time_End": 950.1600000000001,
      "Text": " In this case, we discovered another C2 domain with three different URIs with the same length"
    },
    {
      "Time_Start": 950.1600000000001,
      "Time_End": 953.84,
      "Text": " hosted on the same destination IP."
    },
    {
      "Time_Start": 953.84,
      "Time_End": 962.08,
      "Text": " And sorry for spoiler, but if you would like to see different types of hypothesis, then"
    },
    {
      "Time_Start": 962.08,
      "Time_End": 970.96,
      "Text": " the Jack Kruk mind map, which he prepared some time ago, is a great set of hypothesis."
    },
    {
      "Time_Start": 970.96,
      "Time_End": 975.48,
      "Text": " We implemented several of them, you could see on the previous slides."
    },
    {
      "Time_Start": 975.48,
      "Time_End": 981.4000000000001,
      "Text": " We hope that one day Jack is going to come, because he was supposed to be on the first"
    },
    {
      "Time_Start": 981.4000000000001,
      "Time_End": 982.64,
      "Text": " ZipCon."
    },
    {
      "Time_Start": 982.64,
      "Time_End": 987.6400000000001,
      "Text": " We keep fingers crossed for him."
    },
    {
      "Time_Start": 987.64,
      "Time_End": 997.36,
      "Text": " So it's also a very good way to find the inspirations for detecting the beaconing part."
    },
    {
      "Time_Start": 997.36,
      "Time_End": 1004.24,
      "Text": " So let's go to the part two and focus on beaconing over HTTPS."
    },
    {
      "Time_Start": 1004.24,
      "Time_End": 1011.64,
      "Text": " And actually, like I said before, it will be not a generic detection of HTTPS, but just"
    },
    {
      "Time_Start": 1011.64,
      "Time_End": 1018.16,
      "Text": " a fake TLS example from the Lazarus APT."
    },
    {
      "Time_Start": 1018.16,
      "Time_End": 1023.64,
      "Text": " So just to understand, how does it work?"
    },
    {
      "Time_Start": 1023.64,
      "Time_End": 1027.2,
      "Text": " It has worked for several years."
    },
    {
      "Time_Start": 1027.2,
      "Time_End": 1031.4,
      "Text": " I'm aware that it worked until 2018."
    },
    {
      "Time_Start": 1031.4,
      "Time_End": 1034.24,
      "Text": " I don't know if they still use this protocol."
    },
    {
      "Time_Start": 1034.24,
      "Time_End": 1038.5,
      "Text": " On 2019, I'm now more focused on different kind of threads."
    },
    {
      "Time_Start": 1038.5,
      "Time_End": 1043.86,
      "Text": " So generally, that's the idea behind the fake TLS."
    },
    {
      "Time_Start": 1043.86,
      "Time_End": 1050.66,
      "Text": " So the handshake for the TLS is fake, and the real communications with the C2 server"
    },
    {
      "Time_Start": 1050.66,
      "Time_End": 1057.22,
      "Text": " between the backdoor and the server is after the handshake."
    },
    {
      "Time_Start": 1057.22,
      "Time_End": 1066.26,
      "Text": " So the handshake is the funny part, when, for example, the C2 server just sends back"
    },
    {
      "Time_Start": 1066.3799999999999,
      "Time_End": 1072.7,
      "Text": " the real and often expired certificate, which is just copied from pages like WeTransfer,"
    },
    {
      "Time_Start": 1072.7,
      "Time_End": 1075.26,
      "Text": " Google.com, Dropbox."
    },
    {
      "Time_Start": 1075.26,
      "Time_End": 1082.34,
      "Text": " So they try to make us think that we are connecting to such popular sites."
    },
    {
      "Time_Start": 1082.34,
      "Time_End": 1091.06,
      "Text": " And in most cases, our systems, our network analyzers, they analyze mostly the handshake."
    },
    {
      "Time_Start": 1091.06,
      "Time_End": 1101.06,
      "Text": " So the beginning of the TLS session, and due to the cost of the resources, the analyzers"
    },
    {
      "Time_Start": 1101.06,
      "Time_End": 1105.1799999999998,
      "Text": " are switched off after the handshake."
    },
    {
      "Time_Start": 1105.1799999999998,
      "Time_End": 1112.58,
      "Text": " So they took advantage of this fact, because the real communications is after the handshake."
    },
    {
      "Time_Start": 1112.58,
      "Time_End": 1114.82,
      "Text": " Actually, it's not TLS."
    },
    {
      "Time_Start": 1114.82,
      "Time_End": 1124.46,
      "Text": " The encryption is symmetric, there is a pre-shared key, usually RC4, which was preloaded into"
    },
    {
      "Time_Start": 1124.46,
      "Time_End": 1125.46,
      "Text": " the backdoor."
    },
    {
      "Time_Start": 1125.46,
      "Time_End": 1130.62,
      "Text": " C2, of course, knows this symmetric key, and this is the real communication."
    },
    {
      "Time_Start": 1130.62,
      "Time_End": 1132.06,
      "Text": " So does it beacon?"
    },
    {
      "Time_Start": 1132.06,
      "Time_End": 1133.06,
      "Text": " Yes."
    },
    {
      "Time_Start": 1133.06,
      "Time_End": 1135.26,
      "Text": " This is an example of fake TLS."
    },
    {
      "Time_Start": 1135.26,
      "Time_End": 1142.06,
      "Text": " This is a graph of actually the sizes, the length of the messages, encrypted messages"
    },
    {
      "Time_Start": 1142.06,
      "Time_End": 1145.1799999999998,
      "Text": " between the backdoor and the C2."
    },
    {
      "Time_Start": 1145.1799999999998,
      "Time_End": 1148.02,
      "Text": " And what's interesting about it?"
    },
    {
      "Time_Start": 1148.02,
      "Time_End": 1153.22,
      "Text": " First of all, we can see that the maximum message size used for the communication is"
    },
    {
      "Time_Start": 1153.22,
      "Time_End": 1155.4199999999998,
      "Text": " fixed."
    },
    {
      "Time_Start": 1155.4199999999998,
      "Time_End": 1162.82,
      "Text": " In this case, it's 808 bytes, so it's one possibility to prepare a detection."
    },
    {
      "Time_Start": 1162.82,
      "Time_End": 1168.44,
      "Text": " But another interesting part is that the beginning of the real communication after the handshake"
    },
    {
      "Time_Start": 1168.52,
      "Time_End": 1174.2,
      "Text": " has also fixed size messages."
    },
    {
      "Time_Start": 1174.2,
      "Time_End": 1179.9,
      "Text": " So for example, first five messages are always of the same length."
    },
    {
      "Time_Start": 1179.9,
      "Time_End": 1183.92,
      "Text": " Is it really hardcoded?"
    },
    {
      "Time_Start": 1183.92,
      "Time_End": 1184.92,
      "Text": " Actually yes."
    },
    {
      "Time_Start": 1184.92,
      "Time_End": 1190.04,
      "Text": " If you look into the code of the backdoor, you can see on this example of the second"
    },
    {
      "Time_Start": 1190.04,
      "Time_End": 1199.2,
      "Text": " message that is of the size of 24 bytes, that it's hardcoded into the backdoor's code."
    },
    {
      "Time_Start": 1199.2,
      "Time_End": 1201.52,
      "Text": " It should have that 24 bytes."
    },
    {
      "Time_Start": 1201.52,
      "Time_End": 1205.68,
      "Text": " What can we do about this fact?"
    },
    {
      "Time_Start": 1205.68,
      "Time_End": 1214.04,
      "Text": " We can prepare a kind of SSL TLS profiling, so we can prepare a kind of TLS profiles to"
    },
    {
      "Time_Start": 1214.04,
      "Time_End": 1217.0,
      "Text": " detect those kind of communications."
    },
    {
      "Time_Start": 1217.16,
      "Time_End": 1224.2,
      "Text": " If we only analyze the sizes of the first five messages of encrypted application data,"
    },
    {
      "Time_Start": 1224.2,
      "Time_End": 1233.56,
      "Text": " which occur after the TLS handshake, it can help us detect the traffic to a known C2 infrastructure"
    },
    {
      "Time_Start": 1233.56,
      "Time_End": 1238.92,
      "Text": " that fakes, that uses the fake TLS."
    },
    {
      "Time_Start": 1238.92,
      "Time_End": 1248.72,
      "Text": " So did anybody recognize what can be wrong with those messages, with those sizes?"
    },
    {
      "Time_Start": 1248.72,
      "Time_End": 1257.8400000000001,
      "Text": " So if we analyze it more, especially the lengths of the messages, then it turns out that the"
    },
    {
      "Time_Start": 1257.8400000000001,
      "Time_End": 1262.92,
      "Text": " TLS algorithms for every message, they hash the values."
    },
    {
      "Time_Start": 1263.0800000000002,
      "Time_End": 1272.1200000000001,
      "Text": " For example, if we use the MD5 and the length of the MD5 from a message is always 16 bytes,"
    },
    {
      "Time_Start": 1272.1200000000001,
      "Time_End": 1277.96,
      "Text": " then we can see that it's impossible to have such a connection over TLS where the messages"
    },
    {
      "Time_Start": 1277.96,
      "Time_End": 1280.4,
      "Text": " are of such low sizes."
    },
    {
      "Time_Start": 1280.4,
      "Time_End": 1288.0800000000002,
      "Text": " So it's impossible that it could be a real TLS communication because the sizes are lower"
    },
    {
      "Time_Start": 1288.0800000000002,
      "Time_End": 1290.76,
      "Text": " than 16 bytes."
    },
    {
      "Time_Start": 1290.76,
      "Time_End": 1297.8799999999999,
      "Text": " For the fake TLS, it's even 8 bytes of the communication, so it must be something different,"
    },
    {
      "Time_Start": 1297.8799999999999,
      "Time_End": 1304.44,
      "Text": " something that is not a real TLS."
    },
    {
      "Time_Start": 1304.44,
      "Time_End": 1308.92,
      "Text": " So where can we use this knowledge?"
    },
    {
      "Time_Start": 1308.92,
      "Time_End": 1310.96,
      "Text": " Where can we hunt fake TLS?"
    },
    {
      "Time_Start": 1310.96,
      "Time_End": 1316.6,
      "Text": " One option is to be, of course, we can detect it in our own networks."
    },
    {
      "Time_Start": 1316.6,
      "Time_End": 1320.48,
      "Text": " We can prepare such analysis, such detections."
    },
    {
      "Time_Start": 1320.48,
      "Time_End": 1329.92,
      "Text": " We only need a good, very configurable network analyzer that can analyze the TLS data after"
    },
    {
      "Time_Start": 1329.92,
      "Time_End": 1330.92,
      "Text": " the handshake."
    },
    {
      "Time_Start": 1330.92,
      "Time_End": 1340.48,
      "Text": " Not every network analyzer can be reconfigured to analyze the data after the handshake."
    },
    {
      "Time_Start": 1340.48,
      "Time_End": 1344.28,
      "Text": " On the other hand, we can go and be kind of proactive."
    },
    {
      "Time_Start": 1344.28,
      "Time_End": 1350.0,
      "Text": " We can, for example, download the pickups from the services, from the sandbox services"
    },
    {
      "Time_Start": 1350.0,
      "Time_End": 1360.56,
      "Text": " like hybrid analysis, and we can try to match our profiles to those pickups."
    },
    {
      "Time_Start": 1360.56,
      "Time_End": 1368.36,
      "Text": " That was one of the options I used to detect unknown infrastructure for Lazarus and trying"
    },
    {
      "Time_Start": 1368.36,
      "Time_End": 1372.56,
      "Text": " to check this hypothesis."
    },
    {
      "Time_Start": 1373.32,
      "Time_End": 1382.1599999999999,
      "Text": " This was the part two, so very specific case of detecting the HTTPS beaconing that was"
    },
    {
      "Time_Start": 1382.1599999999999,
      "Time_End": 1385.8799999999999,
      "Text": " not a real HTTPS."
    },
    {
      "Time_Start": 1385.8799999999999,
      "Time_End": 1387.56,
      "Text": " Let's go to part three."
    },
    {
      "Time_Start": 1387.56,
      "Time_End": 1398.12,
      "Text": " It could be something more offensive, but only a general introduction to the topic."
    },
    {
      "Time_Start": 1398.1200000000001,
      "Time_End": 1408.2,
      "Text": " We can always hunt the C2 servers, so not only the way the malware communicates, but"
    },
    {
      "Time_Start": 1408.2,
      "Time_End": 1413.8000000000002,
      "Text": " we can also find the C2 servers or the red directors."
    },
    {
      "Time_Start": 1413.8000000000002,
      "Time_End": 1420.44,
      "Text": " Of course, like guys from Outflank showed us today, red teams can also, and adversaries"
    },
    {
      "Time_Start": 1420.44,
      "Time_End": 1426.5600000000002,
      "Text": " can monitor themselves, probably they should monitor, but we can try to hunt them."
    },
    {
      "Time_Start": 1426.56,
      "Time_End": 1434.56,
      "Text": " Now we know that we have to be more stealthy about such proactive activities."
    },
    {
      "Time_Start": 1434.56,
      "Time_End": 1440.2,
      "Text": " So generally, I grew up in 1990s, and there was a general strategy in NBA that the offense"
    },
    {
      "Time_Start": 1440.2,
      "Time_End": 1444.6,
      "Text": " starts with defense, and that was also the plan for my presentation, that first of all,"
    },
    {
      "Time_Start": 1444.6,
      "Time_End": 1452.56,
      "Text": " I tried to begin with hunting and detecting beaconing on mine playgrounds, but if I feel"
    },
    {
      "Time_Start": 1452.56,
      "Time_End": 1459.3999999999999,
      "Text": " comfortable about detecting different mechanism of beaconing, I can try to be more proactive"
    },
    {
      "Time_Start": 1459.3999999999999,
      "Time_End": 1465.52,
      "Text": " and try to hunt them when they are preparing, so on the maybe weaponization stage, when"
    },
    {
      "Time_Start": 1465.52,
      "Time_End": 1468.32,
      "Text": " the malware is being prepared."
    },
    {
      "Time_Start": 1468.32,
      "Time_End": 1474.9199999999998,
      "Text": " This is just a quick intro, so for example, if you take the two very popular frameworks"
    },
    {
      "Time_Start": 1474.9199999999998,
      "Time_End": 1481.28,
      "Text": " for the command and control, like Cobalt Strike, which is a commercial product or PS Empire,"
    },
    {
      "Time_Start": 1481.28,
      "Time_End": 1488.96,
      "Text": " you can see, this is a data source from the MITRE ATT&CK that several APT groups use this"
    },
    {
      "Time_Start": 1488.96,
      "Time_End": 1495.6,
      "Text": " kind of software, so what can we do about it?"
    },
    {
      "Time_Start": 1495.6,
      "Time_End": 1500.36,
      "Text": " For sure, we have to know the defaults of such frameworks."
    },
    {
      "Time_Start": 1500.36,
      "Time_End": 1506.28,
      "Text": " In case of Cobalt Strike, nothing fancy, but we have to remember that for the Cobalt Strike,"
    },
    {
      "Time_Start": 1506.28,
      "Time_End": 1513.32,
      "Text": " the console port, the default port is the 550 over TCP, is the console, the operator"
    },
    {
      "Time_Start": 1513.32,
      "Time_End": 1522.0,
      "Text": " connects to the team server, sometimes if they make such a mistake, you could see on"
    },
    {
      "Time_Start": 1522.0,
      "Time_End": 1527.6399999999999,
      "Text": " the day one, that the infrastructure for the adversary could be quite complex, and if it"
    },
    {
      "Time_Start": 1527.6399999999999,
      "Time_End": 1532.28,
      "Text": " is complex, that the adversary can make a mistake, and for example, sometimes they can"
    },
    {
      "Time_Start": 1532.28,
      "Time_End": 1538.72,
      "Text": " make an open port for the management, it's not only for Cobalt Strike, but the very custom"
    },
    {
      "Time_Start": 1538.72,
      "Time_End": 1546.8799999999999,
      "Text": " C2 servers from different APTs always also have the management port."
    },
    {
      "Time_Start": 1546.8799999999999,
      "Time_End": 1552.96,
      "Text": " In the case of Cobalt Strike, there is a kind of a characteristic, it's a default one, for"
    },
    {
      "Time_Start": 1552.96,
      "Time_End": 1561.32,
      "Text": " the DNS listener, when there is a DNS request to this DNS listener from Cobalt Strike, then"
    },
    {
      "Time_Start": 1561.32,
      "Time_End": 1563.52,
      "Text": " the answer is always like that."
    },
    {
      "Time_Start": 1563.52,
      "Time_End": 1569.08,
      "Text": " Of course, it can be changed in the configuration, but it's the default."
    },
    {
      "Time_Start": 1569.08,
      "Time_End": 1577.76,
      "Text": " Another interesting aspect of the Cobalt Strike is that it's based on the nano HTTP server,"
    },
    {
      "Time_Start": 1577.76,
      "Time_End": 1583.32,
      "Text": " which is a Java implementation for HTTP D, and this is a typical message, for example,"
    },
    {
      "Time_Start": 1583.32,
      "Time_End": 1592.0,
      "Text": " if you would like to request for any URI, not for the one connected with the malware,"
    },
    {
      "Time_Start": 1592.0,
      "Time_End": 1600.0,
      "Text": " we probably will receive by default this kind of response, which is also kind of one of"
    },
    {
      "Time_Start": 1600.0,
      "Time_End": 1607.1599999999999,
      "Text": " the characteristics of this kind of C2 server."
    },
    {
      "Time_Start": 1607.2,
      "Time_End": 1615.3200000000002,
      "Text": " This is something new that was made, not discovered, but made more public lately with the new edition"
    },
    {
      "Time_Start": 1615.3200000000002,
      "Time_End": 1623.0800000000002,
      "Text": " of the Cobalt Strike 3.13, that for many years there was a kind of additional space, I don't"
    },
    {
      "Time_Start": 1623.0800000000002,
      "Time_End": 1632.4,
      "Text": " know if you were aware of it, there was additional space after the response, after the code,"
    },
    {
      "Time_Start": 1632.64,
      "Time_End": 1640.16,
      "Text": " after the word OK, there was additional space, it was also a signature of the Cobalt Strike,"
    },
    {
      "Time_Start": 1640.16,
      "Time_End": 1646.3200000000002,
      "Text": " which was based on nano HTTP D server."
    },
    {
      "Time_Start": 1646.3200000000002,
      "Time_End": 1658.68,
      "Text": " So going to the conclusion, adversaries tools and procedures often have patterns, so our"
    },
    {
      "Time_Start": 1658.68,
      "Time_End": 1665.3200000000002,
      "Text": " job as threat analysts is to uncover those human factors, those human traces, and also"
    },
    {
      "Time_Start": 1665.3200000000002,
      "Time_End": 1674.1200000000001,
      "Text": " sometimes adversaries weaknesses to connect them and understand what are their limitations."
    },
    {
      "Time_Start": 1674.1200000000001,
      "Time_End": 1680.28,
      "Text": " And for sure, we should burn the defaults if we are aware that our adversary is using"
    },
    {
      "Time_Start": 1680.28,
      "Time_End": 1687.8400000000001,
      "Text": " Cobalt Strike, PowerShell Empire, or any other framework or custom tool that we analyze,"
    },
    {
      "Time_Start": 1687.8400000000001,
      "Time_End": 1698.3600000000001,
      "Text": " we have to use this knowledge to burn it, and for sure we have to burn everything that's"
    },
    {
      "Time_Start": 1698.3600000000001,
      "Time_End": 1704.8400000000001,
      "Text": " connected with open source and commercial C2 servers, what is known, what is default,"
    },
    {
      "Time_Start": 1704.8400000000001,
      "Time_End": 1709.68,
      "Text": " this should be detected by us and prevented."
    },
    {
      "Time_Start": 1709.68,
      "Time_End": 1712.2400000000002,
      "Text": " So thank you for your time."
    }
  ]
}