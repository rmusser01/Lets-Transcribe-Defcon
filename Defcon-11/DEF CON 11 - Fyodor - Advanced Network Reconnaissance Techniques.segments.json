{"segments": [{"Time_Start": 0.0, "Time_End": 7.0, "Text": " Started."}, {"Time_Start": 7.0, "Time_End": 11.0, "Text": " My name's Fyodor from Insecure.org."}, {"Time_Start": 11.0, "Time_End": 13.0, "Text": " Thanks for showing up."}, {"Time_Start": 13.0, "Time_End": 17.0, "Text": " I think I have one of the more hardcore of DefCon crowds here today."}, {"Time_Start": 17.0, "Time_End": 19.0, "Text": " You know, so many people come on the weekends,"}, {"Time_Start": 19.0, "Time_End": 23.0, "Text": " but you guys manage to convince your bosses to let you skip a day at work,"}, {"Time_Start": 23.0, "Time_End": 26.0, "Text": " fly to Las Vegas, and attend this great hacker party."}, {"Time_Start": 26.0, "Time_End": 28.0, "Text": " So congratulations on that."}, {"Time_Start": 28.0, "Time_End": 33.0, "Text": " I was going to just come here and party as well and not even speak,"}, {"Time_Start": 33.0, "Time_End": 37.0, "Text": " but then I saw this network reconnaissance track and that got my attention,"}, {"Time_Start": 37.0, "Time_End": 41.0, "Text": " as it's a subject that is very near and dear to my heart"}, {"Time_Start": 41.0, "Time_End": 45.0, "Text": " as I'm the author and maintainer of a security scanner called NMAP"}, {"Time_Start": 45.0, "Time_End": 51.0, "Text": " that you can use for these sorts of techniques."}, {"Time_Start": 51.0, "Time_End": 56.0, "Text": " I'm also going to discuss, sorry?"}, {"Time_Start": 56.0, "Time_End": 58.0, "Text": " I don't know if I can make it much louder,"}, {"Time_Start": 58.0, "Time_End": 60.0, "Text": " but I'll try my best."}, {"Time_Start": 60.0, "Time_End": 68.0, "Text": " It's not going to discuss other great open source network security tools,"}, {"Time_Start": 68.0, "Time_End": 71.0, "Text": " such as the venerable H-Ping 2."}, {"Time_Start": 71.0, "Time_End": 77.0, "Text": " Just so I can get an idea of the audience and how much introductory NMAP material I have to cover,"}, {"Time_Start": 77.0, "Time_End": 81.0, "Text": " could I get a show of hands for anyone here who has ever used NMAP?"}, {"Time_Start": 81.0, "Time_End": 86.0, "Text": " Okay, that's pretty much all of you, which is great,"}, {"Time_Start": 86.0, "Time_End": 88.0, "Text": " because I wrote far too much"}, {"Time_Start": 88.0, "Time_End": 92.0, "Text": " to fit in 50 minutes, but I'm going to do my best."}, {"Time_Start": 92.0, "Time_End": 95.0, "Text": " So if I look rushed, that's why."}, {"Time_Start": 95.0, "Time_End": 97.0, "Text": " We'll start with"}, {"Time_Start": 100.0, "Time_End": 102.0, "Text": " the disclaimers, of course."}, {"Time_Start": 102.0, "Time_End": 106.0, "Text": " First of all, you'll notice, as opposed to many other presentations,"}, {"Time_Start": 106.0, "Time_End": 109.0, "Text": " we're using real host names and IP addresses here."}, {"Time_Start": 109.0, "Time_End": 113.0, "Text": " Frankly, I sometimes get sick of seeing slide after slide of example.org"}, {"Time_Start": 113.0, "Time_End": 117.0, "Text": " and this is a mock-up of a 192-168 network and so forth."}, {"Time_Start": 117.0, "Time_End": 122.0, "Text": " so forth. Plus, you know, I trust all you guys. You're not going to abuse the information."}, {"Time_Start": 122.0, "Time_End": 129.0, "Text": " But more importantly, even if I didn't, this is really just public information scanning we're doing."}, {"Time_Start": 129.0, "Time_End": 132.0, "Text": " You know, it's called network reconnaissance and that's all we're doing."}, {"Time_Start": 132.0, "Time_End": 135.0, "Text": " We're not going to be exploiting any hosts. We're not going to be getting root."}, {"Time_Start": 135.0, "Time_End": 140.0, "Text": " We're just going to be rattling some doorknobs, maybe peeking in a window or two, you know."}, {"Time_Start": 140.0, "Time_End": 146.0, "Text": " Also, I'm going to start with the basics as a foundation for kind of some of the more advanced stuff."}, {"Time_Start": 146.0, "Time_End": 151.0, "Text": " So if five minutes from now you're saying, oh man, I was doing this stuff back in eighth grade,"}, {"Time_Start": 151.0, "Time_End": 154.0, "Text": " well, hopefully it'll get better."}, {"Time_Start": 154.0, "Time_End": 158.0, "Text": " So let's just start from the beginning here."}, {"Time_Start": 158.0, "Time_End": 162.0, "Text": " Our first step is going to be taking our target company or whatever."}, {"Time_Start": 162.0, "Time_End": 170.0, "Text": " I don't remember if I mentioned that this talk is gained mostly to pen testers and such."}, {"Time_Start": 170.0, "Time_End": 175.0, "Text": " So if you got your client, the first thing you want to do is you might want to try DNS."}, {"Time_Start": 175.0, "Time_End": 179.0, "Text": " want to try DNS. You know, that's pretty obvious, right? Its whole point is to change names"}, {"Time_Start": 179.0, "Time_End": 184.0, "Text": " to IP numbers. So first we'll grab just the low-hanging fruit, just the information"}, {"Time_Start": 184.0, "Time_End": 189.0, "Text": " that companies have to give us in order for, you know, their mail and such to work."}, {"Time_Start": 189.0, "Time_End": 195.0, "Text": " So we use the dig command to grab kind of the basic information from at stake,"}, {"Time_Start": 195.0, "Time_End": 199.0, "Text": " and you see name server records, MX records, and the corresponding A records."}, {"Time_Start": 199.0, "Time_End": 204.0, "Text": " They also have this bonus text record where security and business intersect."}, {"Time_Start": 204.0, "Time_End": 208.0, "Text": " I think they're one of the few companies where they get so many probes"}, {"Time_Start": 208.0, "Time_End": 212.0, "Text": " that it makes sense to put advertisements in their DNS zone information."}, {"Time_Start": 212.0, "Time_End": 215.0, "Text": " So what do we do next?"}, {"Time_Start": 215.0, "Time_End": 218.0, "Text": " Well, you know, let's try his own transfer. Why not?"}, {"Time_Start": 218.0, "Time_End": 222.0, "Text": " You know, it may not always work, but when it does, you get a huge list of host names,"}, {"Time_Start": 222.0, "Time_End": 223.0, "Text": " IP address."}, {"Time_Start": 223.0, "Time_End": 228.0, "Text": " You can get ideas of the functions of the hosts from their names, from their C names."}, {"Time_Start": 228.0, "Time_End": 231.0, "Text": " Poorly configured servers will give you vanity names"}, {"Time_Start": 231.0, "Time_End": 233.0, "Text": " that their sysidming uses far flung."}, {"Time_Start": 233.0, "Time_End": 234.0, "Text": " Sometimes you use."}, {"Time_Start": 234.0, "Time_End": 239.0, "Text": " even get internal network names, which is really bad, but that certainly doesn't mean it doesn't happen."}, {"Time_Start": 239.0, "Time_End": 246.0, "Text": " And popular name servers such as Bind make this information available by default."}, {"Time_Start": 246.0, "Time_End": 250.0, "Text": " So yes, a lot of people turn it off, but when it's on by default,"}, {"Time_Start": 250.0, "Time_End": 253.0, "Text": " we all know that at least half of them leave it as it is."}, {"Time_Start": 253.0, "Time_End": 257.0, "Text": " So here's just an example where we grab the security focus zone,"}, {"Time_Start": 257.0, "Time_End": 263.0, "Text": " and you see a bunch of hosts here, which I've cut off due to space,"}, {"Time_Start": 263.0, "Time_End": 270.0, "Text": " To their credit, they didn't have those problems like internal DNS or far-flung vanity names,"}, {"Time_Start": 270.0, "Time_End": 274.0, "Text": " but it still gives you a lot of IPs to start with in your reconnaissance."}, {"Time_Start": 274.0, "Time_End": 278.0, "Text": " Another thing you want to try, of course, is the version number,"}, {"Time_Start": 278.0, "Time_End": 281.0, "Text": " and that's for one basic reason."}, {"Time_Start": 281.0, "Time_End": 287.0, "Text": " As you all know, Bind has a long and sorted history of remotely exploitable security holes."}, {"Time_Start": 287.0, "Time_End": 291.0, "Text": " So if they're running an insecure version, you can skip the rest of this reconnaissance stuff"}, {"Time_Start": 291.0, "Time_End": 292.0, "Text": " and go straight to owning their name server."}, {"Time_Start": 292.0, "Time_End": 295.0, "Text": " owning their name server."}, {"Time_Start": 295.0, "Time_End": 297.0, "Text": " The bind people also have a useful page."}, {"Time_Start": 297.0, "Time_End": 302.0, "Text": " Most of you have probably seen that lists all the different security holes in the different versions"}, {"Time_Start": 302.0, "Time_End": 305.0, "Text": " of bind that you can cross-reference to."}, {"Time_Start": 305.0, "Time_End": 311.0, "Text": " When I tried a lot of popular companies, I got some interesting flippant responses for a few."}, {"Time_Start": 311.0, "Time_End": 314.0, "Text": " Playboy's version number is move on."}, {"Time_Start": 314.0, "Time_End": 315.0, "Text": " I'm already patched."}, {"Time_Start": 315.0, "Time_End": 318.0, "Text": " Kay, thanks, bye."}, {"Time_Start": 318.0, "Time_End": 320.0, "Text": " Philip Morris's parent, Altria."}, {"Time_Start": 320.0, "Time_End": 321.0, "Text": " You are not cleared for that information."}, {"Time_Start": 321.0, "Time_End": 322.0, "Text": " for that information."}, {"Time_Start": 322.0, "Time_End": 326.0, "Text": " And Sands informed me that all accesses are logged."}, {"Time_Start": 326.0, "Time_End": 327.0, "Text": " Damn."}, {"Time_Start": 327.0, "Time_End": 332.0, "Text": " So I actually thought that these might be some good companies to take a further look at"}, {"Time_Start": 332.0, "Time_End": 337.0, "Text": " because A, they're large companies, they can afford security staff."}, {"Time_Start": 337.0, "Time_End": 342.0, "Text": " B, they've obviously made at least some attempts at securing in that, you know, they rejected"}, {"Time_Start": 342.0, "Time_End": 347.0, "Text": " the zone transfers, they put flippant remarks in their version numbers and so forth."}, {"Time_Start": 347.0, "Time_End": 350.98, "Text": " So I thought that would be more interesting than, you know, if we scan a totally open"}, {"Time_Start": 351.0, "Time_End": 352.0, "Text": " network."}, {"Time_Start": 352.0, "Time_End": 355.0, "Text": " Well, you know, duh, that's easy."}, {"Time_Start": 355.0, "Time_End": 357.0, "Text": " So let's go ahead at other ways."}, {"Time_Start": 357.0, "Time_End": 361.0, "Text": " I'm not going to talk much about NetCraft, but just to mention that that's sometimes underutilized"}, {"Time_Start": 361.0, "Time_End": 364.0, "Text": " in, you know, gathering more information on the company."}, {"Time_Start": 364.0, "Time_End": 368.0, "Text": " You can find domain names that are similar to the company names."}, {"Time_Start": 368.0, "Time_End": 370.0, "Text": " Use similar..."}, {"Time_Start": 370.0, "Time_End": 372.0, "Text": " They took away that?"}, {"Time_Start": 372.0, "Time_End": 374.0, "Text": " Oh, bastards."}, {"Time_Start": 374.0, "Time_End": 380.0, "Text": " But there's still plenty of great features that you can use, such as you can detail down on each one,"}, {"Time_Start": 380.0, "Time_End": 381.0, "Text": " and I'll talk to you."}, {"Time_Start": 381.0, "Time_End": 384.0, "Text": " NetCraft."}, {"Time_Start": 384.0, "Time_End": 391.0, "Text": " Narrow down on each one to get the uptime graphs, to get the hosting history, and all sorts of goodies."}, {"Time_Start": 391.0, "Time_End": 395.0, "Text": " And the great thing is that, you know, here you're totally anonymous sense, you know, it's"}, {"Time_Start": 395.0, "Time_End": 399.0, "Text": " the NetCraft server you're querying, and most of these are in their cache."}, {"Time_Start": 399.0, "Time_End": 405.0, "Text": " The geographical IP registries are another place to start, Erin, Ripe, Appnick, you know,"}, {"Time_Start": 405.0, "Time_End": 410.0, "Text": " find the contact information, emails, phone numbers, etc., etc."}, {"Time_Start": 410.0, "Time_End": 410.98, "Text": " And you can basically"}, {"Time_Start": 411.0, "Time_End": 416.0, "Text": " take the seed numbers that you got from the previous stuff, you know, look up what networks they belong to,"}, {"Time_Start": 416.0, "Time_End": 424.0, "Text": " who administers them, what else that person administers, and keep cycling in this loop as you gain more and more IP addresses."}, {"Time_Start": 424.0, "Time_End": 425.0, "Text": " Here's an example."}, {"Time_Start": 425.0, "Time_End": 429.0, "Text": " We do a who is on Aaron with the string at Microsoft.com."}, {"Time_Start": 429.0, "Time_End": 432.0, "Text": " And again, we see, you know, pages and pages."}, {"Time_Start": 432.0, "Time_End": 440.0, "Text": " This only goes up to H of contacts there, who we can not only find out what networks they run to find IPs,"}, {"Time_Start": 440.0, "Time_End": 441.0, "Text": " but we can save that information."}, {"Time_Start": 441.0, "Time_End": 443.0, "Text": " for further social engineering,"}, {"Time_Start": 443.0, "Time_End": 447.0, "Text": " drill down on each one for their address and so forth."}, {"Time_Start": 447.0, "Time_End": 449.0, "Text": " Here's another example."}, {"Time_Start": 449.0, "Time_End": 450.0, "Text": " We're going to do Aaron."}, {"Time_Start": 450.0, "Time_End": 453.0, "Text": " And here we give the query N, look for net blocks,"}, {"Time_Start": 453.0, "Time_End": 455.0, "Text": " with the name Playboy in it."}, {"Time_Start": 455.0, "Time_End": 458.0, "Text": " And indeed, we get a whole bunch of responses."}, {"Time_Start": 458.0, "Time_End": 461.0, "Text": " Now obviously companies can have similar names,"}, {"Time_Start": 461.0, "Time_End": 462.0, "Text": " so you want to go through and make sure,"}, {"Time_Start": 462.0, "Time_End": 464.0, "Text": " you know, look up each record, check the address,"}, {"Time_Start": 464.0, "Time_End": 466.0, "Text": " make sure it corresponds."}, {"Time_Start": 466.0, "Time_End": 468.0, "Text": " In this case, it does."}, {"Time_Start": 468.0, "Time_End": 469.0, "Text": " So,"}, {"Time_Start": 469.0, "Time_End": 477.0, "Text": " Obviously, this part can't be comprehensive because there's, you know, any number of ways that you can find such thing."}, {"Time_Start": 477.0, "Time_End": 482.0, "Text": " One of the more fun ones, though, are the public route servers I've been looking at lately,"}, {"Time_Start": 482.0, "Time_End": 490.0, "Text": " such as tracerout.org, gives you a list of Cisco boxes that you're publicly able to connect to them"}, {"Time_Start": 490.0, "Time_End": 498.0, "Text": " and get full BGP routing information, so you can look up the AS numbers and so forth of the companies that you're interested in."}, {"Time_Start": 498.0, "Time_End": 501.0, "Text": " and many more techniques that I won't cover."}, {"Time_Start": 501.0, "Time_End": 504.0, "Text": " But the point of that was just so that we can get the IP addresses"}, {"Time_Start": 504.0, "Time_End": 507.0, "Text": " that we're interested in doing further reconnaissance on."}, {"Time_Start": 507.0, "Time_End": 509.0, "Text": " So using some of those techniques,"}, {"Time_Start": 509.0, "Time_End": 514.0, "Text": " I cooled a bunch of networks from Playboy to use them as an example."}, {"Time_Start": 514.0, "Time_End": 519.0, "Text": " Now, I did exclude certain net blocks, such as some of the gaming sites"}, {"Time_Start": 519.0, "Time_End": 522.0, "Text": " because if a key to see no was to catch you scanning them,"}, {"Time_Start": 522.0, "Time_End": 524.0, "Text": " they're liable to break your kneecaps."}, {"Time_Start": 524.0, "Time_End": 527.0, "Text": " So be careful with that."}, {"Time_Start": 527.0, "Time_End": 528.0, "Text": " You can see that."}, {"Time_Start": 528.0, "Time_End": 535.0, "Text": " see here that these are in kind of CIDR notation, so you have a slash 20 here, that's 4,000 hosts, a slash 24."}, {"Time_Start": 535.0, "Time_End": 543.0, "Text": " All the way down to here is just dot 101 through 105, so that's only what six hosts or five."}, {"Time_Start": 543.0, "Time_End": 550.0, "Text": " But NMAP takes it in this convenient format so we can feed that in directly."}, {"Time_Start": 550.0, "Time_End": 552.0, "Text": " So what are we going to start out with?"}, {"Time_Start": 552.0, "Time_End": 556.0, "Text": " Well, we don't want to start out with the ringing all the bells and whistles and IDSs and so forth."}, {"Time_Start": 556.0, "Time_End": 557.0, "Text": " So we're going to start simple."}, {"Time_Start": 557.0, "Time_End": 562.0, "Text": " with the cautious approach, which in NMAP I call the list scan."}, {"Time_Start": 562.0, "Time_End": 566.0, "Text": " So we're going to say, hyphen SL, do a list scan, output to a file,"}, {"Time_Start": 566.0, "Time_End": 569.0, "Text": " and I give it all these addresses that we just looked at."}, {"Time_Start": 569.0, "Time_End": 572.0, "Text": " And here basically all it's doing is going through each one"}, {"Time_Start": 572.0, "Time_End": 576.0, "Text": " and doing a reverse DNS lookup on it, so we can kind of see what we're after."}, {"Time_Start": 576.0, "Time_End": 578.0, "Text": " And this is important for a lot of reasons."}, {"Time_Start": 578.0, "Time_End": 580.0, "Text": " For example, verification."}, {"Time_Start": 580.0, "Time_End": 584.0, "Text": " You know, just because they own the IP blocks doesn't for sure mean that they're using them."}, {"Time_Start": 584.0, "Time_End": 586.0, "Text": " They could be subletting to some other company."}, {"Time_Start": 586.0, "Time_End": 592.0, "Text": " some of the IPs they could be sharing with some other company in the basement."}, {"Time_Start": 592.0, "Time_End": 596.0, "Text": " And so this at least we can look up the names and make sure that there's nothing too out of whack."}, {"Time_Start": 596.0, "Time_End": 601.0, "Text": " Also, sometimes from the names you can figure out what specific machines you might want to dig into"}, {"Time_Start": 601.0, "Time_End": 607.0, "Text": " for more information if you don't want to go after all of them for reasons of subtlety."}, {"Time_Start": 607.0, "Time_End": 610.0, "Text": " So the next step, once we've done that, is the PING scan."}, {"Time_Start": 610.0, "Time_End": 614.0, "Text": " We want to know which of these hosts are up and available."}, {"Time_Start": 614.0, "Time_End": 616.0, "Text": " And so here I did the same thing."}, {"Time_Start": 616.0, "Time_End": 622.0, "Text": " A lot of people don't recognize how much more powerful the ping scanning techniques of NMAP have gotten recently."}, {"Time_Start": 622.0, "Time_End": 629.0, "Text": " You know, there was a day on the internet where you could just send an ICMP, you know, echo request ping packet,"}, {"Time_Start": 629.0, "Time_End": 633.0, "Text": " and pretty much most of the machines that were up would respond happily."}, {"Time_Start": 633.0, "Time_End": 641.0, "Text": " Nowadays, with so many filters and paranoia and such, you have to sometimes go a little bit further in probing the machines looking for any sort of response."}, {"Time_Start": 641.0, "Time_End": 645.0, "Text": " So here we're saying, do a ping scan, SP."}, {"Time_Start": 645.0, "Time_End": 653.56, "Text": " Use sin probes against port 22, 25, 5380, 113, and 31 338."}, {"Time_Start": 653.66, "Time_End": 658.1, "Text": " I just picked a big one because sometimes firewalls only deal with the lower ports."}, {"Time_Start": 659.1, "Time_End": 662.74, "Text": " And that'll send a sin request to each of those and expect a response back."}, {"Time_Start": 663.34, "Time_End": 670.34, "Text": " Similarly, we do an AC scan to a number of ports expecting a reset pack."}, {"Time_Start": 671.54, "Time_End": 674.54, "Text": " And a relatively new feature is hyphen PU."}, {"Time_Start": 675.0, "Time_End": 679.0, "Text": " which sends a UDP packet to the ports that we specify"}, {"Time_Start": 679.0, "Time_End": 683.0, "Text": " and expects an ICMP port unreachable back."}, {"Time_Start": 683.0, "Time_End": 685.0, "Text": " If it gets that, then it knows that they're up."}, {"Time_Start": 685.0, "Time_End": 688.0, "Text": " So you can specify pretty much an arbitrary combination"}, {"Time_Start": 688.0, "Time_End": 692.0, "Text": " of all these different ways to try and elicit some sort of response from the hosts"}, {"Time_Start": 692.0, "Time_End": 697.0, "Text": " so that we can narrow it down from the more than 4,000 that we had listed before."}, {"Time_Start": 697.0, "Time_End": 701.0, "Text": " It also has PE, which is the traditional ping packet,"}, {"Time_Start": 701.0, "Time_End": 704.0, "Text": " and PM, which is an ICMP, netmas request."}, {"Time_Start": 704.0, "Time_End": 705.0, "Text": " And just for kids,"}, {"Time_Start": 705.0, "Time_End": 709.0, "Text": " we set the source address on all the TCP and UDP probes to 53"}, {"Time_Start": 709.0, "Time_End": 712.0, "Text": " because we've all seen once in a while some firewall admin"}, {"Time_Start": 712.0, "Time_End": 715.0, "Text": " will set up his new firewall, inexperienced firewall admin,"}, {"Time_Start": 715.0, "Time_End": 717.0, "Text": " and say, uh-oh, nothing's working."}, {"Time_Start": 717.0, "Time_End": 720.0, "Text": " You know, DNS responses aren't coming back."}, {"Time_Start": 720.0, "Time_End": 722.0, "Text": " Well, you know, there are right ways to fix it,"}, {"Time_Start": 722.0, "Time_End": 724.0, "Text": " and then there are easy ways to fix it."}, {"Time_Start": 724.0, "Time_End": 726.0, "Text": " And a lot of people pick the, well, you know,"}, {"Time_Start": 726.0, "Time_End": 729.0, "Text": " we'll just allow source port 53."}, {"Time_Start": 729.0, "Time_End": 731.0, "Text": " You know, no one's going to notice that."}, {"Time_Start": 731.0, "Time_End": 733.0, "Text": " You know, what are the chances the probes will come from there?"}, {"Time_Start": 733.0, "Time_End": 735.0, "Text": " So, you know, if we put it there just,"}, {"Time_Start": 735.0, "Time_End": 737.0, "Text": " in case it might work."}, {"Time_Start": 737.0, "Time_End": 740.0, "Text": " Other popular choices would be TCP port 20"}, {"Time_Start": 740.0, "Time_End": 745.0, "Text": " because you have the same case with TCP FTP connections coming back."}, {"Time_Start": 745.0, "Time_End": 750.0, "Text": " And so we run that command and it completes,"}, {"Time_Start": 750.0, "Time_End": 753.0, "Text": " and it said that of those 4,393 IP addresses,"}, {"Time_Start": 753.0, "Time_End": 756.0, "Text": " there are 950 of them up."}, {"Time_Start": 756.0, "Time_End": 758.0, "Text": " I just showed a few examples here."}, {"Time_Start": 758.0, "Time_End": 761.0, "Text": " But with any tool, even NMAP,"}, {"Time_Start": 761.0, "Time_End": 763.0, "Text": " you want to make sure that you verify your results."}, {"Time_Start": 763.0, "Time_End": 764.0, "Text": " Go through and look at the output file."}, {"Time_Start": 764.0, "Time_End": 767.0, "Text": " output file and make sure that everything makes sense."}, {"Time_Start": 767.0, "Time_End": 770.0, "Text": " So here, you know, I look at the machine readable output,"}, {"Time_Start": 770.0, "Time_End": 773.0, "Text": " which is what we see in front of us."}, {"Time_Start": 773.0, "Time_End": 776.0, "Text": " And I see hundreds of machines consecutive"}, {"Time_Start": 776.0, "Time_End": 778.0, "Text": " that all look like they're up."}, {"Time_Start": 778.0, "Time_End": 780.0, "Text": " And, you know, that's a little bit suspicious,"}, {"Time_Start": 780.0, "Time_End": 782.0, "Text": " because you would think if they were real machines,"}, {"Time_Start": 782.0, "Time_End": 784.0, "Text": " you would see, you know, a gap in somewhere."}, {"Time_Start": 784.0, "Time_End": 787.0, "Text": " I mean, yeah, it could, and they don't even have reverse DNS."}, {"Time_Start": 787.0, "Time_End": 790.0, "Text": " So yeah, it could be a cluster of machines that's very thick,"}, {"Time_Start": 790.0, "Time_End": 793.0, "Text": " but you kind of want to look into it more"}, {"Time_Start": 793.0, "Time_End": 794.0, "Text": " to make sure you don't waste too much."}, {"Time_Start": 794.0, "Time_End": 797.0, "Text": " much time on machines that aren't really reachable."}, {"Time_Start": 797.0, "Time_End": 801.0, "Text": " So one way to figure that out is say, well, which of these ping probes"}, {"Time_Start": 801.0, "Time_End": 805.0, "Text": " were those alleged up hosts responding to?"}, {"Time_Start": 805.0, "Time_End": 809.0, "Text": " And so MMAP has a feature, not added too too long ago,"}, {"Time_Start": 809.0, "Time_End": 814.0, "Text": " hyphen, hyphen packet trace, which will show you all the packets"}, {"Time_Start": 814.0, "Time_End": 815.0, "Text": " and maps sends and receives."}, {"Time_Start": 815.0, "Time_End": 818.0, "Text": " So we do a command just like the one before,"}, {"Time_Start": 818.0, "Time_End": 821.0, "Text": " but instead we just pick one of those possibly phantom hosts"}, {"Time_Start": 821.0, "Time_End": 823.0, "Text": " to look at and see what it's really responding to."}, {"Time_Start": 823.0, "Time_End": 827.0, "Text": " responding to. So we see the ping request, the UDP requests, the TCP sins,"}, {"Time_Start": 827.0, "Time_End": 833.0, "Text": " TCP acts, and then down at the bottom here, you see this receive line saying that"}, {"Time_Start": 833.0, "Time_End": 838.0, "Text": " it's receiving a TCP reset from port 113 from the host."}, {"Time_Start": 838.0, "Time_End": 844.0, "Text": " Now those of you again who do firewalls know that 113 or the Ident D port"}, {"Time_Start": 844.0, "Time_End": 848.0, "Text": " is also an annoying one. You set up your firewall to block incoming connections"}, {"Time_Start": 848.0, "Time_End": 853.0, "Text": " and then one of your users connects to a mail server or an IRC server and it tries to"}, {"Time_Start": 853.0, "Time_End": 859.0, "Text": " right back to 113 to figure out what user is owning that connection."}, {"Time_Start": 859.0, "Time_End": 865.0, "Text": " And if your firewall is blocking it, that can take a long time to time out and frustrate your users."}, {"Time_Start": 865.0, "Time_End": 868.0, "Text": " And again, that leaves the admin with several possible options,"}, {"Time_Start": 868.0, "Time_End": 870.0, "Text": " and they don't always choose the right one."}, {"Time_Start": 870.0, "Time_End": 873.0, "Text": " Sometimes they say, well, you know, we'll allow 113."}, {"Time_Start": 873.0, "Time_End": 875.0, "Text": " It's only identity, you know, what harm can it be?"}, {"Time_Start": 875.0, "Time_End": 877.0, "Text": " And that way it'll actually work."}, {"Time_Start": 877.0, "Time_End": 882.0, "Text": " With newer firewalls, most of the modern ones, you can say Spufa reset,"}, {"Time_Start": 882.0, "Time_End": 883.0, "Text": " so that it looks like the most of the most of the most of the ones,"}, {"Time_Start": 883.0, "Time_End": 890.0, "Text": " machine is there and listening and just stopping the port 113 without having a long timeout."}, {"Time_Start": 890.0, "Time_End": 893.0, "Text": " And so that leaves us in a quandary. We don't really know."}, {"Time_Start": 893.0, "Time_End": 900.0, "Text": " Is the firewall here blocking the port and spoofing this packet allegedly from 140.226?"}, {"Time_Start": 900.0, "Time_End": 905.0, "Text": " Or did we find a hole that allows us to reach the machine behind it?"}, {"Time_Start": 905.0, "Time_End": 909.0, "Text": " And so you might want to think a little bit about if you were doing this scan,"}, {"Time_Start": 909.0, "Time_End": 913.0, "Text": " you know, what methods would you use to determine what's really going on there?"}, {"Time_Start": 913.0, "Time_End": 920.0, "Text": " And I'll demonstrate a couple ideas, and then maybe you'll have some of your own ideas afterward."}, {"Time_Start": 920.0, "Time_End": 923.0, "Text": " So one thing we could try is the IPID."}, {"Time_Start": 923.0, "Time_End": 930.0, "Text": " As most of you know, every IP packet in the header has an ID flag that's used for fragmentation reassembly,"}, {"Time_Start": 930.0, "Time_End": 934.0, "Text": " so it can figure out what IP packet a fragment belongs to."}, {"Time_Start": 934.0, "Time_End": 941.0, "Text": " And so one thing with IPID, though, is that implementers have a lot of leeway in how they implement it."}, {"Time_Start": 941.0, "Time_End": 942.0, "Text": " So they generally do the easy approach."}, {"Time_Start": 942.0, "Time_End": 949.0, "Text": " do the easy approach of just using a counter that goes from 0 to 65, 535, and then back to zero again."}, {"Time_Start": 949.0, "Time_End": 953.0, "Text": " With each packet they send, they increment it by one."}, {"Time_Start": 953.0, "Time_End": 956.0, "Text": " Other, a few other hosts use different techniques."}, {"Time_Start": 956.0, "Time_End": 960.0, "Text": " So we're going to use the great HPing utility, which you probably all have,"}, {"Time_Start": 960.0, "Time_End": 966.0, "Text": " and if not I stuck it on the DefCon CD, to do a probe to port 113,"}, {"Time_Start": 966.0, "Time_End": 968.0, "Text": " a Syn probe on that machine."}, {"Time_Start": 968.0, "Time_End": 972.0, "Text": " And we look at the responses with a particular emphasis on this"}, {"Time_Start": 972.0, "Time_End": 974.0, "Text": " on the IPID that's in red."}, {"Time_Start": 974.0, "Time_End": 977.0, "Text": " So for this first host, we see it's 4,700,"}, {"Time_Start": 977.0, "Time_End": 980.0, "Text": " 57,900, 9,400."}, {"Time_Start": 980.0, "Time_End": 983.0, "Text": " It's a pretty random-looking distribution."}, {"Time_Start": 983.0, "Time_End": 986.0, "Text": " And then we try another one of these hosts,"}, {"Time_Start": 986.0, "Time_End": 988.0, "Text": " and we look again, and shucks,"}, {"Time_Start": 988.0, "Time_End": 991.0, "Text": " it's another random looking distribution."}, {"Time_Start": 991.0, "Time_End": 993.0, "Text": " If we had seen that this one was incrementing"}, {"Time_Start": 993.0, "Time_End": 998.0, "Text": " from 4793 to 4794 to 4795,"}, {"Time_Start": 998.0, "Time_End": 1001.0, "Text": " and this one was like 5309, 5309,"}, {"Time_Start": 1001.0, "Time_End": 1002.0, "Text": " 53010,"}, {"Time_Start": 1002.0, "Time_End": 1005.0, "Text": " we would know that they were probably different machines"}, {"Time_Start": 1005.0, "Time_End": 1007.0, "Text": " because they're both incrementing,"}, {"Time_Start": 1007.0, "Time_End": 1010.0, "Text": " but they're on a totally different phase there."}, {"Time_Start": 1010.0, "Time_End": 1013.0, "Text": " In the same way, you could send a bunch of packets to one"}, {"Time_Start": 1013.0, "Time_End": 1016.0, "Text": " and see if it increments the IPID of the other."}, {"Time_Start": 1016.0, "Time_End": 1018.0, "Text": " Or if this one was random and this one was sequential,"}, {"Time_Start": 1018.0, "Time_End": 1020.0, "Text": " again, we'd see that it was something different."}, {"Time_Start": 1020.0, "Time_End": 1023.0, "Text": " But unfortunately, this hasn't fully worked for us"}, {"Time_Start": 1023.0, "Time_End": 1025.0, "Text": " because they're both random."}, {"Time_Start": 1025.0, "Time_End": 1027.0, "Text": " And that tells us that it's probably a firewall,"}, {"Time_Start": 1027.0, "Time_End": 1029.0, "Text": " since they're the ones that usually do that,"}, {"Time_Start": 1029.0, "Time_End": 1031.0, "Text": " but systems like OpenBSD will do it too."}, {"Time_Start": 1031.0, "Time_End": 1036.0, "Text": " we'll do it too. So this leads credence to the idea that the firewall is sending the packet back,"}, {"Time_Start": 1036.0, "Time_End": 1042.0, "Text": " but you know, it could be a cluster of open BSD machines behind there. You never know."}, {"Time_Start": 1042.0, "Time_End": 1046.0, "Text": " So let's try something else then. Maybe trace route will help us."}, {"Time_Start": 1046.0, "Time_End": 1052.0, "Text": " So we do a trace route to their mail server,"}, {"Time_Start": 1052.0, "Time_End": 1057.0, "Text": " mx.shy.playboy.com, and using the normal trace route command."}, {"Time_Start": 1057.0, "Time_End": 1060.0, "Text": " And we see that it goes from San Jose to Chicago to the"}, {"Time_Start": 1060.0, "Time_End": 1064.0, "Text": " to the Playboy network, and then it stops at this F0-0,"}, {"Time_Start": 1064.0, "Time_End": 1070.0, "Text": " and it's filtered, and so we're not able to see the destination host at all."}, {"Time_Start": 1070.0, "Time_End": 1073.0, "Text": " So, you know, 10 hops really isn't a lot."}, {"Time_Start": 1073.0, "Time_End": 1076.0, "Text": " We would like to get all the way to the destination host."}, {"Time_Start": 1076.0, "Time_End": 1080.0, "Text": " So instead we're going to do a more custom trace route against the machine."}, {"Time_Start": 1080.0, "Time_End": 1083.0, "Text": " Using HP2 again, it's trace route mode."}, {"Time_Start": 1083.0, "Time_End": 1087.0, "Text": " We do a trace route to port 25, because this is a mail server,"}, {"Time_Start": 1087.0, "Time_End": 1089.0, "Text": " so that instead of using the default UDP probe that gets filtered,"}, {"Time_Start": 1089.0, "Time_End": 1095.0, "Text": " that gets filtered, hopefully the sin packet to port 25 will make it all the way to the server"}, {"Time_Start": 1095.0, "Time_End": 1097.0, "Text": " so that mailers can make connections."}, {"Time_Start": 1097.0, "Time_End": 1103.0, "Text": " And here we see it gets to 10, 11 no response, but 12 all of a sudden we get a TTL"}, {"Time_Start": 1103.0, "Time_End": 1107.0, "Text": " from this FW.shai. Playboy.com."}, {"Time_Start": 1107.0, "Time_End": 1109.0, "Text": " I have to, yeah, I have to thank them for the great naming."}, {"Time_Start": 1109.0, "Time_End": 1110.0, "Text": " It's really helpful."}, {"Time_Start": 1110.0, "Time_End": 1115.0, "Text": " Like their firewall is FW, it's in Chicago, their mail server is MX.chi."}, {"Time_Start": 1115.0, "Time_End": 1118.0, "Text": " You know, that's real convenient and I do appreciate it."}, {"Time_Start": 1118.0, "Time_End": 1125.0, "Text": " But, and then we get a response from the actual host 13 hops away."}, {"Time_Start": 1125.0, "Time_End": 1131.0, "Text": " So that tells us that, you know, we know that the end host is apparently 13 hosts away"}, {"Time_Start": 1131.0, "Time_End": 1135.0, "Text": " and we can get the response by going to port 25."}, {"Time_Start": 1135.0, "Time_End": 1141.0, "Text": " So now we'll try port 113, which is the port that was giving us trouble against the same host."}, {"Time_Start": 1141.0, "Time_End": 1145.0, "Text": " And here we get to 10 like usual, 11 gives us nothing,"}, {"Time_Start": 1145.0, "Time_End": 1148.0, "Text": " but this time we're getting the response from the host at hopper,"}, {"Time_Start": 1148.0, "Time_End": 1155.0, "Text": " number 12, whereas last time that's where the firewall it was, and the real host was on 13."}, {"Time_Start": 1155.0, "Time_End": 1163.0, "Text": " So this pretty here gives us enough evidence to close the deal that it's really the firewall that's at hop 12,"}, {"Time_Start": 1163.0, "Time_End": 1169.0, "Text": " but it's just spoofing the packet to make it look like it's coming from 143.2 and it's sending a reset."}, {"Time_Start": 1169.0, "Time_End": 1173.0, "Text": " And so that means we probably can't reach the machines at all."}, {"Time_Start": 1173.0, "Time_End": 1176.0, "Text": " Does anyone have other ideas?"}, {"Time_Start": 1176.0, "Time_End": 1177.0, "Text": " Suppose this hadn't worked."}, {"Time_Start": 1177.0, "Time_End": 1181.0, "Text": " worked and the IPID failed as it did and the trace route had failed too."}, {"Time_Start": 1181.0, "Time_End": 1186.0, "Text": " What other techniques do you think we could have used to try and determine whether the host"}, {"Time_Start": 1186.0, "Time_End": 1190.0, "Text": " is spoofing the packet is alive or whether it's the firewall spoofing?"}, {"Time_Start": 1190.0, "Time_End": 1193.0, "Text": " ISN Prober?"}, {"Time_Start": 1193.0, "Time_End": 1202.0, "Text": " It's quite a great tool that's also that looks at DCP."}, {"Time_Start": 1202.0, "Time_End": 1207.0, "Text": " Okay, that's great. He's suggesting a good tool called ISN Prober, which I haven't personally used."}, {"Time_Start": 1207.0, "Time_End": 1213.0, "Text": " But instead of checking the IPID sequences, they would have checked the TCPISN sequences."}, {"Time_Start": 1213.0, "Time_End": 1218.0, "Text": " And so if it was like a 64K rule or Windows time dependent or such,"}, {"Time_Start": 1218.0, "Time_End": 1223.0, "Text": " we could see that they're on totally different phases or use different algorithms."}, {"Time_Start": 1223.0, "Time_End": 1226.0, "Text": " What other techniques do you think you could use?"}, {"Time_Start": 1226.0, "Time_End": 1227.0, "Text": " Sure."}, {"Time_Start": 1227.0, "Time_End": 1229.0, "Text": " Time to lift?"}, {"Time_Start": 1229.0, "Time_End": 1233.0, "Text": " Yeah, kind of like, you mean like we were doing here?"}, {"Time_Start": 1237.0, "Time_End": 1245.0, "Text": " Right, yeah, I think that's what we're doing here, where we see that since it's 12, we know that it's spoofing it on the TTL."}, {"Time_Start": 1245.0, "Time_End": 1249.0, "Text": " And since it's 13, we know that it's not."}, {"Time_Start": 1249.0, "Time_End": 1251.0, "Text": " Anyone have other ideas?"}, {"Time_Start": 1255.0, "Time_End": 1257.0, "Text": " NBT stat?"}, {"Time_Start": 1257.0, "Time_End": 1263.0, "Text": " Okay, yeah, so if it's like a Windows host and it had those ports open, you could try that."}, {"Time_Start": 1263.0, "Time_End": 1266.0, "Text": " Hopefully they wouldn't put their mail server on there, but you know, some people do."}, {"Time_Start": 1266.0, "Time_End": 1269.0, "Text": " know, some people do."}, {"Time_Start": 1269.0, "Time_End": 1281.0, "Text": " Okay, that's another great idea."}, {"Time_Start": 1281.0, "Time_End": 1283.0, "Text": " See, there are a lot of ways to do it."}, {"Time_Start": 1283.0, "Time_End": 1289.0, "Text": " His suggestion for people who didn't hear was to do an OS fingerprint such as NMAP-H-O and, you know,"}, {"Time_Start": 1289.0, "Time_End": 1291.0, "Text": " see if they match."}, {"Time_Start": 1291.0, "Time_End": 1295.0, "Text": " Another technique for anyone who's read Frank 60, someone wrote a real good paper on"}, {"Time_Start": 1295.0, "Time_End": 1298.0, "Text": " on bad checksums."}, {"Time_Start": 1298.0, "Time_End": 1300.0, "Text": " They found that many firewalls"}, {"Time_Start": 1300.0, "Time_End": 1302.0, "Text": " configured this way to respond to packets"}, {"Time_Start": 1302.0, "Time_End": 1305.0, "Text": " wouldn't even look at the check sum and would respond"}, {"Time_Start": 1305.0, "Time_End": 1308.0, "Text": " regardless of whether the check sum is valid."}, {"Time_Start": 1308.0, "Time_End": 1310.0, "Text": " Whereas any decent end host, even a Windows host,"}, {"Time_Start": 1310.0, "Time_End": 1313.0, "Text": " is going to just drop that packet on the floor."}, {"Time_Start": 1313.0, "Time_End": 1316.0, "Text": " So if we had sent our sin packets from a,"}, {"Time_Start": 1316.0, "Time_End": 1320.0, "Text": " if we had sent it with a bad check sum and didn't get a response,"}, {"Time_Start": 1320.0, "Time_End": 1323.0, "Text": " you know, there's a good chance that the host was receiving it."}, {"Time_Start": 1323.0, "Time_End": 1325.0, "Text": " Whereas if we got a response to a bad check sum,"}, {"Time_Start": 1325.0, "Time_End": 1328.0, "Text": " we would be pretty certain that it's the firewall,"}, {"Time_Start": 1328.0, "Time_End": 1331.0, "Text": " since no host would do that."}, {"Time_Start": 1331.0, "Time_End": 1334.0, "Text": " So that's just an example of how there are a lot of means"}, {"Time_Start": 1334.0, "Time_End": 1337.0, "Text": " in your pen testing to achieve the same ends,"}, {"Time_Start": 1337.0, "Time_End": 1340.0, "Text": " and sometimes you'll get frustrated by the first couple tries."}, {"Time_Start": 1340.0, "Time_End": 1342.0, "Text": " But, you know, if you think about it,"}, {"Time_Start": 1342.0, "Time_End": 1345.0, "Text": " you can often find ways to get around these problems."}, {"Time_Start": 1345.0, "Time_End": 1348.0, "Text": " A side note on host names, real quick,"}, {"Time_Start": 1348.0, "Time_End": 1350.0, "Text": " we noticed that MX."}, {"Time_Start": 1350.0, "Time_End": 1352.0, "Text": " Chai and FW Chai were well-named."}, {"Time_Start": 1352.0, "Time_End": 1354.0, "Text": " Security focus wasn't quite as kind."}, {"Time_Start": 1354.0, "Time_End": 1358.0, "Text": " quite as kind. I was looking through the zone transfer and saw a bugzilla,"}, {"Time_Start": 1358.0, "Time_End": 1360.0, "Text": " and I thought, hey, I know that bug tracking system."}, {"Time_Start": 1360.0, "Time_End": 1362.0, "Text": " I know an exploit for that."}, {"Time_Start": 1362.0, "Time_End": 1367.0, "Text": " And so I tell them it in, and instead I get this Raptor secure firewall gateway and so forth."}, {"Time_Start": 1367.0, "Time_End": 1373.0, "Text": " So you can't always assume that it's going to be, you know, exactly as they say."}, {"Time_Start": 1373.0, "Time_End": 1375.0, "Text": " You know, host names go out of date."}, {"Time_Start": 1375.0, "Time_End": 1379.0, "Text": " They may be trying to trick you, you know, or for whatever other reason."}, {"Time_Start": 1379.0, "Time_End": 1383.0, "Text": " So now the whole point of that exercise of finding out the 1-1-3 thing is that now"}, {"Time_Start": 1383.0, "Time_End": 1388.0, "Text": " is that now we can redo our P-Scan, and this time, 1-1-3 is out of the picture,"}, {"Time_Start": 1388.0, "Time_End": 1391.0, "Text": " because we know that it's giving us unreliable results."}, {"Time_Start": 1391.0, "Time_End": 1394.0, "Text": " And this time we only see 71 hosts up,"}, {"Time_Start": 1394.0, "Time_End": 1397.0, "Text": " as opposed to the 950 that we got before."}, {"Time_Start": 1397.0, "Time_End": 1402.0, "Text": " And so that's a much more manageable number for us to deal with."}, {"Time_Start": 1402.0, "Time_End": 1406.0, "Text": " So I just use a quick, easy command to grab all the IP addresses"}, {"Time_Start": 1406.0, "Time_End": 1409.0, "Text": " from our NMAP log and put them in a file."}, {"Time_Start": 1409.0, "Time_End": 1411.0, "Text": " And I also added that FW. shi, because the filet"}, {"Time_Start": 1411.0, "Time_End": 1417.0, "Text": " fW. shi, because the filtering on that was good enough that it didn't respond to any of our ping probes."}, {"Time_Start": 1417.0, "Time_End": 1423.0, "Text": " However, thanks to the little expedition we did, we found it via the custom trace route,"}, {"Time_Start": 1423.0, "Time_End": 1426.0, "Text": " and so of course we want to scan it too."}, {"Time_Start": 1426.0, "Time_End": 1430.0, "Text": " So now I'm going to move to a slightly different tangent."}, {"Time_Start": 1430.0, "Time_End": 1433.0, "Text": " We'll go back to those later."}, {"Time_Start": 1433.0, "Time_End": 1438.0, "Text": " Sometimes what you really want to do is do a fast single-service sweep."}, {"Time_Start": 1438.0, "Time_End": 1440.98, "Text": " So hypothetically, suppose there was a huge Windows"}, {"Time_Start": 1441.0, "Time_End": 1444.0, "Text": " RPCDCOM exploit on the loose."}, {"Time_Start": 1444.0, "Time_End": 1449.0, "Text": " And you want to scan all your systems really fast before the attackers do"}, {"Time_Start": 1449.0, "Time_End": 1451.0, "Text": " for port 1135."}, {"Time_Start": 1451.0, "Time_End": 1454.0, "Text": " Of course, you know, it can potentially be exploited on other ports,"}, {"Time_Start": 1454.0, "Time_End": 1456.0, "Text": " but that's the main one."}, {"Time_Start": 1456.0, "Time_End": 1461.0, "Text": " And so NMAP has what I call a turbo mode that supports that to make it really fast."}, {"Time_Start": 1461.0, "Time_End": 1464.0, "Text": " Now for Playboy, I'm not going to scan 135."}, {"Time_Start": 1464.0, "Time_End": 1468.0, "Text": " Given the nature of their sites, I decided I wanted to find web servers."}, {"Time_Start": 1468.0, "Time_End": 1470.0, "Text": " And so here,"}, {"Time_Start": 1470.0, "Time_End": 1475.0, "Text": " And so here we're say, do a CIN probe to Port 80."}, {"Time_Start": 1475.0, "Time_End": 1479.0, "Text": " Do a CIN scan, and we want to scan for Port 80."}, {"Time_Start": 1479.0, "Time_End": 1482.0, "Text": " And NMAP will be smart enough to say, hey,"}, {"Time_Start": 1482.0, "Time_End": 1485.0, "Text": " you know, the PIM probe is already sending a CIN packet"}, {"Time_Start": 1485.0, "Time_End": 1487.0, "Text": " and getting a reset or a CINAC."}, {"Time_Start": 1487.0, "Time_End": 1490.0, "Text": " So let's skip the whole port scan and just use the PIM probe results"}, {"Time_Start": 1490.0, "Time_End": 1492.0, "Text": " to give you what you need."}, {"Time_Start": 1492.0, "Time_End": 1496.0, "Text": " And so this was able to scan those 4397 hosts"}, {"Time_Start": 1496.0, "Time_End": 1499.0, "Text": " in just a little under a minute."}, {"Time_Start": 1499.0, "Time_End": 1501.0, "Text": " which can be handy."}, {"Time_Start": 1501.0, "Time_End": 1504.0, "Text": " Sometimes I get emails from people saying,"}, {"Time_Start": 1504.0, "Time_End": 1505.0, "Text": " dude, NMAP is so slow."}, {"Time_Start": 1505.0, "Time_End": 1507.0, "Text": " I wrote my own scanner,"}, {"Time_Start": 1507.0, "Time_End": 1510.0, "Text": " and it can scan, you know, a Class B in 10 seconds."}, {"Time_Start": 1510.0, "Time_End": 1512.0, "Text": " And it's only 20 lines of code."}, {"Time_Start": 1512.0, "Time_End": 1514.0, "Text": " You know, it's just a for loop that, you know,"}, {"Time_Start": 1514.0, "Time_End": 1517.0, "Text": " goes through and send, send, send, send, send."}, {"Time_Start": 1517.0, "Time_End": 1520.0, "Text": " But the problem, of course, is, you know, it can scan really fast,"}, {"Time_Start": 1520.0, "Time_End": 1523.0, "Text": " but the results aren't going to be accurate at all."}, {"Time_Start": 1523.0, "Time_End": 1524.0, "Text": " At all."}, {"Time_Start": 1524.0, "Time_End": 1526.0, "Text": " NMAP has to be very careful"}, {"Time_Start": 1526.0, "Time_End": 1528.0, "Text": " about remembering all the probes it has sent,"}, {"Time_Start": 1528.0, "Time_End": 1531.0, "Text": " percent, retransmitting if it doesn't get a response,"}, {"Time_Start": 1531.0, "Time_End": 1534.0, "Text": " detecting dropped packets, looking at latency,"}, {"Time_Start": 1534.0, "Time_End": 1537.0, "Text": " adjusting the parallelism accordingly."}, {"Time_Start": 1537.0, "Time_End": 1540.0, "Text": " Whereas if you just have a for loop that just scans real quick,"}, {"Time_Start": 1540.0, "Time_End": 1543.0, "Text": " you know, it's liable to be all dropped 90% of your packets"}, {"Time_Start": 1543.0, "Time_End": 1548.0, "Text": " at the first bottleneck router on the route between the machines."}, {"Time_Start": 1548.0, "Time_End": 1552.0, "Text": " One thing that just slightly modifies from that"}, {"Time_Start": 1552.0, "Time_End": 1557.0, "Text": " is if you want to do an internet-wide ping sweep,"}, {"Time_Start": 1557.0, "Time_End": 1562.0, "Text": " So here we're using a feature of NMAP called IR,"}, {"Time_Start": 1562.0, "Time_End": 1566.0, "Text": " input from random, which just, and it now takes an argument."}, {"Time_Start": 1566.0, "Time_End": 1568.0, "Text": " It used to just go forever."}, {"Time_Start": 1568.0, "Time_End": 1571.0, "Text": " However, sometimes that makes it easy to start it up going"}, {"Time_Start": 1571.0, "Time_End": 1573.0, "Text": " and then forget about it, and then it'll scan for good,"}, {"Time_Start": 1573.0, "Time_End": 1577.0, "Text": " and you'll get up the next morning with angry messages from your ISP,"}, {"Time_Start": 1577.0, "Time_End": 1579.0, "Text": " or so I hear."}, {"Time_Start": 1579.0, "Time_End": 1582.0, "Text": " So after that happened,"}, {"Time_Start": 1582.0, "Time_End": 1586.0, "Text": " I added a feature that lets you limit it to, in this case, 10,000 hosts."}, {"Time_Start": 1586.0, "Time_End": 1587.0, "Text": " So here we're seeing."}, {"Time_Start": 1587.0, "Time_End": 1593.0, "Text": " saying pick hosts at random, do this fast SIN sweep for web servers."}, {"Time_Start": 1593.0, "Time_End": 1596.0, "Text": " So you can use this as an alternative browsing approach."}, {"Time_Start": 1596.0, "Time_End": 1601.0, "Text": " Instead of search engines, you can just find your web servers randomly and"}, {"Time_Start": 1601.0, "Time_End": 1602.0, "Text": " see what you get."}, {"Time_Start": 1602.0, "Time_End": 1604.0, "Text": " They just pop up one after another."}, {"Time_Start": 1604.0, "Time_End": 1607.0, "Text": " Perhaps you would have to be pretty bored to do that, but"}, {"Time_Start": 1607.0, "Time_End": 1610.0, "Text": " you know, if you wanted to, it's there."}, {"Time_Start": 1610.0, "Time_End": 1613.0, "Text": " And it kind of looks like sort of a script kitty feature,"}, {"Time_Start": 1613.0, "Time_End": 1616.0, "Text": " but actually I can find it quite useful in a number of cases."}, {"Time_Start": 1616.0, "Time_End": 1617.0, "Text": " If you want to do server."}, {"Time_Start": 1617.0, "Time_End": 1620.0, "Text": " of certain ports, see how many people are running whatever."}, {"Time_Start": 1620.0, "Time_End": 1624.0, "Text": " You can get a lot of good information just by doing a random scan."}, {"Time_Start": 1624.0, "Time_End": 1630.0, "Text": " Okay, so now we're going to get more intense with these Playboy IPs that we've found."}, {"Time_Start": 1630.0, "Time_End": 1633.0, "Text": " So here we're going to say, NMAP, don't bother pinging it,"}, {"Time_Start": 1633.0, "Time_End": 1635.0, "Text": " because we already know that they're up."}, {"Time_Start": 1635.0, "Time_End": 1638.0, "Text": " Do a S scan, an OS scan."}, {"Time_Start": 1638.0, "Time_End": 1643.0, "Text": " We give it this OS scan underscore guess, which wasn't documented until recently."}, {"Time_Start": 1643.0, "Time_End": 1646.98, "Text": " And basically, the problem we encounter when I did normal OS"}, {"Time_Start": 1647.0, "Time_End": 1651.0, "Text": " detection is that those 113 ports that were coming back, the resets,"}, {"Time_Start": 1651.0, "Time_End": 1653.0, "Text": " those weren't from the machines at all."}, {"Time_Start": 1653.0, "Time_End": 1657.0, "Text": " Those were from the, you know, firewall forging them."}, {"Time_Start": 1657.0, "Time_End": 1659.0, "Text": " And so NMAP got a little bit confused"}, {"Time_Start": 1659.0, "Time_End": 1662.0, "Text": " because those resets didn't match what it would have expected"}, {"Time_Start": 1662.0, "Time_End": 1664.0, "Text": " from the true destination host."}, {"Time_Start": 1664.0, "Time_End": 1667.0, "Text": " However, this OS scan guess will say,"}, {"Time_Start": 1667.0, "Time_End": 1669.0, "Text": " hey, even if you don't have a perfect match,"}, {"Time_Start": 1669.0, "Time_End": 1671.0, "Text": " you know, just give the closest match."}, {"Time_Start": 1671.0, "Time_End": 1673.0, "Text": " And that's usually pretty effective."}, {"Time_Start": 1673.0, "Time_End": 1676.0, "Text": " T4 is the timing option we'll talk about later."}, {"Time_Start": 1676.0, "Time_End": 1677.0, "Text": " We want to scan all of the."}, {"Time_Start": 1677.0, "Time_End": 1684.0, "Text": " the ports, and I mean all of them. MAP used to just do one through 65, 535, but this year I added"}, {"Time_Start": 1684.0, "Time_End": 1691.0, "Text": " the port zero support, which is a pretty bogus port, but some people wanted to scan it, so why not?"}, {"Time_Start": 1691.0, "Time_End": 1696.0, "Text": " We give it the list of IPs, tell it to log to a file, and we're off."}, {"Time_Start": 1696.0, "Time_End": 1700.0, "Text": " So let's just take a look and try and analyze some of the results."}, {"Time_Start": 1700.0, "Time_End": 1706.0, "Text": " Let's take a look. One thing, we have this router here, it looks like it's a Cisco."}, {"Time_Start": 1706.0, "Time_End": 1712.0, "Text": " It's a Cisco. It's got all the ports. And this is a line that a lot of people don't pay enough attention to."}, {"Time_Start": 1712.0, "Time_End": 1716.0, "Text": " Here we see that the ports that were scanned but not shown are in state closed,"}, {"Time_Start": 1716.0, "Time_End": 1719.0, "Text": " meaning there's not really much of a firewall protecting them."}, {"Time_Start": 1719.0, "Time_End": 1726.0, "Text": " So if the ports were open, you know, they would be available to users as opposed to a more proper default deny stance"}, {"Time_Start": 1726.0, "Time_End": 1730.0, "Text": " where they say only allow the ports that I specifically want to be allowed."}, {"Time_Start": 1730.0, "Time_End": 1735.0, "Text": " So for example, they probably didn't have a real great reason for having finger open."}, {"Time_Start": 1735.0, "Time_End": 1744.0, "Text": " open. It's probably not necessary on the router for external internet users. But because they have this default allow policy, you know, it was up and available."}, {"Time_Start": 1744.0, "Time_End": 1753.0, "Text": " Whereas at this host, we see that the default is filtered. And so hopefully they only have ports open that they have a good reason for."}, {"Time_Start": 1753.0, "Time_End": 1764.98, "Text": " Let's take a look at another one. This one's big IP2, chai.playboy.com. And one thing I found really interesting on this guy is that"}, {"Time_Start": 1765.0, "Time_End": 1771.5, "Text": " that the OS guest said that it's an F5 lab's big IP load balancer, which is probably true given the name of the host."}, {"Time_Start": 1772.5, "Time_End": 1777.2, "Text": " And what's interesting is that, you know, I certainly don't have one of those in my lab to add that fingerprint."}, {"Time_Start": 1777.92, "Time_End": 1783.0, "Text": " And so a feature that has turned out really useful in NMAP is that if it doesn't detect an OS,"}, {"Time_Start": 1783.0, "Time_End": 1786.0, "Text": " it gives you a fingerprint and a web page where you can submit it."}, {"Time_Start": 1786.5, "Time_End": 1790.0, "Text": " And a lot of really helpful users have submitted thousands of these fingerprints."}, {"Time_Start": 1790.0, "Time_End": 1794.98, "Text": " And so that the database now includes everything from Xbox is running Linux to Amiga,"}, {"Time_Start": 1795.0, "Time_End": 1800.0, "Text": " to VoIP phones, PBXs, and F5 Labs, big IP load balancers."}, {"Time_Start": 1800.0, "Time_End": 1803.0, "Text": " Has anyone here ever submitted a fingerprint?"}, {"Time_Start": 1803.0, "Time_End": 1808.0, "Text": " Okay, mad props to you guys because that's what's helped it to be so up to date."}, {"Time_Start": 1808.0, "Time_End": 1812.0, "Text": " When people submit one, you know, then everyone can benefit if they ever do see that weird"}, {"Time_Start": 1812.0, "Time_End": 1815.0, "Text": " type of machine somewhere."}, {"Time_Start": 1815.0, "Time_End": 1818.0, "Text": " Let's look at a couple more examples."}, {"Time_Start": 1818.0, "Time_End": 1821.0, "Text": " Here's one. It looks like it's an ad server in Chicago."}, {"Time_Start": 1821.0, "Time_End": 1824.0, "Text": " And their default state is filtered, good. Not many ports over."}, {"Time_Start": 1824.0, "Time_End": 1825.2, "Text": " not many ports open."}, {"Time_Start": 1826.0, "Time_End": 1829.0, "Text": " The fact that they have Oracle open is kind of questionable."}, {"Time_Start": 1829.0, "Time_End": 1833.0, "Text": " You know, just because Larry Ellison says it's unbreakable"}, {"Time_Start": 1833.0, "Time_End": 1838.0, "Text": " doesn't necessarily mean that it's a good idea to leave it open flapping in the wind."}, {"Time_Start": 1838.0, "Time_End": 1843.0, "Text": " But at least you can see they made some efforts here in terms of the default filtered,"}, {"Time_Start": 1843.0, "Time_End": 1847.0, "Text": " and you can see the OS guess says that it's Solaris 2, 6, or 7"}, {"Time_Start": 1847.0, "Time_End": 1851.0, "Text": " and that they've specifically changed the TCP strong ISS variable"}, {"Time_Start": 1851.0, "Time_End": 1854.0, "Text": " to give them stronger initial sequence number."}, {"Time_Start": 1854.0, "Time_End": 1858.0, "Text": " generation to make it hard to do TCP spoofing attacks."}, {"Time_Start": 1858.0, "Time_End": 1865.0, "Text": " Here's another machine that's on kind of the same class C where they haven't taken as much care."}, {"Time_Start": 1865.0, "Time_End": 1867.0, "Text": " The default state is closed."}, {"Time_Start": 1867.0, "Time_End": 1872.0, "Text": " It's got more hosts open and it has my SQL, which is just as bad."}, {"Time_Start": 1872.0, "Time_End": 1879.0, "Text": " So now we're going to move to a few other tricks that can be handy."}, {"Time_Start": 1879.0, "Time_End": 1883.0, "Text": " First, let's look at IPV6 scanning."}, {"Time_Start": 1883.0, "Time_End": 1886.0, "Text": " scanning, which NMAP now supports."}, {"Time_Start": 1886.0, "Time_End": 1891.0, "Text": " So I take a machine, I use www.kame.net just because they have some good IPV6 network,"}, {"Time_Start": 1891.0, "Time_End": 1893.0, "Text": " so I knew they supported it."}, {"Time_Start": 1893.0, "Time_End": 1896.0, "Text": " And I do a scan of them, and we see a number of open ports,"}, {"Time_Start": 1896.0, "Time_End": 1900.0, "Text": " but we also see all these filtered ports here that we're not able to get to"}, {"Time_Start": 1900.0, "Time_End": 1902.0, "Text": " because of some filtering system."}, {"Time_Start": 1902.0, "Time_End": 1905.0, "Text": " Well, let's take exactly the same command, but add hyphen 6,"}, {"Time_Start": 1905.0, "Time_End": 1908.0, "Text": " so that it scans the IPV6 version instead."}, {"Time_Start": 1908.0, "Time_End": 1913.0, "Text": " Here you see that suddenly there are no"}, {"Time_Start": 1913.0, "Time_End": 1918.0, "Text": " open, no filtered ports, and this port 113 that was filtered in the previous one,"}, {"Time_Start": 1918.0, "Time_End": 1920.0, "Text": " you know, is now open."}, {"Time_Start": 1920.0, "Time_End": 1925.0, "Text": " So you could take your IPV6 enabled RPC info and interrogate the ports further."}, {"Time_Start": 1925.0, "Time_End": 1928.0, "Text": " So that's something that can sometimes be useful to try,"}, {"Time_Start": 1928.0, "Time_End": 1934.0, "Text": " and it's going to become more useful if and when IPV6 starts seeing more usage."}, {"Time_Start": 1934.0, "Time_End": 1938.0, "Text": " Another thing that people are often interested in is how to get the timing right."}, {"Time_Start": 1938.0, "Time_End": 1940.0, "Text": " You know, MAP offers a lot of options."}, {"Time_Start": 1940.0, "Time_End": 1943.0, "Text": " Max parallelism, min parallelism, min-parallelism, min-R-T-R-T-R-T-."}, {"Time_Start": 1943.0, "Time_End": 1949.0, "Text": " timeout, max RTT timeout, initial RTT timeout, a host timeout, a scan delay."}, {"Time_Start": 1949.0, "Time_End": 1951.0, "Text": " So if you want to get your scans faster,"}, {"Time_Start": 1951.0, "Time_End": 1955.0, "Text": " all you really have to do is pick the exact right values for each of these variables"}, {"Time_Start": 1955.0, "Time_End": 1957.0, "Text": " and everything will be set."}, {"Time_Start": 1957.0, "Time_End": 1959.0, "Text": " Fortunately, there's a better way."}, {"Time_Start": 1959.0, "Time_End": 1963.0, "Text": " And that are these canned timing levels I added,"}, {"Time_Start": 1963.0, "Time_End": 1969.0, "Text": " which tries to do the smart things, but lets you configure kind of how aggressive it wants to be."}, {"Time_Start": 1969.0, "Time_End": 1973.0, "Text": " It can be everything from paranoid, which does only one probe every five,"}, {"Time_Start": 1973.0, "Time_End": 1978.0, "Text": " minutes. So yes, you're going to stay under the IDS port scan detection thresholds,"}, {"Time_Start": 1978.0, "Time_End": 1984.0, "Text": " but you're going to be old and gray by the time any scan actually finishes, unless it's a real small,"}, {"Time_Start": 1984.0, "Time_End": 1989.0, "Text": " very limited scan. Sneaky is kind of the same, except it's 15 seconds."}, {"Time_Start": 1989.0, "Time_End": 1994.0, "Text": " And you can use numbers here from 0 to 5 instead of the names, if you want."}, {"Time_Start": 1994.0, "Time_End": 1997.0, "Text": " Polite, normal mode, which is kind of the default."}, {"Time_Start": 1997.0, "Time_End": 2001.0, "Text": " And then there's aggressive mode, which is something I've worked a bit on."}, {"Time_Start": 2001.0, "Time_End": 2003.0, "Text": " By default, you know, I think NMAT needs some."}, {"Time_Start": 2003.0, "Time_End": 2008.0, "Text": " the error on the side of being conservative with how fast, you know, it does its scan,"}, {"Time_Start": 2008.0, "Time_End": 2012.0, "Text": " because it doesn't really know for sure about all the network infrastructure in between."}, {"Time_Start": 2012.0, "Time_End": 2018.0, "Text": " You know, for all it knows, you could be on a 300 bod slip link to Pakistan or something."}, {"Time_Start": 2018.0, "Time_End": 2022.0, "Text": " And so it has to be safe so that I would rather have it be slower,"}, {"Time_Start": 2022.0, "Time_End": 2024.0, "Text": " you know, in the case where you're on a faster network"}, {"Time_Start": 2024.0, "Time_End": 2029.0, "Text": " than if you're on a slow network and get wrong results."}, {"Time_Start": 2029.0, "Time_End": 2032.98, "Text": " However, with this aggressive mode, I've tried to make it so that if you're on at least a somewhat"}, {"Time_Start": 2033.0, "Time_End": 2038.0, "Text": " reasonable network, you know, if you're on an Ethernet or even a broadband connection,"}, {"Time_Start": 2038.0, "Time_End": 2043.0, "Text": " or possibly even a modem of, I don't know, this will be much more aggressive in its timing"}, {"Time_Start": 2043.0, "Time_End": 2049.0, "Text": " while still providing accurate results, you know, assuming, you know, the latency and such"}, {"Time_Start": 2049.0, "Time_End": 2053.0, "Text": " and packet loss aren't horrible on that network."}, {"Time_Start": 2053.0, "Time_End": 2059.0, "Text": " So let's look at ways that you can speed your scan and some of the things that I've been adding lately."}, {"Time_Start": 2059.0, "Time_End": 2062.98, "Text": " Here we do a scan with an older version 3.15 beta 3.3.3.3.3."}, {"Time_Start": 2063.0, "Time_End": 2065.0, "Text": " against Insecure.org."}, {"Time_Start": 2065.0, "Time_End": 2068.0, "Text": " See, I actually scan my own system sometimes too."}, {"Time_Start": 2068.0, "Time_End": 2070.0, "Text": " It's not only other people."}, {"Time_Start": 2070.0, "Time_End": 2075.0, "Text": " And here it scans the 1600 default ports in a little less than 10 minutes,"}, {"Time_Start": 2075.0, "Time_End": 2077.0, "Text": " which isn't a disaster,"}, {"Time_Start": 2077.0, "Time_End": 2080.0, "Text": " but it still will take a long time if you have a lot of hosts"}, {"Time_Start": 2080.0, "Time_End": 2082.0, "Text": " which are firewalled in this sort of way."}, {"Time_Start": 2082.0, "Time_End": 2085.0, "Text": " So I made a bunch of changes to the timing algorithm,"}, {"Time_Start": 2085.0, "Time_End": 2089.0, "Text": " which in the next version of NMAP was able to do the same thing in 228 seconds,"}, {"Time_Start": 2089.0, "Time_End": 2092.0, "Text": " which, hey, you saved half your time."}, {"Time_Start": 2092.0, "Time_End": 2093.0, "Text": " But even better,"}, {"Time_Start": 2093.0, "Time_End": 2097.0, "Text": " is if you add the T4 option, you know, all of a sudden it only takes 41 seconds."}, {"Time_Start": 2097.0, "Time_End": 2099.0, "Text": " And so if you're doing big scans,"}, {"Time_Start": 2099.0, "Time_End": 2102.0, "Text": " if you're doing scans against heavily firewalled hosts"}, {"Time_Start": 2102.0, "Time_End": 2104.0, "Text": " and you're on a decent network,"}, {"Time_Start": 2104.0, "Time_End": 2106.0, "Text": " you know that's something that you might want to consider using"}, {"Time_Start": 2106.0, "Time_End": 2109.0, "Text": " on a more regular basis."}, {"Time_Start": 2109.0, "Time_End": 2113.0, "Text": " Now let's look on a different track, avoiding the IDS's."}, {"Time_Start": 2113.0, "Time_End": 2117.0, "Text": " There are a few different ways that you can do this."}, {"Time_Start": 2117.0, "Time_End": 2121.0, "Text": " One of them is the scan flags option,"}, {"Time_Start": 2121.0, "Time_End": 2123.0, "Text": " which lets you specify"}, {"Time_Start": 2123.0, "Time_End": 2126.0, "Text": " different flags for a certain scan you want to do."}, {"Time_Start": 2126.0, "Time_End": 2130.0, "Text": " For example, one fact that seems to be little known by certain IDS vendors"}, {"Time_Start": 2130.0, "Time_End": 2132.0, "Text": " is that you can do a sin scan."}, {"Time_Start": 2132.0, "Time_End": 2134.0, "Text": " You know, it doesn't have to be just sin."}, {"Time_Start": 2134.0, "Time_End": 2136.0, "Text": " You know, a sin fin, for example,"}, {"Time_Start": 2136.0, "Time_End": 2138.0, "Text": " will often do the same thing."}, {"Time_Start": 2138.0, "Time_End": 2141.0, "Text": " And so with scan flags, you can say do a sin scan,"}, {"Time_Start": 2141.0, "Time_End": 2144.0, "Text": " but instead of using the default flags, use these TCP flags instead."}, {"Time_Start": 2144.0, "Time_End": 2146.0, "Text": " And here's an example."}, {"Time_Start": 2146.0, "Time_End": 2149.0, "Text": " The same thing with like the fin scan."}, {"Time_Start": 2149.0, "Time_End": 2152.0, "Text": " You know, a lot of other combinations will work such as push urge."}, {"Time_Start": 2152.0, "Time_End": 2155.0, "Text": " push urge."}, {"Time_Start": 2155.0, "Time_End": 2159.0, "Text": " And another approach, instead of avoiding the IDS entirely,"}, {"Time_Start": 2159.0, "Time_End": 2163.0, "Text": " is you can try and avoid, overload the IDS using decoy scanning."}, {"Time_Start": 2163.0, "Time_End": 2166.0, "Text": " So here we're going to say, for every packet NMAP sends,"}, {"Time_Start": 2166.0, "Time_End": 2169.0, "Text": " and this is a feature it has had for a long time,"}, {"Time_Start": 2169.0, "Time_End": 2174.0, "Text": " for every packet NMAP sends, spoof a packet from all these IP addresses"}, {"Time_Start": 2174.0, "Time_End": 2177.0, "Text": " that we've specified so that when the target gets it,"}, {"Time_Start": 2177.0, "Time_End": 2182.0, "Text": " their IDS report will look like that, and they'll see the intruder as being"}, {"Time_Start": 2182.0, "Time_End": 2188.0, "Text": " all these IP addresses, and they don't really know where to go after."}, {"Time_Start": 2188.0, "Time_End": 2192.0, "Text": " A couple of caveats with this technique, because I see people use it wrongly sometimes,"}, {"Time_Start": 2192.0, "Time_End": 2195.0, "Text": " and think they're more anonymous than they are."}, {"Time_Start": 2195.0, "Time_End": 2199.0, "Text": " For one thing, more and more ISPs are starting to implement egress filtering."}, {"Time_Start": 2199.0, "Time_End": 2203.0, "Text": " And so if your ISP is implementing that, you might want to check because"}, {"Time_Start": 2203.0, "Time_End": 2207.0, "Text": " otherwise it might block at your ISPs router all the spoof source addresses,"}, {"Time_Start": 2207.0, "Time_End": 2211.0, "Text": " and so the attacker will just see you, and you won't feel quite so clever."}, {"Time_Start": 2211.0, "Time_End": 2218.0, "Text": " Another thing that very inexperienced NMAP users tend to do on occasion"}, {"Time_Start": 2218.0, "Time_End": 2222.0, "Text": " is they'll say, well, what host should I use for the decoys?"}, {"Time_Start": 2222.0, "Time_End": 2223.0, "Text": " Well, what host do I know?"}, {"Time_Start": 2223.0, "Time_End": 2227.0, "Text": " And so they'll put down some popular hosts they think of off the top of their head,"}, {"Time_Start": 2227.0, "Time_End": 2231.0, "Text": " and then the admin on the other side says, okay, we've been scanned by yahoo.com,"}, {"Time_Start": 2231.0, "Time_End": 2237.0, "Text": " Whitehouse.gov, AOL, and PPP-478.Earthlink.net."}, {"Time_Start": 2237.0, "Time_End": 2239.0, "Text": " You know, I wonder who's really behind this."}, {"Time_Start": 2239.0, "Time_End": 2244.0, "Text": " And so you have to be careful with that."}, {"Time_Start": 2244.0, "Time_End": 2248.0, "Text": " Now, if you want to get the ultimate stealth scan,"}, {"Time_Start": 2248.0, "Time_End": 2252.0, "Text": " I think you want to look at the idle scan technique."}, {"Time_Start": 2252.0, "Time_End": 2256.0, "Text": " Due to time limitations, I can't discuss it all in depth,"}, {"Time_Start": 2256.0, "Time_End": 2261.0, "Text": " but it's a really neat technique that allows you to scan a machine"}, {"Time_Start": 2261.0, "Time_End": 2264.0, "Text": " without sending any packets at all to that target machine"}, {"Time_Start": 2264.0, "Time_End": 2266.0, "Text": " from your own IP address,"}, {"Time_Start": 2266.0, "Time_End": 2269.0, "Text": " because you're basically using a zombie machine that you pick"}, {"Time_Start": 2269.0, "Time_End": 2272.0, "Text": " from the internet to sort of proxy that scan"}, {"Time_Start": 2272.0, "Time_End": 2277.0, "Text": " using an interesting usage of the IPID field."}, {"Time_Start": 2277.0, "Time_End": 2279.0, "Text": " And I put a paper about that I wrote,"}, {"Time_Start": 2279.0, "Time_End": 2283.0, "Text": " I have it at this earl, and I also stuck it on the DefCon CD."}, {"Time_Start": 2283.0, "Time_End": 2288.0, "Text": " And so another thing that users ask me a lot"}, {"Time_Start": 2288.0, "Time_End": 2290.0, "Text": " is, you know, what's MAP going to look like"}, {"Time_Start": 2290.0, "Time_End": 2292.0, "Text": " in three to five years from now?"}, {"Time_Start": 2292.0, "Time_End": 2294.0, "Text": " And that, you know, I don't have a good answer"}, {"Time_Start": 2294.0, "Time_End": 2297.0, "Text": " because I try and follow kind of the evolution of networks"}, {"Time_Start": 2297.0, "Time_End": 2298.0, "Text": " and the way they're used."}, {"Time_Start": 2298.0, "Time_End": 2303.0, "Text": " and you never really know for sure you can't predict where that's going to go."}, {"Time_Start": 2303.0, "Time_End": 2308.0, "Text": " However, what I often do know is what's the next big feature that I think is cool"}, {"Time_Start": 2308.0, "Time_End": 2310.0, "Text": " that's going to be coming next."}, {"Time_Start": 2310.0, "Time_End": 2314.0, "Text": " And in this case, I think that's going to be serviced in version detection."}, {"Time_Start": 2314.0, "Time_End": 2321.0, "Text": " There are a few reasons that I think that this can be particularly useful"}, {"Time_Start": 2321.0, "Time_End": 2324.0, "Text": " and it's becoming more and more useful as time goes on."}, {"Time_Start": 2324.0, "Time_End": 2327.0, "Text": " One are the unknown ports you see."}, {"Time_Start": 2327.0, "Time_End": 2328.0, "Text": " You might have saw some of the things."}, {"Time_Start": 2328.0, "Time_End": 2335.0, "Text": " those examples in the Playboy host we looked at where they would have port 21,147 open."}, {"Time_Start": 2335.0, "Time_End": 2337.0, "Text": " Well, that doesn't tell you a lot."}, {"Time_Start": 2337.0, "Time_End": 2340.0, "Text": " You immediately want to know, well, what's listening on that port?"}, {"Time_Start": 2340.0, "Time_End": 2342.0, "Text": " What is it? Can I exploit it?"}, {"Time_Start": 2342.0, "Time_End": 2348.0, "Text": " And so with the probing and map will interrogate all the open and closed ports,"}, {"Time_Start": 2348.0, "Time_End": 2353.0, "Text": " UDP and TCP, to try and determine what type of service it is that's listening there."}, {"Time_Start": 2353.0, "Time_End": 2357.0, "Text": " And ideally, what's the application name and version number that it's running."}, {"Time_Start": 2357.0, "Time_End": 2358.0, "Text": " it's running."}, {"Time_Start": 2358.0, "Time_End": 2364.0, "Text": " This is also helpful for coping with, we've seen more firewall evasion port selection now."}, {"Time_Start": 2364.0, "Time_End": 2368.0, "Text": " Instead of saying, I'm going to run it on the normal port, the well known port, they say,"}, {"Time_Start": 2368.0, "Time_End": 2372.0, "Text": " well, I need to run it on this port because that's the one allowed by the firewall."}, {"Time_Start": 2372.0, "Time_End": 2376.0, "Text": " I had a friend, a not particularly security conscious friend, who said,"}, {"Time_Start": 2376.0, "Time_End": 2381.0, "Text": " dang it, my ISP blocked port 23 because telnet's so insecure."}, {"Time_Start": 2381.0, "Time_End": 2386.0, "Text": " So of course he moves telnet to port 22 and telnet's to the SSH port."}, {"Time_Start": 2386.0, "Time_End": 2393.5, "Text": " which shows the kind of level of effort people will go to to avoid even very sensible security mechanisms."}, {"Time_Start": 2393.5, "Time_End": 2398.0, "Text": " But, and also a lot of times people will put stuff on Port 80."}, {"Time_Start": 2398.0, "Time_End": 2400.5, "Text": " They'll say, hey, you know, the only thing that gets through is Port 80."}, {"Time_Start": 2400.5, "Time_End": 2405.5, "Text": " So we'll just put whatever application, you know, on there so that people will be able to get to it"}, {"Time_Start": 2405.5, "Time_End": 2408.5, "Text": " and kind of defeat the point of whatever the firewalling was."}, {"Time_Start": 2408.5, "Time_End": 2412.0, "Text": " And so when MMAP by default right now scans them,"}, {"Time_Start": 2412.0, "Time_End": 2415.5, "Text": " it'll say, okay, Port 80 and it'll put HTTP, because that's what the table is."}, {"Time_Start": 2415.5, "Time_End": 2417.0, "Text": " that's what the table says."}, {"Time_Start": 2417.0, "Time_End": 2423.5, "Text": " But it would be much better and less misleading if it would actually look and determine what's really listening."}, {"Time_Start": 2423.5, "Time_End": 2427.5, "Text": " And a third reason is to counter UDP filtering."}, {"Time_Start": 2427.5, "Time_End": 2432.5, "Text": " Back, you know, many years ago, when I wrote the initial UDP scanner,"}, {"Time_Start": 2432.5, "Time_End": 2434.5, "Text": " you know, there was a lot less of the UDP filtering,"}, {"Time_Start": 2434.5, "Time_End": 2438.5, "Text": " so you could kind of, when you would send a UDP packet to a wrong port,"}, {"Time_Start": 2438.5, "Time_End": 2442.5, "Text": " you had a much higher chance of getting an actual ICMP port unreachable back."}, {"Time_Start": 2442.5, "Time_End": 2445.48, "Text": " Now this filtering is so pervasive that those of you who scanned big,"}, {"Time_Start": 2445.5, "Time_End": 2450.0, "Text": " networks over the internet often find that you see lots of allegedly open ports"}, {"Time_Start": 2450.0, "Time_End": 2454.8, "Text": " because they're not really open but they're being filtered and so it looks to NMAP like"}, {"Time_Start": 2454.8, "Time_End": 2459.3, "Text": " they're open and that makes it very hard to figure out which ones are really there"}, {"Time_Start": 2459.3, "Time_End": 2464.7, "Text": " and would it be a waste of time to brute force the SNMP community strings if it's"}, {"Time_Start": 2464.7, "Time_End": 2468.7, "Text": " really probably just filtered and so with the version detection that offers a way to"}, {"Time_Start": 2468.7, "Time_End": 2475.1, "Text": " somewhat counter that because if we send a DNS server status probe and get a response"}, {"Time_Start": 2475.1, "Time_End": 2480.1, "Text": " back, we know that A, S, D and B, that it actually is open."}, {"Time_Start": 2480.1, "Time_End": 2486.1, "Text": " And for the other ports, I can put some sort of open slash filtered state for that."}, {"Time_Start": 2486.1, "Time_End": 2488.1, "Text": " Now, this isn't entirely vaporware."}, {"Time_Start": 2488.1, "Time_End": 2493.1, "Text": " In fact, I spent a lot of July working on an implementation of that,"}, {"Time_Start": 2493.1, "Time_End": 2495.1, "Text": " this service inversion detection."}, {"Time_Start": 2495.1, "Time_End": 2498.1, "Text": " And so let me just give a quick demonstration."}, {"Time_Start": 2498.1, "Time_End": 2502.1, "Text": " We want to do an NMAP, and we want to do, let's do a SIN scan,"}, {"Time_Start": 2502.1, "Time_End": 2504.1, "Text": " we'll do a UDP scan, we want it to be verbose about it,"}, {"Time_Start": 2504.1, "Time_End": 2511.1, "Text": " verbose about it. We'll do OS detection just for fun, and we'll do this about local host."}, {"Time_Start": 2511.1, "Time_End": 2516.1, "Text": " And so here it goes, it's scanning the default 1,600 TCP ports, now is scanning the default"}, {"Time_Start": 2516.1, "Time_End": 2518.1, "Text": " 1,400 UDP ports."}, {"Time_Start": 2518.1, "Time_End": 2522.1, "Text": " Now it's starting the new service scan against the services that it's located."}, {"Time_Start": 2522.1, "Time_End": 2527.1, "Text": " Now it's doing RPC grinding to find the RPC numbers by brute force of the RPC services."}, {"Time_Start": 2527.1, "Time_End": 2531.1, "Text": " Then it did OS detection, and now here it gave us the results."}, {"Time_Start": 2531.1, "Time_End": 2534.1, "Text": " And for those of you who are used to seeing NMAPS."}, {"Time_Start": 2534.1, "Time_End": 2538.1, "Text": " output, you see the difference here is in this section."}, {"Time_Start": 2538.1, "Time_End": 2543.1, "Text": " First of all, these services here, instead of just coming from a table,"}, {"Time_Start": 2543.1, "Time_End": 2547.1, "Text": " these were detected through the interrogation techniques."}, {"Time_Start": 2547.1, "Time_End": 2552.1, "Text": " And if it hadn't been able to find them, it would have put like a question mark after the service name."}, {"Time_Start": 2552.1, "Time_End": 2556.1, "Text": " And also there's this brand new version table which tells us not only that it's SSH,"}, {"Time_Start": 2556.1, "Time_End": 2560.1, "Text": " but it's open SSH 351, Patch 1, Protocol 199."}, {"Time_Start": 2560.1, "Time_End": 2563.1, "Text": " You know, the RPC bind is version 2, and here's the RPC program number."}, {"Time_Start": 2563.1, "Time_End": 2570.1, "Text": " program number, the internet printing protocol server is Cups 1.1, and X11 is X386,"}, {"Time_Start": 2570.1, "Time_End": 2571.1, "Text": " and then it's open."}, {"Time_Start": 2571.1, "Time_End": 2577.1, "Text": " Only open to 127.0.0.1, mind you, so don't get any ideas."}, {"Time_Start": 2577.1, "Time_End": 2580.1, "Text": " And so that's basically how that's going to work."}, {"Time_Start": 2580.1, "Time_End": 2584.1, "Text": " And I think the implementation, hopefully it'll be a relatively good one."}, {"Time_Start": 2584.1, "Time_End": 2588.1, "Text": " It's doing that it's all in parallel, multiple ports at the same time,"}, {"Time_Start": 2588.1, "Time_End": 2593.1, "Text": " as well as being able to do multiple machines at the same time, TCP, UDP,"}, {"Time_Start": 2593.1, "Time_End": 2599.1, "Text": " IPV6 is the TCP and UDP work now, IPV6, I'm still adding."}, {"Time_Start": 2599.1, "Time_End": 2603.1, "Text": " One thing I'm excited about is just like with OS detection,"}, {"Time_Start": 2603.1, "Time_End": 2607.1, "Text": " when it detects a service it doesn't know, but it gets some responses to any of its"}, {"Time_Start": 2607.1, "Time_End": 2610.1, "Text": " probes, it gives you a nice fingerprint that you can submit,"}, {"Time_Start": 2610.1, "Time_End": 2615.1, "Text": " and so hopefully that will help me build a very large, comprehensive database"}, {"Time_Start": 2615.1, "Time_End": 2620.1, "Text": " that'll give us good results against most of the machines we scan."}, {"Time_Start": 2620.1, "Time_End": 2622.1, "Text": " So far, the database isn't so big."}, {"Time_Start": 2622.1, "Time_End": 2629.1, "Text": " so big, but I just last week did scans against hundreds of thousands of machines to get all these service numbers."}, {"Time_Start": 2629.1, "Time_End": 2635.1, "Text": " I had to stop because of ISP complaints, but I did get a lot of stuff there."}, {"Time_Start": 2635.1, "Time_End": 2640.1, "Text": " And so I wish I could give you this, release this today right now with an earl,"}, {"Time_Start": 2640.1, "Time_End": 2646.1, "Text": " but it's not quite polished enough for the final release, but I'm hoping to have it in the next two weeks."}, {"Time_Start": 2646.1, "Time_End": 2651.1, "Text": " I figure I'll take next week recovering from DefCon and then work hard the week after that and then release it."}, {"Time_Start": 2651.1, "Time_End": 2652.1, "Text": " and then release it."}, {"Time_Start": 2652.1, "Time_End": 2658.1, "Text": " But for those of you who are kind of real good testers and saying good test reports"}, {"Time_Start": 2658.1, "Time_End": 2660.1, "Text": " and are really interested in trying the bleeding edge,"}, {"Time_Start": 2660.1, "Time_End": 2662.1, "Text": " if you catch me around the con sometime,"}, {"Time_Start": 2662.1, "Time_End": 2666.1, "Text": " you know, I can give you an earl for this version if you want to try it out."}, {"Time_Start": 2666.1, "Time_End": 2670.1, "Text": " And so that's basically the material that I had."}, {"Time_Start": 2670.1, "Time_End": 2675.1, "Text": " Is there anybody who has questions about network reconnaissance and map"}, {"Time_Start": 2675.1, "Time_End": 2678.1, "Text": " or anything else security related?"}, {"Time_Start": 2678.1, "Time_End": 2679.1, "Text": " Go ahead."}, {"Time_Start": 2679.1, "Time_End": 2683.1, "Text": " Is there such a thing as an idle host on the Windows network where there's"}, {"Time_Start": 2683.1, "Time_End": 2686.1, "Text": " that box garbage and other types of broadcasts?"}, {"Time_Start": 2686.1, "Time_End": 2689.1, "Text": " Yeah, the windows don't make the best idle host zombies"}, {"Time_Start": 2689.1, "Time_End": 2695.1, "Text": " because they're always spewing that crap all over the network."}, {"Time_Start": 2695.1, "Time_End": 2698.1, "Text": " But fortunately there's plenty of machines on the internet,"}, {"Time_Start": 2698.1, "Time_End": 2700.1, "Text": " printers, hosts that aren't doing much,"}, {"Time_Start": 2700.1, "Time_End": 2703.1, "Text": " that it's usually not hard to find them."}, {"Time_Start": 2703.1, "Time_End": 2707.1, "Text": " And you can use any of the idle host you have to scan any of the other machines."}, {"Time_Start": 2707.1, "Time_End": 2708.1, "Text": " And so find a good one."}, {"Time_Start": 2708.1, "Time_End": 2709.1, "Text": " And so find a good one."}, {"Time_Start": 2709.1, "Time_End": 2710.1, "Text": " stick with that."}, {"Time_Start": 2710.1, "Time_End": 2715.0, "Text": " In one of my example paper, I used a host on the Adobe because I was kind of mad about the"}, {"Time_Start": 2715.0, "Time_End": 2717.1, "Text": " Dimitri thing at the time."}, {"Time_Start": 2717.1, "Time_End": 2719.1, "Text": " It was kiosk.adobby.com."}, {"Time_Start": 2719.1, "Time_End": 2725.1, "Text": " And within like a day, I noticed kiosk, the name had been removed, but all they did is remove the DNS"}, {"Time_Start": 2725.1, "Time_End": 2728.1, "Text": " name, whereas the IP address was still there."}, {"Time_Start": 2728.1, "Time_End": 2731.9, "Text": " So that's kind of an example of what I was talking about, where the admins sometimes take the easy"}, {"Time_Start": 2731.9, "Time_End": 2737.2999999999997, "Text": " approach and say, well, we'll just remove the name and no one will find it, as opposed to fixing"}, {"Time_Start": 2737.2999999999997, "Time_End": 2738.1, "Text": " the actual problem."}, {"Time_Start": 2738.1, "Time_End": 2739.1, "Text": " Any other question?"}, {"Time_Start": 2739.1, "Time_End": 2741.1, "Text": " back there?"}, {"Time_Start": 2741.1, "Time_End": 2746.1, "Text": " I can't hear you at all."}, {"Time_Start": 2746.1, "Time_End": 2753.1, "Text": " Okay."}, {"Time_Start": 2753.1, "Time_End": 2760.1, "Text": " Okay, I've looked at packet Koretsu a little, but I may not have looked at packet Koretsu a little,"}, {"Time_Start": 2760.1, "Time_End": 2762.1, "Text": " but I may not have looked at his newest stuff."}, {"Time_Start": 2762.1, "Time_End": 2764.1, "Text": " Any others?"}, {"Time_Start": 2764.1, "Time_End": 2766.1, "Text": " Okay, way back there."}, {"Time_Start": 2766.1, "Time_End": 2768.1, "Text": " Oh, sorry, that's just my warning to find out."}, {"Time_Start": 2768.1, "Time_End": 2772.1, "Text": " warning to five minutes. I have to get the hell out of here."}, {"Time_Start": 2772.1, "Time_End": 2788.1, "Text": " Okay, yeah. He mentioned Jay Freeman,"}, {"Time_Start": 2788.1, "Time_End": 2791.1, "Text": " who may be here today, also has a version of NMAPE."}, {"Time_Start": 2791.1, "Time_End": 2796.1, "Text": " Also has a version and service detection patch for NMAP that's been around for a few years."}, {"Time_Start": 2796.1, "Time_End": 2797.1, "Text": " And he's one of the people that I've been around for a few years."}, {"Time_Start": 2797.1, "Time_End": 2799.1, "Text": " that I've been talking to."}, {"Time_Start": 2799.1, "Time_End": 2803.1, "Text": " I looked at a lot of the other version service detection things out there."}, {"Time_Start": 2803.1, "Time_End": 2804.1, "Text": " AMAP."}, {"Time_Start": 2804.1, "Time_End": 2808.1, "Text": " Nes has a very simple one implemented an MAP plus V,"}, {"Time_Start": 2808.1, "Time_End": 2813.1, "Text": " and I got a group of about 30 of kind of the top NMAP contributors together,"}, {"Time_Start": 2813.1, "Time_End": 2815.1, "Text": " and so we've been doing these private releases."}, {"Time_Start": 2815.1, "Time_End": 2818.1, "Text": " And J.SORC is one of the one who's provided valuable insight"}, {"Time_Start": 2818.1, "Time_End": 2822.1, "Text": " into improving this implementation here,"}, {"Time_Start": 2822.1, "Time_End": 2825.1, "Text": " although it's a completely different implementation."}, {"Time_Start": 2825.1, "Time_End": 2826.1, "Text": " One last question."}, {"Time_Start": 2826.1, "Time_End": 2827.1, "Text": " Go ahead."}, {"Time_Start": 2827.1, "Time_End": 2836.1, "Text": " Yes, I don't think you can fake the root dance."}, {"Time_Start": 2836.1, "Time_End": 2843.1, "Text": " You can only do it when you get rude or if a hot babe in the movies uses your product."}, {"Time_Start": 2843.1, "Time_End": 2847.1, "Text": " But thanks a lot. You've been a great audience."}]}