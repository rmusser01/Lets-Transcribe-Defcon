{
  "segments": [
    {
      "Time_Start": 0.0,
      "Time_End": 8.68,
      "Text": "This text was transcribed using whisper model: large-v2\n\n I'm just going to go ahead and jump right in."
    },
    {
      "Time_Start": 8.68,
      "Time_End": 10.64,
      "Text": " There's two caveats to this presentation."
    },
    {
      "Time_Start": 10.64,
      "Time_End": 13.44,
      "Text": " The first caveat is almost the entirety of this presentation"
    },
    {
      "Time_Start": 13.44,
      "Time_End": 15.36,
      "Text": " was learned through reverse engineering."
    },
    {
      "Time_Start": 15.36,
      "Time_End": 19.8,
      "Text": " So I tried really hard to make sure everything is accurate,"
    },
    {
      "Time_Start": 19.8,
      "Time_End": 22.7,
      "Text": " but there is likely going to be one or two inaccuracies."
    },
    {
      "Time_Start": 22.7,
      "Time_End": 25.92,
      "Text": " Please just give me some grace with that."
    },
    {
      "Time_Start": 25.92,
      "Time_End": 29.0,
      "Text": " The other caveat is there is a ton of content."
    },
    {
      "Time_Start": 29.0,
      "Time_End": 33.24,
      "Text": " This project has lasted the last two years."
    },
    {
      "Time_Start": 33.24,
      "Time_End": 35.8,
      "Text": " So I'm very thankful and appreciative"
    },
    {
      "Time_Start": 35.8,
      "Time_End": 37.68,
      "Text": " that I can present it to you today,"
    },
    {
      "Time_Start": 37.68,
      "Time_End": 39.96,
      "Text": " but it's also two years of content in 45 minutes."
    },
    {
      "Time_Start": 39.96,
      "Time_End": 41.4,
      "Text": " So we're going to have to go quick."
    },
    {
      "Time_Start": 41.4,
      "Time_End": 43.480000000000004,
      "Text": " I can't go in depth with too much,"
    },
    {
      "Time_Start": 43.480000000000004,
      "Time_End": 46.16,
      "Text": " but this presentation, the video,"
    },
    {
      "Time_Start": 46.16,
      "Time_End": 47.879999999999995,
      "Text": " an associated tool that implements"
    },
    {
      "Time_Start": 47.879999999999995,
      "Time_End": 50.0,
      "Text": " every single thing that we're going to talk about,"
    },
    {
      "Time_Start": 50.0,
      "Time_End": 52.400000000000006,
      "Text": " an extensive wiki, and then an associated blog post"
    },
    {
      "Time_Start": 52.400000000000006,
      "Time_End": 54.72,
      "Text": " is all going to come out about a month from now."
    },
    {
      "Time_Start": 54.72,
      "Time_End": 57.2,
      "Text": " So although we're going to go quick through the slides,"
    },
    {
      "Time_Start": 57.2,
      "Time_End": 59.92,
      "Text": " there's going to be tons of reference documentation."
    },
    {
      "Time_Start": 59.92,
      "Time_End": 62.36,
      "Text": " So if you miss something, ask me a question about it,"
    },
    {
      "Time_Start": 62.36,
      "Time_End": 64.32000000000001,
      "Text": " but don't feel too bad if you didn't"
    },
    {
      "Time_Start": 64.32000000000001,
      "Time_End": 65.84,
      "Text": " take a note on something."
    },
    {
      "Time_Start": 65.84,
      "Time_End": 68.76,
      "Text": " There'll be plenty of references later."
    },
    {
      "Time_Start": 68.76,
      "Time_End": 70.96000000000001,
      "Text": " With that, let's jump right in."
    },
    {
      "Time_Start": 70.96000000000001,
      "Time_End": 72.8,
      "Text": " Thank you so much for coming here today."
    },
    {
      "Time_Start": 72.8,
      "Time_End": 74.56,
      "Text": " I know there's a lot of really cool talks."
    },
    {
      "Time_Start": 74.56,
      "Time_End": 77.12,
      "Text": " I appreciate that you're at this one."
    },
    {
      "Time_Start": 77.12,
      "Time_End": 80.88,
      "Text": " LSA Whisperer is this idea of instead"
    },
    {
      "Time_Start": 80.88,
      "Time_End": 85.28,
      "Text": " of accessing LSAS memory to accomplish our normal trade"
    },
    {
      "Time_Start": 85.36,
      "Time_End": 89.32000000000001,
      "Text": " craft, what can we accomplish without ever touching"
    },
    {
      "Time_Start": 89.32000000000001,
      "Time_End": 91.8,
      "Text": " LSAS memory in the first place?"
    },
    {
      "Time_Start": 91.8,
      "Time_End": 95.04,
      "Text": " That's the idea that we're going to play with today."
    },
    {
      "Time_Start": 95.04,
      "Time_End": 97.64,
      "Text": " So we have an obligatory, who am I?"
    },
    {
      "Time_Start": 97.64,
      "Time_End": 99.12,
      "Text": " Hello, my name is Evan McBroom."
    },
    {
      "Time_Start": 99.12,
      "Time_End": 101.68,
      "Text": " I work at SpectreOps as a systems developer."
    },
    {
      "Time_Start": 101.68,
      "Time_End": 103.12,
      "Text": " What that means from our day to day"
    },
    {
      "Time_Start": 103.12,
      "Time_End": 108.36,
      "Text": " is I write desktop application software, which in our domain"
    },
    {
      "Time_Start": 108.36,
      "Time_End": 109.64,
      "Text": " just means writing tools."
    },
    {
      "Time_Start": 109.64,
      "Time_End": 111.52000000000001,
      "Text": " It's usually for the Windows operating system,"
    },
    {
      "Time_Start": 111.52000000000001,
      "Time_End": 113.92,
      "Text": " but any operating system is fair game."
    },
    {
      "Time_Start": 113.92,
      "Time_End": 115.88,
      "Text": " Sometimes it's Linux operating system questions"
    },
    {
      "Time_Start": 115.88,
      "Time_End": 118.8,
      "Text": " through Slack internally that I help out with."
    },
    {
      "Time_Start": 118.8,
      "Time_End": 120.92,
      "Text": " I work on a team called the Internal and Community"
    },
    {
      "Time_Start": 120.92,
      "Time_End": 121.96000000000001,
      "Text": " Products Team."
    },
    {
      "Time_Start": 121.96000000000001,
      "Time_End": 126.6,
      "Text": " We develop software that we use both internally"
    },
    {
      "Time_Start": 126.6,
      "Time_End": 128.16,
      "Text": " as Red Team consultants, but we also"
    },
    {
      "Time_Start": 128.16,
      "Time_End": 132.4,
      "Text": " produce for the world to use, like other companies"
    },
    {
      "Time_Start": 132.4,
      "Time_End": 134.08,
      "Text": " to use as well."
    },
    {
      "Time_Start": 134.08,
      "Time_End": 137.48,
      "Text": " Some software that you may have heard of that we maintain"
    },
    {
      "Time_Start": 137.48,
      "Time_End": 141.08,
      "Text": " is the Mythic C2 platform that my lovely co-worker Cody"
    },
    {
      "Time_Start": 141.08,
      "Time_End": 143.6,
      "Text": " Thomas maintains, as well as the Ghostwriter"
    },
    {
      "Time_Start": 143.6,
      "Time_End": 146.35999999999999,
      "Text": " management software, which my manager Christopher"
    },
    {
      "Time_Start": 146.35999999999999,
      "Time_End": 150.07999999999998,
      "Text": " Maddalena created."
    },
    {
      "Time_Start": 150.07999999999998,
      "Time_End": 154.04,
      "Text": " There's also several co-workers that helped with this project."
    },
    {
      "Time_Start": 154.04,
      "Time_End": 157.12,
      "Text": " Five that I want to call out in specific"
    },
    {
      "Time_Start": 157.12,
      "Time_End": 159.84,
      "Text": " is Elad, Lee, Will, Daniel, and Kai."
    },
    {
      "Time_Start": 159.84,
      "Time_End": 161.29999999999998,
      "Text": " You see their images on the screen."
    },
    {
      "Time_Start": 161.29999999999998,
      "Time_End": 163.07999999999998,
      "Text": " A lot of them are here today."
    },
    {
      "Time_Start": 163.07999999999998,
      "Time_End": 166.4,
      "Text": " These guys contributed many ideas"
    },
    {
      "Time_Start": 166.4,
      "Time_End": 167.84,
      "Text": " that we're going to talk about."
    },
    {
      "Time_Start": 167.84,
      "Time_End": 169.88,
      "Text": " They helped with hours of testing, sometimes"
    },
    {
      "Time_Start": 169.88,
      "Time_End": 171.2,
      "Text": " contributing code as well."
    },
    {
      "Time_Start": 171.2,
      "Time_End": 173.35999999999999,
      "Text": " So they spent a lot of time on this project,"
    },
    {
      "Time_Start": 174.12,
      "Time_End": 175.48000000000002,
      "Text": " and I appreciate that."
    },
    {
      "Time_Start": 175.48000000000002,
      "Time_End": 178.24,
      "Text": " There's also many people externally to the company"
    },
    {
      "Time_Start": 178.24,
      "Time_End": 181.92000000000002,
      "Text": " that we reviewed a lot of their online research,"
    },
    {
      "Time_Start": 181.92000000000002,
      "Time_End": 183.72000000000003,
      "Text": " and that helped with the project as well."
    },
    {
      "Time_Start": 183.72000000000003,
      "Time_End": 186.8,
      "Text": " So if you see your name on the screen,"
    },
    {
      "Time_Start": 186.8,
      "Time_End": 189.88000000000002,
      "Text": " or if you're watching this video later and you see your name,"
    },
    {
      "Time_Start": 189.88000000000002,
      "Time_End": 193.04000000000002,
      "Text": " thank you for your work."
    },
    {
      "Time_Start": 193.04000000000002,
      "Time_End": 194.84,
      "Text": " Now let's jump right in."
    },
    {
      "Time_Start": 194.84,
      "Time_End": 196.94000000000003,
      "Text": " So if you're a Red Team operator,"
    },
    {
      "Time_Start": 196.94000000000003,
      "Time_End": 199.44000000000003,
      "Text": " there's a common problem you've probably run into,"
    },
    {
      "Time_Start": 199.44000000000003,
      "Time_End": 202.24,
      "Text": " which is that, well, we want to get credentials."
    },
    {
      "Time_Start": 202.24,
      "Time_End": 203.8,
      "Text": " Credentials are managed by LSAS,"
    },
    {
      "Time_Start": 203.8,
      "Time_End": 206.4,
      "Text": " so we want to usually access LSAS memory."
    },
    {
      "Time_Start": 206.4,
      "Time_End": 208.28,
      "Text": " But Microsoft recognizes that, and they"
    },
    {
      "Time_Start": 208.28,
      "Time_End": 212.32000000000002,
      "Text": " put in a lot of mitigations to prevent you"
    },
    {
      "Time_Start": 212.32000000000002,
      "Time_End": 218.62,
      "Text": " not only accessing LSAS memory, but having a lot of abuse"
    },
    {
      "Time_Start": 218.62,
      "Time_End": 221.12,
      "Text": " options once you do gain access."
    },
    {
      "Time_Start": 221.12,
      "Time_End": 223.12,
      "Text": " So things like PPL prevents access,"
    },
    {
      "Time_Start": 223.12,
      "Time_End": 225.68,
      "Text": " and then Credential Guard mitigates the abuse"
    },
    {
      "Time_Start": 225.68,
      "Time_End": 227.62,
      "Text": " that you can do once you gain access."
    },
    {
      "Time_Start": 227.62,
      "Time_End": 231.8,
      "Text": " And that, for Red Team operators, stinks."
    },
    {
      "Time_Start": 231.8,
      "Time_End": 234.92000000000002,
      "Text": " We started brainstorming ideas of maybe ways"
    },
    {
      "Time_Start": 234.92000000000002,
      "Time_End": 236.8,
      "Text": " to get around this."
    },
    {
      "Time_Start": 236.8,
      "Time_End": 239.08,
      "Text": " And one idea that we started playing with"
    },
    {
      "Time_Start": 239.08,
      "Time_End": 242.4,
      "Text": " was the idea of maybe we can just request credentials"
    },
    {
      "Time_Start": 242.4,
      "Time_End": 245.12,
      "Text": " from LSAS, and if we do it kindly,"
    },
    {
      "Time_Start": 245.12,
      "Time_End": 249.12,
      "Text": " maybe LSAS would just give them to us."
    },
    {
      "Time_Start": 249.12,
      "Time_End": 251.36,
      "Text": " TLDR, turns out you can."
    },
    {
      "Time_Start": 251.36,
      "Time_End": 254.4,
      "Text": " But we've actually been doing this for years now."
    },
    {
      "Time_Start": 254.4,
      "Time_End": 257.48,
      "Text": " So you have likely, if you've been on a Red Team,"
    },
    {
      "Time_Start": 257.48,
      "Time_End": 258.84000000000003,
      "Text": " dumped Kerberos tickets."
    },
    {
      "Time_Start": 258.84000000000003,
      "Time_End": 261.56,
      "Text": " That's the same idea that we're going to talk about here"
    },
    {
      "Time_Start": 262.32,
      "Time_End": 262.82,
      "Text": " today."
    },
    {
      "Time_Start": 262.82,
      "Time_End": 267.6,
      "Text": " But you can dump more than just Kerberos tickets."
    },
    {
      "Time_Start": 267.6,
      "Time_End": 271.2,
      "Text": " The nice thing with this is if you can just ask LSAS directly"
    },
    {
      "Time_Start": 271.2,
      "Time_End": 272.76,
      "Text": " for creds, and it gives it to you,"
    },
    {
      "Time_Start": 272.76,
      "Time_End": 275.56,
      "Text": " it doesn't matter what mitigations Microsoft"
    },
    {
      "Time_Start": 275.56,
      "Time_End": 276.88,
      "Text": " allows you to enable."
    },
    {
      "Time_Start": 276.88,
      "Time_End": 279.28,
      "Text": " This would just work."
    },
    {
      "Time_Start": 279.28,
      "Time_End": 281.72,
      "Text": " The thing that was surprising to us"
    },
    {
      "Time_Start": 281.72,
      "Time_End": 283.76,
      "Text": " is outside of the Kerberos package,"
    },
    {
      "Time_Start": 283.76,
      "Time_End": 285.48,
      "Text": " there's many packages first off."
    },
    {
      "Time_Start": 285.48,
      "Time_End": 287.52,
      "Text": " Outside of the Kerberos package, the ability"
    },
    {
      "Time_Start": 287.52,
      "Time_End": 289.84000000000003,
      "Text": " to request different pieces of data"
    },
    {
      "Time_Start": 289.84000000000003,
      "Time_End": 292.64000000000004,
      "Text": " has gone largely unexplored outside Microsoft,"
    },
    {
      "Time_Start": 292.64000000000004,
      "Time_End": 295.64000000000004,
      "Text": " which when we started finding lots of stuff,"
    },
    {
      "Time_Start": 295.64000000000004,
      "Time_End": 297.20000000000005,
      "Text": " lots of potential in this research,"
    },
    {
      "Time_Start": 297.20000000000005,
      "Time_End": 299.78000000000003,
      "Text": " and we just kept looking online, has anybody done this before?"
    },
    {
      "Time_Start": 299.78000000000003,
      "Time_End": 302.36,
      "Text": " And we were really surprised."
    },
    {
      "Time_Start": 302.36,
      "Time_End": 306.40000000000003,
      "Text": " It seems like for some packages, nobody has looked at them."
    },
    {
      "Time_Start": 306.40000000000003,
      "Time_End": 308.52000000000004,
      "Text": " So for a lot of the packages today,"
    },
    {
      "Time_Start": 308.52000000000004,
      "Time_End": 310.92,
      "Text": " it's likely going to be new content, which is fun."
    },
    {
      "Time_Start": 313.6,
      "Time_End": 316.48,
      "Text": " Again, the focus of this talk is specifically"
    },
    {
      "Time_Start": 316.48,
      "Time_End": 319.32,
      "Text": " on making requests to all different authentication"
    },
    {
      "Time_Start": 319.32,
      "Time_End": 323.56,
      "Text": " packages and recovering data from those requests."
    },
    {
      "Time_Start": 323.56,
      "Time_End": 327.20000000000005,
      "Text": " Now, this talk is going to be broken off into two large"
    },
    {
      "Time_Start": 327.20000000000005,
      "Time_End": 327.88,
      "Text": " parts."
    },
    {
      "Time_Start": 327.88,
      "Time_End": 330.36,
      "Text": " The first part, we just have to get this out of the way."
    },
    {
      "Time_Start": 330.36,
      "Time_End": 333.0,
      "Text": " We're going to talk about some LSA internals that"
    },
    {
      "Time_Start": 333.0,
      "Time_End": 336.52000000000004,
      "Text": " are specific to understanding the rest of the talk."
    },
    {
      "Time_Start": 336.52000000000004,
      "Time_End": 339.04,
      "Text": " There's a lot of architecture stuff we could discuss."
    },
    {
      "Time_Start": 339.04,
      "Time_End": 340.82,
      "Text": " We're going to disregard most of it."
    },
    {
      "Time_Start": 340.82,
      "Time_End": 342.28000000000003,
      "Text": " We're only going to talk about what"
    },
    {
      "Time_Start": 342.28000000000003,
      "Time_End": 346.08000000000004,
      "Text": " we need to know to understand the rest of the talk."
    },
    {
      "Time_Start": 346.15999999999997,
      "Time_End": 349.12,
      "Text": " And then we're going to go into the second half, which"
    },
    {
      "Time_Start": 349.12,
      "Time_End": 352.24,
      "Text": " is the authentication packages, what they are,"
    },
    {
      "Time_Start": 352.24,
      "Time_End": 354.21999999999997,
      "Text": " and what data you can request from them."
    },
    {
      "Time_Start": 354.21999999999997,
      "Time_End": 355.91999999999996,
      "Text": " And that's the part that is probably going"
    },
    {
      "Time_Start": 355.91999999999996,
      "Time_End": 359.59999999999997,
      "Text": " to be of most interest to people."
    },
    {
      "Time_Start": 359.59999999999997,
      "Time_End": 361.64,
      "Text": " So let's get this first part out of the way,"
    },
    {
      "Time_Start": 361.64,
      "Time_End": 363.96,
      "Text": " the internals of LSA, the specific ones"
    },
    {
      "Time_Start": 363.96,
      "Time_End": 366.47999999999996,
      "Text": " that you need to know about."
    },
    {
      "Time_Start": 366.47999999999996,
      "Time_End": 368.71999999999997,
      "Text": " The first thing that you should be aware of"
    },
    {
      "Time_Start": 368.71999999999997,
      "Time_End": 372.71999999999997,
      "Text": " is this term called a security support provider."
    },
    {
      "Time_Start": 372.71999999999997,
      "Time_End": 373.91999999999996,
      "Text": " It's a long term."
    },
    {
      "Time_Start": 373.92,
      "Time_End": 377.12,
      "Text": " This just means a DLL that LSAS loads."
    },
    {
      "Time_Start": 377.12,
      "Time_End": 381.16,
      "Text": " Again, all this is is a DLL that LSAS loads."
    },
    {
      "Time_Start": 381.16,
      "Time_End": 385.40000000000003,
      "Text": " This DLL will extend LSAS to support a new authentication"
    },
    {
      "Time_Start": 385.40000000000003,
      "Time_End": 388.12,
      "Text": " scheme or a new security protocol."
    },
    {
      "Time_Start": 390.96000000000004,
      "Time_End": 395.52000000000004,
      "Text": " If a DLL implements a new authentication scheme,"
    },
    {
      "Time_Start": 395.52000000000004,
      "Time_End": 398.56,
      "Text": " we say that that DLL is an authentication package."
    },
    {
      "Time_Start": 399.16,
      "Time_End": 401.84,
      "Text": " It not only will implement a new authentication scheme,"
    },
    {
      "Time_Start": 401.84,
      "Time_End": 403.6,
      "Text": " when you log in using that package,"
    },
    {
      "Time_Start": 403.6,
      "Time_End": 405.64,
      "Text": " it will maintain some information"
    },
    {
      "Time_Start": 405.64,
      "Time_End": 406.92,
      "Text": " about your logon session."
    },
    {
      "Time_Start": 406.92,
      "Time_End": 410.4,
      "Text": " And that's some data that we can make requests to and get"
    },
    {
      "Time_Start": 410.4,
      "Time_End": 412.28000000000003,
      "Text": " some data back, which is pretty neat."
    },
    {
      "Time_Start": 412.28000000000003,
      "Time_End": 414.12,
      "Text": " If you want to get very specific,"
    },
    {
      "Time_Start": 414.12,
      "Time_End": 416.68,
      "Text": " these DLLs implement some callback functions."
    },
    {
      "Time_Start": 416.68,
      "Time_End": 418.92,
      "Text": " And there's a few functions that are associated"
    },
    {
      "Time_Start": 418.92,
      "Time_End": 421.28,
      "Text": " with an authentication package."
    },
    {
      "Time_Start": 421.28,
      "Time_End": 423.36,
      "Text": " There's like six of them."
    },
    {
      "Time_Start": 423.36,
      "Time_End": 425.16,
      "Text": " But you have to implement at least one"
    },
    {
      "Time_Start": 425.16,
      "Time_End": 426.4,
      "Text": " of those callback functions."
    },
    {
      "Time_Start": 426.64000000000004,
      "Time_End": 428.84000000000003,
      "Text": " And if you do, you are now considered"
    },
    {
      "Time_Start": 428.84000000000003,
      "Time_End": 430.72,
      "Text": " an authentication package."
    },
    {
      "Time_Start": 430.72,
      "Time_End": 433.92,
      "Text": " But the spirit of this DLL is it's just"
    },
    {
      "Time_Start": 433.92,
      "Time_End": 437.64000000000004,
      "Text": " a DLL that implements an authentication scheme."
    },
    {
      "Time_Start": 437.64000000000004,
      "Time_End": 441.48,
      "Text": " Now, that DLL can also implement a security protocol."
    },
    {
      "Time_Start": 441.48,
      "Time_End": 443.56000000000006,
      "Text": " You're probably familiar with a lot of these things"
    },
    {
      "Time_Start": 443.56000000000006,
      "Time_End": 446.36,
      "Text": " like OAuth 2, Kerberos, and TLM."
    },
    {
      "Time_Start": 446.36,
      "Time_End": 449.24,
      "Text": " If your DLL implements a security protocol,"
    },
    {
      "Time_Start": 449.24,
      "Time_End": 451.20000000000005,
      "Text": " we call it a security package."
    },
    {
      "Time_Start": 451.20000000000005,
      "Time_End": 453.68000000000006,
      "Text": " The fun part is these DLLs commonly"
    },
    {
      "Time_Start": 454.48,
      "Time_End": 458.56,
      "Text": " The fun part is these DLLs commonly are both."
    },
    {
      "Time_Start": 458.56,
      "Time_End": 460.8,
      "Text": " For the purposes of this talk, though,"
    },
    {
      "Time_Start": 460.8,
      "Time_End": 463.36,
      "Text": " we don't care about any of the security package"
    },
    {
      "Time_Start": 463.36,
      "Time_End": 466.72,
      "Text": " concepts, those NTLM protocols, Kerberos protocols,"
    },
    {
      "Time_Start": 466.72,
      "Time_End": 469.36,
      "Text": " the own-the-wire things that you would dump in Wireshark."
    },
    {
      "Time_Start": 469.36,
      "Time_End": 471.02,
      "Text": " We're not going to look at any of that."
    },
    {
      "Time_Start": 471.02,
      "Time_End": 473.44,
      "Text": " We're only going to look at authentication packages,"
    },
    {
      "Time_Start": 473.44,
      "Time_End": 476.04,
      "Text": " specifically what is that information"
    },
    {
      "Time_Start": 476.04,
      "Time_End": 477.64,
      "Text": " they store about your session?"
    },
    {
      "Time_Start": 477.64,
      "Time_End": 482.36,
      "Text": " And of that information, what can you recover?"
    },
    {
      "Time_Start": 482.36,
      "Time_End": 485.08000000000004,
      "Text": " Just like an AP, a security package"
    },
    {
      "Time_Start": 485.08000000000004,
      "Time_End": 486.48,
      "Text": " has, again, some callback functions"
    },
    {
      "Time_Start": 486.48,
      "Time_End": 488.16,
      "Text": " associated with that idea."
    },
    {
      "Time_Start": 488.16,
      "Time_End": 489.68,
      "Text": " As long as you implement one of them,"
    },
    {
      "Time_Start": 489.68,
      "Time_End": 491.52000000000004,
      "Text": " you are now a security package."
    },
    {
      "Time_Start": 491.52000000000004,
      "Time_End": 494.24,
      "Text": " Cool."
    },
    {
      "Time_Start": 494.24,
      "Time_End": 495.28000000000003,
      "Text": " This is a big table."
    },
    {
      "Time_Start": 495.28000000000003,
      "Time_End": 500.68,
      "Text": " This is every SSP that Microsoft has ever produced currently."
    },
    {
      "Time_Start": 500.68,
      "Time_End": 502.84000000000003,
      "Text": " It includes legacy ones as well as ones"
    },
    {
      "Time_Start": 502.84000000000003,
      "Time_End": 504.24,
      "Text": " that currently ship with Windows."
    },
    {
      "Time_Start": 504.24,
      "Time_End": 505.6,
      "Text": " It's a lot of stuff on the screen."
    },
    {
      "Time_Start": 505.6,
      "Time_End": 507.44,
      "Text": " I'm going to break down a few parts of this."
    },
    {
      "Time_Start": 507.44,
      "Time_End": 508.92,
      "Text": " Just don't get bogged down."
    },
    {
      "Time_Start": 508.92,
      "Time_End": 514.44,
      "Text": " The main thing is every row represents a new SSP."
    },
    {
      "Time_Start": 514.44,
      "Time_End": 518.72,
      "Text": " There's one column labeled SP for security package."
    },
    {
      "Time_Start": 518.72,
      "Time_End": 521.04,
      "Text": " And that just highlights the specific protocol"
    },
    {
      "Time_Start": 521.04,
      "Time_End": 523.64,
      "Text": " that DLL implements."
    },
    {
      "Time_Start": 523.64,
      "Time_End": 526.54,
      "Text": " There's another column that's labeled AP for authentication"
    },
    {
      "Time_Start": 526.54,
      "Time_End": 527.04,
      "Text": " package."
    },
    {
      "Time_Start": 527.04,
      "Time_End": 529.9200000000001,
      "Text": " If there's a green checkmark in that column,"
    },
    {
      "Time_Start": 529.9200000000001,
      "Time_End": 531.52,
      "Text": " we're going to talk about it today."
    },
    {
      "Time_Start": 531.52,
      "Time_End": 533.9200000000001,
      "Text": " So again, all of these fancy protocols,"
    },
    {
      "Time_Start": 533.9200000000001,
      "Time_End": 535.4200000000001,
      "Text": " we're not going to discuss them."
    },
    {
      "Time_Start": 535.4200000000001,
      "Time_End": 536.84,
      "Text": " So we're not going to look at Wireshark dumps"
    },
    {
      "Time_Start": 536.84,
      "Time_End": 537.88,
      "Text": " or any of that."
    },
    {
      "Time_Start": 537.88,
      "Time_End": 540.64,
      "Text": " All we're going to talk about is the authentication package"
    },
    {
      "Time_Start": 540.64,
      "Time_End": 543.4,
      "Text": " functionality."
    },
    {
      "Time_Start": 543.4,
      "Time_End": 545.4,
      "Text": " Now, you may wonder, how do we make these requests"
    },
    {
      "Time_Start": 545.4,
      "Time_End": 546.96,
      "Text": " in the first place?"
    },
    {
      "Time_Start": 546.96,
      "Time_End": 551.04,
      "Text": " There's this wonderful Win32 API called LSA Call Authentication"
    },
    {
      "Time_Start": 551.04,
      "Time_End": 553.8,
      "Text": " Package, which facilitates all of this."
    },
    {
      "Time_Start": 553.8,
      "Time_End": 557.92,
      "Text": " How this call works is you can be any third-party software,"
    },
    {
      "Time_Start": 557.92,
      "Time_End": 559.96,
      "Text": " some client process."
    },
    {
      "Time_Start": 559.96,
      "Time_End": 563.6,
      "Text": " And you will say, hey, I would like to make a request to a,"
    },
    {
      "Time_Start": 563.6,
      "Time_End": 567.76,
      "Text": " and you give a package name or a package ID to be specific."
    },
    {
      "Time_Start": 567.76,
      "Time_End": 570.64,
      "Text": " In your request, you give a blob of data."
    },
    {
      "Time_Start": 570.64,
      "Time_End": 573.56,
      "Text": " That blob of data needs to be formatted correctly"
    },
    {
      "Time_Start": 573.56,
      "Time_End": 575.92,
      "Text": " for that package to understand it, interpret it,"
    },
    {
      "Time_Start": 575.92,
      "Time_End": 577.84,
      "Text": " do something meaningful."
    },
    {
      "Time_Start": 577.84,
      "Time_End": 581.0,
      "Text": " But as long as it's formatted correctly for that package,"
    },
    {
      "Time_Start": 581.0,
      "Time_End": 584.16,
      "Text": " you should get a blob of data in response."
    },
    {
      "Time_Start": 584.16,
      "Time_End": 585.96,
      "Text": " And that blob of data is going to be"
    },
    {
      "Time_Start": 585.96,
      "Time_End": 588.48,
      "Text": " some piece of information."
    },
    {
      "Time_Start": 588.48,
      "Time_End": 591.36,
      "Text": " A perfect example of this is dumping Kerberos tickets."
    },
    {
      "Time_Start": 591.36,
      "Time_End": 595.0,
      "Text": " I'm sure a lot of people here have dumped Kerberos tickets."
    },
    {
      "Time_Start": 595.0,
      "Time_End": 597.3199999999999,
      "Text": " But a lot of people may not be aware."
    },
    {
      "Time_Start": 597.36,
      "Time_End": 600.96,
      "Text": " This is facilitated through this Win32 API."
    },
    {
      "Time_Start": 600.96,
      "Time_End": 603.5600000000001,
      "Text": " All of your Red Team tools that dump Kerberos tickets"
    },
    {
      "Time_Start": 603.5600000000001,
      "Time_End": 605.12,
      "Text": " call this API."
    },
    {
      "Time_Start": 605.12,
      "Time_End": 608.0,
      "Text": " They submit a blob of data that says, hey, Kerberos package,"
    },
    {
      "Time_Start": 608.0,
      "Time_End": 609.84,
      "Text": " give me tickets."
    },
    {
      "Time_Start": 609.84,
      "Time_End": 612.24,
      "Text": " And then that Kerberos package gives a blob of data"
    },
    {
      "Time_Start": 612.24,
      "Time_End": 613.0,
      "Text": " in response."
    },
    {
      "Time_Start": 613.0,
      "Time_End": 616.9200000000001,
      "Text": " And that blob of data is those Kerberos tickets."
    },
    {
      "Time_Start": 616.9200000000001,
      "Time_End": 619.2800000000001,
      "Text": " Now, there's a lot of different requests"
    },
    {
      "Time_Start": 619.2800000000001,
      "Time_End": 621.4000000000001,
      "Text": " you can make to all these different auth packages,"
    },
    {
      "Time_Start": 621.4000000000001,
      "Time_End": 623.86,
      "Text": " which we're going to get into in the second half."
    },
    {
      "Time_Start": 623.86,
      "Time_End": 625.6,
      "Text": " There's a lot of valuable ones."
    },
    {
      "Time_Start": 625.6,
      "Time_End": 627.1600000000001,
      "Text": " But if you're writing Red Team tools,"
    },
    {
      "Time_Start": 628.16,
      "Time_End": 630.28,
      "Text": " you may already be thinking, is there"
    },
    {
      "Time_Start": 630.28,
      "Time_End": 633.6,
      "Text": " any way I can bypass this Win32 API"
    },
    {
      "Time_Start": 633.6,
      "Time_End": 635.9599999999999,
      "Text": " to bypass some EDR monitoring?"
    },
    {
      "Time_Start": 635.9599999999999,
      "Time_End": 637.04,
      "Text": " And yes, you can."
    },
    {
      "Time_Start": 637.04,
      "Time_End": 639.28,
      "Text": " We've already figured that out for you."
    },
    {
      "Time_Start": 639.28,
      "Time_End": 647.0,
      "Text": " So originally in NT 5.2, so a long time ago,"
    },
    {
      "Time_Start": 647.0,
      "Time_End": 650.7199999999999,
      "Text": " Windows introduced an LPC port for communication"
    },
    {
      "Time_Start": 650.7199999999999,
      "Time_End": 655.4,
      "Text": " to an LSA component called the Security Package Manager."
    },
    {
      "Time_Start": 655.4,
      "Time_End": 658.56,
      "Text": " Now, I'm confident no one here has heard of this component."
    },
    {
      "Time_Start": 658.56,
      "Time_End": 660.0799999999999,
      "Text": " That is OK."
    },
    {
      "Time_Start": 660.0799999999999,
      "Time_End": 661.76,
      "Text": " And the reason I'm confident about that"
    },
    {
      "Time_Start": 661.76,
      "Time_End": 665.0799999999999,
      "Text": " is we tried our hardest to find literally any resource that"
    },
    {
      "Time_Start": 665.0799999999999,
      "Time_End": 666.68,
      "Text": " mentioned this."
    },
    {
      "Time_Start": 666.68,
      "Time_End": 667.76,
      "Text": " And we cannot."
    },
    {
      "Time_Start": 667.76,
      "Time_End": 669.56,
      "Text": " Even the Windows internals books don't"
    },
    {
      "Time_Start": 669.56,
      "Time_End": 671.4,
      "Text": " cover this component, which is surprising"
    },
    {
      "Time_Start": 671.4,
      "Time_End": 673.0799999999999,
      "Text": " because it's very old."
    },
    {
      "Time_Start": 673.0799999999999,
      "Time_End": 675.84,
      "Text": " And it is the component that orchestrates"
    },
    {
      "Time_Start": 675.84,
      "Time_End": 676.84,
      "Text": " all of these packages."
    },
    {
      "Time_Start": 676.84,
      "Time_End": 678.6,
      "Text": " So it's very important."
    },
    {
      "Time_Start": 678.6,
      "Time_End": 681.56,
      "Text": " We learned about it ourselves through leaked Windows source"
    },
    {
      "Time_Start": 681.56,
      "Time_End": 684.72,
      "Text": " code that came out with the Windows Research Kernel."
    },
    {
      "Time_Start": 685.08,
      "Time_End": 687.88,
      "Text": " So this LPC port is how you communicate"
    },
    {
      "Time_Start": 687.88,
      "Time_End": 690.0,
      "Text": " with a component called the Security Package Manager,"
    },
    {
      "Time_Start": 690.0,
      "Time_End": 692.1600000000001,
      "Text": " or the SPM for short."
    },
    {
      "Time_Start": 692.1600000000001,
      "Time_End": 695.2,
      "Text": " If you submit an appropriate request to that port,"
    },
    {
      "Time_Start": 695.2,
      "Time_End": 697.48,
      "Text": " it will ferry it along to a package"
    },
    {
      "Time_Start": 697.48,
      "Time_End": 701.4,
      "Text": " to make that authentication package call."
    },
    {
      "Time_Start": 701.4,
      "Time_End": 703.72,
      "Text": " So you can dump Kerberos tickets if you want by just"
    },
    {
      "Time_Start": 703.72,
      "Time_End": 706.72,
      "Text": " communicating to this LPC port."
    },
    {
      "Time_Start": 706.72,
      "Time_End": 712.36,
      "Text": " In Windows 7, Microsoft introduced a RPC server."
    },
    {
      "Time_Start": 712.36,
      "Time_End": 714.64,
      "Text": " All they did is put this RPC server"
    },
    {
      "Time_Start": 715.56,
      "Time_End": 720.36,
      "Text": " right in front of that original component for LSA."
    },
    {
      "Time_Start": 720.36,
      "Time_End": 722.12,
      "Text": " So the Security Package Manager component"
    },
    {
      "Time_Start": 722.12,
      "Time_End": 724.52,
      "Text": " still exists in LSA today."
    },
    {
      "Time_Start": 724.52,
      "Time_End": 726.1999999999999,
      "Text": " There's an RPC server in front of it."
    },
    {
      "Time_Start": 726.1999999999999,
      "Time_End": 728.68,
      "Text": " And it now listens on an ALPC port."
    },
    {
      "Time_Start": 728.68,
      "Time_End": 731.12,
      "Text": " Again, you can communicate to the ALPC port"
    },
    {
      "Time_Start": 731.12,
      "Time_End": 733.48,
      "Text": " directly, submit an RPC request."
    },
    {
      "Time_Start": 733.48,
      "Time_End": 735.4,
      "Text": " It has to be formatted correctly."
    },
    {
      "Time_Start": 735.4,
      "Time_End": 737.92,
      "Text": " But if you do that, you can dump Kerberos tickets"
    },
    {
      "Time_Start": 737.92,
      "Time_End": 740.2,
      "Text": " or do any of these other requests"
    },
    {
      "Time_Start": 740.2,
      "Time_End": 742.8000000000001,
      "Text": " that we're going to cover without going"
    },
    {
      "Time_Start": 742.8000000000001,
      "Time_End": 745.6400000000001,
      "Text": " through the Win32 API."
    },
    {
      "Time_Start": 745.6400000000001,
      "Time_End": 748.12,
      "Text": " And you might think, oh, this is a lot of work."
    },
    {
      "Time_Start": 748.12,
      "Time_End": 750.0400000000001,
      "Text": " I mentioned that there is a tool that we're"
    },
    {
      "Time_Start": 750.0400000000001,
      "Time_End": 752.32,
      "Text": " going to release about a month from now that implements"
    },
    {
      "Time_Start": 752.32,
      "Time_End": 753.6600000000001,
      "Text": " everything we talk about."
    },
    {
      "Time_Start": 753.6600000000001,
      "Time_End": 756.84,
      "Text": " We have implemented this RPC interaction ourselves"
    },
    {
      "Time_Start": 756.84,
      "Time_End": 757.36,
      "Text": " in the tool."
    },
    {
      "Time_Start": 757.36,
      "Time_End": 760.4000000000001,
      "Text": " So you'll be able to use that if you"
    },
    {
      "Time_Start": 760.4000000000001,
      "Time_End": 765.2800000000001,
      "Text": " want to implement that yourself to see how to do that."
    },
    {
      "Time_Start": 765.2800000000001,
      "Time_End": 767.6,
      "Text": " With that out of the way, here's the fun part of the talk,"
    },
    {
      "Time_Start": 767.6,
      "Time_End": 769.88,
      "Text": " which is all the authentication packages that currently"
    },
    {
      "Time_Start": 769.88,
      "Time_End": 772.14,
      "Text": " ship with Windows and what you can do with them."
    },
    {
      "Time_Start": 772.14,
      "Time_End": 773.56,
      "Text": " We're going to start with one that"
    },
    {
      "Time_Start": 773.56,
      "Time_End": 775.52,
      "Text": " is likely most familiar with everyone, which"
    },
    {
      "Time_Start": 775.52,
      "Time_End": 777.0,
      "Text": " is the Kerberos package."
    },
    {
      "Time_Start": 777.0,
      "Time_End": 780.04,
      "Text": " But remember, we're not talking about the on-the-wire Kerberos"
    },
    {
      "Time_Start": 780.04,
      "Time_End": 780.92,
      "Text": " protocol."
    },
    {
      "Time_Start": 780.92,
      "Time_End": 783.76,
      "Text": " We're just talking about this authentication scheme logic."
    },
    {
      "Time_Start": 783.76,
      "Time_End": 785.56,
      "Text": " Basically, this package is going to store"
    },
    {
      "Time_Start": 785.56,
      "Time_End": 788.12,
      "Text": " some information about your logon session,"
    },
    {
      "Time_Start": 788.12,
      "Time_End": 792.08,
      "Text": " all that information, what can we interact with."
    },
    {
      "Time_Start": 792.08,
      "Time_End": 794.8,
      "Text": " So how all these slides are going to be laid out"
    },
    {
      "Time_Start": 794.8,
      "Time_End": 798.04,
      "Text": " is on the right, you're going to see the literal requests"
    },
    {
      "Time_Start": 798.04,
      "Time_End": 799.48,
      "Text": " that you can make to this package."
    },
    {
      "Time_Start": 799.5600000000001,
      "Time_End": 803.9200000000001,
      "Text": " And this is stuff that we had to typically reverse engineer."
    },
    {
      "Time_Start": 803.9200000000001,
      "Time_End": 805.22,
      "Text": " That's going to be on the right."
    },
    {
      "Time_Start": 805.22,
      "Time_End": 807.52,
      "Text": " On the left, you're going to see a high-level overview"
    },
    {
      "Time_Start": 807.52,
      "Time_End": 810.6,
      "Text": " of all of this same information."
    },
    {
      "Time_Start": 810.6,
      "Time_End": 812.64,
      "Text": " So these are half reference slides,"
    },
    {
      "Time_Start": 812.64,
      "Time_End": 815.36,
      "Text": " half we're going to talk through it together."
    },
    {
      "Time_Start": 815.36,
      "Time_End": 817.2,
      "Text": " So for the Kerberos package, you can"
    },
    {
      "Time_Start": 817.2,
      "Time_End": 820.48,
      "Text": " do basic host enumeration, which is like dumping Kerberos"
    },
    {
      "Time_Start": 820.48,
      "Time_End": 822.0,
      "Text": " cash tickets, which is nice."
    },
    {
      "Time_Start": 822.0,
      "Time_End": 823.84,
      "Text": " But there's other stuff that people usually"
    },
    {
      "Time_Start": 823.84,
      "Time_End": 827.44,
      "Text": " aren't aware of, like you can dump cloud configuration"
    },
    {
      "Time_Start": 827.44,
      "Time_End": 828.48,
      "Text": " information."
    },
    {
      "Time_Start": 828.48,
      "Time_End": 831.84,
      "Text": " You can also dump information about Kerberos mitigations"
    },
    {
      "Time_Start": 831.84,
      "Time_End": 834.04,
      "Text": " that are in place, such as the fast armor in."
    },
    {
      "Time_Start": 834.04,
      "Time_End": 838.84,
      "Text": " If that's enabled, you can get that from a specific request"
    },
    {
      "Time_Start": 838.84,
      "Time_End": 840.1800000000001,
      "Text": " to the Kerberos package."
    },
    {
      "Time_Start": 840.1800000000001,
      "Time_End": 842.5600000000001,
      "Text": " You can do ticket recovery, which is dump tickets,"
    },
    {
      "Time_Start": 842.5600000000001,
      "Time_End": 845.4,
      "Text": " like everyone, I'm sure, has done that, which is great."
    },
    {
      "Time_Start": 845.4,
      "Time_End": 847.9200000000001,
      "Text": " You can do pass a ticket usage, which, again, you"
    },
    {
      "Time_Start": 847.9200000000001,
      "Time_End": 849.24,
      "Text": " can do with plenty of tools."
    },
    {
      "Time_Start": 849.24,
      "Time_End": 851.8000000000001,
      "Text": " But that's facilitated through these calls as well."
    },
    {
      "Time_Start": 851.8000000000001,
      "Time_End": 854.52,
      "Text": " And ticket purging, which is also pretty common."
    },
    {
      "Time_Start": 854.52,
      "Time_End": 857.0,
      "Text": " The thing that's worth highlighting on this slide"
    },
    {
      "Time_Start": 857.08,
      "Time_End": 859.12,
      "Text": " specifically with ticket purging,"
    },
    {
      "Time_Start": 859.12,
      "Time_End": 861.0,
      "Text": " all the Red Team tools I'm aware of"
    },
    {
      "Time_Start": 861.0,
      "Time_End": 863.28,
      "Text": " will purge all of your tickets at once,"
    },
    {
      "Time_Start": 863.28,
      "Time_End": 864.52,
      "Text": " which is really frustrating."
    },
    {
      "Time_Start": 864.52,
      "Time_End": 866.12,
      "Text": " If you have a cache of 10 tickets,"
    },
    {
      "Time_Start": 866.12,
      "Time_End": 868.32,
      "Text": " but you only care about purging one of them,"
    },
    {
      "Time_Start": 868.32,
      "Time_End": 869.8,
      "Text": " all of the current Red Team tools"
    },
    {
      "Time_Start": 869.8,
      "Time_End": 872.2,
      "Text": " typically will purge all 10 tickets."
    },
    {
      "Time_Start": 872.2,
      "Time_End": 873.6,
      "Text": " That's just frustrating."
    },
    {
      "Time_Start": 873.6,
      "Time_End": 875.08,
      "Text": " It turns out the Kerberos package"
    },
    {
      "Time_Start": 875.08,
      "Time_End": 878.18,
      "Text": " has support for selectively purging tickets."
    },
    {
      "Time_Start": 878.18,
      "Time_End": 879.72,
      "Text": " So if you have a cache of 10 tickets,"
    },
    {
      "Time_Start": 879.72,
      "Time_End": 883.6,
      "Text": " you can say only purge that one ticket out of the 10,"
    },
    {
      "Time_Start": 883.6,
      "Time_End": 884.4,
      "Text": " and it will do it."
    },
    {
      "Time_Start": 884.4,
      "Time_End": 888.88,
      "Text": " So this is a quality of life improvement for Red Team tools."
    },
    {
      "Time_Start": 888.88,
      "Time_End": 891.52,
      "Text": " The last thing, name, bindin, and pinin."
    },
    {
      "Time_Start": 891.52,
      "Time_End": 894.24,
      "Text": " This is probably a lesser known term."
    },
    {
      "Time_Start": 894.24,
      "Time_End": 896.88,
      "Text": " But basically, bindin is when you say, hey,"
    },
    {
      "Time_Start": 896.88,
      "Time_End": 900.56,
      "Text": " if I authenticate to a domain name, use this DC address."
    },
    {
      "Time_Start": 900.56,
      "Time_End": 903.88,
      "Text": " And pinin is similar."
    },
    {
      "Time_Start": 903.88,
      "Time_End": 909.8,
      "Text": " If I authenticate inside this domain, use this KDC."
    },
    {
      "Time_Start": 909.8,
      "Time_End": 913.16,
      "Text": " Both of these are basically troubleshooting."
    },
    {
      "Time_Start": 913.16,
      "Time_End": 915.6,
      "Text": " They're helpful with troubleshooting for an operator."
    },
    {
      "Time_Start": 915.6,
      "Time_End": 918.16,
      "Text": " The specific situations you're going to run into"
    },
    {
      "Time_Start": 918.16,
      "Time_End": 921.4,
      "Text": " is if you have a golden ticket, and you're not"
    },
    {
      "Time_Start": 921.4,
      "Time_End": 924.4399999999999,
      "Text": " able to use that golden ticket to authenticate in a domain,"
    },
    {
      "Time_Start": 924.4399999999999,
      "Time_End": 928.16,
      "Text": " there is a trick that the user on Twitter,"
    },
    {
      "Time_Start": 928.16,
      "Time_End": 934.68,
      "Text": " mpgin, identified with domain bindin, where you can say,"
    },
    {
      "Time_Start": 934.68,
      "Time_End": 936.3,
      "Text": " hey, with this golden ticket, I actually"
    },
    {
      "Time_Start": 936.3,
      "Time_End": 938.8,
      "Text": " want to bind to a certain domain address,"
    },
    {
      "Time_Start": 938.8,
      "Time_End": 940.6,
      "Text": " and it will fix your authentication issues,"
    },
    {
      "Time_Start": 940.6,
      "Time_End": 941.72,
      "Text": " which is nice."
    },
    {
      "Time_Start": 941.72,
      "Time_End": 943.96,
      "Text": " And you can do that with, instead of a command line"
    },
    {
      "Time_Start": 943.96,
      "Time_End": 945.6800000000001,
      "Text": " utility, you can just submit that request"
    },
    {
      "Time_Start": 945.6800000000001,
      "Time_End": 947.44,
      "Text": " to the Kerberos package yourself."
    },
    {
      "Time_Start": 947.44,
      "Time_End": 950.6,
      "Text": " And with DC pinin, there are some neat tricks"
    },
    {
      "Time_Start": 950.6,
      "Time_End": 951.84,
      "Text": " you can abuse with this."
    },
    {
      "Time_Start": 951.84,
      "Time_End": 953.96,
      "Text": " But if you're interested in that,"
    },
    {
      "Time_Start": 953.96,
      "Time_End": 956.6,
      "Text": " I would recommend watching the James Foreshaw and Nick"
    },
    {
      "Time_Start": 956.6,
      "Time_End": 959.52,
      "Text": " Landers talk from Black Hat 2002 called"
    },
    {
      "Time_Start": 959.52,
      "Time_End": 961.64,
      "Text": " Kerberos to the Next Level."
    },
    {
      "Time_Start": 961.64,
      "Time_End": 965.08,
      "Text": " But there are other abuse situations with domain pinin."
    },
    {
      "Time_Start": 965.08,
      "Time_End": 967.5600000000001,
      "Text": " It's worth looking into."
    },
    {
      "Time_Start": 967.5600000000001,
      "Time_End": 970.12,
      "Text": " Now, with the next authentication package,"
    },
    {
      "Time_Start": 970.12,
      "Time_End": 971.68,
      "Text": " I want to jump to something that I'm"
    },
    {
      "Time_Start": 971.68,
      "Time_End": 975.0,
      "Text": " sure most people have not interacted with before,"
    },
    {
      "Time_Start": 975.0,
      "Time_End": 976.04,
      "Text": " at least directly."
    },
    {
      "Time_Start": 976.04,
      "Time_End": 978.48,
      "Text": " And this is the Cloud Authentication Package."
    },
    {
      "Time_Start": 978.48,
      "Time_End": 980.84,
      "Text": " This supports anything cloud-based"
    },
    {
      "Time_Start": 980.84,
      "Time_End": 983.08,
      "Text": " that you can log into from a Windows host,"
    },
    {
      "Time_Start": 983.08,
      "Time_End": 985.8,
      "Text": " including Azure, now called Intra,"
    },
    {
      "Time_Start": 985.8,
      "Time_End": 991.32,
      "Text": " that's name changed recently, ADFS, so your on-prem stuff,"
    },
    {
      "Time_Start": 991.32,
      "Time_End": 994.6,
      "Text": " and personal Microsoft accounts."
    },
    {
      "Time_Start": 994.6,
      "Time_End": 996.8,
      "Text": " You can submit requests to this package"
    },
    {
      "Time_Start": 996.8,
      "Time_End": 999.64,
      "Text": " to, again, do some host enumeration that's"
    },
    {
      "Time_Start": 999.64,
      "Time_End": 1001.3199999999999,
      "Text": " going to happen with every package."
    },
    {
      "Time_Start": 1001.3199999999999,
      "Time_End": 1004.84,
      "Text": " But you can also recover single sign-on cookies"
    },
    {
      "Time_Start": 1004.84,
      "Time_End": 1006.52,
      "Text": " for a logon session."
    },
    {
      "Time_Start": 1006.52,
      "Time_End": 1010.68,
      "Text": " So you know how normal Red Team tools will use some com API"
    },
    {
      "Time_Start": 1010.68,
      "Time_End": 1013.4,
      "Text": " or, let's say, a browser interaction"
    },
    {
      "Time_Start": 1013.4,
      "Time_End": 1015.92,
      "Text": " to grab a user's single sign-on cookies?"
    },
    {
      "Time_Start": 1015.92,
      "Time_End": 1017.0,
      "Text": " You don't have to do that."
    },
    {
      "Time_Start": 1017.0,
      "Time_End": 1019.28,
      "Text": " You can just make a request to this package"
    },
    {
      "Time_Start": 1019.28,
      "Time_End": 1021.28,
      "Text": " and say, give me their single, actually,"
    },
    {
      "Time_Start": 1021.28,
      "Time_End": 1023.36,
      "Text": " create a single sign-on cookie for this user."
    },
    {
      "Time_Start": 1023.36,
      "Time_End": 1024.6,
      "Text": " Give it back to me."
    },
    {
      "Time_Start": 1024.6,
      "Time_End": 1026.32,
      "Text": " And that's something that you can directly"
    },
    {
      "Time_Start": 1026.32,
      "Time_End": 1029.16,
      "Text": " use in your browser, which is fantastic."
    },
    {
      "Time_Start": 1029.16,
      "Time_End": 1032.3600000000001,
      "Text": " There's also some odd behavior with PRT specifically."
    },
    {
      "Time_Start": 1032.3600000000001,
      "Time_End": 1035.0800000000002,
      "Text": " There is a call where you can refresh a PRT,"
    },
    {
      "Time_Start": 1035.0800000000002,
      "Time_End": 1038.4,
      "Text": " just force that host to get a new one."
    },
    {
      "Time_Start": 1038.4,
      "Time_End": 1041.3200000000002,
      "Text": " There's some nomenclature to go over real quick."
    },
    {
      "Time_Start": 1041.3200000000002,
      "Time_End": 1043.8000000000002,
      "Text": " In this code base, Microsoft appears"
    },
    {
      "Time_Start": 1043.8000000000002,
      "Time_End": 1047.44,
      "Text": " to refer to PRTs as a token blob."
    },
    {
      "Time_Start": 1047.44,
      "Time_End": 1051.16,
      "Text": " There's also a request called get token blob,"
    },
    {
      "Time_Start": 1051.16,
      "Time_End": 1054.14,
      "Text": " which I interpret as getting a PRT, which"
    },
    {
      "Time_Start": 1054.14,
      "Time_End": 1055.24,
      "Text": " is kind of interesting."
    },
    {
      "Time_Start": 1055.24,
      "Time_End": 1057.7,
      "Text": " We haven't actually, that's one of the few commands"
    },
    {
      "Time_Start": 1057.74,
      "Time_End": 1061.98,
      "Text": " that we haven't had success getting responses back yet."
    },
    {
      "Time_Start": 1061.98,
      "Time_End": 1064.22,
      "Text": " But if you were to look into one of these commands out"
    },
    {
      "Time_Start": 1064.22,
      "Time_End": 1066.3400000000001,
      "Text": " of all of them, I would recommend the command"
    },
    {
      "Time_Start": 1066.3400000000001,
      "Time_End": 1071.18,
      "Text": " get token blob, which may possibly recover a PRT."
    },
    {
      "Time_Start": 1071.18,
      "Time_End": 1074.54,
      "Text": " Now, Cloud AP itself is modular."
    },
    {
      "Time_Start": 1074.54,
      "Time_End": 1075.94,
      "Text": " It has plugins."
    },
    {
      "Time_Start": 1075.94,
      "Time_End": 1078.5,
      "Text": " It has plugins to deal with."
    },
    {
      "Time_Start": 1078.5,
      "Time_End": 1083.3,
      "Text": " The first plugin is a combo."
    },
    {
      "Time_Start": 1083.3,
      "Time_End": 1087.82,
      "Text": " It facilitates Azure AD as well as on-prem ADFS interaction."
    },
    {
      "Time_Start": 1087.82,
      "Time_End": 1090.26,
      "Text": " And then the other plugin is Microsoft Accounts."
    },
    {
      "Time_Start": 1090.26,
      "Time_End": 1094.86,
      "Text": " And Microsoft may come up with new plugins in the future."
    },
    {
      "Time_Start": 1094.86,
      "Time_End": 1096.46,
      "Text": " The one that we played with the most"
    },
    {
      "Time_Start": 1096.46,
      "Time_End": 1100.1399999999999,
      "Text": " was the Azure AD slash ADFS plugin."
    },
    {
      "Time_Start": 1100.1399999999999,
      "Time_End": 1102.18,
      "Text": " And there's a ton of stuff you can do with this."
    },
    {
      "Time_Start": 1102.18,
      "Time_End": 1104.1399999999999,
      "Text": " You can get all the single sign-on cookies"
    },
    {
      "Time_Start": 1104.1399999999999,
      "Time_End": 1106.26,
      "Text": " you want for a user."
    },
    {
      "Time_Start": 1106.26,
      "Time_End": 1110.34,
      "Text": " If you want to get their ADFS single sign-on cookie,"
    },
    {
      "Time_Start": 1110.34,
      "Time_End": 1113.3,
      "Text": " there's an equivalent command called create enterprise"
    },
    {
      "Time_Start": 1113.3,
      "Time_End": 1114.62,
      "Text": " single sign-on cookie."
    },
    {
      "Time_Start": 1114.62,
      "Time_End": 1118.8999999999999,
      "Text": " The term enterprise in this context is referring to ADFS."
    },
    {
      "Time_Start": 1118.8999999999999,
      "Time_End": 1121.26,
      "Text": " What's neat is you can actually get a single sign-on cookie"
    },
    {
      "Time_Start": 1121.26,
      "Time_End": 1123.58,
      "Text": " for your device as well."
    },
    {
      "Time_Start": 1123.58,
      "Time_End": 1127.3,
      "Text": " So you can, again, get a single sign-on cookie for your device"
    },
    {
      "Time_Start": 1127.3,
      "Time_End": 1130.1399999999999,
      "Text": " and authenticate with intra."
    },
    {
      "Time_Start": 1130.1399999999999,
      "Time_End": 1133.74,
      "Text": " Now, these are all cookies that you would get this cookie"
    },
    {
      "Time_Start": 1133.74,
      "Time_End": 1137.54,
      "Text": " and you would pass it to another tool like road token"
    },
    {
      "Time_Start": 1137.54,
      "Time_End": 1141.94,
      "Text": " to interact with MsGraph or other Azure resources"
    },
    {
      "Time_Start": 1141.94,
      "Time_End": 1145.6599999999999,
      "Text": " to do enumeration or some abuse."
    },
    {
      "Time_Start": 1145.6599999999999,
      "Time_End": 1148.06,
      "Text": " Caveat, I am not an OAuth person,"
    },
    {
      "Time_Start": 1148.06,
      "Time_End": 1151.58,
      "Text": " so all of the Azure abuses I'm not too familiar with."
    },
    {
      "Time_Start": 1151.58,
      "Time_End": 1154.46,
      "Text": " I just help facilitate getting the initial credentials"
    },
    {
      "Time_Start": 1154.46,
      "Time_End": 1157.8999999999999,
      "Text": " for other people to abuse."
    },
    {
      "Time_Start": 1157.8999999999999,
      "Time_End": 1159.94,
      "Text": " There's plenty of other really interesting things"
    },
    {
      "Time_Start": 1159.94,
      "Time_End": 1161.78,
      "Text": " you can do with this plugin, but we're"
    },
    {
      "Time_Start": 1161.78,
      "Time_End": 1164.34,
      "Text": " going to talk about them on a future works"
    },
    {
      "Time_Start": 1164.34,
      "Time_End": 1168.22,
      "Text": " slide towards the end."
    },
    {
      "Time_Start": 1168.22,
      "Time_End": 1171.02,
      "Text": " The last authentication package that"
    },
    {
      "Time_Start": 1171.02,
      "Time_End": 1172.78,
      "Text": " ended up being very valuable to us"
    },
    {
      "Time_Start": 1172.78,
      "Time_End": 1176.9399999999998,
      "Text": " was the Microsoft Authentication Package."
    },
    {
      "Time_Start": 1176.9399999999998,
      "Time_End": 1179.3799999999999,
      "Text": " The short name for this is MSV1.0,"
    },
    {
      "Time_Start": 1179.3799999999999,
      "Time_End": 1181.78,
      "Text": " which you may have heard of that acronym."
    },
    {
      "Time_Start": 1181.78,
      "Time_End": 1185.1399999999999,
      "Text": " But this facilitates local logons."
    },
    {
      "Time_Start": 1185.1399999999999,
      "Time_End": 1187.1,
      "Text": " Again, you can do host-based enumeration,"
    },
    {
      "Time_Start": 1187.1,
      "Time_End": 1190.5,
      "Text": " so you can directly request information"
    },
    {
      "Time_Start": 1190.5,
      "Time_End": 1194.1799999999998,
      "Text": " about users that are logged on from this package."
    },
    {
      "Time_Start": 1194.18,
      "Time_End": 1196.54,
      "Text": " But the neat thing is you can recover a lot"
    },
    {
      "Time_Start": 1196.54,
      "Time_End": 1198.38,
      "Text": " of creds with this package."
    },
    {
      "Time_Start": 1198.38,
      "Time_End": 1202.0600000000002,
      "Text": " If a user is logged on with MSV1, which any of their data"
    },
    {
      "Time_Start": 1202.0600000000002,
      "Time_End": 1206.1000000000001,
      "Text": " is cached with MSV1, one of those is going to be likely,"
    },
    {
      "Time_Start": 1206.1000000000001,
      "Time_End": 1211.8600000000001,
      "Text": " you can recover some DPAPI keys for the user."
    },
    {
      "Time_Start": 1211.8600000000001,
      "Time_End": 1213.46,
      "Text": " The specific keys that you can recover,"
    },
    {
      "Time_Start": 1213.46,
      "Time_End": 1215.7,
      "Text": " I'll talk about it in a moment."
    },
    {
      "Time_Start": 1215.7,
      "Time_End": 1219.3400000000001,
      "Text": " You can also generate an ntlmv1 for that user."
    },
    {
      "Time_Start": 1219.3400000000001,
      "Time_End": 1223.46,
      "Text": " This is pretty cool because you can disable ntlmv1 on the host"
    },
    {
      "Time_Start": 1223.46,
      "Time_End": 1227.06,
      "Text": " and you can still create a ntlmv1 response."
    },
    {
      "Time_Start": 1227.06,
      "Time_End": 1229.38,
      "Text": " It doesn't matter what mitigation you enable."
    },
    {
      "Time_Start": 1229.38,
      "Time_End": 1231.06,
      "Text": " So that's fun."
    },
    {
      "Time_Start": 1231.06,
      "Time_End": 1233.14,
      "Text": " I'm confident that you can also enable"
    },
    {
      "Time_Start": 1233.14,
      "Time_End": 1236.46,
      "Text": " and you can generate an ntlmv2 response for the user."
    },
    {
      "Time_Start": 1236.46,
      "Time_End": 1238.1000000000001,
      "Text": " But honestly, it doesn't really matter"
    },
    {
      "Time_Start": 1238.1000000000001,
      "Time_End": 1241.22,
      "Text": " if you can get a ntlmv1 response."
    },
    {
      "Time_Start": 1241.22,
      "Time_End": 1244.18,
      "Text": " If you watched Alad's talk, you know"
    },
    {
      "Time_Start": 1244.18,
      "Time_End": 1247.82,
      "Text": " that if you get an ntlmv1 response,"
    },
    {
      "Time_Start": 1247.82,
      "Time_End": 1253.9399999999998,
      "Text": " you can go to crack.sh and just get a ntowf hash, which"
    },
    {
      "Time_Start": 1253.9399999999998,
      "Time_End": 1254.58,
      "Text": " is neat."
    },
    {
      "Time_Start": 1254.58,
      "Time_End": 1259.06,
      "Text": " Crack.sh also, when it's actually functioning again,"
    },
    {
      "Time_Start": 1259.06,
      "Time_End": 1264.3,
      "Text": " it has this free option where if you get an ntlmv1 response"
    },
    {
      "Time_Start": 1264.3,
      "Time_End": 1268.78,
      "Text": " with a certain server challenge, specifically 1.1.2.2.3.3"
    },
    {
      "Time_Start": 1268.78,
      "Time_End": 1272.1799999999998,
      "Text": " along those lines, it'll crack it for you for free."
    },
    {
      "Time_Start": 1272.1799999999998,
      "Time_End": 1273.98,
      "Text": " The fun part with the request that you"
    },
    {
      "Time_Start": 1273.98,
      "Time_End": 1278.46,
      "Text": " make to this package to generate this ntlmv1 response"
    },
    {
      "Time_Start": 1278.46,
      "Time_End": 1281.1,
      "Text": " is you specify the server challenge."
    },
    {
      "Time_Start": 1281.1,
      "Time_End": 1284.38,
      "Text": " So you can specify, hey, give me a response with this server"
    },
    {
      "Time_Start": 1284.38,
      "Time_End": 1287.22,
      "Text": " challenge, the 1.1.2.2.3.3, whatever."
    },
    {
      "Time_Start": 1287.22,
      "Time_End": 1289.06,
      "Text": " With all mitigations enabled, you'll get it."
    },
    {
      "Time_Start": 1289.06,
      "Time_End": 1292.98,
      "Text": " You can go directly to crack.sh when it's functioning again"
    },
    {
      "Time_Start": 1292.98,
      "Time_End": 1297.78,
      "Text": " and just immediately get ntowf hash for a pass to hash."
    },
    {
      "Time_Start": 1297.78,
      "Time_End": 1299.54,
      "Text": " Cool."
    },
    {
      "Time_Start": 1299.54,
      "Time_End": 1304.94,
      "Text": " So I mentioned that we can get dppi keys."
    },
    {
      "Time_Start": 1304.94,
      "Time_End": 1307.78,
      "Text": " We do need a brief talk together, though,"
    },
    {
      "Time_Start": 1307.78,
      "Time_End": 1309.6599999999999,
      "Text": " about these dppi keys."
    },
    {
      "Time_Start": 1309.6599999999999,
      "Time_End": 1311.42,
      "Text": " We got them, and then we realized"
    },
    {
      "Time_Start": 1311.42,
      "Time_End": 1313.1,
      "Text": " we don't know how to use these keys."
    },
    {
      "Time_Start": 1313.1,
      "Time_End": 1315.26,
      "Text": " And the reason why is the nomenclature in our field"
    },
    {
      "Time_Start": 1315.26,
      "Time_End": 1319.98,
      "Text": " for dppi key abuse has all been these."
    },
    {
      "Time_Start": 1319.98,
      "Time_End": 1322.42,
      "Text": " We've all come up with our own terms"
    },
    {
      "Time_Start": 1322.42,
      "Time_End": 1324.54,
      "Text": " for different parts of the key derivation"
    },
    {
      "Time_Start": 1324.54,
      "Time_End": 1327.3799999999999,
      "Text": " process for decrypting a master key file,"
    },
    {
      "Time_Start": 1327.3799999999999,
      "Time_End": 1329.1,
      "Text": " and they're not Microsoft terms."
    },
    {
      "Time_Start": 1329.18,
      "Time_End": 1331.8200000000002,
      "Text": " So when we recovered these keys, which"
    },
    {
      "Time_Start": 1331.8200000000002,
      "Time_End": 1334.3400000000001,
      "Text": " have these names from it that we reverse engineered"
    },
    {
      "Time_Start": 1334.3400000000001,
      "Time_End": 1336.66,
      "Text": " and tried to match it up to public literature,"
    },
    {
      "Time_Start": 1336.66,
      "Time_End": 1338.38,
      "Text": " we were very confused."
    },
    {
      "Time_Start": 1338.38,
      "Time_End": 1340.14,
      "Text": " We didn't know how to use them."
    },
    {
      "Time_Start": 1340.14,
      "Time_End": 1342.38,
      "Text": " We eventually figured out how to use them."
    },
    {
      "Time_Start": 1342.38,
      "Time_End": 1347.2600000000002,
      "Text": " But it's worth talking about this nomenclature together."
    },
    {
      "Time_Start": 1347.2600000000002,
      "Time_End": 1350.22,
      "Text": " Specifically, we're going to go over how keys are derived"
    },
    {
      "Time_Start": 1350.22,
      "Time_End": 1355.2600000000002,
      "Text": " to decrypt a dppi master key using the actual terms"
    },
    {
      "Time_Start": 1355.2600000000002,
      "Time_End": 1357.7,
      "Text": " that Microsoft used themselves, which we know from reverse"
    },
    {
      "Time_Start": 1357.74,
      "Time_End": 1359.78,
      "Text": " engineering DLLs."
    },
    {
      "Time_Start": 1359.78,
      "Time_End": 1362.46,
      "Text": " And then together, we'll show which of these keys"
    },
    {
      "Time_Start": 1362.46,
      "Time_End": 1366.3,
      "Text": " we can recover from MSV1 directly."
    },
    {
      "Time_Start": 1366.3,
      "Time_End": 1368.42,
      "Text": " So first, with this derivation process,"
    },
    {
      "Time_Start": 1368.42,
      "Time_End": 1369.98,
      "Text": " you start with a password."
    },
    {
      "Time_Start": 1369.98,
      "Time_End": 1372.46,
      "Text": " Now, we don't want to store that password in LSAS memory."
    },
    {
      "Time_Start": 1372.46,
      "Time_End": 1374.74,
      "Text": " So the first thing that we'll do is"
    },
    {
      "Time_Start": 1374.74,
      "Time_End": 1378.46,
      "Text": " we'll hash that password with a one-way function hash."
    },
    {
      "Time_Start": 1378.46,
      "Time_End": 1380.8600000000001,
      "Text": " Back in NT5 from leaked source code,"
    },
    {
      "Time_Start": 1380.8600000000001,
      "Time_End": 1382.68,
      "Text": " we know that Microsoft didn't have"
    },
    {
      "Time_Start": 1382.68,
      "Time_End": 1384.54,
      "Text": " a proper name for this output."
    },
    {
      "Time_Start": 1384.54,
      "Time_End": 1388.1,
      "Text": " They just commonly referred to it as an OWF hash"
    },
    {
      "Time_Start": 1388.1,
      "Time_End": 1389.78,
      "Text": " or an OWF password."
    },
    {
      "Time_Start": 1389.78,
      "Time_End": 1392.82,
      "Text": " They didn't really have a good name for it yet."
    },
    {
      "Time_Start": 1392.82,
      "Time_End": 1395.26,
      "Text": " But that password, we can't use it directly"
    },
    {
      "Time_Start": 1395.26,
      "Time_End": 1397.98,
      "Text": " because two different users could"
    },
    {
      "Time_Start": 1397.98,
      "Time_End": 1400.06,
      "Text": " be sharing the same password."
    },
    {
      "Time_Start": 1400.06,
      "Time_End": 1406.62,
      "Text": " So you won't want user A to be able to decrypt the master key"
    },
    {
      "Time_Start": 1406.62,
      "Time_End": 1409.94,
      "Text": " file of user B. You need to solve this some way."
    },
    {
      "Time_Start": 1409.94,
      "Time_End": 1411.62,
      "Text": " The way that Microsoft came up with"
    },
    {
      "Time_Start": 1411.6200000000001,
      "Time_End": 1415.5000000000002,
      "Text": " is they will add, from that first output, the user"
    },
    {
      "Time_Start": 1415.5000000000002,
      "Time_End": 1418.5800000000002,
      "Text": " SID to a SHA-1 HMAC."
    },
    {
      "Time_Start": 1418.5800000000002,
      "Time_End": 1421.38,
      "Text": " And that output, we have an actual name for this."
    },
    {
      "Time_Start": 1421.38,
      "Time_End": 1423.98,
      "Text": " That output is the master key encryption key."
    },
    {
      "Time_Start": 1423.98,
      "Time_End": 1427.3400000000001,
      "Text": " This is the Microsoft term for this part of the key derivation"
    },
    {
      "Time_Start": 1427.3400000000001,
      "Time_End": 1428.94,
      "Text": " process."
    },
    {
      "Time_Start": 1428.94,
      "Time_End": 1433.14,
      "Text": " Now, when you actually want to go decrypt the master key file,"
    },
    {
      "Time_Start": 1433.14,
      "Time_End": 1435.42,
      "Text": " you have to take this key, usually"
    },
    {
      "Time_Start": 1435.42,
      "Time_End": 1437.1000000000001,
      "Text": " the starting key in crypto, and then"
    },
    {
      "Time_Start": 1437.1000000000001,
      "Time_End": 1440.14,
      "Text": " turn it to some derived key to actually do your decryption"
    },
    {
      "Time_Start": 1440.14,
      "Time_End": 1440.8200000000002,
      "Text": " process."
    },
    {
      "Time_Start": 1440.82,
      "Time_End": 1442.58,
      "Text": " That's the same thing that happens here."
    },
    {
      "Time_Start": 1442.58,
      "Time_End": 1446.1399999999999,
      "Text": " Microsoft does one last phase to this."
    },
    {
      "Time_Start": 1446.1399999999999,
      "Time_End": 1449.54,
      "Text": " And the output is called, by Microsoft, the symmetric key."
    },
    {
      "Time_Start": 1449.54,
      "Time_End": 1454.22,
      "Text": " I know it's a generic name, but that is the name they use."
    },
    {
      "Time_Start": 1454.22,
      "Time_End": 1456.62,
      "Text": " But the symmetric key is what can decrypt"
    },
    {
      "Time_Start": 1456.62,
      "Time_End": 1458.98,
      "Text": " the DPAPI master key file."
    },
    {
      "Time_Start": 1458.98,
      "Time_End": 1461.3,
      "Text": " Now that you know this key derivation process,"
    },
    {
      "Time_Start": 1461.3,
      "Time_End": 1462.1399999999999,
      "Text": " here's the fun part."
    },
    {
      "Time_Start": 1462.1399999999999,
      "Time_End": 1464.8999999999999,
      "Text": " We'll show you all the different parts of this flow"
    },
    {
      "Time_Start": 1464.8999999999999,
      "Time_End": 1467.58,
      "Text": " that you can recover from MSV1."
    },
    {
      "Time_Start": 1467.58,
      "Time_End": 1470.3799999999999,
      "Text": " The first one that you can get close to recovering"
    },
    {
      "Time_Start": 1470.44,
      "Time_End": 1472.14,
      "Text": " is the master key encryption key."
    },
    {
      "Time_Start": 1472.14,
      "Time_End": 1475.3400000000001,
      "Text": " There's this request to MSV1 called derive credential"
    },
    {
      "Time_Start": 1475.3400000000001,
      "Time_End": 1478.6200000000001,
      "Text": " that you should be able to call."
    },
    {
      "Time_Start": 1478.6200000000001,
      "Time_End": 1482.5800000000002,
      "Text": " But unfortunately, to make a proper request to this call,"
    },
    {
      "Time_Start": 1482.5800000000002,
      "Time_End": 1485.3000000000002,
      "Text": " you have to supply valid pointers"
    },
    {
      "Time_Start": 1485.3000000000002,
      "Time_End": 1488.1000000000001,
      "Text": " to LSAS memory, which is out of the scope of the project."
    },
    {
      "Time_Start": 1488.1000000000001,
      "Time_End": 1491.66,
      "Text": " Because if you're able to create valid pointers in LSAS memory,"
    },
    {
      "Time_Start": 1491.66,
      "Time_End": 1493.0200000000002,
      "Text": " you can just use Mimikatz."
    },
    {
      "Time_Start": 1493.0200000000002,
      "Time_End": 1494.7800000000002,
      "Text": " So that's out of scope."
    },
    {
      "Time_Start": 1494.7800000000002,
      "Time_End": 1497.74,
      "Text": " Luckily, though, in NT 6.2, Microsoft"
    },
    {
      "Time_Start": 1497.74,
      "Time_End": 1502.6200000000001,
      "Text": " came out with a new function called getCredentialKey."
    },
    {
      "Time_Start": 1502.6200000000001,
      "Time_End": 1507.26,
      "Text": " They also formalized the name of the OWF hash output."
    },
    {
      "Time_Start": 1507.26,
      "Time_End": 1511.74,
      "Text": " It's now officially called, just from reverse engineering DLLs,"
    },
    {
      "Time_Start": 1511.74,
      "Time_End": 1513.7,
      "Text": " the credential key."
    },
    {
      "Time_Start": 1513.7,
      "Time_End": 1517.06,
      "Text": " So if you ever hear, if you run across the name credential key,"
    },
    {
      "Time_Start": 1517.06,
      "Time_End": 1519.82,
      "Text": " this is the part in the process that we're referring to."
    },
    {
      "Time_Start": 1519.82,
      "Time_End": 1525.26,
      "Text": " Now, the getCredentialKey, as it sounds, will give you that key."
    },
    {
      "Time_Start": 1525.26,
      "Time_End": 1526.78,
      "Text": " It actually gives you two keys."
    },
    {
      "Time_Start": 1526.78,
      "Time_End": 1528.78,
      "Text": " It gives you two hash outputs."
    },
    {
      "Time_Start": 1528.78,
      "Time_End": 1531.02,
      "Text": " One you can use if the associated user"
    },
    {
      "Time_Start": 1531.02,
      "Time_End": 1532.78,
      "Text": " account is a local account."
    },
    {
      "Time_Start": 1532.78,
      "Time_End": 1536.22,
      "Text": " One that you can use if it's a remote, sorry, a domain account."
    },
    {
      "Time_Start": 1536.22,
      "Time_End": 1537.6399999999999,
      "Text": " But at least one of those hashes you"
    },
    {
      "Time_Start": 1537.6399999999999,
      "Time_End": 1543.62,
      "Text": " can use to decrypt that user's DPPI master key file."
    },
    {
      "Time_Start": 1543.62,
      "Time_End": 1545.5,
      "Text": " Now, if you didn't want to figure out"
    },
    {
      "Time_Start": 1545.5,
      "Time_End": 1550.42,
      "Text": " which of those two hashes that you need to use, in NT 6.4,"
    },
    {
      "Time_Start": 1550.42,
      "Time_End": 1554.62,
      "Text": " Microsoft added a new call, getStrongCredentialKey."
    },
    {
      "Time_Start": 1554.62,
      "Time_End": 1555.8999999999999,
      "Text": " It does the exact same thing."
    },
    {
      "Time_Start": 1555.9,
      "Time_End": 1559.0600000000002,
      "Text": " It gives you a credential key, but it only returns one hash."
    },
    {
      "Time_Start": 1559.0600000000002,
      "Time_End": 1561.42,
      "Text": " And that one hash is going to be the hash that you"
    },
    {
      "Time_Start": 1561.42,
      "Time_End": 1563.26,
      "Text": " can use for that user account."
    },
    {
      "Time_Start": 1563.26,
      "Time_End": 1564.5400000000002,
      "Text": " So there's no more guesswork."
    },
    {
      "Time_Start": 1564.5400000000002,
      "Time_End": 1566.5800000000002,
      "Text": " You call that command instead, you get a hash,"
    },
    {
      "Time_Start": 1566.5800000000002,
      "Time_End": 1569.46,
      "Text": " and you decrypt that user's DPPI master key file."
    },
    {
      "Time_Start": 1569.46,
      "Time_End": 1570.22,
      "Text": " Fantastic."
    },
    {
      "Time_Start": 1573.3600000000001,
      "Time_End": 1575.98,
      "Text": " Now, something that gets a little confusing"
    },
    {
      "Time_Start": 1575.98,
      "Time_End": 1579.22,
      "Text": " is they came up with this new OWF hash called"
    },
    {
      "Time_Start": 1579.22,
      "Time_End": 1580.98,
      "Text": " this cureCredCache."
    },
    {
      "Time_Start": 1580.98,
      "Time_End": 1583.8600000000001,
      "Text": " This is something that, for newer Windows computers that"
    },
    {
      "Time_Start": 1583.8600000000001,
      "Time_End": 1585.8200000000002,
      "Text": " are domain joined, they're going to use this hash"
    },
    {
      "Time_Start": 1585.82,
      "Time_End": 1588.58,
      "Text": " instead of the old SHA-1 hash."
    },
    {
      "Time_Start": 1591.6599999999999,
      "Time_End": 1594.1799999999998,
      "Text": " It's worth just mentioning that because sometimes it"
    },
    {
      "Time_Start": 1594.1799999999998,
      "Time_End": 1597.54,
      "Text": " gets confusing between the phrase secureCredHash"
    },
    {
      "Time_Start": 1597.54,
      "Time_End": 1599.22,
      "Text": " and the phrase getStrongCredentialKey."
    },
    {
      "Time_Start": 1599.22,
      "Time_End": 1602.1799999999998,
      "Text": " But anyway, the last thing that's worth mentioning"
    },
    {
      "Time_Start": 1602.1799999999998,
      "Time_End": 1606.6599999999999,
      "Text": " is an update for NT 10 2004."
    },
    {
      "Time_Start": 1606.6599999999999,
      "Time_End": 1608.5,
      "Text": " Credential Guard was added."
    },
    {
      "Time_Start": 1608.5,
      "Time_End": 1611.1399999999999,
      "Text": " When Credential Guard was added, Microsoft"
    },
    {
      "Time_Start": 1611.1399999999999,
      "Time_End": 1615.02,
      "Text": " added explicit checks to two commands."
    },
    {
      "Time_Start": 1615.02,
      "Time_End": 1618.18,
      "Text": " They're the two commands that are crossed out."
    },
    {
      "Time_Start": 1618.18,
      "Time_End": 1621.1,
      "Text": " Those two commands now check, is Credential Guard enabled?"
    },
    {
      "Time_Start": 1621.1,
      "Time_End": 1623.7,
      "Text": " If so, access denied."
    },
    {
      "Time_Start": 1623.7,
      "Time_End": 1625.5,
      "Text": " For us, that doesn't really matter"
    },
    {
      "Time_Start": 1625.5,
      "Time_End": 1627.1,
      "Text": " because one of those commands, we"
    },
    {
      "Time_Start": 1627.1,
      "Time_End": 1628.86,
      "Text": " can't call anyway effectively."
    },
    {
      "Time_Start": 1628.86,
      "Time_End": 1631.58,
      "Text": " And the other command gives us two hashes,"
    },
    {
      "Time_Start": 1631.58,
      "Time_End": 1633.66,
      "Text": " but we can still get the appropriate hash"
    },
    {
      "Time_Start": 1633.66,
      "Time_End": 1637.12,
      "Text": " from the equivalent getStrongCredentialKey request."
    },
    {
      "Time_Start": 1637.12,
      "Time_End": 1640.26,
      "Text": " So again, Credential Guard will remove access"
    },
    {
      "Time_Start": 1640.26,
      "Time_End": 1641.1399999999999,
      "Text": " to some functions."
    },
    {
      "Time_Start": 1641.18,
      "Time_End": 1643.9,
      "Text": " But as Red Team operators, it doesn't really affect us."
    },
    {
      "Time_Start": 1646.7800000000002,
      "Time_End": 1650.0200000000002,
      "Text": " Now we're going to go through a few other authentication"
    },
    {
      "Time_Start": 1650.0200000000002,
      "Time_End": 1652.6200000000001,
      "Text": " packages that do ship with Windows currently."
    },
    {
      "Time_Start": 1652.6200000000001,
      "Time_End": 1656.98,
      "Text": " We found them to not particularly be as useful,"
    },
    {
      "Time_Start": 1656.98,
      "Time_End": 1658.22,
      "Text": " but they made to you."
    },
    {
      "Time_Start": 1658.22,
      "Time_End": 1661.46,
      "Text": " So they're worth going over very briefly."
    },
    {
      "Time_Start": 1661.46,
      "Time_End": 1664.38,
      "Text": " The first is PublicKeyUserToUser."
    },
    {
      "Time_Start": 1664.38,
      "Time_End": 1668.3000000000002,
      "Text": " The short name that you'll hear is usually PKU2U."
    },
    {
      "Time_Start": 1668.3,
      "Time_End": 1674.22,
      "Text": " This was first introduced to support this really legacy"
    },
    {
      "Time_Start": 1674.22,
      "Time_End": 1675.82,
      "Text": " piece of software called HomeGroups"
    },
    {
      "Time_Start": 1675.82,
      "Time_End": 1678.54,
      "Text": " that no one uses anymore because it doesn't"
    },
    {
      "Time_Start": 1678.54,
      "Time_End": 1680.22,
      "Text": " ship with Windows anymore."
    },
    {
      "Time_Start": 1680.22,
      "Time_End": 1683.3799999999999,
      "Text": " The way this comes up now is with Azure specifically."
    },
    {
      "Time_Start": 1683.3799999999999,
      "Time_End": 1688.18,
      "Text": " If you have two hosts that are joined to an Azure tenant"
    },
    {
      "Time_Start": 1688.18,
      "Time_End": 1690.78,
      "Text": " and they need to authenticate to each other,"
    },
    {
      "Time_Start": 1690.78,
      "Time_End": 1693.26,
      "Text": " let's say with remote desktop, that"
    },
    {
      "Time_Start": 1693.26,
      "Time_End": 1696.4199999999998,
      "Text": " is facilitated using PKU2U right now."
    },
    {
      "Time_Start": 1696.4199999999998,
      "Time_End": 1697.86,
      "Text": " Microsoft is making some changes,"
    },
    {
      "Time_Start": 1697.9,
      "Time_End": 1699.98,
      "Text": " and this is likely going to go away in a few years."
    },
    {
      "Time_Start": 1699.98,
      "Time_End": 1702.7800000000002,
      "Text": " But right now, PKU2U is what's used."
    },
    {
      "Time_Start": 1702.7800000000002,
      "Time_End": 1705.94,
      "Text": " PKU2U is a reimplementation of Kerberos"
    },
    {
      "Time_Start": 1705.94,
      "Time_End": 1709.18,
      "Text": " with some attributes hardcoded to signify"
    },
    {
      "Time_Start": 1709.18,
      "Time_End": 1711.7,
      "Text": " that PKU2U is the thing being used instead"
    },
    {
      "Time_Start": 1711.7,
      "Time_End": 1715.8600000000001,
      "Text": " of normal full-blown Kerberos."
    },
    {
      "Time_Start": 1715.8600000000001,
      "Time_End": 1717.2600000000002,
      "Text": " The nice thing to know, though, is"
    },
    {
      "Time_Start": 1717.2600000000002,
      "Time_End": 1722.94,
      "Text": " if you do get on a host that's joined to some Azure tenant,"
    },
    {
      "Time_Start": 1722.94,
      "Time_End": 1725.7,
      "Text": " you can request from this package, hey,"
    },
    {
      "Time_Start": 1725.7,
      "Time_End": 1731.38,
      "Text": " what tickets were cached for PKU2U just like with Kerberos?"
    },
    {
      "Time_Start": 1731.38,
      "Time_End": 1733.18,
      "Text": " And if you see some output, if you"
    },
    {
      "Time_Start": 1733.18,
      "Time_End": 1736.3400000000001,
      "Text": " see like some tickets were cached for PKU2U,"
    },
    {
      "Time_Start": 1736.3400000000001,
      "Time_End": 1738.76,
      "Text": " it'll inform you about another host"
    },
    {
      "Time_Start": 1738.76,
      "Time_End": 1741.5800000000002,
      "Text": " that you can authenticate to as that user, which"
    },
    {
      "Time_Start": 1741.5800000000002,
      "Time_End": 1744.8600000000001,
      "Text": " is great user host enumeration type stuff."
    },
    {
      "Time_Start": 1747.5800000000002,
      "Time_End": 1749.5800000000002,
      "Text": " This is a weird one, the negotiate package."
    },
    {
      "Time_Start": 1749.58,
      "Time_End": 1755.62,
      "Text": " The negotiate package is something"
    },
    {
      "Time_Start": 1755.62,
      "Time_End": 1762.74,
      "Text": " that allows Windows to, as the name implies,"
    },
    {
      "Time_Start": 1762.74,
      "Time_End": 1765.3,
      "Text": " negotiate which authentication scheme is going"
    },
    {
      "Time_Start": 1765.3,
      "Time_End": 1767.46,
      "Text": " to be used between two computers."
    },
    {
      "Time_Start": 1767.46,
      "Time_End": 1769.4199999999998,
      "Text": " If you want to authenticate to another computer"
    },
    {
      "Time_Start": 1769.4199999999998,
      "Time_End": 1771.6599999999999,
      "Text": " and you don't want to pick something like Kerberos,"
    },
    {
      "Time_Start": 1771.6599999999999,
      "Time_End": 1775.02,
      "Text": " you can just say, hey, authenticate using negotiate,"
    },
    {
      "Time_Start": 1775.02,
      "Time_End": 1777.3,
      "Text": " and Windows will figure it out."
    },
    {
      "Time_Start": 1777.3,
      "Time_End": 1780.22,
      "Text": " When this first came out, negotiate was hardcoded."
    },
    {
      "Time_Start": 1780.22,
      "Time_End": 1782.06,
      "Text": " It still is, but it was hardcoded"
    },
    {
      "Time_Start": 1782.06,
      "Time_End": 1786.06,
      "Text": " to only attempt Kerberos and NTLM."
    },
    {
      "Time_Start": 1786.06,
      "Time_End": 1787.98,
      "Text": " And that's not really modular."
    },
    {
      "Time_Start": 1787.98,
      "Time_End": 1793.22,
      "Text": " So an NT 6.2, I believe, doesn't really matter."
    },
    {
      "Time_Start": 1793.22,
      "Time_End": 1795.78,
      "Text": " But at some point, Microsoft introduced"
    },
    {
      "Time_Start": 1795.78,
      "Time_End": 1798.4199999999998,
      "Text": " a new hardcoded plugin for negotiate"
    },
    {
      "Time_Start": 1798.4199999999998,
      "Time_End": 1799.98,
      "Text": " called Negotiate Extender."
    },
    {
      "Time_Start": 1799.98,
      "Time_End": 1801.5,
      "Text": " It's the one in the middle."
    },
    {
      "Time_Start": 1801.5,
      "Time_End": 1803.74,
      "Text": " And that's just, we're going to get to it in a moment,"
    },
    {
      "Time_Start": 1803.74,
      "Time_End": 1805.98,
      "Text": " that allows you to add more things that"
    },
    {
      "Time_Start": 1806.02,
      "Time_End": 1810.34,
      "Text": " can be negotiated beyond Kerberos and NTLM."
    },
    {
      "Time_Start": 1810.34,
      "Time_End": 1812.58,
      "Text": " So with this package, since it does"
    },
    {
      "Time_Start": 1812.58,
      "Time_End": 1816.38,
      "Text": " have to store user information for a negotiated logon session,"
    },
    {
      "Time_Start": 1816.38,
      "Time_End": 1819.6200000000001,
      "Text": " it is itself considered an authentication package."
    },
    {
      "Time_Start": 1819.6200000000001,
      "Time_End": 1821.8600000000001,
      "Text": " You can make authentication package requests to it"
    },
    {
      "Time_Start": 1821.8600000000001,
      "Time_End": 1823.02,
      "Text": " as well."
    },
    {
      "Time_Start": 1823.02,
      "Time_End": 1825.3,
      "Text": " The only one that we found mildly interesting"
    },
    {
      "Time_Start": 1825.3,
      "Time_End": 1827.48,
      "Text": " was if there was a negotiated session,"
    },
    {
      "Time_Start": 1827.48,
      "Time_End": 1830.06,
      "Text": " you can get the username for that session."
    },
    {
      "Time_Start": 1830.06,
      "Time_End": 1833.26,
      "Text": " But that's kind of it."
    },
    {
      "Time_Start": 1833.26,
      "Time_End": 1834.46,
      "Text": " This one is more interesting."
    },
    {
      "Time_Start": 1834.46,
      "Time_End": 1836.1000000000001,
      "Text": " It's the Negotiate Extender package."
    },
    {
      "Time_Start": 1836.1000000000001,
      "Time_End": 1837.6200000000001,
      "Text": " It was that one in the middle."
    },
    {
      "Time_Start": 1837.6200000000001,
      "Time_End": 1839.22,
      "Text": " This flowchart is now broken out."
    },
    {
      "Time_Start": 1839.22,
      "Time_End": 1840.66,
      "Text": " It's a little bigger."
    },
    {
      "Time_Start": 1840.66,
      "Time_End": 1842.74,
      "Text": " Remember, Negotiate Extender was added"
    },
    {
      "Time_Start": 1842.74,
      "Time_End": 1846.54,
      "Text": " in to allow this hardcoded Negotiate package to actually"
    },
    {
      "Time_Start": 1846.54,
      "Time_End": 1848.42,
      "Text": " support more plugins."
    },
    {
      "Time_Start": 1848.42,
      "Time_End": 1850.98,
      "Text": " So you can add more Negotiate Extender plugins"
    },
    {
      "Time_Start": 1850.98,
      "Time_End": 1852.3400000000001,
      "Text": " to your file system."
    },
    {
      "Time_Start": 1852.3400000000001,
      "Time_End": 1855.22,
      "Text": " And as long as you update the registry appropriately,"
    },
    {
      "Time_Start": 1855.22,
      "Time_End": 1858.78,
      "Text": " it'll get loaded by LSAS, which is great."
    },
    {
      "Time_Start": 1858.78,
      "Time_End": 1861.46,
      "Text": " So the only two Negotiate Extender plugins"
    },
    {
      "Time_Start": 1861.46,
      "Time_End": 1863.46,
      "Text": " that currently ship with Windows"
    },
    {
      "Time_Start": 1863.46,
      "Time_End": 1868.7,
      "Text": " is Cloud AP, which supports Aureo Cloud Logins, and PKETU."
    },
    {
      "Time_Start": 1868.7,
      "Time_End": 1871.46,
      "Text": " Now, there is one call you can make"
    },
    {
      "Time_Start": 1871.46,
      "Time_End": 1874.14,
      "Text": " to Negotiate Extender that is kind of interesting,"
    },
    {
      "Time_Start": 1874.14,
      "Time_End": 1877.3400000000001,
      "Text": " but we did not have time to look too far into."
    },
    {
      "Time_Start": 1877.3400000000001,
      "Time_End": 1880.14,
      "Text": " There's a call called Get Cred UI Context."
    },
    {
      "Time_Start": 1880.14,
      "Time_End": 1882.74,
      "Text": " And if you look into that, it essentially"
    },
    {
      "Time_Start": 1882.74,
      "Time_End": 1885.58,
      "Text": " is supposed to return some authentication data that"
    },
    {
      "Time_Start": 1885.58,
      "Time_End": 1890.1000000000001,
      "Text": " could be a certification."
    },
    {
      "Time_Start": 1890.1000000000001,
      "Time_End": 1894.8200000000002,
      "Text": " Data could be a certificate, a cryptographic service provider"
    },
    {
      "Time_Start": 1894.8200000000002,
      "Time_End": 1897.3000000000002,
      "Text": " blob of data, or a password."
    },
    {
      "Time_Start": 1897.3000000000002,
      "Time_End": 1899.6200000000001,
      "Text": " So that's kind of interesting that you can potentially"
    },
    {
      "Time_Start": 1899.6200000000001,
      "Time_End": 1900.66,
      "Text": " get some creds from that."
    },
    {
      "Time_Start": 1900.66,
      "Time_End": 1902.96,
      "Text": " But again, caveat, we didn't have time to look into it."
    },
    {
      "Time_Start": 1902.96,
      "Time_End": 1905.38,
      "Text": " It's supposed to return some form of creds,"
    },
    {
      "Time_Start": 1905.38,
      "Time_End": 1909.5400000000002,
      "Text": " but how it gets those creds and can you make use of them,"
    },
    {
      "Time_Start": 1909.5400000000002,
      "Time_End": 1914.3000000000002,
      "Text": " maybe one of you will have the opportunity to look into."
    },
    {
      "Time_Start": 1914.3000000000002,
      "Time_End": 1916.8200000000002,
      "Text": " There's, I believe, two left."
    },
    {
      "Time_Start": 1916.82,
      "Time_End": 1920.54,
      "Text": " The next one is Secure Channel Authentication Package."
    },
    {
      "Time_Start": 1920.54,
      "Time_End": 1924.78,
      "Text": " This supports so many different protocols."
    },
    {
      "Time_Start": 1924.78,
      "Time_End": 1927.62,
      "Text": " Yes, you can make authentication package requests to it"
    },
    {
      "Time_Start": 1927.62,
      "Time_End": 1930.1399999999999,
      "Text": " to query different data about logon sessions"
    },
    {
      "Time_Start": 1930.1399999999999,
      "Time_End": 1932.3999999999999,
      "Text": " that were initiated with this package."
    },
    {
      "Time_Start": 1932.3999999999999,
      "Time_End": 1935.62,
      "Text": " None of them were useful, as far as we know."
    },
    {
      "Time_Start": 1935.62,
      "Time_End": 1937.54,
      "Text": " So you can look into this as well,"
    },
    {
      "Time_Start": 1937.54,
      "Time_End": 1939.58,
      "Text": " but I don't think any of it's useful."
    },
    {
      "Time_Start": 1942.4199999999998,
      "Time_End": 1944.9399999999998,
      "Text": " Oh, next to last one is the Terminal Service Package."
    },
    {
      "Time_Start": 1944.94,
      "Time_End": 1949.5,
      "Text": " Of course, this supports remote desktop application."
    },
    {
      "Time_Start": 1949.5,
      "Time_End": 1951.94,
      "Text": " You know, the remote desktop application."
    },
    {
      "Time_Start": 1951.94,
      "Time_End": 1955.8600000000001,
      "Text": " So if you RDP to another host, your session"
    },
    {
      "Time_Start": 1955.8600000000001,
      "Time_End": 1959.06,
      "Text": " on that remote host is going to be managed by the Terminal"
    },
    {
      "Time_Start": 1959.06,
      "Time_End": 1960.66,
      "Text": " Service Package."
    },
    {
      "Time_Start": 1960.66,
      "Time_End": 1963.1200000000001,
      "Text": " There are lots of calls you can make with this."
    },
    {
      "Time_Start": 1963.1200000000001,
      "Time_End": 1964.66,
      "Text": " I think it's, I have it written down,"
    },
    {
      "Time_Start": 1964.66,
      "Time_End": 1966.5,
      "Text": " I think it's like 23 or something like that."
    },
    {
      "Time_Start": 1966.5,
      "Time_End": 1968.98,
      "Text": " But we did not have time to look into it"
    },
    {
      "Time_Start": 1968.98,
      "Time_End": 1972.5800000000002,
      "Text": " because this takes more marshaling of your data"
    },
    {
      "Time_Start": 1972.5800000000002,
      "Time_End": 1974.66,
      "Text": " to be able to actually submit these requests."
    },
    {
      "Time_Start": 1974.8600000000001,
      "Time_End": 1978.66,
      "Text": " We do intend to implement this in the associated LSA Whisperer"
    },
    {
      "Time_Start": 1978.66,
      "Time_End": 1983.42,
      "Text": " tool, but unfortunately, we have not had time yet to do it."
    },
    {
      "Time_Start": 1983.42,
      "Time_End": 1986.46,
      "Text": " The last one is the WDigest package,"
    },
    {
      "Time_Start": 1986.46,
      "Time_End": 1990.7,
      "Text": " which does not support any authentication package call."
    },
    {
      "Time_Start": 1990.7,
      "Time_End": 1992.74,
      "Text": " So there's nothing for us to do."
    },
    {
      "Time_Start": 1992.74,
      "Time_End": 1994.3000000000002,
      "Text": " Womp."
    },
    {
      "Time_Start": 1994.3000000000002,
      "Time_End": 1994.98,
      "Text": " OK."
    },
    {
      "Time_Start": 1994.98,
      "Time_End": 1997.52,
      "Text": " Let's wrap this thing up."
    },
    {
      "Time_Start": 1997.52,
      "Time_End": 1999.6000000000001,
      "Text": " So if you're watching this and you're a defender,"
    },
    {
      "Time_Start": 1999.6000000000001,
      "Time_End": 2001.66,
      "Text": " you may be wondering, OK, I just learned"
    },
    {
      "Time_Start": 2001.66,
      "Time_End": 2004.5800000000002,
      "Text": " that I can get a ton of creds from LSAS"
    },
    {
      "Time_Start": 2004.5800000000002,
      "Time_End": 2006.78,
      "Text": " without ever touching LSAS memory."
    },
    {
      "Time_Start": 2006.78,
      "Time_End": 2009.26,
      "Text": " Actually, you don't even have to get a handle to LSAS"
    },
    {
      "Time_Start": 2009.26,
      "Time_End": 2010.38,
      "Text": " to do any of this."
    },
    {
      "Time_Start": 2010.38,
      "Time_End": 2012.66,
      "Text": " For a lot of things, you either need to be system"
    },
    {
      "Time_Start": 2012.66,
      "Time_End": 2014.3400000000001,
      "Text": " or you need to impersonate the user"
    },
    {
      "Time_Start": 2014.3400000000001,
      "Time_End": 2017.28,
      "Text": " you want to recover creds off."
    },
    {
      "Time_Start": 2017.28,
      "Time_End": 2020.26,
      "Text": " So again, you don't have to even touch LSAS in any way"
    },
    {
      "Time_Start": 2020.26,
      "Time_End": 2021.5800000000002,
      "Text": " to do any of this."
    },
    {
      "Time_Start": 2021.5800000000002,
      "Time_End": 2024.9,
      "Text": " So you may be wondering, what can I do to prevent this?"
    },
    {
      "Time_Start": 2024.9,
      "Time_End": 2027.5400000000002,
      "Text": " This slide is only covering things"
    },
    {
      "Time_Start": 2027.5400000000002,
      "Time_End": 2030.3400000000001,
      "Text": " that you can do as an administrator"
    },
    {
      "Time_Start": 2030.3400000000001,
      "Time_End": 2033.46,
      "Text": " without buying any vendor product."
    },
    {
      "Time_Start": 2033.46,
      "Time_End": 2036.9,
      "Text": " As an administrator, there is a lot of potential with ETW."
    },
    {
      "Time_Start": 2036.9,
      "Time_End": 2040.8200000000002,
      "Text": " Essentially, there's tons of ETW telemetry"
    },
    {
      "Time_Start": 2040.8200000000002,
      "Time_End": 2042.94,
      "Text": " inside of all Microsoft software,"
    },
    {
      "Time_Start": 2042.94,
      "Time_End": 2046.0200000000002,
      "Text": " including LSAS itself and all these authentication packages."
    },
    {
      "Time_Start": 2046.0200000000002,
      "Time_End": 2049.7000000000003,
      "Text": " But Microsoft, unfortunately, doesn't make public"
    },
    {
      "Time_Start": 2049.7000000000003,
      "Time_End": 2053.9,
      "Text": " all the schemas to actually make use of this data."
    },
    {
      "Time_Start": 2053.9,
      "Time_End": 2057.78,
      "Text": " So we ourselves are doing more research"
    },
    {
      "Time_Start": 2057.78,
      "Time_End": 2060.5400000000004,
      "Text": " into the specific ETW providers and all"
    },
    {
      "Time_Start": 2060.5400000000004,
      "Time_End": 2062.1600000000003,
      "Text": " these different authentication packages."
    },
    {
      "Time_Start": 2062.1600000000003,
      "Time_End": 2063.78,
      "Text": " And hopefully, we'll stumble upon one"
    },
    {
      "Time_Start": 2063.78,
      "Time_End": 2066.34,
      "Text": " that will allow us to monitor anybody trying"
    },
    {
      "Time_Start": 2066.34,
      "Time_End": 2067.82,
      "Text": " to abuse these techniques."
    },
    {
      "Time_Start": 2067.82,
      "Time_End": 2070.7000000000003,
      "Text": " But it just takes a lot of work, reverse engineering"
    },
    {
      "Time_Start": 2070.7000000000003,
      "Time_End": 2074.02,
      "Text": " those provider schemas, because Microsoft, unfortunately,"
    },
    {
      "Time_Start": 2074.02,
      "Time_End": 2076.26,
      "Text": " doesn't make them public."
    },
    {
      "Time_Start": 2076.26,
      "Time_End": 2078.86,
      "Text": " You can, though, prevent some things"
    },
    {
      "Time_Start": 2078.86,
      "Time_End": 2080.94,
      "Text": " by enabling Credential Guard."
    },
    {
      "Time_Start": 2080.94,
      "Time_End": 2085.02,
      "Text": " Effectively, it probably won't prevent much."
    },
    {
      "Time_Start": 2085.06,
      "Time_End": 2088.06,
      "Text": " But there's likely calls that we haven't identified"
    },
    {
      "Time_Start": 2088.06,
      "Time_End": 2091.94,
      "Text": " that Credential Guard will block that we just assume will work"
    },
    {
      "Time_Start": 2091.94,
      "Time_End": 2094.78,
      "Text": " and we just haven't tested effectively,"
    },
    {
      "Time_Start": 2094.78,
      "Time_End": 2096.6,
      "Text": " because there's like 200 different calls"
    },
    {
      "Time_Start": 2096.6,
      "Time_End": 2098.48,
      "Text": " that we had to look at for this."
    },
    {
      "Time_Start": 2098.48,
      "Time_End": 2099.78,
      "Text": " So we probably missed something."
    },
    {
      "Time_Start": 2099.78,
      "Time_End": 2102.42,
      "Text": " But you can still enable Credential Guard"
    },
    {
      "Time_Start": 2102.42,
      "Time_End": 2104.2599999999998,
      "Text": " and block a few calls."
    },
    {
      "Time_Start": 2104.2599999999998,
      "Time_End": 2107.06,
      "Text": " We also looked at RPC filters, which"
    },
    {
      "Time_Start": 2107.06,
      "Time_End": 2111.18,
      "Text": " is a baked-in firewall feature to the Windows Advanced"
    },
    {
      "Time_Start": 2111.18,
      "Time_End": 2113.18,
      "Text": " Firewall."
    },
    {
      "Time_Start": 2113.18,
      "Time_End": 2115.5,
      "Text": " RPC filters we looked at to say, hey,"
    },
    {
      "Time_Start": 2115.5,
      "Time_End": 2120.2599999999998,
      "Text": " this all is facilitated over a RPC interface."
    },
    {
      "Time_Start": 2120.2599999999998,
      "Time_End": 2122.3799999999997,
      "Text": " Can we block access to that?"
    },
    {
      "Time_Start": 2122.3799999999997,
      "Time_End": 2124.94,
      "Text": " Unfortunately, no."
    },
    {
      "Time_Start": 2124.94,
      "Time_End": 2130.02,
      "Text": " RPC filters only work at the RPC interface level."
    },
    {
      "Time_Start": 2130.02,
      "Time_End": 2132.5,
      "Text": " If you block this entire interface,"
    },
    {
      "Time_Start": 2132.5,
      "Time_End": 2134.98,
      "Text": " authentication will not work on your host."
    },
    {
      "Time_Start": 2134.98,
      "Time_End": 2138.46,
      "Text": " You have to allow authentication to this interface."
    },
    {
      "Time_Start": 2138.46,
      "Time_End": 2143.14,
      "Text": " So it's not granular enough of a feature for us to use it."
    },
    {
      "Time_Start": 2143.14,
      "Time_End": 2146.2999999999997,
      "Text": " There's also a really popular tool called the RPC Firewall."
    },
    {
      "Time_Start": 2146.2999999999997,
      "Time_End": 2147.74,
      "Text": " It's a third-party product on Git."
    },
    {
      "Time_Start": 2147.74,
      "Time_End": 2151.9,
      "Text": " Sorry, free piece of software on GitHub that can."
    },
    {
      "Time_Start": 2151.9,
      "Time_End": 2152.98,
      "Text": " It is more granular."
    },
    {
      "Time_Start": 2152.98,
      "Time_End": 2154.2599999999998,
      "Text": " That's fantastic."
    },
    {
      "Time_Start": 2154.2599999999998,
      "Time_End": 2157.18,
      "Text": " But the RPC Firewall has two issues"
    },
    {
      "Time_Start": 2157.18,
      "Time_End": 2159.2999999999997,
      "Text": " for our specific use case."
    },
    {
      "Time_Start": 2159.2999999999997,
      "Time_End": 2163.02,
      "Text": " One is it only blocks traffic from a remote host."
    },
    {
      "Time_Start": 2163.02,
      "Time_End": 2164.44,
      "Text": " And we're doing all this locally,"
    },
    {
      "Time_Start": 2164.44,
      "Time_End": 2166.1,
      "Text": " so it doesn't really affect us."
    },
    {
      "Time_Start": 2166.1,
      "Time_End": 2168.98,
      "Text": " But even if it did, the RPC Firewall"
    },
    {
      "Time_Start": 2168.98,
      "Time_End": 2171.8599999999997,
      "Text": " requires you to disable LSAS running"
    },
    {
      "Time_Start": 2171.86,
      "Time_End": 2173.46,
      "Text": " as a protected process."
    },
    {
      "Time_Start": 2173.46,
      "Time_End": 2176.36,
      "Text": " If you disable that, why not just use Mimikatz?"
    },
    {
      "Time_Start": 2176.36,
      "Time_End": 2181.3,
      "Text": " So it's really not usable for our situation."
    },
    {
      "Time_Start": 2181.3,
      "Time_End": 2185.42,
      "Text": " Now, the real group that can probably provide the most help"
    },
    {
      "Time_Start": 2185.42,
      "Time_End": 2187.42,
      "Text": " here are EDRs."
    },
    {
      "Time_Start": 2187.42,
      "Time_End": 2190.5,
      "Text": " So if you work in an EDR, if you have a friend who does,"
    },
    {
      "Time_Start": 2190.5,
      "Time_End": 2192.06,
      "Text": " these are the specific things that we"
    },
    {
      "Time_Start": 2192.06,
      "Time_End": 2193.54,
      "Text": " would recommend you look for."
    },
    {
      "Time_Start": 2193.54,
      "Time_End": 2196.9,
      "Text": " First, monitor for this Win32 API."
    },
    {
      "Time_Start": 2196.9,
      "Time_End": 2199.02,
      "Text": " You likely are already monitoring"
    },
    {
      "Time_Start": 2199.02,
      "Time_End": 2201.9,
      "Text": " for this in the first place to monitor"
    },
    {
      "Time_Start": 2201.9,
      "Time_End": 2206.38,
      "Text": " for pass-the-ticket abuses or dumping Kerberos tickets."
    },
    {
      "Time_Start": 2206.38,
      "Time_End": 2209.78,
      "Text": " You should know, though, that this one Win32 API"
    },
    {
      "Time_Start": 2209.78,
      "Time_End": 2212.34,
      "Text": " can do a lot more."
    },
    {
      "Time_Start": 2212.34,
      "Time_End": 2213.86,
      "Text": " I would also recommend monitoring"
    },
    {
      "Time_Start": 2213.86,
      "Time_End": 2216.54,
      "Text": " for interaction with a specific ALPC port"
    },
    {
      "Time_Start": 2216.54,
      "Time_End": 2220.38,
      "Text": " called the LSASP IRPC port."
    },
    {
      "Time_Start": 2220.38,
      "Time_End": 2222.42,
      "Text": " This is the endpoint that is intended"
    },
    {
      "Time_Start": 2222.42,
      "Time_End": 2227.58,
      "Text": " to be used for all of these authentication requests."
    },
    {
      "Time_Start": 2227.62,
      "Time_End": 2232.34,
      "Text": " So if someone is using, again, this Win32 API,"
    },
    {
      "Time_Start": 2232.34,
      "Time_End": 2234.74,
      "Text": " you can also monitor this ALPC port."
    },
    {
      "Time_Start": 2234.74,
      "Time_End": 2237.2599999999998,
      "Text": " There's a few sneaky ways you can do this."
    },
    {
      "Time_Start": 2237.2599999999998,
      "Time_End": 2239.2599999999998,
      "Text": " One that I call out on the slides"
    },
    {
      "Time_Start": 2239.2599999999998,
      "Time_End": 2243.14,
      "Text": " is a patent from INSQ and CrowdStrike,"
    },
    {
      "Time_Start": 2243.14,
      "Time_End": 2248.34,
      "Text": " where they basically machine in the middle an ALPC port."
    },
    {
      "Time_Start": 2248.34,
      "Time_End": 2251.22,
      "Text": " Their EDR, they at least have a patent for doing that,"
    },
    {
      "Time_Start": 2251.22,
      "Time_End": 2253.42,
      "Text": " so I assume their EDR does."
    },
    {
      "Time_Start": 2253.42,
      "Time_End": 2255.7,
      "Text": " If you work at a competing EDR, you"
    },
    {
      "Time_Start": 2255.7400000000002,
      "Time_End": 2257.78,
      "Text": " shouldn't use something that's patented,"
    },
    {
      "Time_Start": 2257.78,
      "Time_End": 2261.2200000000003,
      "Text": " but you can likely find other sneaky solutions"
    },
    {
      "Time_Start": 2261.2200000000003,
      "Time_End": 2263.3,
      "Text": " to monitor for this."
    },
    {
      "Time_Start": 2263.3,
      "Time_End": 2266.0200000000004,
      "Text": " Now, there's one cool idea for prevention,"
    },
    {
      "Time_Start": 2266.0200000000004,
      "Time_End": 2268.2200000000003,
      "Text": " which is if you're a red team operator,"
    },
    {
      "Time_Start": 2268.2200000000003,
      "Time_End": 2271.9,
      "Text": " you probably know you don't have to use a specific endpoint"
    },
    {
      "Time_Start": 2271.9,
      "Time_End": 2276.1800000000003,
      "Text": " for a process to interact with a specific RPC interface."
    },
    {
      "Time_Start": 2276.1800000000003,
      "Time_End": 2280.1000000000004,
      "Text": " You can interact with any endpoint hosted by that process"
    },
    {
      "Time_Start": 2280.1000000000004,
      "Time_End": 2283.1400000000003,
      "Text": " to interact with any interface inside that process."
    },
    {
      "Time_Start": 2283.1400000000003,
      "Time_End": 2284.9800000000005,
      "Text": " So maybe you just pick a different endpoint."
    },
    {
      "Time_Start": 2284.98,
      "Time_End": 2287.1,
      "Text": " If you see that as an EDR, you should block that."
    },
    {
      "Time_Start": 2287.1,
      "Time_End": 2294.3,
      "Text": " That's going to be malicious behavior 100%."
    },
    {
      "Time_Start": 2294.3,
      "Time_End": 2297.58,
      "Text": " So we've got about, I think, 10 minutes left."
    },
    {
      "Time_Start": 2297.58,
      "Time_End": 2300.38,
      "Text": " We've got a few slides left, so I'll try to be quick."
    },
    {
      "Time_Start": 2300.38,
      "Time_End": 2302.9,
      "Text": " I thought it'd be fun to talk about dead ends and future"
    },
    {
      "Time_Start": 2302.9,
      "Time_End": 2303.42,
      "Text": " work."
    },
    {
      "Time_Start": 2303.42,
      "Time_End": 2306.58,
      "Text": " So the first dead end is things that we wanted."
    },
    {
      "Time_Start": 2306.58,
      "Time_End": 2309.26,
      "Text": " We thought this would be so cool if this would work out,"
    },
    {
      "Time_Start": 2309.26,
      "Time_End": 2310.34,
      "Text": " and it did not."
    },
    {
      "Time_Start": 2310.34,
      "Time_End": 2313.22,
      "Text": " The first was, it would be so cool if we can dump Kerberos"
    },
    {
      "Time_Start": 2313.22,
      "Time_End": 2314.3,
      "Text": " tickets remotely."
    },
    {
      "Time_Start": 2314.3,
      "Time_End": 2315.26,
      "Text": " Why can't we do that?"
    },
    {
      "Time_Start": 2315.26,
      "Time_End": 2318.02,
      "Text": " Because this is an RPC interface that we're interacting with."
    },
    {
      "Time_Start": 2318.02,
      "Time_End": 2321.42,
      "Text": " Why can't we interact with that RPC server from another host?"
    },
    {
      "Time_Start": 2321.42,
      "Time_End": 2322.4,
      "Text": " Cool, right?"
    },
    {
      "Time_Start": 2322.4,
      "Time_End": 2324.5,
      "Text": " Well, unfortunately, this RPC interface"
    },
    {
      "Time_Start": 2324.5,
      "Time_End": 2326.6200000000003,
      "Text": " is registered with a specific flag."
    },
    {
      "Time_Start": 2326.6200000000003,
      "Time_End": 2329.9,
      "Text": " With RPC runtime, it says, only allow local clients."
    },
    {
      "Time_Start": 2329.9,
      "Time_End": 2333.48,
      "Text": " So the RPC runtime for that LSAS process"
    },
    {
      "Time_Start": 2333.48,
      "Time_End": 2337.6200000000003,
      "Text": " will block remote clients, unfortunately."
    },
    {
      "Time_Start": 2337.6200000000003,
      "Time_End": 2341.28,
      "Text": " There's a few requests for a few packages"
    },
    {
      "Time_Start": 2341.28,
      "Time_End": 2343.94,
      "Text": " that we thought would be very valuable"
    },
    {
      "Time_Start": 2343.94,
      "Time_End": 2346.14,
      "Text": " that we could not make."
    },
    {
      "Time_Start": 2346.14,
      "Time_End": 2349.58,
      "Text": " We call this, quote unquote, LSA-only calls,"
    },
    {
      "Time_Start": 2349.58,
      "Time_End": 2351.58,
      "Text": " and we couldn't make them for different reasons."
    },
    {
      "Time_Start": 2351.58,
      "Time_End": 2355.3,
      "Text": " One reason is some of the requests,"
    },
    {
      "Time_Start": 2355.3,
      "Time_End": 2359.2200000000003,
      "Text": " the actual procedure that implements that request"
    },
    {
      "Time_Start": 2359.2200000000003,
      "Time_End": 2362.14,
      "Text": " will check, are you the LSAS process?"
    },
    {
      "Time_Start": 2362.14,
      "Time_End": 2366.58,
      "Text": " And if you are not the LSAS process, block that request."
    },
    {
      "Time_Start": 2366.58,
      "Time_End": 2369.7400000000002,
      "Text": " One example of this is the cache logon request."
    },
    {
      "Time_Start": 2369.7400000000002,
      "Time_End": 2371.38,
      "Text": " We thought it'd be fun to abuse this,"
    },
    {
      "Time_Start": 2371.38,
      "Time_End": 2374.42,
      "Text": " because you can, say, for a logon session,"
    },
    {
      "Time_Start": 2374.42,
      "Time_End": 2378.58,
      "Text": " cache a brand new hash that you specify."
    },
    {
      "Time_Start": 2378.58,
      "Time_End": 2380.54,
      "Text": " This was a lot of Alad's idea, which"
    },
    {
      "Time_Start": 2380.54,
      "Time_End": 2381.9,
      "Text": " I think is pretty awesome."
    },
    {
      "Time_Start": 2381.9,
      "Time_End": 2383.82,
      "Text": " If you can call this function, you"
    },
    {
      "Time_Start": 2383.82,
      "Time_End": 2388.58,
      "Text": " can basically do pass the hash with own host tooling"
    },
    {
      "Time_Start": 2388.58,
      "Time_End": 2390.42,
      "Text": " without having to modify LSAS memory."
    },
    {
      "Time_Start": 2390.42,
      "Time_End": 2391.26,
      "Text": " That would be great."
    },
    {
      "Time_Start": 2391.26,
      "Time_End": 2394.46,
      "Text": " But unfortunately, it checks if you're the LSAS process"
    },
    {
      "Time_Start": 2394.46,
      "Time_End": 2397.62,
      "Text": " and blocks that."
    },
    {
      "Time_Start": 2397.62,
      "Time_End": 2399.82,
      "Text": " Another example of LSAS-only calls"
    },
    {
      "Time_Start": 2399.82,
      "Time_End": 2404.2200000000003,
      "Text": " is when you have to provide valid pointers to LSAS memory."
    },
    {
      "Time_Start": 2404.2200000000003,
      "Time_End": 2406.6600000000003,
      "Text": " You can absolutely make a lot of these calls"
    },
    {
      "Time_Start": 2406.6600000000003,
      "Time_End": 2410.34,
      "Text": " not as the LSAS process, and the end result"
    },
    {
      "Time_Start": 2410.34,
      "Time_End": 2414.1400000000003,
      "Text": " is that you crash LSAS, you kill a critical process,"
    },
    {
      "Time_Start": 2414.1400000000003,
      "Time_End": 2417.42,
      "Text": " and your host reboots."
    },
    {
      "Time_Start": 2417.42,
      "Time_End": 2419.7400000000002,
      "Text": " By the way, that was all reported to MSRC."
    },
    {
      "Time_Start": 2419.7400000000002,
      "Time_End": 2423.1800000000003,
      "Text": " They considered it a non-fix, because you"
    },
    {
      "Time_Start": 2423.1800000000003,
      "Time_End": 2426.6200000000003,
      "Text": " had to be system for a lot of these."
    },
    {
      "Time_Start": 2426.6200000000003,
      "Time_End": 2429.1000000000004,
      "Text": " Besides the point, you effectively"
    },
    {
      "Time_Start": 2429.18,
      "Time_End": 2432.1,
      "Text": " can't use these calls, because if you"
    },
    {
      "Time_Start": 2432.1,
      "Time_End": 2435.14,
      "Text": " were able to gain access to memory for LSAS,"
    },
    {
      "Time_Start": 2435.14,
      "Time_End": 2438.58,
      "Text": " you would just use Mimikatz in the first place."
    },
    {
      "Time_Start": 2438.58,
      "Time_End": 2443.02,
      "Text": " There are some calls that, well, there's"
    },
    {
      "Time_Start": 2443.02,
      "Time_End": 2445.2599999999998,
      "Text": " this way that we're thinking about bypassing"
    },
    {
      "Time_Start": 2445.2599999999998,
      "Time_End": 2447.2999999999997,
      "Text": " these LSAS-only calls."
    },
    {
      "Time_Start": 2447.2999999999997,
      "Time_End": 2450.5,
      "Text": " There's this feature called a pass-through request,"
    },
    {
      "Time_Start": 2450.5,
      "Time_End": 2453.38,
      "Text": " where you can say, hey, pass my authentication package request"
    },
    {
      "Time_Start": 2453.38,
      "Time_End": 2455.14,
      "Text": " to a domain controller."
    },
    {
      "Time_Start": 2455.14,
      "Time_End": 2456.72,
      "Text": " What if you're on a workgroup, though?"
    },
    {
      "Time_Start": 2456.72,
      "Time_End": 2458.18,
      "Text": " Well, there's no domain controller."
    },
    {
      "Time_Start": 2458.18,
      "Time_End": 2460.62,
      "Text": " LSAS would just resubmit that request itself."
    },
    {
      "Time_Start": 2460.62,
      "Time_End": 2463.8199999999997,
      "Text": " So we're like, well, if LSAS has to make this request,"
    },
    {
      "Time_Start": 2463.8199999999997,
      "Time_End": 2469.3399999999997,
      "Text": " why can't we just force LSAS to do that for us?"
    },
    {
      "Time_Start": 2469.3399999999997,
      "Time_End": 2474.74,
      "Text": " Force an LSAS to think, oh, I'm on a workgroup machine,"
    },
    {
      "Time_Start": 2474.74,
      "Time_End": 2476.3399999999997,
      "Text": " and just resubmit that request for us"
    },
    {
      "Time_Start": 2476.3399999999997,
      "Time_End": 2478.1,
      "Text": " by passing some of these checks."
    },
    {
      "Time_Start": 2478.1,
      "Time_End": 2481.54,
      "Text": " Unfortunately, the calls you can make as a pass-through call"
    },
    {
      "Time_Start": 2481.54,
      "Time_End": 2482.58,
      "Text": " are heavily filtered."
    },
    {
      "Time_Start": 2482.58,
      "Time_End": 2483.98,
      "Text": " There's only one or two calls you"
    },
    {
      "Time_Start": 2483.98,
      "Time_End": 2486.3799999999997,
      "Text": " can pass through for each authentication package,"
    },
    {
      "Time_Start": 2486.38,
      "Time_End": 2490.3,
      "Text": " and they're not useful, unfortunately."
    },
    {
      "Time_Start": 2490.3,
      "Time_End": 2493.42,
      "Text": " Last dead end was there's this idea"
    },
    {
      "Time_Start": 2493.42,
      "Time_End": 2495.82,
      "Text": " of transferring credentials between logon sessions."
    },
    {
      "Time_Start": 2495.82,
      "Time_End": 2496.62,
      "Text": " That sounds great."
    },
    {
      "Time_Start": 2496.62,
      "Time_End": 2498.04,
      "Text": " We can make our own logon session."
    },
    {
      "Time_Start": 2498.04,
      "Time_End": 2501.38,
      "Text": " We can transfer a domain admin or some other privileged user"
    },
    {
      "Time_Start": 2501.38,
      "Time_End": 2503.78,
      "Text": " credentials to our logon session and use them."
    },
    {
      "Time_Start": 2503.78,
      "Time_End": 2504.98,
      "Text": " Wouldn't that be wonderful?"
    },
    {
      "Time_Start": 2504.98,
      "Time_End": 2511.02,
      "Text": " In practice, this isn't as helpful as we believe it to be."
    },
    {
      "Time_Start": 2511.02,
      "Time_End": 2512.6,
      "Text": " Will did a lot of testing for this,"
    },
    {
      "Time_Start": 2512.6,
      "Time_End": 2514.96,
      "Text": " and we found that with Kerberos, as an example,"
    },
    {
      "Time_Start": 2514.96,
      "Time_End": 2516.4,
      "Text": " when you transfer credentials, it"
    },
    {
      "Time_Start": 2516.4,
      "Time_End": 2520.48,
      "Text": " appears that the tickets from the source logon session"
    },
    {
      "Time_Start": 2520.48,
      "Time_End": 2523.8,
      "Text": " are cleared out, which would affect that user's logon"
    },
    {
      "Time_Start": 2523.8,
      "Time_End": 2524.32,
      "Text": " session."
    },
    {
      "Time_Start": 2524.32,
      "Time_End": 2525.92,
      "Text": " That's unfortunate."
    },
    {
      "Time_Start": 2525.92,
      "Time_End": 2530.2400000000002,
      "Text": " With local logons with MSV1, you can't do it"
    },
    {
      "Time_Start": 2530.2400000000002,
      "Time_End": 2531.96,
      "Text": " unless you're LSAS."
    },
    {
      "Time_Start": 2531.96,
      "Time_End": 2536.36,
      "Text": " You can still do it if you're dealing with a cloud logon"
    },
    {
      "Time_Start": 2536.36,
      "Time_End": 2539.08,
      "Text": " session, like Cloud AP, but we didn't"
    },
    {
      "Time_Start": 2539.08,
      "Time_End": 2542.04,
      "Text": " have time to look into that."
    },
    {
      "Time_Start": 2542.04,
      "Time_End": 2544.02,
      "Text": " So future ideas."
    },
    {
      "Time_Start": 2544.02,
      "Time_End": 2545.62,
      "Text": " The first one is what I just mentioned."
    },
    {
      "Time_Start": 2545.62,
      "Time_End": 2548.82,
      "Text": " With cloud logons, you can transfer credentials"
    },
    {
      "Time_Start": 2548.82,
      "Time_End": 2551.58,
      "Text": " between cloud-based logon sessions."
    },
    {
      "Time_Start": 2551.58,
      "Time_End": 2554.7,
      "Text": " We just think that's interesting, worth looking into."
    },
    {
      "Time_Start": 2554.7,
      "Time_End": 2557.84,
      "Text": " With Azure AD, you can create a single sign-on cookie"
    },
    {
      "Time_Start": 2557.84,
      "Time_End": 2563.06,
      "Text": " for a device, which we also think is pretty useful."
    },
    {
      "Time_Start": 2563.06,
      "Time_End": 2565.18,
      "Text": " We couldn't find anybody abusing this publicly,"
    },
    {
      "Time_Start": 2565.18,
      "Time_End": 2567.68,
      "Text": " but we think there's probably situations where you can abuse"
    },
    {
      "Time_Start": 2567.68,
      "Time_End": 2568.66,
      "Text": " it."
    },
    {
      "Time_Start": 2568.66,
      "Time_End": 2570.82,
      "Text": " There's another set of requests with Cloud AP"
    },
    {
      "Time_Start": 2570.82,
      "Time_End": 2573.2,
      "Text": " where it's what's highlighted on the screen,"
    },
    {
      "Time_Start": 2573.2000000000003,
      "Time_End": 2575.4,
      "Text": " these three calls."
    },
    {
      "Time_Start": 2575.4,
      "Time_End": 2578.84,
      "Text": " They're designed to allow two computers to authenticate"
    },
    {
      "Time_Start": 2578.84,
      "Time_End": 2584.5600000000004,
      "Text": " over RTP to each other using Azure AD without PKUTU."
    },
    {
      "Time_Start": 2584.5600000000004,
      "Time_End": 2586.1600000000003,
      "Text": " If you make these two requests locally,"
    },
    {
      "Time_Start": 2586.1600000000003,
      "Time_End": 2588.1200000000003,
      "Text": " though, the documentation says that you"
    },
    {
      "Time_Start": 2588.1200000000003,
      "Time_End": 2591.4800000000005,
      "Text": " should get a blob of data that you can immediately"
    },
    {
      "Time_Start": 2591.4800000000005,
      "Time_End": 2594.44,
      "Text": " pass to LSA logon user to get a new logon"
    },
    {
      "Time_Start": 2594.44,
      "Time_End": 2598.26,
      "Text": " session for an Azure AD user, which I think is pretty neat."
    },
    {
      "Time_Start": 2598.26,
      "Time_End": 2600.7200000000003,
      "Text": " So if you want to get a new logon session for a cloud-based"
    },
    {
      "Time_Start": 2600.7200000000003,
      "Time_End": 2602.88,
      "Text": " account, you should be able to make these two calls,"
    },
    {
      "Time_Start": 2602.88,
      "Time_End": 2605.6800000000003,
      "Text": " blob data, call logon user, and make a session."
    },
    {
      "Time_Start": 2608.96,
      "Time_End": 2611.2200000000003,
      "Text": " I'm confident you can recover a single sign-on cookies"
    },
    {
      "Time_Start": 2611.2200000000003,
      "Time_End": 2613.84,
      "Text": " for personal Microsoft accounts."
    },
    {
      "Time_Start": 2613.84,
      "Time_End": 2615.6,
      "Text": " But again, there's additional data"
    },
    {
      "Time_Start": 2615.6,
      "Time_End": 2618.08,
      "Text": " marshaling that we haven't been able to work out"
    },
    {
      "Time_Start": 2618.08,
      "Time_End": 2621.32,
      "Text": " yet for the tool, but we do plan to implement that."
    },
    {
      "Time_Start": 2624.04,
      "Time_End": 2626.92,
      "Text": " Remember that flowchart about DPAPI,"
    },
    {
      "Time_Start": 2626.92,
      "Time_End": 2628.7200000000003,
      "Text": " master key file decryption?"
    },
    {
      "Time_Start": 2628.7200000000003,
      "Time_End": 2632.6400000000003,
      "Text": " Well, again, there is that call for drive."
    },
    {
      "Time_Start": 2632.64,
      "Time_End": 2633.8799999999997,
      "Text": " You can say drive credential."
    },
    {
      "Time_Start": 2633.8799999999997,
      "Time_End": 2634.7999999999997,
      "Text": " You get an output."
    },
    {
      "Time_Start": 2634.7999999999997,
      "Time_End": 2637.48,
      "Text": " That output is a master key encryption key"
    },
    {
      "Time_Start": 2637.48,
      "Time_End": 2642.8799999999997,
      "Text": " that you should be able to use to decrypt a master key file."
    },
    {
      "Time_Start": 2642.8799999999997,
      "Time_End": 2645.3599999999997,
      "Text": " So although you do have to be LSAS,"
    },
    {
      "Time_Start": 2645.3599999999997,
      "Time_End": 2648.08,
      "Text": " I think it's worth just looking into injecting into LSAS,"
    },
    {
      "Time_Start": 2648.08,
      "Time_End": 2652.96,
      "Text": " making this call, and abusing it with sharp DPPI."
    },
    {
      "Time_Start": 2652.96,
      "Time_End": 2657.2799999999997,
      "Text": " Last thing is relaying with NTLM responses."
    },
    {
      "Time_Start": 2657.2799999999997,
      "Time_End": 2661.56,
      "Text": " The neat thing with this is you should absolutely"
    },
    {
      "Time_Start": 2661.56,
      "Time_End": 2665.12,
      "Text": " be able to get on a host, see a logon session for a user"
    },
    {
      "Time_Start": 2665.12,
      "Time_End": 2668.64,
      "Text": " on that host, and say, OK, I'm going to start with impacket,"
    },
    {
      "Time_Start": 2668.64,
      "Time_End": 2671.96,
      "Text": " make a request for some server, get that server's response,"
    },
    {
      "Time_Start": 2671.96,
      "Time_End": 2674.96,
      "Text": " go on that host, and say, hey, MSV1,"
    },
    {
      "Time_Start": 2674.96,
      "Time_End": 2677.2799999999997,
      "Text": " make me the appropriate NTLM vresponse"
    },
    {
      "Time_Start": 2677.2799999999997,
      "Time_End": 2680.16,
      "Text": " that I need for impacket, and then give that response back"
    },
    {
      "Time_Start": 2680.16,
      "Time_End": 2682.0,
      "Text": " to impacket to finish that authentication."
    },
    {
      "Time_Start": 2682.0,
      "Time_End": 2683.72,
      "Text": " You should absolutely be able to do that."
    },
    {
      "Time_Start": 2683.72,
      "Time_End": 2687.56,
      "Text": " We just don't have the code yet in impacket for it."
    },
    {
      "Time_Start": 2687.56,
      "Time_End": 2690.0,
      "Text": " OK, only got a few minutes."
    },
    {
      "Time_Start": 2690.0,
      "Time_End": 2691.8,
      "Text": " Again, negotiate extender package"
    },
    {
      "Time_Start": 2691.8,
      "Time_End": 2695.2,
      "Text": " has this call that should return some form of credentials."
    },
    {
      "Time_Start": 2695.2,
      "Time_End": 2699.28,
      "Text": " How that's recovered and returned to you"
    },
    {
      "Time_Start": 2699.28,
      "Time_End": 2701.24,
      "Text": " is to be determined."
    },
    {
      "Time_Start": 2701.24,
      "Time_End": 2703.96,
      "Text": " There's also a few different components inside LSAS,"
    },
    {
      "Time_Start": 2703.96,
      "Time_End": 2706.68,
      "Text": " such as terminal service package that has a ton of calls,"
    },
    {
      "Time_Start": 2706.68,
      "Time_End": 2710.0,
      "Text": " the SPM itself that has a ton of calls."
    },
    {
      "Time_Start": 2710.0,
      "Time_End": 2712.48,
      "Text": " One of those calls is add in a package,"
    },
    {
      "Time_Start": 2712.48,
      "Time_End": 2718.28,
      "Text": " how you say, hey, Mimikatz, add a SSP to LSAS."
    },
    {
      "Time_Start": 2718.28,
      "Time_End": 2720.2000000000003,
      "Text": " That is facilitated through this component, one"
    },
    {
      "Time_Start": 2720.2000000000003,
      "Time_End": 2721.48,
      "Text": " of these 23 calls."
    },
    {
      "Time_Start": 2721.48,
      "Time_End": 2724.1200000000003,
      "Text": " But there's 22 other ones."
    },
    {
      "Time_Start": 2724.1200000000003,
      "Time_End": 2726.1200000000003,
      "Text": " What else is useful there?"
    },
    {
      "Time_Start": 2726.1200000000003,
      "Time_End": 2728.48,
      "Text": " Microsoft has implemented a new authentication scheme"
    },
    {
      "Time_Start": 2728.48,
      "Time_End": 2730.48,
      "Text": " called IACurb."
    },
    {
      "Time_Start": 2730.48,
      "Time_End": 2732.0800000000004,
      "Text": " We do not know yet if this is going"
    },
    {
      "Time_Start": 2732.0800000000004,
      "Time_End": 2733.92,
      "Text": " to be a brand new authentication package."
    },
    {
      "Time_Start": 2733.92,
      "Time_End": 2737.52,
      "Text": " If it is, it's in the scope of the project."
    },
    {
      "Time_Start": 2737.52,
      "Time_End": 2740.28,
      "Text": " Lastly, we've only been making authentication package"
    },
    {
      "Time_Start": 2740.28,
      "Time_End": 2741.1200000000003,
      "Text": " requests."
    },
    {
      "Time_Start": 2741.1200000000003,
      "Time_End": 2743.4,
      "Text": " There's a whole other side to authentication packages,"
    },
    {
      "Time_Start": 2743.4,
      "Time_End": 2745.8,
      "Text": " which is log in on a user."
    },
    {
      "Time_Start": 2745.8,
      "Time_End": 2748.92,
      "Text": " We can actually log on, say, make a log on user request"
    },
    {
      "Time_Start": 2748.92,
      "Time_End": 2751.28,
      "Text": " to make a new session to a specific package."
    },
    {
      "Time_Start": 2751.28,
      "Time_End": 2753.4,
      "Text": " You can specify the package."
    },
    {
      "Time_Start": 2753.4,
      "Time_End": 2754.2400000000002,
      "Text": " It's worth exploring."
    },
    {
      "Time_Start": 2754.2400000000002,
      "Time_End": 2756.6400000000003,
      "Text": " We just haven't done it yet."
    },
    {
      "Time_Start": 2756.6400000000003,
      "Time_End": 2760.0600000000004,
      "Text": " To wrap up, because we're basically at time,"
    },
    {
      "Time_Start": 2760.0600000000004,
      "Time_End": 2762.88,
      "Text": " Microsoft has, again, put in many mitigations"
    },
    {
      "Time_Start": 2762.88,
      "Time_End": 2765.36,
      "Text": " to prevent not only gaining access to LSAS memory,"
    },
    {
      "Time_Start": 2765.36,
      "Time_End": 2768.4,
      "Text": " but abusing that access once you have it."
    },
    {
      "Time_Start": 2768.4,
      "Time_End": 2771.88,
      "Text": " For us, effectively, that doesn't really matter."
    },
    {
      "Time_Start": 2771.88,
      "Time_End": 2775.2400000000002,
      "Text": " Because you can just, if a user is logged on to that host"
    },
    {
      "Time_Start": 2775.2400000000002,
      "Time_End": 2778.48,
      "Text": " and you have enough privileges, either impersonating that user"
    },
    {
      "Time_Start": 2778.48,
      "Time_End": 2781.76,
      "Text": " or being a system itself, you can make an appropriate"
    },
    {
      "Time_Start": 2781.76,
      "Time_End": 2785.5600000000004,
      "Text": " response to LSAS to most likely recover"
    },
    {
      "Time_Start": 2785.5600000000004,
      "Time_End": 2788.1600000000003,
      "Text": " all the credentials you would care about in the first place."
    },
    {
      "Time_Start": 2788.1600000000003,
      "Time_End": 2790.92,
      "Text": " You can recover single sign-on cookies"
    },
    {
      "Time_Start": 2790.92,
      "Time_End": 2792.1200000000003,
      "Text": " for doing cloud-based stuff."
    },
    {
      "Time_Start": 2792.1200000000003,
      "Time_End": 2795.1600000000003,
      "Text": " You can recover DPAPI keys to decrypt their master key"
    },
    {
      "Time_Start": 2795.1600000000003,
      "Time_End": 2796.0000000000005,
      "Text": " files."
    },
    {
      "Time_Start": 2796.0000000000005,
      "Time_End": 2798.32,
      "Text": " You can recover NTLMV responses, even"
    },
    {
      "Time_Start": 2798.32,
      "Time_End": 2800.0400000000004,
      "Text": " with all the medications enabled,"
    },
    {
      "Time_Start": 2800.0400000000004,
      "Time_End": 2804.5800000000004,
      "Text": " to go to crack.sh and recover an NTOWF hash for past hash stuff."
    },
    {
      "Time_Start": 2804.58,
      "Time_End": 2807.46,
      "Text": " So really, in my opinion, what you probably want to get,"
    },
    {
      "Time_Start": 2807.46,
      "Time_End": 2811.22,
      "Text": " you can just go ahead and get without access in LSAS memory."
    },
    {
      "Time_Start": 2811.22,
      "Time_End": 2814.22,
      "Text": " There's a lot of other host enumeration stuff"
    },
    {
      "Time_Start": 2814.22,
      "Time_End": 2816.38,
      "Text": " that we didn't even talk about much."
    },
    {
      "Time_Start": 2816.38,
      "Time_End": 2819.98,
      "Text": " But there's a lot of stuff that we see in command line tooling"
    },
    {
      "Time_Start": 2819.98,
      "Time_End": 2824.1,
      "Text": " for Windows that we can't get that same data from 132 calls."
    },
    {
      "Time_Start": 2824.1,
      "Time_End": 2826.14,
      "Text": " But you can get that data from making the request"
    },
    {
      "Time_Start": 2826.14,
      "Time_End": 2828.7,
      "Text": " to the authentication packages themselves."
    },
    {
      "Time_Start": 2828.7,
      "Time_End": 2831.88,
      "Text": " And we did mention a few other tradecraft ideas,"
    },
    {
      "Time_Start": 2831.88,
      "Time_End": 2835.48,
      "Text": " such as the new way to do NTLM relays"
    },
    {
      "Time_Start": 2835.48,
      "Time_End": 2837.4,
      "Text": " by modifying impact."
    },
    {
      "Time_Start": 2837.4,
      "Time_End": 2837.88,
      "Text": " Cool."
    },
    {
      "Time_Start": 2837.88,
      "Time_End": 2840.2400000000002,
      "Text": " Last slide."
    },
    {
      "Time_Start": 2840.2400000000002,
      "Time_End": 2841.6400000000003,
      "Text": " Again, multiple medications."
    },
    {
      "Time_Start": 2841.6400000000003,
      "Time_End": 2844.28,
      "Text": " Oh, yeah, sorry."
    },
    {
      "Time_Start": 2844.28,
      "Time_End": 2847.08,
      "Text": " The last note at the bottom is we"
    },
    {
      "Time_Start": 2847.08,
      "Time_End": 2849.44,
      "Text": " do have a tool that implements every single thing we"
    },
    {
      "Time_Start": 2849.44,
      "Time_End": 2851.1600000000003,
      "Text": " talked about today."
    },
    {
      "Time_Start": 2851.1600000000003,
      "Time_End": 2852.76,
      "Text": " And we have an extensive wiki that"
    },
    {
      "Time_Start": 2852.76,
      "Time_End": 2856.08,
      "Text": " goes way more in-depth in all these concepts."
    },
    {
      "Time_Start": 2856.08,
      "Time_End": 2859.2400000000002,
      "Text": " We plan for it to be released about a month from now."
    },
    {
      "Time_Start": 2862.88,
      "Time_End": 2864.1600000000003,
      "Text": " I know I'm at time."
    },
    {
      "Time_Start": 2864.1600000000003,
      "Time_End": 2865.7200000000003,
      "Text": " Do we have time for questions?"
    },
    {
      "Time_Start": 2869.96,
      "Time_End": 2870.84,
      "Text": " I'm going to say yes."
    },
    {
      "Time_Start": 2870.84,
      "Time_End": 2872.28,
      "Text": " So anybody have questions?"
    },
    {
      "Time_Start": 2879.7200000000003,
      "Time_End": 2880.2200000000003,
      "Text": " No?"
    },
    {
      "Time_Start": 2880.2200000000003,
      "Time_End": 2880.7200000000003,
      "Text": " Cool."
    },
    {
      "Time_Start": 2880.7200000000003,
      "Time_End": 2881.7200000000003,
      "Text": " Thank you for coming."
    },
    {
      "Time_Start": 2881.7200000000003,
      "Time_End": 2883.76,
      "Text": " Thank you."
    }
  ]
}