{"segments": [{"Time_Start": 0.0, "Time_End": 16.92, "Text": " Network Ice and the chief architect of Black Ice Intrusion Detection System."}, {"Time_Start": 16.92, "Time_End": 24.84, "Text": " And what I'll be discussing today is some of our experiences of running IDS systems in the battlefield."}, {"Time_Start": 24.84, "Time_End": 29.98, "Text": " In particular, I'll be discussing how to evade or how"}, {"Time_Start": 30.0, "Time_End": 34.24, "Text": " people are evading intrusion detection systems."}, {"Time_Start": 34.24, "Time_End": 40.28, "Text": " And then I'll be introducing some new methods that we've been working on that allow hackers"}, {"Time_Start": 40.28, "Time_End": 46.22, "Text": " to implement new methods of evading intrusion detection systems."}, {"Time_Start": 46.22, "Time_End": 50.0, "Text": " To start with, I'm going to talk about, a little bit about the background and the surrounding"}, {"Time_Start": 50.0, "Time_End": 53.96, "Text": " areas of intrusion detection systems and how this applies."}, {"Time_Start": 53.96, "Time_End": 59.24, "Text": " It's basically marketing drivel, but you'll have to bear with me for a moment."}, {"Time_Start": 59.24, "Time_End": 63.7, "Text": " IDS systems are sort of like weaponry in the war against hackers."}, {"Time_Start": 63.7, "Time_End": 66.0, "Text": " But they're kind of like flaky weaponry."}, {"Time_Start": 66.0, "Time_End": 70.44, "Text": " It's kind of like a tank that you might take out to a battlefield, and an enemy soldier"}, {"Time_Start": 70.44, "Time_End": 75.2, "Text": " walks up behind it, aims a gun at it, and the tank explodes."}, {"Time_Start": 75.2, "Time_End": 80.36, "Text": " This is like in the movie Kelly's Heroes from 1968, where Donald Sutherland plays"}, {"Time_Start": 80.36, "Time_End": 86.78, "Text": " Oddball, who gets behind a German panzer tank and aims a small little missile at it,"}, {"Time_Start": 86.78, "Time_End": 88.36, "Text": " and then poof, the tank blows up."}, {"Time_Start": 88.36, "Time_End": 93.36, "Text": " And the way he was able to do this was by a foot soldier running around behind the tank"}, {"Time_Start": 93.36, "Time_End": 96.22, "Text": " rather than the frontal assault where all the armor is."}, {"Time_Start": 97.66, "Time_End": 99.42, "Text": " Now, of course, all tanks can be blown up."}, {"Time_Start": 99.5, "Time_End": 105.03999999999999, "Text": " The only question is, is whether you do it with a nuke or a howitzer or with a handgun."}, {"Time_Start": 107.96000000000001, "Time_End": 113.46000000000001, "Text": " IDSers are a lot like radar systems that trigger on the passing flight of flocks of birds"}, {"Time_Start": 113.46000000000001, "Time_End": 115.36, "Text": " and automatically launch missiles at them."}, {"Time_Start": 117.53999999999999, "Time_End": 118.34, "Text": " While at the same thing."}, {"Time_Start": 118.36, "Time_End": 122.28, "Text": " same time, not detecting enemy fighter planes that are bearing down on you."}, {"Time_Start": 125.64, "Time_End": 133.86, "Text": " During the Iran-Iraq War, the Iraqi and not the Iran-Iraq War, the Gulf War, the Desert Storm,"}, {"Time_Start": 134.24, "Time_End": 139.46, "Text": " the Iraqi soldiers were famous for throwing down their weapons and running away. This was their"}, {"Time_Start": 139.46, "Time_End": 141.12, "Text": " primary battle strategy."}, {"Time_Start": 148.36, "Time_End": 154.0, "Text": " These analogies and the weaponry and the war against hackers, IDS systems are a lot like this."}, {"Time_Start": 154.0, "Time_End": 156.24, "Text": " They work well in the laboratory."}, {"Time_Start": 156.24, "Time_End": 161.36, "Text": " I can bring my IDS system in, I can run an exploit script, and I can say, see, my IDS catches"}, {"Time_Start": 161.36, "Time_End": 162.36, "Text": " this attack."}, {"Time_Start": 162.36, "Time_End": 167.82000000000002, "Text": " But when you put them into the real world, into the battle conditions, they start to fail."}, {"Time_Start": 167.82000000000002, "Time_End": 172.12, "Text": " They start to flee the battlefield, they blow it from behind, they trigger on the passing"}, {"Time_Start": 172.12, "Time_End": 173.02, "Text": " flights of birds."}, {"Time_Start": 175.98000000000002, "Time_End": 177.86, "Text": " Now here's the blatant marketing pitch."}, {"Time_Start": 178.36, "Time_End": 186.36, "Text": " Network ice right now, we estimate, is the market leader in intrusion detection system."}, {"Time_Start": 186.36, "Time_End": 193.36, "Text": " We're only like number five in terms of monetary value, whatever, from 1999, according to Internet Week."}, {"Time_Start": 193.36, "Time_End": 199.36, "Text": " But we believe that more traffic is being monitored by Black Ice than any other intrusion detection system."}, {"Time_Start": 199.36, "Time_End": 205.36, "Text": " And this is partially because we run on lots of ISP backbones and high-end websites"}, {"Time_Start": 205.36, "Time_End": 208.34, "Text": " because we can keep up with the traffic where a lot of traffic we're allowed."}, {"Time_Start": 208.36, "Time_End": 209.36, "Text": " others fail."}, {"Time_Start": 209.36, "Time_End": 213.36, "Text": " But it's also because we've got it running on 2 million desktops."}, {"Time_Start": 213.36, "Time_End": 219.36, "Text": " We have two versions. We have BlackEyce Defender, which is a personal IDS that runs on a desktop computer."}, {"Time_Start": 219.36, "Time_End": 230.36, "Text": " And then Black Ice Sentry, which is a traditional network-based intrusion detection system like Snort or Real Secure or Net Ranger and so forth."}, {"Time_Start": 230.36, "Time_End": 238.34, "Text": " And in the competitions products, first of all, the exploit signal,"}, {"Time_Start": 238.36, "Time_End": 240.36, "Text": " are not as extensive as they would have you believe."}, {"Time_Start": 240.36, "Time_End": 245.36, "Text": " There's lots of D codes that just sort of say, well, somebody logged in and that's about it."}, {"Time_Start": 245.36, "Time_End": 247.36, "Text": " There are lots of port numbers they trigger on."}, {"Time_Start": 247.36, "Time_End": 250.36, "Text": " There's lots of CGI strings we just add one right after the other."}, {"Time_Start": 250.36, "Time_End": 254.36, "Text": " When you get beyond all that and really hunt down the exploit signatures they have,"}, {"Time_Start": 254.36, "Time_End": 256.36, "Text": " they're not nearly as extensive as you would think."}, {"Time_Start": 256.36, "Time_End": 261.36, "Text": " Even ours, if you go through our list, you'll see lots of CGI programs, lots of ports."}, {"Time_Start": 261.36, "Time_End": 265.36, "Text": " Though we do have lots of other good exploit signatures."}, {"Time_Start": 265.36, "Time_End": 268.36, "Text": " Existing technologies are easily evaded."}, {"Time_Start": 268.36, "Time_End": 272.36, "Text": " by really commonly available programs."}, {"Time_Start": 272.36, "Time_End": 275.36, "Text": " These aren't, you know, really Uber Hacker programs."}, {"Time_Start": 275.36, "Time_End": 278.36, "Text": " There are things that you can download, configure, and run,"}, {"Time_Start": 278.36, "Time_End": 281.36, "Text": " like Fragruder, Whisker, and other stuff."}, {"Time_Start": 281.36, "Time_End": 286.36, "Text": " I'll also be introducing some new techniques that really will put them in knots."}, {"Time_Start": 286.36, "Time_End": 291.36, "Text": " And they also die, you know, pretty gruesomely under heavy load or complex traffic."}, {"Time_Start": 291.36, "Time_End": 295.36, "Text": " As I like to say, they'll easily flee the field of battle like Iraqi soldiers."}, {"Time_Start": 295.36, "Time_End": 298.36, "Text": " To start my time,"}, {"Time_Start": 298.36, "Time_End": 301.86, "Text": " talk of the technical side of things now, now that I'm done with the marketing stuff."}, {"Time_Start": 301.86, "Time_End": 306.36, "Text": " You see the marketing department pays for my flight out here in my hotel, so I have to sort of"}, {"Time_Start": 306.36, "Time_End": 310.36, "Text": " throw them a bone here."}, {"Time_Start": 310.36, "Time_End": 314.86, "Text": " What is a network IDS? Fundamentally it's showing this little diagram."}, {"Time_Start": 314.86, "Time_End": 319.36, "Text": " You have a hacker, and he wants to break into your website, or behind your website into"}, {"Time_Start": 319.36, "Time_End": 320.36, "Text": " your corporation."}, {"Time_Start": 320.36, "Time_End": 326.36, "Text": " Your external presence is the web server, the FTP server, your name server, your mail exchanger."}, {"Time_Start": 326.36, "Time_End": 328.34000000000003, "Text": " The network"}, {"Time_Start": 328.36, "Time_End": 335.36, "Text": " IDS will monitor the network traffic looking for signs of intrusions against your computers."}, {"Time_Start": 335.36, "Time_End": 339.36, "Text": " Hopefully, it will tip you off that someone's actively attacking you,"}, {"Time_Start": 339.36, "Time_End": 342.36, "Text": " and if they break in, it'll tell you how they did it."}, {"Time_Start": 342.36, "Time_End": 348.36, "Text": " However, a network intrusion detection system..."}, {"Time_Start": 352.36, "Time_End": 356.36, "Text": " Is there a Sean Hedges in the room?"}, {"Time_Start": 356.36, "Time_End": 360.36, "Text": " Some of you might know this already."}, {"Time_Start": 360.36, "Time_End": 361.36, "Text": " Okay, he's not."}, {"Time_Start": 361.36, "Time_End": 362.36, "Text": " Thank you."}, {"Time_Start": 362.36, "Time_End": 363.36, "Text": " He's lost."}, {"Time_Start": 363.36, "Time_End": 366.36, "Text": " Yeah, the feds are looking for him."}, {"Time_Start": 366.36, "Time_End": 368.36, "Text": " Is there a Sean Hedges?"}, {"Time_Start": 372.36, "Time_End": 379.36, "Text": " So in the previous diagram, I tried to emphasize the fact that network intrusion detection systems"}, {"Time_Start": 379.36, "Time_End": 384.36, "Text": " detect that they're happening but don't necessarily protect you."}, {"Time_Start": 384.36, "Time_End": 385.36, "Text": " They're sort of a..."}, {"Time_Start": 385.36, "Time_End": 390.36, "Text": " an early warning system and then a post-phorinsic system."}, {"Time_Start": 390.36, "Time_End": 395.36, "Text": " They're like a detective that witnesses, that doesn't witness the actual crime,"}, {"Time_Start": 395.36, "Time_End": 398.36, "Text": " but tries to piece together the clues afterwards."}, {"Time_Start": 398.36, "Time_End": 401.36, "Text": " It's like the Colombo movies and television shows,"}, {"Time_Start": 401.36, "Time_End": 405.36, "Text": " where he comes in 15 minutes after the crime has happened,"}, {"Time_Start": 405.36, "Time_End": 408.36, "Text": " and then he tries to, over the course of the show,"}, {"Time_Start": 408.36, "Time_End": 411.36, "Text": " pieces together the clues until he figures out what happened."}, {"Time_Start": 411.36, "Time_End": 415.36, "Text": " And hackers are really, really good at, at least really good"}, {"Time_Start": 415.36, "Time_End": 416.36, "Text": " I should say."}, {"Time_Start": 416.36, "Time_End": 420.36, "Text": " They're really good at smudging these clues and hiding their fingerprints."}, {"Time_Start": 420.36, "Time_End": 424.36, "Text": " So a network IDS system is like a detective or a sleuth,"}, {"Time_Start": 424.36, "Time_End": 428.36, "Text": " and it really isn't like the psychic system that sort of knows everything that"}, {"Time_Start": 428.36, "Time_End": 432.36, "Text": " happens and tells you exactly that you've been broken into or not."}, {"Time_Start": 432.36, "Time_End": 435.36, "Text": " They detect. It's not really a protection thing."}, {"Time_Start": 435.36, "Time_End": 438.36, "Text": " It's an enhancement to your protection."}, {"Time_Start": 438.36, "Time_End": 444.36, "Text": " Now I'm going to start talking about classic evasion techniques."}, {"Time_Start": 444.36, "Time_End": 445.36, "Text": " The first one,"}, {"Time_Start": 445.36, "Time_End": 451.16, "Text": " It was written, I'm not quite sure when it was written, a year and a half ago, two years ago, called FraggRouter."}, {"Time_Start": 451.16, "Time_End": 460.36, "Text": " It was written by a reseller of NFR to really irk the market leaders like Cisco and ISS."}, {"Time_Start": 460.36, "Time_End": 463.36, "Text": " It's a very simple utility. You can download it, run it."}, {"Time_Start": 463.36, "Time_End": 470.36, "Text": " What it does is, as shown by the two diagrams here, is it fragments here, is it fragments the attack."}, {"Time_Start": 470.36, "Time_End": 475.34000000000003, "Text": " Most IDS systems bring in a packet, look for a signature, and then say, well,"}, {"Time_Start": 475.36, "Time_End": 477.36, "Text": " is a sign of intrusion."}, {"Time_Start": 477.36, "Time_End": 480.36, "Text": " A common intrusion is the PHF attack."}, {"Time_Start": 480.36, "Time_End": 484.36, "Text": " It's the one that we all use now as the sort of the standard one"}, {"Time_Start": 484.36, "Time_End": 487.36, "Text": " that we've been tried, when we describe signatures."}, {"Time_Start": 487.36, "Time_End": 492.36, "Text": " What frag router does is it fragments that across three different packets."}, {"Time_Start": 492.36, "Time_End": 497.36, "Text": " So none of the three packets now contain the signature CGI bin pHF."}, {"Time_Start": 497.36, "Time_End": 501.36, "Text": " You see a little bit of the CGI bin and a little bit of the pHF"}, {"Time_Start": 501.36, "Time_End": 504.36, "Text": " in each packet, but not the whole signature."}, {"Time_Start": 504.36, "Time_End": 505.36, "Text": " This causes the signature."}, {"Time_Start": 505.36, "Time_End": 508.36, "Text": " the IDS system to be completely silent."}, {"Time_Start": 508.36, "Time_End": 512.36, "Text": " Fragg router also goes through a lot of firewalls."}, {"Time_Start": 512.36, "Time_End": 515.36, "Text": " Most firewalls have a configuration option saying disallow fragments,"}, {"Time_Start": 515.36, "Time_End": 518.36, "Text": " but it's frequently not configured correctly."}, {"Time_Start": 518.36, "Time_End": 523.36, "Text": " And since you can fragment packets so they can get a good reading on the port number,"}, {"Time_Start": 523.36, "Time_End": 526.36, "Text": " they'll allow the packets on through."}, {"Time_Start": 526.36, "Time_End": 530.36, "Text": " Fragg router requires an extra machine."}, {"Time_Start": 530.36, "Time_End": 535.36, "Text": " The hacker sets up this,"}, {"Time_Start": 535.36, "Time_End": 542.36, "Text": " extra machine on his own side. He then passes all of the traffic on through and"}, {"Time_Start": 542.36, "Time_End": 547.36, "Text": " the fragment are then automatically fragments whatever it is. It could be any attack."}, {"Time_Start": 547.36, "Time_End": 552.36, "Text": " The IDS at the victim side can no longer detect the attack and is pretty much silent."}, {"Time_Start": 552.36, "Time_End": 557.36, "Text": " Some IDS is at least give a little bit of indication and will say, I'm seeing an excessive"}, {"Time_Start": 557.36, "Time_End": 561.36, "Text": " number of fragments, but they have no visibility into what's really going on."}, {"Time_Start": 565.36, "Time_End": 572.36, "Text": " NMAP, which is a common utility that pretty much is the first thing that is going to run against your site when they're attacking you,"}, {"Time_Start": 572.36, "Time_End": 575.36, "Text": " has a couple of stealth features."}, {"Time_Start": 575.36, "Time_End": 581.36, "Text": " The first stealth feature of NMAP was this stealth scan or half-open scan or SIN scan."}, {"Time_Start": 581.36, "Time_End": 584.36, "Text": " And what it does is it doesn't complete the TCP connection."}, {"Time_Start": 584.36, "Time_End": 586.36, "Text": " It starts it but doesn't complete it."}, {"Time_Start": 586.36, "Time_End": 590.36, "Text": " And this evaded lots of host-based intrusion detection systems"}, {"Time_Start": 590.36, "Time_End": 594.36, "Text": " because they would only start the logging process once the connection had connected."}, {"Time_Start": 594.36, "Time_End": 599.86, "Text": " the connection had completed. But from the network side of things, this doesn't evade"}, {"Time_Start": 599.86, "Time_End": 604.6, "Text": " network intrusion detection systems at all. We see all the sin packets. As a matter of fact, when"}, {"Time_Start": 604.6, "Time_End": 608.92, "Text": " we see lots of these connections not being completed, we actually can tell that it's a stealth"}, {"Time_Start": 608.92, "Time_End": 617.3000000000001, "Text": " scan. But there are other stealth scan features of NMAP that do evade intrusion detection systems."}, {"Time_Start": 617.3000000000001, "Time_End": 623.66, "Text": " And that's again using the fragmentation technique. As you fragment the sin and then the idea system"}, {"Time_Start": 623.66, "Time_End": 626.86, "Text": " can't put it together and figure out what it is and doesn't know what it is and"}, {"Time_Start": 626.86, "Time_End": 629.8, "Text": " doesn't detect the SIN scan."}, {"Time_Start": 629.8, "Time_End": 633.36, "Text": " And it evades some firewalls, evades some IDS systems."}, {"Time_Start": 633.36, "Time_End": 638.86, "Text": " I recently tested one IDS from a vendor that claimed to support a reassembly, but yet could"}, {"Time_Start": 638.86, "Time_End": 644.4599999999999, "Text": " not detect the NMAP SIN scan, the fragmented one."}, {"Time_Start": 644.4599999999999, "Time_End": 651.66, "Text": " Another classic evasion technique is to flood the IDS, to attack it itself."}, {"Time_Start": 651.66, "Time_End": 653.64, "Text": " Lots of IDSss fail under."}, {"Time_Start": 653.66, "Time_End": 657.06, "Text": " these DDoS attack, distributed denial of service attacks."}, {"Time_Start": 658.06, "Time_End": 665.52, "Text": " I heard one vendor recently comment that they can do like 30,000 and even more packets per second,"}, {"Time_Start": 667.36, "Time_End": 671.4, "Text": " which is more than you'll ever see on normal networks, normal 100 megabit networks."}, {"Time_Start": 672.16, "Time_End": 678.1, "Text": " But yet they do fail still under 148,000 frames per second, under heavy loads."}, {"Time_Start": 678.52, "Time_End": 683.26, "Text": " And yes, they're not normal, but that's what the hacker does, is they create abnormal conditions."}, {"Time_Start": 683.66, "Time_End": 685.78, "Text": " A buffer overflow isn't normal, it's abnormal."}, {"Time_Start": 687.3399999999999, "Time_End": 690.9, "Text": " Vendors are designing for the normal case, not so much the exceptional case."}, {"Time_Start": 692.78, "Time_End": 696.9599999999999, "Text": " Today's IDSs are built under the same assumptions that applications are built under,"}, {"Time_Start": 697.0799999999999, "Time_End": 702.42, "Text": " which is to say, you're building for what normal people normally do for that 80% of what normally happens."}, {"Time_Start": 703.48, "Time_End": 706.8, "Text": " IDS has really need to be built for that 20% exceptional cases."}, {"Time_Start": 708.22, "Time_End": 713.42, "Text": " And by the way, packets per second is often the more difficult thing that IDS has have to handle"}, {"Time_Start": 713.42, "Time_End": 714.9599999999999, "Text": " rather than bits per second."}, {"Time_Start": 715.0999999999999, "Time_End": 718.26, "Text": " Most IDSs can handle 100 megabits per second,"}, {"Time_Start": 718.56, "Time_End": 722.4, "Text": " but they can't handle the fully loaded and saturated network"}, {"Time_Start": 722.4, "Time_End": 723.68, "Text": " with lots of small packets."}, {"Time_Start": 724.5999999999999, "Time_End": 727.88, "Text": " As a matter of fact, the maximum for 100 megabit networks"}, {"Time_Start": 727.88, "Time_End": 730.4399999999999, "Text": " is 148,800 packets per second."}, {"Time_Start": 730.92, "Time_End": 733.5799999999999, "Text": " That's actually only about 66 megabits per second"}, {"Time_Start": 733.5799999999999, "Time_End": 735.1999999999999, "Text": " because of spacing between frames,"}, {"Time_Start": 735.56, "Time_End": 737.4599999999999, "Text": " but it will kill most IDS's."}, {"Time_Start": 739.56, "Time_End": 742.02, "Text": " And when they fail, they fail really hard."}, {"Time_Start": 742.5999999999999, "Time_End": 743.4, "Text": " I show three great."}, {"Time_Start": 743.42, "Time_End": 744.92, "Text": " graphs here of three possibilities."}, {"Time_Start": 745.88, "Time_End": 751.5999999999999, "Text": " Let's say that the number 100 represents the maximum that you can put across that wire."}, {"Time_Start": 753.3, "Time_End": 756.4799999999999, "Text": " And maybe the IDS fails at about 75%."}, {"Time_Start": 756.4799999999999, "Time_End": 762.66, "Text": " Well, IDS number one in this diagram shows that the IDS basically processes 75% of the traffic"}, {"Time_Start": 762.66, "Time_End": 766.5799999999999, "Text": " and drops the other 25%, no matter what that traffic is."}, {"Time_Start": 767.74, "Time_End": 770.62, "Text": " But what really happens is that IDS is start to degrade."}, {"Time_Start": 771.42, "Time_End": 773.4, "Text": " So the more traffic you pump, the more traffic you pump,"}, {"Time_Start": 773.4200000000001, "Time_End": 777.1200000000001, "Text": " in the fewer that's actually processing over time."}, {"Time_Start": 777.58, "Time_End": 780.34, "Text": " So you pump in 75, it processes 75."}, {"Time_Start": 780.9200000000001, "Time_End": 783.2800000000001, "Text": " You pump in 80, it now processes 70."}, {"Time_Start": 783.44, "Time_End": 785.5000000000001, "Text": " You pump in 90, now it processes 60."}, {"Time_Start": 787.0000000000001, "Time_End": 790.2400000000001, "Text": " In reality, they really act like IDIS number three."}, {"Time_Start": 790.9000000000001, "Time_End": 794.1600000000001, "Text": " As soon after they reach their limit, they start failing really, really fast."}, {"Time_Start": 795.0000000000001, "Time_End": 798.96, "Text": " A lot of them, when you do pump in that full 148,000 frames per second,"}, {"Time_Start": 799.5600000000001, "Time_End": 801.22, "Text": " they actually detect zero frames."}, {"Time_Start": 802.3000000000001, "Time_End": 803.4000000000001, "Text": " Now, run that test again."}, {"Time_Start": 803.4200000000001, "Time_End": 805.4200000000001, "Text": " against a couple of competitors, and that's indeed what they do."}, {"Time_Start": 809.4200000000001, "Time_End": 811.4200000000001, "Text": " Black ice can handle 148,000 frames per second."}, {"Time_Start": 812.4200000000001, "Time_End": 815.4200000000001, "Text": " This little notebook is a 400 megahertz Pentium 2,"}, {"Time_Start": 816.0200000000001, "Time_End": 820.4200000000001, "Text": " and I've pumped 148,000 frames per second at it with a little smart bits tester."}, {"Time_Start": 821.4200000000001, "Time_End": 822.4200000000001, "Text": " It's actually kind of cool."}, {"Time_Start": 824.4200000000001, "Time_End": 828.4200000000001, "Text": " But that's because the founders of network ice, we come from the sniffer world."}, {"Time_Start": 829.4200000000001, "Time_End": 832.4200000000001, "Text": " And this is the same diagram we would use to describe sniffers."}, {"Time_Start": 833.4200000000001, "Time_End": 835.82, "Text": " We would look at our competitors and we'd say they do the same thing."}, {"Time_Start": 835.9000000000001, "Time_End": 837.94, "Text": " You pump in too much traffic and they go to zero."}, {"Time_Start": 838.98, "Time_End": 841.4000000000001, "Text": " So in network general, we tried to do the same optimizations,"}, {"Time_Start": 841.5600000000001, "Time_End": 846.6, "Text": " has tried to optimize the system to at least fail gracefully when it's going to fail."}, {"Time_Start": 847.44, "Time_End": 852.1, "Text": " Network general started with sniffers on 286s, so on 10-meabit networks."}, {"Time_Start": 852.82, "Time_End": 860.8600000000001, "Text": " The engineer that wrote the drivers for the 286 on 10 megabits is the one who wrote the drivers for 100 megabits at network ice."}, {"Time_Start": 863.4200000000001, "Time_End": 868.0200000000001, "Text": " So how can you generate that? If you're a hacker, you want to flood the system."}, {"Time_Start": 868.6600000000001, "Time_End": 875.1600000000001, "Text": " A lot of DDoS attacks will work if you're trying to attack Yahoo or eBay or E-Tray or all these other major websites."}, {"Time_Start": 875.82, "Time_End": 879.0200000000001, "Text": " And they've got really fast links. They've got gigabit links. How are you going to flood them?"}, {"Time_Start": 879.7400000000001, "Time_End": 882.46, "Text": " One one easy way is with a smurf for a fragile attack."}, {"Time_Start": 883.6600000000001, "Time_End": 893.0200000000001, "Text": " My home network, I'm running off with DSL, and I see this a lot. I see lots of people trying to use my whole area around my home to do these attacks."}, {"Time_Start": 893.4200000000001, "Time_End": 899.6200000000001, "Text": " The way they work is, is the hacker sends in a ping to the broadcast address from my whole area."}, {"Time_Start": 900.32, "Time_End": 904.3000000000001, "Text": " The router then splits that out essentially and sends a ping to everybody in that subnet."}, {"Time_Start": 905.2400000000001, "Time_End": 910.6200000000001, "Text": " Well, by spoofing the IP address of the victim, everyone in that subnet responds to that victim."}, {"Time_Start": 911.22, "Time_End": 917.0200000000001, "Text": " So even though the hacker has maybe a dial-up line, they can do some pretty severe damage against a victim's got a gigabit line."}, {"Time_Start": 918.8000000000001, "Time_End": 923.4000000000001, "Text": " As we do in my home network, my machine, of course, doesn't respond to these pins or to the, to, to,"}, {"Time_Start": 923.4200000000001, "Time_End": 926.8600000000001, "Text": " UDP echoes, but I see the attempts."}, {"Time_Start": 930.96, "Time_End": 937.2, "Text": " Now, let's say that the victim only has a T1 line, and the IDS is behind it on 100 megabit."}, {"Time_Start": 938.1200000000001, "Time_End": 942.44, "Text": " Well, you're not going to be able to overflow, and you can overflow the T1 line, but the IDS itself"}, {"Time_Start": 942.44, "Time_End": 946.1, "Text": " will not be overflowed because it's still only processing 1.5 megabits per second."}, {"Time_Start": 947.2600000000001, "Time_End": 953.4000000000001, "Text": " But you can do a lot of internal smurfs, that you send the smurf inside."}, {"Time_Start": 953.4200000000001, "Time_End": 959.2, "Text": " through to the corporation, and the corporation basically smirks itself in the IDS overloads now in 100-magabit network."}, {"Time_Start": 963.0400000000001, "Time_End": 966.2400000000001, "Text": " A similar technique is jamming. This is like radar jamming."}, {"Time_Start": 967.3600000000001, "Time_End": 973.3600000000001, "Text": " Back in World War II and World War I, when radars were first developed, they equally developed lots of techniques against radars."}, {"Time_Start": 973.6, "Time_End": 975.2800000000001, "Text": " And the easiest way was to jam the radar."}, {"Time_Start": 976.5400000000001, "Time_End": 981.32, "Text": " Flood it with electronic signals that didn't know how they handle or too much signal, and it would basically die."}, {"Time_Start": 983.4200000000001, "Time_End": 988.72, "Text": " You can do this against a lot of IDSs from a dial-up line. You run attacks that generate lots"}, {"Time_Start": 988.72, "Time_End": 993.44, "Text": " and lots of frames with lots and lots of signatures. The IDS has attempt to be really robust"}, {"Time_Start": 993.44, "Time_End": 1002.0400000000001, "Text": " and try to log each and every attack. So you do a decoy scan, which spooks your IP address,"}, {"Time_Start": 1002.0400000000001, "Time_End": 1007.2, "Text": " or run target, which spruce most of its attacks IP addresses, and you just keep running it on"}, {"Time_Start": 1007.2, "Time_End": 1013.2, "Text": " your dial-up line. Eventually, the database will fill up with all these events and keel over."}, {"Time_Start": 1013.4200000000001, "Time_End": 1018.4200000000001, "Text": " A lot of vendors use access databases which keel over really, really easily."}, {"Time_Start": 1018.4200000000001, "Time_End": 1026.42, "Text": " We use, we allow access, but we recommend other databases, real databases."}, {"Time_Start": 1026.42, "Time_End": 1036.42, "Text": " One of our vendor has an interesting message that I found that every single customer that uses this vendor product I've ever talked to"}, {"Time_Start": 1036.42, "Time_End": 1040.42, "Text": " is familiar with this error message, which is DB high watermark reached."}, {"Time_Start": 1040.42, "Time_End": 1042.42, "Text": " There's also a Q overflow message."}, {"Time_Start": 1042.42, "Time_End": 1046.42, "Text": " message. And they all are familiar with this message because they get it."}, {"Time_Start": 1046.42, "Time_End": 1049.42, "Text": " And they have to go in and start cleaning out their database."}, {"Time_Start": 1049.42, "Time_End": 1053.42, "Text": " This is one of the ways that they flee from the field of battle."}, {"Time_Start": 1053.42, "Time_End": 1059.42, "Text": " Another classic evasion technique is Rainforest Puppy's Whisker."}, {"Time_Start": 1059.42, "Time_End": 1065.42, "Text": " It changes the signature of how the attack appears on the wire but doesn't change its meaning."}, {"Time_Start": 1065.42, "Time_End": 1072.4, "Text": " And here's an example of all these attacks are the same. They all mean the first one, which is see"}, {"Time_Start": 1072.42, "Time_End": 1079.42, "Text": " BGIBIN PHF. And it changes this pattern. One way is to use the head command"}, {"Time_Start": 1079.42, "Time_End": 1084.42, "Text": " rather than the get command. It doesn't get the full file, but we'll test to see if it's there."}, {"Time_Start": 1084.42, "Time_End": 1087.42, "Text": " It can often do a lot of buffer overflow exploits with it."}, {"Time_Start": 1087.42, "Time_End": 1092.42, "Text": " You can URL encode the characters, so like percent 63 is a C."}, {"Time_Start": 1092.42, "Time_End": 1099.42, "Text": " You can append some extra slashes, which a lot of web servers just strip out to meaning one slash."}, {"Time_Start": 1099.42, "Time_End": 1102.4, "Text": " You can go descend directories and pop back up."}, {"Time_Start": 1102.42, "Time_End": 1108.42, "Text": " again with a dot dot. So a foobar slash dot means the same as nothing."}, {"Time_Start": 1108.42, "Time_End": 1113.3000000000002, "Text": " You can put a slash and a dot in the middle of it, or a string of these as many as you want,"}, {"Time_Start": 1113.3000000000002, "Time_End": 1119.42, "Text": " and all they really mean is the same directory. So tells the web server go into CGI bin, then go into the same directory."}, {"Time_Start": 1119.42, "Time_End": 1123.42, "Text": " And if you repeat them, it's going to same directory, same directory, and then execute PHF."}, {"Time_Start": 1123.42, "Time_End": 1130.42, "Text": " Another one takes advantage, I believe this is Windows, of putting the percent zero zero, which encodes"}, {"Time_Start": 1130.42, "Time_End": 1131.42, "Text": " in null string."}, {"Time_Start": 1131.42, "Time_End": 1138.42, "Text": " If the HTTP server is doing string copies, it will fail to copy the rest of the string."}, {"Time_Start": 1138.42, "Time_End": 1144.42, "Text": " Or if the web server doesn't do that and doesn't do the string copy, it gets the entire string."}, {"Time_Start": 1144.42, "Time_End": 1150.42, "Text": " But if you do a string copy on the IDS, it will fail to get the entire string and the rest of it's ignored."}, {"Time_Start": 1150.42, "Time_End": 1159.42, "Text": " When RFP released this, he released his original whisker scanner with just the head command as being the IDS evasion technique."}, {"Time_Start": 1159.42, "Time_End": 1160.42, "Text": " And then a few months."}, {"Time_Start": 1160.42, "Time_End": 1163.22, "Text": " And then a few months later, I'm not quite sure how long later,"}, {"Time_Start": 1163.3000000000002, "Time_End": 1169.5, "Text": " he released the next version they had 10 of these style of IDS evasion techniques."}, {"Time_Start": 1169.98, "Time_End": 1173.26, "Text": " Most of them would only work on specific web servers."}, {"Time_Start": 1173.98, "Time_End": 1175.5600000000002, "Text": " These other ones listed here are pretty much generic."}, {"Time_Start": 1177.14, "Time_End": 1182.0800000000002, "Text": " I pull out this, the head, and the two of these are sort of off to the side"}, {"Time_Start": 1182.0800000000002, "Time_End": 1184.26, "Text": " because those are the ones that affected black ice."}, {"Time_Start": 1185.1200000000001, "Time_End": 1188.94, "Text": " I was kind of ticked off on this first release because it immediately evaded us,"}, {"Time_Start": 1188.98, "Time_End": 1190.4, "Text": " and I had to go in and fix the head."}, {"Time_Start": 1190.42, "Time_End": 1191.92, "Text": " and re-release a patch."}, {"Time_Start": 1192.92, "Time_End": 1195.66, "Text": " But then I went through and tried to figure out everything else he might be adding,"}, {"Time_Start": 1195.74, "Time_End": 1198.26, "Text": " because he claimed he's going to add some more IDS evasion techniques."}, {"Time_Start": 1198.7, "Time_End": 1201.6000000000001, "Text": " And I figured out nine of them, but I didn't quite catch the 10th one."}, {"Time_Start": 1203.42, "Time_End": 1209.3400000000001, "Text": " And the cool thing is, is we release patches to our product very quickly after our whisker was released,"}, {"Time_Start": 1209.46, "Time_End": 1210.02, "Text": " both versions."}, {"Time_Start": 1210.76, "Time_End": 1214.5600000000002, "Text": " A lot of vendors today still can't catch these, or at least catch all of them,"}, {"Time_Start": 1214.94, "Time_End": 1219.8000000000002, "Text": " especially if you combine multiple techniques, like encode in URL encoding,"}, {"Time_Start": 1219.8, "Time_End": 1225.1599999999999, "Text": " and then add the dot directory, self-referencing directories."}, {"Time_Start": 1227.86, "Time_End": 1229.98, "Text": " Now, Whisker is just a CGI scanner."}, {"Time_Start": 1230.32, "Time_End": 1234.48, "Text": " It scans a website and looks for a few hundred possible scripts that the website might be running."}, {"Time_Start": 1235.12, "Time_End": 1237.58, "Text": " If you're a script kiddy and you want to break into a website,"}, {"Time_Start": 1237.72, "Time_End": 1239.62, "Text": " this is the first thing you're going to do is run Whisker on it."}, {"Time_Start": 1240.02, "Time_End": 1245.08, "Text": " Find out it's got one of the hundreds of CGI programs vulnerable."}, {"Time_Start": 1245.6399999999999, "Time_End": 1247.56, "Text": " Then you'll exploit that CGI program."}, {"Time_Start": 1248.28, "Time_End": 1249.46, "Text": " When you do the exploit, you have to do the exploit."}, {"Time_Start": 1249.8, "Time_End": 1250.94, "Text": " to do the evasion yourself."}, {"Time_Start": 1251.72, "Time_End": 1259.84, "Text": " Like, in this case, I've shown how to access a website for the PHF and put the self-referencing"}, {"Time_Start": 1259.84, "Time_End": 1264.3799999999999, "Text": " directory, a dot, and then to encode the dot with URL encoding, which comes out as a percent"}, {"Time_Start": 1264.3799999999999, "Time_End": 1264.72, "Text": " 2E."}, {"Time_Start": 1266.1, "Time_End": 1271.44, "Text": " My website actually has a, what looks to be a pHF script on Robertgram.com, which is my website,"}, {"Time_Start": 1272.1399999999999, "Time_End": 1274.8, "Text": " just so I have fun with hackers that try to access it."}, {"Time_Start": 1277.04, "Time_End": 1278.74, "Text": " Actually, I do a lot of stuff in my website."}, {"Time_Start": 1278.74, "Time_End": 1282.74, "Text": " If you scan around, you'll find lots of these little Easter eggs on it."}, {"Time_Start": 1285.7, "Time_End": 1286.96, "Text": " Next classic evasion."}, {"Time_Start": 1287.08, "Time_End": 1290.36, "Text": " Now, I believe somebody yesterday discussed this."}, {"Time_Start": 1290.42, "Time_End": 1293.76, "Text": " I wanted to go to it, but the room was filled, and I couldn't ever get into it,"}, {"Time_Start": 1294.26, "Time_End": 1296.06, "Text": " to see how much of that's overlapping with this."}, {"Time_Start": 1296.1, "Time_End": 1297.3, "Text": " It probably overlaps entirely."}, {"Time_Start": 1298.52, "Time_End": 1299.86, "Text": " You probably show it a lot more techniques."}, {"Time_Start": 1304.56, "Time_End": 1305.96, "Text": " Fed spying on us again."}, {"Time_Start": 1307.88, "Time_End": 1308.72, "Text": " When you write it."}, {"Time_Start": 1308.74, "Time_End": 1318.0, "Text": " Except for Overflow, one characteristic that you see for most of them is that they have these fillers of no-op codes to align where they want to jump into the code."}, {"Time_Start": 1319.1, "Time_End": 1325.46, "Text": " For example, on the x86 architecture, the 90-op code is a no-op. It does nothing."}, {"Time_Start": 1327.22, "Time_End": 1329.4, "Text": " A lot of CPUs have multiple no-op codes."}, {"Time_Start": 1329.4, "Time_End": 1337.24, "Text": " So simply by replacing the standard no-op with a different no-op, you can evade the signature looking for no-op codes."}, {"Time_Start": 1338.74, "Time_End": 1342.1, "Text": " You can also fill it with normal ops, stuff that, you know, actually do things."}, {"Time_Start": 1342.14, "Time_End": 1347.76, "Text": " If you're going to overwrite register, your no-op code could actually just be an increment of the register you're about to overwrite later on."}, {"Time_Start": 1350.08, "Time_End": 1353.08, "Text": " X-86 has lots of no-ops, being a nice little system processor."}, {"Time_Start": 1353.08, "Time_End": 1356.02, "Text": " It, you know, provides us lots of complicated ways to do nothing."}, {"Time_Start": 1359.68, "Time_End": 1368.0, "Text": " Now, if you want to be truly evil, when you do that fill, most of these exploit scripts start with a little fill of fill of all the no-ops."}, {"Time_Start": 1368.74, "Time_End": 1370.74, "Text": " And like this little for loop here."}, {"Time_Start": 1370.74, "Time_End": 1376.74, "Text": " If you want to be nasty, what you do is you create your little table of what you want to be your no-up codes and do a random look-up."}, {"Time_Start": 1376.74, "Time_End": 1380.74, "Text": " So every time you run your script, you'll have a different signature on the wire."}, {"Time_Start": 1380.74, "Time_End": 1387.74, "Text": " So even if I'm looking for certain patterns in no-ops, it still won't work because there are different patterns every single time."}, {"Time_Start": 1387.74, "Time_End": 1395.74, "Text": " And the reason this affects network-based intrusion detection systems is that they're mostly based upon the packet-crep technology,"}, {"Time_Start": 1395.74, "Time_End": 1397.74, "Text": " which is bringing a packet, look for a pattern."}, {"Time_Start": 1397.74, "Time_End": 1398.74, "Text": " look for a pattern."}, {"Time_Start": 1398.74, "Time_End": 1405.74, "Text": " But alternative technology that I know at least one company is using is protocol decoding."}, {"Time_Start": 1405.74, "Time_End": 1408.74, "Text": " It doesn't really care about the exact pattern that you're using."}, {"Time_Start": 1408.74, "Time_End": 1412.74, "Text": " What it cares about is that you're doing something suspicious."}, {"Time_Start": 1412.74, "Time_End": 1417.74, "Text": " In this case, if you're doing a buffer overflow attack against a POP3 server,"}, {"Time_Start": 1417.74, "Time_End": 1425.74, "Text": " rather than looking for the actual overflow itself, you say, hey, he's just entered in a username that's 1,000 characters long."}, {"Time_Start": 1425.74, "Time_End": 1426.74, "Text": " And it's got some binary in the username."}, {"Time_Start": 1426.74, "Time_End": 1430.74, "Text": " in the username. This is something extremely suspicious."}, {"Time_Start": 1430.74, "Time_End": 1435.74, "Text": " Now, you can, you know, evade that actual pattern of buffer overflow all you want."}, {"Time_Start": 1435.74, "Time_End": 1439.74, "Text": " We still detect the fact that you've got the suspiciously long username."}, {"Time_Start": 1439.74, "Time_End": 1446.74, "Text": " As I mentioned before, a lot of these intrusion detection systems"}, {"Time_Start": 1446.74, "Time_End": 1452.74, "Text": " have a long list of ports that are suspicious ports, like back orifice is 31337."}, {"Time_Start": 1452.74, "Time_End": 1456.72, "Text": " Sub 7 uses two different ports. But these things can run"}, {"Time_Start": 1456.74, "Time_End": 1458.74, "Text": " any port."}, {"Time_Start": 1458.74, "Time_End": 1461.74, "Text": " If you look on your firewall logs right now,"}, {"Time_Start": 1461.74, "Time_End": 1466.74, "Text": " you'll see lots of scans for port 27374 and 1243"}, {"Time_Start": 1466.74, "Time_End": 1469.74, "Text": " for the sub seven Trojan horse."}, {"Time_Start": 1469.74, "Time_End": 1471.74, "Text": " And you're seeing lots and lots and lots of these scans."}, {"Time_Start": 1471.74, "Time_End": 1474.74, "Text": " So you're thinking, I see so many of these scans,"}, {"Time_Start": 1474.74, "Time_End": 1477.74, "Text": " it must be that everyone's running sub seven on the default ports."}, {"Time_Start": 1477.74, "Time_End": 1482.74, "Text": " But actually looking at our own, what we've seen on the net,"}, {"Time_Start": 1482.74, "Time_End": 1486.74, "Text": " is that most successful compromises are actually at"}, {"Time_Start": 1486.74, "Time_End": 1490.74, "Text": " non-default ports with non-default passwords."}, {"Time_Start": 1490.74, "Time_End": 1493.74, "Text": " And we can see this sort of stuff because we run on some ISP"}, {"Time_Start": 1493.74, "Time_End": 1497.74, "Text": " backbones, and our customer base actually sends us a large number of these files"}, {"Time_Start": 1497.74, "Time_End": 1500.74, "Text": " when our product detects affect that they've been exploited."}, {"Time_Start": 1500.74, "Time_End": 1508.74, "Text": " So the real danger is that you've got these Trojan horses running on non-default ports,"}, {"Time_Start": 1508.74, "Time_End": 1511.74, "Text": " and the default ports are just noise."}, {"Time_Start": 1511.74, "Time_End": 1515.74, "Text": " And the reason they're so commonly is not because people are running at those ports,"}, {"Time_Start": 1515.74, "Time_End": 1516.74, "Text": " is because the same ports."}, {"Time_Start": 1516.74, "Time_End": 1520.74, "Text": " scanner, the sub seven itself contains a built-in scanner."}, {"Time_Start": 1520.74, "Time_End": 1524.74, "Text": " I compromise one person, and the first thing I do is I tell that one person to scan the whole internet"}, {"Time_Start": 1524.74, "Time_End": 1527.74, "Text": " looking for other possible victims."}, {"Time_Start": 1527.74, "Time_End": 1531.74, "Text": " It rarely finds them, though, at the default ports."}, {"Time_Start": 1531.74, "Time_End": 1539.74, "Text": " The way these Trojan infections work is that a hacker wants to get the Trojan on your computer."}, {"Time_Start": 1539.74, "Time_End": 1542.74, "Text": " It might do so by posting to Usenet."}, {"Time_Start": 1542.74, "Time_End": 1545.74, "Text": " Some victims, somewhere in the world, unrelated to the HACTA,"}, {"Time_Start": 1545.74, "Time_End": 1548.74, "Text": " unrelated to the hacker, goes to the Usenet Group, says,"}, {"Time_Start": 1548.74, "Time_End": 1551.74, "Text": " hey, this is a great new porn picture viewer or something,"}, {"Time_Start": 1551.74, "Time_End": 1555.74, "Text": " downloads the program, runs it, and infects themselves."}, {"Time_Start": 1555.74, "Time_End": 1559.74, "Text": " Now, if it's drawing a non-default port or a non-default password,"}, {"Time_Start": 1559.74, "Time_End": 1562.74, "Text": " one way that the hacker can find who that is"}, {"Time_Start": 1562.74, "Time_End": 1565.74, "Text": " is by telling the Trojan horse to notify them."}, {"Time_Start": 1565.74, "Time_End": 1568.74, "Text": " And you can't notify a hacker directly because then it's like a clear"}, {"Time_Start": 1568.74, "Time_End": 1570.74, "Text": " finger pointing for the feds to follow."}, {"Time_Start": 1570.74, "Time_End": 1573.74, "Text": " So instead, the hacker has them notify a third party,"}, {"Time_Start": 1573.74, "Time_End": 1575.74, "Text": " which can be done with email,"}, {"Time_Start": 1575.74, "Time_End": 1579.74, "Text": " IRC, ICQ, or a number of other options."}, {"Time_Start": 1579.74, "Time_End": 1585.74, "Text": " The hacker then logs on to that third party system and find the victims that have all notified themselves to him."}, {"Time_Start": 1585.74, "Time_End": 1592.74, "Text": " At that point, he uses the password and port number to break into the victim's machine."}, {"Time_Start": 1592.74, "Time_End": 1601.74, "Text": " This is the sub seven edit server program, which sets all these values of how it's going to actually compromise the person."}, {"Time_Start": 1601.74, "Time_End": 1604.74, "Text": " You can see that it will notify via ICQ, via IRC,"}, {"Time_Start": 1604.74, "Time_End": 1611.74, "Text": " IRC, which IRC servers, email systems, and so forth."}, {"Time_Start": 1611.74, "Time_End": 1616.74, "Text": " One of the cool things it has is that it can use a random port on startup,"}, {"Time_Start": 1616.74, "Time_End": 1619.74, "Text": " which means every time it runs, it's going to run at a different port."}, {"Time_Start": 1619.74, "Time_End": 1623.74, "Text": " So that there's no amount of scanning for ports they'll ever find this system"}, {"Time_Start": 1623.74, "Time_End": 1625.74, "Text": " because they'll always run at some other port."}, {"Time_Start": 1625.74, "Time_End": 1628.74, "Text": " But yet, having an IRC notify is,"}, {"Time_Start": 1628.74, "Time_End": 1632.74, "Text": " we'll always tell the hacker exactly which ports currently in use."}, {"Time_Start": 1632.74, "Time_End": 1634.74, "Text": " So even if you're a user with a user with a,"}, {"Time_Start": 1634.74, "Time_End": 1637.74, "Text": " with a notebook computer maybe on the road dialing up,"}, {"Time_Start": 1637.74, "Time_End": 1641.24, "Text": " every time you dial up, you notify the hacker where you are,"}, {"Time_Start": 1641.24, "Time_End": 1644.24, "Text": " and he'll come find you."}, {"Time_Start": 1644.24, "Time_End": 1648.24, "Text": " It's, from our own evidence, it looks like the IRC is the most popular way"}, {"Time_Start": 1648.24, "Time_End": 1649.24, "Text": " for notifying the hacker."}, {"Time_Start": 1649.24, "Time_End": 1657.24, "Text": " So those are the standard evasion techniques that people are using today."}, {"Time_Start": 1657.24, "Time_End": 1659.24, "Text": " They're very simple to use."}, {"Time_Start": 1659.24, "Time_End": 1662.24, "Text": " It's not really too difficult."}, {"Time_Start": 1662.24, "Time_End": 1664.24, "Text": " Now we get into some Uber evasion."}, {"Time_Start": 1664.24, "Time_End": 1665.86, "Text": " techniques."}, {"Time_Start": 1667.06, "Time_End": 1668.34, "Text": " First is the theory."}, {"Time_Start": 1669.14, "Time_End": 1674.74, "Text": " As I just mentioned before, packet grep systems are looking on the wire for patterns."}, {"Time_Start": 1676.24, "Time_End": 1680.74, "Text": " Logically, according to the OSI model, that belongs in the presentation layer."}, {"Time_Start": 1681.84, "Time_End": 1684.94, "Text": " The OSI model was this model developed back in the 80s."}, {"Time_Start": 1684.94, "Time_End": 1690.42, "Text": " It's a very big bureaucratic process, and it's supposed to be the overall end-all of describing how"}, {"Time_Start": 1690.42, "Time_End": 1692.06, "Text": " technologies like this should work."}, {"Time_Start": 1692.86, "Time_End": 1694.22, "Text": " It tries to find, okay, it lay our..."}, {"Time_Start": 1694.24, "Time_End": 1696.78, "Text": " one, you're worried about cabling, getting the bits across the wire."}, {"Time_Start": 1697.34, "Time_End": 1701.74, "Text": " Label 2 is getting two machines to actually talk and send data to each other"}, {"Time_Start": 1701.74, "Time_End": 1705.08, "Text": " and getting frames, what they call, across the wire."}, {"Time_Start": 1705.54, "Time_End": 1709.68, "Text": " Layer 3 is getting IP end-to-end across the entire Internet, done just locally."}, {"Time_Start": 1710.66, "Time_End": 1712.86, "Text": " TCP is getting two applications to talk to each other."}, {"Time_Start": 1713.96, "Time_End": 1717.5, "Text": " The session layer is this meaningless thing that everyone actually never turned out to be worthwhile"}, {"Time_Start": 1717.5, "Time_End": 1719.04, "Text": " in practice and no one ever uses it."}, {"Time_Start": 1720.08, "Time_End": 1724.22, "Text": " The presentation layer, by the way, there's lots of books about OSI."}, {"Time_Start": 1724.24, "Time_End": 1727.24, "Text": " model and when you look for the description of the session layer always"}, {"Time_Start": 1727.24, "Time_End": 1729.88, "Text": " comes down down to two things the session layer is something that manages"}, {"Time_Start": 1729.88, "Time_End": 1733.48, "Text": " sessions but what's a session well it's in one of these things that you get in the"}, {"Time_Start": 1733.48, "Time_End": 1738.52, "Text": " session layer and so I I've looked the other time I find a new book on the OSI"}, {"Time_Start": 1738.52, "Time_End": 1742.06, "Text": " model I look to see if they've actually defined it any way it's not circular I never"}, {"Time_Start": 1742.06, "Time_End": 1746.32, "Text": " found one that does well I found one a long time ago and really a session layer came"}, {"Time_Start": 1746.32, "Time_End": 1750.1200000000001, "Text": " from these old teletype terminal type things and there are some concepts in"}, {"Time_Start": 1750.1200000000001, "Time_End": 1754.22, "Text": " there that never apply outside of that environment so then there's the press"}, {"Time_Start": 1754.24, "Time_End": 1759.24, "Text": " And back in the OSI model, they wanted to negotiate the presentation layer."}, {"Time_Start": 1759.24, "Time_End": 1764.24, "Text": " But really lots of protocols have a presentation layer, even though it's not really a separate entity."}, {"Time_Start": 1764.24, "Time_End": 1768.24, "Text": " And all it's specifying is how data is formatted across the network."}, {"Time_Start": 1768.24, "Time_End": 1775.24, "Text": " For example, in SMTP, it might be the mime encoding, sort of a presentation layer type concept."}, {"Time_Start": 1775.24, "Time_End": 1781.24, "Text": " And the application layer is the mail, the IRC, FTP, web, and so forth."}, {"Time_Start": 1784.24, "Time_End": 1789.24, "Text": " RPC has a very distinctive presentation layer."}, {"Time_Start": 1789.24, "Time_End": 1795.24, "Text": " One of the lesser known things about that layer is something called record marking."}, {"Time_Start": 1795.24, "Time_End": 1799.24, "Text": " When you send RPC packets across a TCP connection,"}, {"Time_Start": 1799.24, "Time_End": 1805.24, "Text": " TCP creates this virtual byte stream, so you must know when a command ends and begins."}, {"Time_Start": 1805.24, "Time_End": 1809.24, "Text": " And so they do that with this record marking code."}, {"Time_Start": 1809.24, "Time_End": 1814.24, "Text": " Now lots of protocols do this, but what RPC has added to the whole mix,"}, {"Time_Start": 1814.24, "Time_End": 1818.24, "Text": " is the ability to fragment the records."}, {"Time_Start": 1818.24, "Time_End": 1821.24, "Text": " So most protocols, when running over TCP, they have a length field."}, {"Time_Start": 1821.24, "Time_End": 1824.24, "Text": " That's the first field that says the length of the command."}, {"Time_Start": 1824.24, "Time_End": 1827.24, "Text": " So even though TCP might segment it out into multiple packets,"}, {"Time_Start": 1827.24, "Time_End": 1830.24, "Text": " they know exactly how many bytes are in that command."}, {"Time_Start": 1830.24, "Time_End": 1835.24, "Text": " TCP adds something where you can send multiple of these length encoded items"}, {"Time_Start": 1835.24, "Time_End": 1840.24, "Text": " that all then combine back into the common original record."}, {"Time_Start": 1840.24, "Time_End": 1843.24, "Text": " And the way that would work,"}, {"Time_Start": 1843.24, "Time_End": 1848.24, "Text": " And the way that would work is in this little diagram here I have the normal record,"}, {"Time_Start": 1848.24, "Time_End": 1853.24, "Text": " which is the RPC command in white, which is prefixed with a 4 byte length field."}, {"Time_Start": 1853.24, "Time_End": 1859.24, "Text": " The top bit of that length field says whether there will be another,"}, {"Time_Start": 1859.24, "Time_End": 1866.24, "Text": " whether it's the last fragment of this record or whether more fragments follow across the TCP connection."}, {"Time_Start": 1866.24, "Time_End": 1873.24, "Text": " So I split in this case in this diagram that white command into two fragments, each with a"}, {"Time_Start": 1873.24, "Time_End": 1880.24, "Text": " own record mark. The first one says that another record fragment follows, and the last one says,"}, {"Time_Start": 1880.24, "Time_End": 1883.24, "Text": " that's the last fragment in the whole stream."}, {"Time_Start": 1883.24, "Time_End": 1892.24, "Text": " Now, if you want to be nasty, you want to randomly combine the TCP layer segmenting"}, {"Time_Start": 1892.24, "Time_End": 1896.24, "Text": " and the RPC layer record marking."}, {"Time_Start": 1896.24, "Time_End": 1902.24, "Text": " And then one of the cool things is, normally, in normal traffic, these things are always working together."}, {"Time_Start": 1902.24, "Time_End": 1908.24, "Text": " together. You see a TCP segment across the wire, it always starts with a record mark, but doesn't have to be."}, {"Time_Start": 1908.24, "Time_End": 1916.24, "Text": " So in this third little diagram here, I show where I fragmented the TCP segments separately from the record marking segments."}, {"Time_Start": 1916.24, "Time_End": 1922.24, "Text": " So I'm sending four TCP segments for that original request."}, {"Time_Start": 1926.24, "Time_End": 1931.24, "Text": " So the upside of that is, is that you're not going to find a traditional RPC pattern,"}, {"Time_Start": 1931.24, "Time_End": 1935.24, "Text": " pattern in that TCP connection."}, {"Time_Start": 1935.24, "Time_End": 1937.24, "Text": " So I wrote a little code."}, {"Time_Start": 1937.24, "Time_End": 1940.24, "Text": " I'll be posting this to my website after DefCon."}, {"Time_Start": 1940.24, "Time_End": 1944.24, "Text": " And what it does is you replace your traditional socket send function"}, {"Time_Start": 1944.24, "Time_End": 1949.24, "Text": " that sends the data across the wire in your exploit script with MySend."}, {"Time_Start": 1949.24, "Time_End": 1954.24, "Text": " What MySend does is it randomizes where it's going to record mark and fragment the stuff"}, {"Time_Start": 1954.24, "Time_End": 1958.24, "Text": " and where it's going to segment at the TCP layer."}, {"Time_Start": 1958.24, "Time_End": 1961.24, "Text": " If you're familiar with RPP,"}, {"Time_Start": 1961.24, "Time_End": 1968.24, "Text": " it has, XDR has this very distinctive rule that everything has to be fragmented on four,"}, {"Time_Start": 1968.24, "Time_End": 1971.24, "Text": " or everything has to be on four-byte boundaries."}, {"Time_Start": 1971.24, "Time_End": 1975.24, "Text": " So all integers must be four bytes. You can't have a three-byte integer."}, {"Time_Start": 1975.24, "Time_End": 1980.24, "Text": " A string of someone's name that's nine bytes long has to be padded out to an even 12 bytes"}, {"Time_Start": 1980.24, "Time_End": 1982.24, "Text": " with nulls at the end."}, {"Time_Start": 1982.24, "Time_End": 1986.24, "Text": " But that XDR restriction does not apply to record marking."}, {"Time_Start": 1986.24, "Time_End": 1991.24, "Text": " I point this out because the first time I did the anti-evasion start"}, {"Time_Start": 1991.24, "Time_End": 1994.24, "Text": " in black ice, I made the assumption that was XDR."}, {"Time_Start": 1994.24, "Time_End": 1997.24, "Text": " And then I played around with the spec, realized it didn't have to apply,"}, {"Time_Start": 1997.24, "Time_End": 1999.24, "Text": " try it out on the exploit script, and sure enough, it evaded,"}, {"Time_Start": 1999.24, "Time_End": 2002.24, "Text": " so I had to change my code yet again."}, {"Time_Start": 2002.24, "Time_End": 2006.24, "Text": " So anyway, so we call the MySend function instead of your normal send function"}, {"Time_Start": 2006.24, "Time_End": 2008.24, "Text": " that you have as part of your exploit script."}, {"Time_Start": 2008.24, "Time_End": 2014.24, "Text": " It calls the MySend upper function, which adds the record marking stuff to it"}, {"Time_Start": 2014.24, "Time_End": 2020.24, "Text": " with a random length field, and then passes it to the TCP layer."}, {"Time_Start": 2020.24, "Time_End": 2025.24, "Text": " where I again then randomize how long a TCP segment is going to be."}, {"Time_Start": 2025.24, "Time_End": 2032.24, "Text": " I also put a little random sleep time there, so if you're trying to find, you know, the traffic over time, that messes up too."}, {"Time_Start": 2032.24, "Time_End": 2035.24, "Text": " And what I come up with is something that looks like this,"}, {"Time_Start": 2035.24, "Time_End": 2040.24, "Text": " is randomize where I'm going to record frag and randomize where I'm going to TCP segment."}, {"Time_Start": 2040.24, "Time_End": 2047.24, "Text": " So if my original command is like a port dump command,"}, {"Time_Start": 2047.24, "Time_End": 2050.18, "Text": " a port dump command, is a scanning technique, you scan an RPC"}, {"Time_Start": 2050.2400000000002, "Time_End": 2053.2400000000002, "Text": " server and ask it what services are running."}, {"Time_Start": 2053.2400000000002, "Time_End": 2056.2400000000002, "Text": " This is how you hunt down to see which ones might be vulnerable that you're going to exploit"}, {"Time_Start": 2056.2400000000002, "Time_End": 2059.2400000000002, "Text": " with buffer overflow exploits."}, {"Time_Start": 2059.2400000000002, "Time_End": 2062.2400000000002, "Text": " This is what the packet looks like in hex."}, {"Time_Start": 2062.2400000000002, "Time_End": 2066.2400000000002, "Text": " Right below it is a decode. The first four bytes are that record frag."}, {"Time_Start": 2066.2400000000002, "Time_End": 2070.2400000000002, "Text": " The byte, the first byte, is that little bit saying that there's,"}, {"Time_Start": 2070.2400000000002, "Time_End": 2073.2400000000002, "Text": " it's the last record frag in the sequence,"}, {"Time_Start": 2073.2400000000002, "Time_End": 2077.2400000000002, "Text": " because it normally doesn't record frag on requests."}, {"Time_Start": 2077.2400000000002, "Time_End": 2080.2200000000003, "Text": " Then you have the XID, the message type, it calls this RPC"}, {"Time_Start": 2080.2400000000002, "Time_End": 2083.2400000000002, "Text": " version 2, which is all RPC we use today."}, {"Time_Start": 2083.2400000000002, "Time_End": 2084.2400000000002, "Text": " It's a port map command."}, {"Time_Start": 2084.2400000000002, "Time_End": 2086.2400000000002, "Text": " It's port map version 2."}, {"Time_Start": 2086.2400000000002, "Time_End": 2088.2400000000002, "Text": " The procedure is dump, which is procedure number 4."}, {"Time_Start": 2088.2400000000002, "Time_End": 2090.2400000000002, "Text": " There's no authentication or verification."}, {"Time_Start": 2090.2400000000002, "Time_End": 2094.2400000000002, "Text": " Here's what it looks like after it gets through the MySend functions."}, {"Time_Start": 2094.2400000000002, "Time_End": 2098.2400000000002, "Text": " The first packet has a TCP segment of 0 and 0."}, {"Time_Start": 2098.2400000000002, "Time_End": 2102.2400000000002, "Text": " The next packet has a TCP segment of 0, 5,"}, {"Time_Start": 2102.2400000000002, "Time_End": 2104.2400000000002, "Text": " and so on and so forth."}, {"Time_Start": 2104.2400000000002, "Time_End": 2108.2400000000002, "Text": " Those first 4 bytes, of course, are the record marking stuff."}, {"Time_Start": 2108.2400000000002, "Time_End": 2110.2400000000002, "Text": " Where I randomly chosen that the first record is going to be"}, {"Time_Start": 2110.2400000000002, "Time_End": 2120.2400000000002, "Text": " five bytes long, and even by the randomization of the packet, even that record mark itself was segmented in the TCP segments."}, {"Time_Start": 2120.2400000000002, "Time_End": 2126.2400000000002, "Text": " So I have about 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 60, 7."}, {"Time_Start": 2126.2400000000002, "Time_End": 2130.2400000000002, "Text": " So I've got 17 packets there, where originally I had only one packet."}, {"Time_Start": 2130.2400000000002, "Time_End": 2136.2400000000002, "Text": " It's also about 70 bytes long, where the original packet was about 40 bytes long."}, {"Time_Start": 2136.2400000000002, "Time_End": 2139.7400000000002, "Text": " And this, of course, gives IDS's fits."}, {"Time_Start": 2140.2400000000002, "Time_End": 2144.2400000000002, "Text": " Most IDES still don't reassemble TCP streams, but even if they did,"}, {"Time_Start": 2144.2400000000002, "Time_End": 2148.2400000000002, "Text": " the stream wouldn't look like anything like they've ever seen with RPC."}, {"Time_Start": 2148.2400000000002, "Time_End": 2151.2400000000002, "Text": " So they don't detect the port map attack."}, {"Time_Start": 2151.2400000000002, "Time_End": 2153.2400000000002, "Text": " Now, I've tried us against the number of the other IDS."}, {"Time_Start": 2153.2400000000002, "Time_End": 2158.2400000000002, "Text": " Sure enough, they detect the normal one, but they don't detect the evaded one."}, {"Time_Start": 2158.2400000000002, "Time_End": 2165.2400000000002, "Text": " And this was particularly important because of the way that a lot of IDS's work,"}, {"Time_Start": 2165.2400000000002, "Time_End": 2169.2400000000002, "Text": " well, I assume they work with RPC."}, {"Time_Start": 2169.2400000000002, "Time_End": 2175.2400000000002, "Text": " Its RPC runs its services at random ports, like CMSD, calendar messenger service,"}, {"Time_Start": 2175.2400000000002, "Time_End": 2179.2400000000002, "Text": " that a lot of Solaris machines fell victim to last year,"}, {"Time_Start": 2179.2400000000002, "Time_End": 2182.2400000000002, "Text": " runs at a randomly chosen port."}, {"Time_Start": 2182.2400000000002, "Time_End": 2185.2400000000002, "Text": " When it starts up, it registered with portmapper at the well-known port of 111"}, {"Time_Start": 2185.2400000000002, "Time_End": 2188.2400000000002, "Text": " and tells it which port it's running at."}, {"Time_Start": 2188.2400000000002, "Time_End": 2191.2400000000002, "Text": " Back at Network General when we worked in the sniffer,"}, {"Time_Start": 2191.2400000000002, "Time_End": 2195.2400000000002, "Text": " the way we got around this fact was by using a heuristic called Smells Like,"}, {"Time_Start": 2195.2400000000002, "Time_End": 2198.2400000000002, "Text": " where we looked at an RPC request and say, does this look like an RPC request?"}, {"Time_Start": 2198.2400000000002, "Time_End": 2199.2400000000002, "Text": " request."}, {"Time_Start": 2199.2400000000002, "Time_End": 2202.2400000000002, "Text": " RPC is kind of cool because it's very distinctive."}, {"Time_Start": 2202.2400000000002, "Time_End": 2204.2400000000002, "Text": " You have that record mark."}, {"Time_Start": 2204.2400000000002, "Time_End": 2206.2400000000002, "Text": " You have the XID, which is random."}, {"Time_Start": 2206.2400000000002, "Time_End": 2208.2400000000002, "Text": " The message type is either 0 or 1."}, {"Time_Start": 2208.2400000000002, "Time_End": 2211.2400000000002, "Text": " So you've got 4 bytes that are either going to be 0 or 1."}, {"Time_Start": 2211.2400000000002, "Time_End": 2214.2400000000002, "Text": " RPC version is always 2, so that field must be 2."}, {"Time_Start": 2214.2400000000002, "Time_End": 2218.2400000000002, "Text": " And so on and so forth, we can really distinctively say 99.9% of the time,"}, {"Time_Start": 2218.2400000000002, "Time_End": 2221.2400000000002, "Text": " whether it's RPC."}, {"Time_Start": 2221.2400000000002, "Time_End": 2224.2400000000002, "Text": " But in this packet, those rules don't apply."}, {"Time_Start": 2224.2400000000002, "Time_End": 2227.2400000000002, "Text": " It looks nothing like RPC anymore, according to those heuristics."}, {"Time_Start": 2227.2400000000002, "Time_End": 2235.2400000000002, "Text": " and Euristics that tried to deal with the record mark can always be evaded by carefully constructing your record to look like something else."}, {"Time_Start": 2235.2400000000002, "Time_End": 2242.2400000000002, "Text": " So the only way to get around that is the IDS needs to not use those he restricts"}, {"Time_Start": 2242.2400000000002, "Time_End": 2245.2400000000002, "Text": " and must instead keep a lot more state around."}, {"Time_Start": 2245.2400000000002, "Time_End": 2249.2400000000002, "Text": " Must profile the target to say, I've seen a port map response come back,"}, {"Time_Start": 2249.2400000000002, "Time_End": 2252.2400000000002, "Text": " therefore I know which ports all the services are running out."}, {"Time_Start": 2252.2400000000002, "Time_End": 2256.2400000000002, "Text": " So that's RPC record fragging."}, {"Time_Start": 2256.2400000000002, "Time_End": 2257.2400000000002, "Text": " That was a suggestion."}, {"Time_Start": 2257.2400000000002, "Time_End": 2260.2400000000002, "Text": " to me by Doug Song, who wrote the original frag router."}, {"Time_Start": 2260.2400000000002, "Time_End": 2263.2400000000002, "Text": " He's working on like a frag proxy, or I'm not quite sure what he's working on,"}, {"Time_Start": 2263.2400000000002, "Time_End": 2265.2400000000002, "Text": " that will do this automatically for you,"}, {"Time_Start": 2265.2400000000002, "Time_End": 2269.2400000000002, "Text": " whereas my code you have to sort of add to your script and change the script."}, {"Time_Start": 2269.2400000000002, "Time_End": 2274.2400000000002, "Text": " The next one is something that I discovered myself,"}, {"Time_Start": 2274.2400000000002, "Time_End": 2279.2400000000002, "Text": " where I'm using the telnet channel on FTP."}, {"Time_Start": 2279.2400000000002, "Time_End": 2285.2400000000002, "Text": " If you read the FTP specification, it says that the control channel is really telnet."}, {"Time_Start": 2285.2400000000002, "Time_End": 2287.2400000000002, "Text": " Now, the later on,"}, {"Time_Start": 2287.2400000000002, "Time_End": 2290.2400000000002, "Text": " host requirements RFC says, no, it's really not Telnet."}, {"Time_Start": 2290.2400000000002, "Time_End": 2292.2400000000002, "Text": " It's just something that looks a lot like Telnet,"}, {"Time_Start": 2292.2400000000002, "Time_End": 2297.2400000000002, "Text": " using the same option strings, the out-of-band option communication."}, {"Time_Start": 2297.2400000000002, "Time_End": 2303.2400000000002, "Text": " What Telnet has is strings that start with FF, a byte with all ones,"}, {"Time_Start": 2303.2400000000002, "Time_End": 2306.2400000000002, "Text": " followed by either one or two bytes of the option code."}, {"Time_Start": 2306.2400000000002, "Time_End": 2308.2400000000002, "Text": " And in the Telnet usage is really complex,"}, {"Time_Start": 2308.2400000000002, "Time_End": 2312.2400000000002, "Text": " you can negotiate which terminal you are, what your backspace character is going to be,"}, {"Time_Start": 2312.2400000000002, "Time_End": 2314.2400000000002, "Text": " and a lot of other stuff."}, {"Time_Start": 2314.2400000000002, "Time_End": 2317.2400000000002, "Text": " In the normal Telnet environment,"}, {"Time_Start": 2317.2400000000002, "Time_End": 2321.2400000000002, "Text": " that issue is so bad, you can basically avoid any IDS detection on the Telnet channel."}, {"Time_Start": 2321.2400000000002, "Time_End": 2325.2400000000002, "Text": " You can reconfigure your backspace character to be Q or something like that."}, {"Time_Start": 2325.2400000000002, "Time_End": 2331.2400000000002, "Text": " So the IDS is seeing a string of cues, but the target system is seeing a string of backspaces."}, {"Time_Start": 2331.2400000000002, "Time_End": 2335.2400000000002, "Text": " But in the FTP case, none of that can be negotiated."}, {"Time_Start": 2335.2400000000002, "Time_End": 2338.2400000000002, "Text": " All they can negotiate is whether to use the abort option,"}, {"Time_Start": 2338.2400000000002, "Time_End": 2340.2400000000002, "Text": " the abort Telnet option code."}, {"Time_Start": 2340.2400000000002, "Time_End": 2342.2400000000002, "Text": " Everything else is a null option."}, {"Time_Start": 2342.2400000000002, "Time_End": 2346.2400000000002, "Text": " So an FF followed by any other byte is pretty much ignored in the FTP command channel."}, {"Time_Start": 2346.2400000000002, "Time_End": 2348.2400000000002, "Text": " the command channel."}, {"Time_Start": 2348.2400000000002, "Time_End": 2352.2400000000002, "Text": " So when you log on as, in this case, user Rob,"}, {"Time_Start": 2352.2400000000002, "Time_End": 2355.2400000000002, "Text": " you can put in that FF and then another byte."}, {"Time_Start": 2355.2400000000002, "Time_End": 2358.2400000000002, "Text": " The F1 is the Telnet Noop code."}, {"Time_Start": 2358.2400000000002, "Time_End": 2362.2400000000002, "Text": " But any byte will do because it will strip it out and ignore it."}, {"Time_Start": 2362.2400000000002, "Time_End": 2365.2400000000002, "Text": " So instead of seeing user Rob, you see this user, you know, garbage rob,"}, {"Time_Start": 2365.2400000000002, "Time_End": 2368.2400000000002, "Text": " and it's past like garbage and foo."}, {"Time_Start": 2368.2400000000002, "Time_End": 2372.2400000000002, "Text": " And this is a lot like, conceptually like RPC."}, {"Time_Start": 2372.2400000000002, "Time_End": 2375.2400000000002, "Text": " It's at the presentation layer of the OSI model."}, {"Time_Start": 2375.2400000000002, "Time_End": 2376.2400000000002, "Text": " I'm changing how."}, {"Time_Start": 2376.2400000000002, "Time_End": 2378.2400000000002, "Text": " formatting this stuff."}, {"Time_Start": 2378.2400000000002, "Time_End": 2382.2400000000002, "Text": " So you think through all of the"}, {"Time_Start": 2382.2400000000002, "Time_End": 2384.2400000000002, "Text": " the exploits that FTP can do,"}, {"Time_Start": 2384.2400000000002, "Time_End": 2387.2400000000002, "Text": " they're all pretty much run across the control channel."}, {"Time_Start": 2387.2400000000002, "Time_End": 2390.2400000000002, "Text": " Like bounce scans, the TAR compress,"}, {"Time_Start": 2390.2400000000002, "Time_End": 2392.2400000000002, "Text": " execute bug, buffer overflows,"}, {"Time_Start": 2392.2400000000002, "Time_End": 2394.2400000000002, "Text": " change working directory to routes,"}, {"Time_Start": 2394.2400000000002, "Time_End": 2397.2400000000002, "Text": " logging on with using the in password,"}, {"Time_Start": 2397.2400000000002, "Time_End": 2400.2400000000002, "Text": " a site exec has been a lot of site exec to holes lately,"}, {"Time_Start": 2400.2400000000002, "Time_End": 2403.2400000000002, "Text": " printout format bugs, shell characters, and so forth."}, {"Time_Start": 2403.2400000000002, "Time_End": 2405.2400000000002, "Text": " Now, as it's working,"}, {"Time_Start": 2405.2400000000002, "Time_End": 2407.2400000000002, "Text": " Now, as I was working on this and testing it out,"}, {"Time_Start": 2407.2400000000002, "Time_End": 2409.2400000000002, "Text": " I found a number of problems."}, {"Time_Start": 2409.2400000000002, "Time_End": 2412.2400000000002, "Text": " Unix supports this three-character"}, {"Time_Start": 2412.2400000000002, "Time_End": 2415.2400000000002, "Text": " do-don't command negotiation,"}, {"Time_Start": 2415.2400000000002, "Time_End": 2417.2400000000002, "Text": " where the client logs on and says,"}, {"Time_Start": 2417.2400000000002, "Time_End": 2419.2400000000002, "Text": " I want to do something or other."}, {"Time_Start": 2419.2400000000002, "Time_End": 2421.2400000000002, "Text": " And the server comes back and says,"}, {"Time_Start": 2421.2400000000002, "Time_End": 2423.2400000000002, "Text": " no, I don't support that, or I do support it."}, {"Time_Start": 2423.2400000000002, "Time_End": 2427.2400000000002, "Text": " And a cool thing about that is, is you can desynchronize"}, {"Time_Start": 2427.2400000000002, "Time_End": 2429.2400000000002, "Text": " an IDS because you can start up and say,"}, {"Time_Start": 2429.2400000000002, "Time_End": 2431.2400000000002, "Text": " send the do command,"}, {"Time_Start": 2431.2400000000002, "Time_End": 2433.2400000000002, "Text": " FTP comes back and says, won't."}, {"Time_Start": 2433.2400000000002, "Time_End": 2435.2400000000002, "Text": " The FTP, by the way, the specification,"}, {"Time_Start": 2435.2400000000002, "Time_End": 2439.2400000000002, "Text": " now with host requirements, RC, says that it should respond with the won't for everything,"}, {"Time_Start": 2439.2400000000002, "Time_End": 2441.2400000000002, "Text": " because it shouldn't really support Telnet."}, {"Time_Start": 2441.2400000000002, "Time_End": 2445.2400000000002, "Text": " So you can send, you can pepper your code with these,"}, {"Time_Start": 2445.2400000000002, "Time_End": 2447.2400000000002, "Text": " like you can send a command like user password,"}, {"Time_Start": 2447.2400000000002, "Time_End": 2451.2400000000002, "Text": " and the middle of that user string send the do command,"}, {"Time_Start": 2451.2400000000002, "Time_End": 2453.2400000000002, "Text": " and you'll get back to this don't command,"}, {"Time_Start": 2453.2400000000002, "Time_End": 2456.2400000000002, "Text": " and it'll really confuse the IDS."}, {"Time_Start": 2456.2400000000002, "Time_End": 2460.2400000000002, "Text": " Unfortunately, Windows FTP implementation from Microsoft"}, {"Time_Start": 2460.2400000000002, "Time_End": 2464.2400000000002, "Text": " doesn't support the three-character code, only the two-character"}, {"Time_Start": 2464.2400000000002, "Time_End": 2465.2400000000002, "Text": " evasion stuff."}, {"Time_Start": 2465.2400000000002, "Time_End": 2470.2400000000002, "Text": " It also has that same null problem as Whisker does with a string copy."}, {"Time_Start": 2470.2400000000002, "Time_End": 2473.2400000000002, "Text": " So you can send a null to it prefixed by the option code,"}, {"Time_Start": 2473.2400000000002, "Time_End": 2477.2400000000002, "Text": " then it'll stop processing the string and anything after it won't be interpreted by the server."}, {"Time_Start": 2477.2400000000002, "Time_End": 2482.2400000000002, "Text": " Now, if the IDS interprets that string, it will no longer figure out what the user,"}, {"Time_Start": 2482.2400000000002, "Time_End": 2484.2400000000002, "Text": " or the hacker is really doing."}, {"Time_Start": 2484.2400000000002, "Time_End": 2487.2400000000002, "Text": " But of course, if it does do the same logic as the Windows NT stuff,"}, {"Time_Start": 2487.2400000000002, "Time_End": 2491.2400000000002, "Text": " then it will no longer be able to detect all the attacks against the Unix FTP server."}, {"Time_Start": 2491.2400000000002, "Time_End": 2495.2200000000003, "Text": " Now there's also the problem that a lot of Windows FTP servers"}, {"Time_Start": 2495.2400000000002, "Time_End": 2499.2400000000002, "Text": " you might download off the web, don't support any of this option stuff at all."}, {"Time_Start": 2499.2400000000002, "Time_End": 2506.2400000000002, "Text": " So what you really need to do is to profile the target and figure out what kind of FTP server is the target running"}, {"Time_Start": 2506.2400000000002, "Time_End": 2509.2400000000002, "Text": " and adjust your IDS algorithms accordingly."}, {"Time_Start": 2509.2400000000002, "Time_End": 2515.2400000000002, "Text": " Also, if you're writing the exploit scripts, you equally have to profile the target."}, {"Time_Start": 2515.2400000000002, "Time_End": 2518.2400000000002, "Text": " For example, a lot of scripts run across the anonymous authentication."}, {"Time_Start": 2518.2400000000002, "Time_End": 2521.2400000000002, "Text": " So the first thing you should do is encode the user string."}, {"Time_Start": 2521.2400000000002, "Time_End": 2524.2400000000002, "Text": " So you get back an error, you know it's not handling the option code."}, {"Time_Start": 2524.2400000000002, "Time_End": 2525.2400000000002, "Text": " If you say, okay,"}, {"Time_Start": 2525.2400000000002, "Time_End": 2529.2400000000002, "Text": " anonymous is allowed to log in, or guest accounts allowed to log in,"}, {"Time_Start": 2529.2400000000002, "Time_End": 2534.2400000000002, "Text": " that you know that it did accept the option code, and you should use option codes from then on."}, {"Time_Start": 2534.2400000000002, "Time_End": 2537.2400000000002, "Text": " You can use the same technique back you used in the RPC record fragging,"}, {"Time_Start": 2537.2400000000002, "Time_End": 2539.2400000000002, "Text": " is randomized the whole thing."}, {"Time_Start": 2539.2400000000002, "Time_End": 2542.2400000000002, "Text": " Like just every character is either randomly the original character"}, {"Time_Start": 2542.2400000000002, "Time_End": 2546.2400000000002, "Text": " or one prefix by the option evasion stuff."}, {"Time_Start": 2546.2400000000002, "Time_End": 2552.2400000000002, "Text": " So here's an example of where I do the change current working directory to root."}, {"Time_Start": 2552.2400000000002, "Time_End": 2554.2400000000002, "Text": " I log on is anonymous, and I send that."}, {"Time_Start": 2554.2400000000002, "Time_End": 2558.2400000000002, "Text": " and I send that corruption in the user string."}, {"Time_Start": 2558.2400000000002, "Time_End": 2561.2400000000002, "Text": " But the server supports FTP, or Telnet options,"}, {"Time_Start": 2561.2400000000002, "Time_End": 2565.2400000000002, "Text": " and says, great, guest account, login, okay, continue on."}, {"Time_Start": 2565.2400000000002, "Time_End": 2569.2400000000002, "Text": " I then do the exploit, change current working directory to route,"}, {"Time_Start": 2569.2400000000002, "Time_End": 2572.2400000000002, "Text": " and I insert my little option codes in there,"}, {"Time_Start": 2572.2400000000002, "Time_End": 2575.2400000000002, "Text": " so it doesn't look anything like, change current working directory to root."}, {"Time_Start": 2575.2400000000002, "Time_End": 2579.2400000000002, "Text": " And indeed, all the other IDSs fail to detect this."}, {"Time_Start": 2579.2400000000002, "Time_End": 2583.2400000000002, "Text": " Though on the server, I got back 250 success, meaning I actually was able to change my current working directory."}, {"Time_Start": 2583.2400000000002, "Time_End": 2588.2400000000002, "Text": " to change my current working director to route, and I can grab any file out the server I want."}, {"Time_Start": 2588.2400000000002, "Time_End": 2597.2400000000002, "Text": " A similar technique using sort of the presentation formatting of the data is within DNS."}, {"Time_Start": 2597.2400000000002, "Time_End": 2600.2400000000002, "Text": " First of all, you have a case sensitivity issue."}, {"Time_Start": 2600.2400000000002, "Time_End": 2606.2400000000002, "Text": " I noticed that a lot of IDS is assumed that the case will be either all uppercase or all lowercase."}, {"Time_Start": 2606.2400000000002, "Time_End": 2612.2400000000002, "Text": " The second thing is, is that DNS supports this name compression thing, where it splits up names,"}, {"Time_Start": 2612.2400000000002, "Time_End": 2617.2400000000002, "Text": " names in order to compress responses and requests."}, {"Time_Start": 2617.2400000000002, "Time_End": 2620.2400000000002, "Text": " This has long been used to crash IDS's and to crash sniffers,"}, {"Time_Start": 2620.2400000000002, "Time_End": 2624.2400000000002, "Text": " because you can cause it to reference itself in an infinite loop."}, {"Time_Start": 2624.2400000000002, "Time_End": 2629.2400000000002, "Text": " The way this compression works is that you have like one name,"}, {"Time_Start": 2629.2400000000002, "Time_End": 2633.2400000000002, "Text": " maybe I try to reference www.jahoo.com."}, {"Time_Start": 2633.2400000000002, "Time_End": 2637.2400000000002, "Text": " It comes back and says, well, actually, there's lots of servers there at www.jahoo.com,"}, {"Time_Start": 2637.2400000000002, "Time_End": 2641.2400000000002, "Text": " they're like WW1, WW2, and so forth."}, {"Time_Start": 2641.2400000000002, "Time_End": 2642.2400000000002, "Text": " Now, in order to cover,"}, {"Time_Start": 2642.2400000000002, "Time_End": 2648.2400000000002, "Text": " press that DNS response, the first one says the full Yahoo.com, and the second ones have a pointer,"}, {"Time_Start": 2648.2400000000002, "Time_End": 2653.2400000000002, "Text": " saying, continue on now with the rest of the original Yahoo.com."}, {"Time_Start": 2653.2400000000002, "Time_End": 2657.2400000000002, "Text": " So when you look at the text decode of it, you see something that looks a lot like this."}, {"Time_Start": 2657.2400000000002, "Time_End": 2662.2400000000002, "Text": " You see in the clear text, the first name followed by a lot of other fractions of the name."}, {"Time_Start": 2662.2400000000002, "Time_End": 2667.2400000000002, "Text": " And this is where you can crash in an IDS or a sniffer,"}, {"Time_Start": 2667.2400000000002, "Time_End": 2671.2400000000002, "Text": " is where you make that self-referential loop, saying reference myself and continue here."}, {"Time_Start": 2671.2400000000002, "Time_End": 2674.32, "Text": " and continue here, and it'll continue to continue here and hang."}, {"Time_Start": 2674.32, "Time_End": 2677.7400000000002, "Text": " Or you can tell it to point off to Never Neverland where it will crash."}, {"Time_Start": 2681.7400000000002, "Time_End": 2683.2400000000002, "Text": " Oops."}, {"Time_Start": 2683.2400000000002, "Time_End": 2686.2400000000002, "Text": " So I wrote a little version Bind scanner."}, {"Time_Start": 2686.2400000000002, "Time_End": 2689.2400000000002, "Text": " In the Bind, Berkeley internet name game,"}, {"Time_Start": 2689.2400000000002, "Time_End": 2692.2400000000002, "Text": " in which server says like 90% of all name requests on the internet,"}, {"Time_Start": 2692.2400000000002, "Time_End": 2696.2400000000002, "Text": " you can query which version of the software is running."}, {"Time_Start": 2696.2400000000002, "Time_End": 2700.2400000000002, "Text": " And you have a special record called a text record that's in the chaos class."}, {"Time_Start": 2700.2400000000002, "Time_End": 2704.2400000000002, "Text": " class with the string that you're looking up version.bind."}, {"Time_Start": 2704.2400000000002, "Time_End": 2708.2400000000002, "Text": " And that's like hard code into the code is an Easter A that returns what version it's running,"}, {"Time_Start": 2708.2400000000002, "Time_End": 2713.2400000000002, "Text": " like 8.22 or 4.31 or something like that."}, {"Time_Start": 2713.2400000000002, "Time_End": 2718.2400000000002, "Text": " Well, a lot of IDSs detect this because it's a common scanning thing you do when you're attacking"}, {"Time_Start": 2718.2400000000002, "Time_End": 2720.2400000000002, "Text": " a DNS server."}, {"Time_Start": 2720.2400000000002, "Time_End": 2725.2400000000002, "Text": " So I did two evasions here, one of which is I changed the name to be capital V"}, {"Time_Start": 2725.2400000000002, "Time_End": 2729.2400000000002, "Text": " and small version, capital B and small I."}, {"Time_Start": 2729.2400000000002, "Time_End": 2732.2400000000002, "Text": " And I played around with this for a couple of days."}, {"Time_Start": 2732.2400000000002, "Time_End": 2736.2400000000002, "Text": " I could use all sorts of different arrangements by using this name compression"}, {"Time_Start": 2736.2400000000002, "Time_End": 2740.2400000000002, "Text": " by taking the second part of the name and pointed it off somewhere else in the packet."}, {"Time_Start": 2740.2400000000002, "Time_End": 2743.2400000000002, "Text": " And I finally came down to the only way I could figure out how to get to work"}, {"Time_Start": 2743.2400000000002, "Time_End": 2748.2400000000002, "Text": " by going to the source code of bind, of course, was to put the dot bind"}, {"Time_Start": 2748.2400000000002, "Time_End": 2753.2400000000002, "Text": " after the end, logical end of the DNS portion of the packet."}, {"Time_Start": 2753.2400000000002, "Time_End": 2757.2400000000002, "Text": " So that I see version, where you see that plus here in the text decode,"}, {"Time_Start": 2757.2400000000002, "Time_End": 2758.2400000000002, "Text": " it's actually specified now."}, {"Time_Start": 2758.2400000000002, "Time_End": 2760.5400000000004, "Text": " actually specify in the offset where to find bind."}, {"Time_Start": 2761.34, "Time_End": 2765.5800000000004, "Text": " And the web server will paste this back together to version.bind and return you the correct string."}, {"Time_Start": 2766.0400000000004, "Time_End": 2770.32, "Text": " But if you're looking for version.bind in the packet, you're not going to see that as a contiguous"}, {"Time_Start": 2770.32, "Time_End": 2772.1200000000003, "Text": " signature that you can trigger on."}, {"Time_Start": 2774.88, "Time_End": 2779.82, "Text": " So I'll be posting that DNS scanner to my website as an example after a defcon."}, {"Time_Start": 2781.2400000000002, "Time_End": 2783.38, "Text": " Problem is I couldn't get quite work on Linux."}, {"Time_Start": 2783.5400000000004, "Time_End": 2788.1400000000003, "Text": " There's a clock, I throttle it for like bulk scanning and the clock function on Linux,"}, {"Time_Start": 2788.2400000000002, "Time_End": 2791.6400000000003, "Text": " wasn't quite working. I don't know why it would stop incrementing after a while."}, {"Time_Start": 2794.44, "Time_End": 2798.0400000000004, "Text": " All of these evasion techniques, which I discovered after I wrote the presentation here,"}, {"Time_Start": 2798.7400000000002, "Time_End": 2804.2400000000002, "Text": " are at the OSI presentation layer, like HTTP, RPC, FTP, DNS. They're all changing how"}, {"Time_Start": 2804.2400000000002, "Time_End": 2806.2000000000003, "Text": " the data is formatted, but not the meaning of the data."}, {"Time_Start": 2808.96, "Time_End": 2813.46, "Text": " So I decided that it would be kind of cool to actually add these to directly into NMAP,"}, {"Time_Start": 2813.7000000000003, "Time_End": 2818.0400000000004, "Text": " so that NMAP's FTP bounce scans will automatically evade and,"}, {"Time_Start": 2818.2400000000002, "Time_End": 2824.9, "Text": " RPC, no-proc stuff it does to detect RPC services, will also evade the IDS."}, {"Time_Start": 2827.6600000000003, "Time_End": 2834.0000000000005, "Text": " So today's networks, the most popular way you can exploit a site is through DNS, through Bind,"}, {"Time_Start": 2834.5000000000005, "Time_End": 2836.7200000000003, "Text": " a huge number of Byn exploits over the past year."}, {"Time_Start": 2837.5600000000004, "Time_End": 2840.2000000000003, "Text": " FTP, you know, there's a new one discovered every week."}, {"Time_Start": 2841.0400000000004, "Time_End": 2842.0200000000004, "Text": " New exploit into FTP."}, {"Time_Start": 2842.76, "Time_End": 2847.6400000000003, "Text": " RPC services, Suns, Solaris Machines, and Linux boxes have been exploited with RPC."}, {"Time_Start": 2848.2400000000002, "Time_End": 2850.0400000000004, "Text": " a lot in the last two years."}, {"Time_Start": 2850.6800000000003, "Time_End": 2853.7000000000003, "Text": " Of course, HTTP with all the ZGI stuff, will never end."}, {"Time_Start": 2853.7400000000002, "Time_End": 2855.5000000000005, "Text": " You'll always be able to break into boxes with that."}, {"Time_Start": 2856.0400000000004, "Time_End": 2857.1200000000003, "Text": " And, of course, Trojan horses."}, {"Time_Start": 2857.92, "Time_End": 2861.6000000000004, "Text": " So these are most popular ways that people are actually hacking into systems today."}, {"Time_Start": 2862.88, "Time_End": 2867.5600000000004, "Text": " And, of course, the easiest way of evading IDS is are using those protocols that we've just demonstrated."}, {"Time_Start": 2868.5200000000004, "Time_End": 2872.98, "Text": " I like to do this, you know, back and forth, along with the frag and the flood and the jam techniques"}, {"Time_Start": 2872.98, "Time_End": 2878.2200000000003, "Text": " of either fragmenting any attack with fragmentation or any attack."}, {"Time_Start": 2878.2400000000002, "Time_End": 2880.5800000000004, "Text": " flooding or jamming the IDS sensor, bringing it down."}, {"Time_Start": 2883.0200000000004, "Time_End": 2892.2200000000003, "Text": " So the idea of evading IDS's with protocols is still not a widely researched topic in the hacker community."}, {"Time_Start": 2894.0400000000004, "Time_End": 2897.5800000000004, "Text": " I've been just working on a few protocols because they're the most commonly used and found"}, {"Time_Start": 2897.5800000000004, "Time_End": 2903.36, "Text": " I can easily add to these protocols the ability to evade IDS's, including black guys,"}, {"Time_Start": 2903.36, "Time_End": 2905.0000000000005, "Text": " which is why I fixed it, so it no longer works."}, {"Time_Start": 2907.1400000000003, "Time_End": 2908.2200000000003, "Text": " Lots of protocols."}, {"Time_Start": 2908.2400000000002, "Time_End": 2914.4, "Text": " are vulnerable to these presentation layer attacks or application layer evasion."}, {"Time_Start": 2915.92, "Time_End": 2921.36, "Text": " And the reason I'm presenting it is because a lot of the competitors still haven't dealt with fragmentation,"}, {"Time_Start": 2921.5000000000005, "Time_End": 2922.6600000000003, "Text": " which is like really, really old."}, {"Time_Start": 2923.1600000000003, "Time_End": 2926.26, "Text": " They really need to be kicked in the pants and say, you need to add these to your products."}, {"Time_Start": 2927.0000000000005, "Time_End": 2937.0000000000005, "Text": " As I started with the presentation here, the IDS vendors are selling you a tank that some, you know, oddball can walk up behind with a grenade and blow it up."}, {"Time_Start": 2938.2400000000002, "Time_End": 2940.5200000000004, "Text": " And this is not a really good state of the industry right now."}, {"Time_Start": 2943.4, "Time_End": 2944.94, "Text": " So this is the end of the presentation."}, {"Time_Start": 2945.28, "Time_End": 2949.36, "Text": " I'll be posting the slides to this URL at my own personal website."}, {"Time_Start": 2950.88, "Time_End": 2954.5200000000004, "Text": " I've got a fact on generic network intrusion detection stuff at my website."}, {"Time_Start": 2955.5600000000004, "Time_End": 2958.92, "Text": " And we've been coming out with a Linux version of a lot of you might be interested in beta in about a month."}, {"Time_Start": 2959.36, "Time_End": 2960.2000000000003, "Text": " Are there any questions?"}, {"Time_Start": 2961.96, "Time_End": 2962.4, "Text": " There."}, {"Time_Start": 2968.2400000000002, "Time_End": 2968.6400000000003, "Text": " Thank you."}]}