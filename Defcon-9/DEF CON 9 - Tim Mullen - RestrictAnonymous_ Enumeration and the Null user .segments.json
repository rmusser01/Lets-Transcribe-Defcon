{"segments": [{"Time_Start": 0.0, "Time_End": 10.0, "Text": " I'm Tim Mullen."}, {"Time_Start": 10.0, "Time_End": 29.0, "Text": " I'm Tim Mullen, and like we talked about a little earlier, we're going to be talking about"}, {"Time_Start": 29.0, "Time_End": 35.6, "Text": " restrict anonymous enumeration in the null user. Of course the first question that"}, {"Time_Start": 35.6, "Time_End": 40.88, "Text": " comes up is what is a no user? Why do we need one? Why do we have one? Why is"}, {"Time_Start": 40.88, "Time_End": 46.760000000000005, "Text": " NT set up to accept one? Well, the no user, some people call it the anonymous user."}, {"Time_Start": 46.760000000000005, "Time_End": 53.120000000000005, "Text": " Special user account built in all the NT boxes out there, 4-0, Win2K, lives and"}, {"Time_Start": 53.120000000000005, "Time_End": 58.0, "Text": " breathes. It's an account with no username and no password."}, {"Time_Start": 58.0, "Time_End": 61.0, "Text": " you can't do anything about that."}, {"Time_Start": 61.0, "Time_End": 64.5, "Text": " You can't change it, you can't rename it, you can't do anything because it has no"}, {"Time_Start": 64.5, "Time_End": 66.0, "Text": " username and no password, it has no credentials."}, {"Time_Start": 66.0, "Time_End": 73.5, "Text": " Back in the day of NT40, if you had a box that was part of a domain structure,"}, {"Time_Start": 73.5, "Time_End": 79.0, "Text": " when that guy boots up, he's going to initiate a secure channel on the network,"}, {"Time_Start": 79.0, "Time_End": 82.0, "Text": " talk to a domain controller and say, hey, am I part of this domain or not?"}, {"Time_Start": 82.0, "Time_End": 87.0, "Text": " That connection is established over null credentials initially."}, {"Time_Start": 87.0, "Time_End": 87.98, "Text": " No username, no password."}, {"Time_Start": 88.0, "Time_End": 90.86, "Text": " word, bang, talks to the domain controller, says, hey, am I part of this domain?"}, {"Time_Start": 90.96, "Time_End": 97.9, "Text": " Yes or no? If you keep an NT box from using that connection, he will not authenticate."}, {"Time_Start": 98.1, "Time_End": 102.4, "Text": " He won't even join the domain. It'll say no domain controller was found."}, {"Time_Start": 103.32, "Time_End": 108.44, "Text": " It's also used in, I wish I had more stuff. I'd like to be an evangelist and come out and"}, {"Time_Start": 108.44, "Time_End": 115.88, "Text": " it's used when, remember multi-domain structures, you have some trust domains over here and"}, {"Time_Start": 115.88, "Time_End": 121.88, "Text": " Like, I'll trust these guys, but they won't trust me, or normally it's they trust me, but I don't trust them, right?"}, {"Time_Start": 122.97999999999999, "Time_End": 130.18, "Text": " If they were going to grant me access to their resources, well, they need to be able to grab a list of user names to grant access to."}, {"Time_Start": 131.38, "Time_End": 140.38, "Text": " Since I don't trust them, the way that they make a connection to enumerate what users they can set on their resources, that's also done with null credentials."}, {"Time_Start": 140.57999999999998, "Time_End": 141.38, "Text": " Ooh, air conditioning."}, {"Time_Start": 141.88, "Time_End": 142.96, "Text": " Could you stay right there?"}, {"Time_Start": 143.84, "Time_End": 144.28, "Text": " Thanks."}, {"Time_Start": 145.88, "Time_End": 147.88, "Text": " Got a cool wind blowing in here."}, {"Time_Start": 147.88, "Time_End": 156.88, "Text": " And SMS, some of the third-party Microsoft apps, also use that for discovery."}, {"Time_Start": 156.88, "Time_End": 162.88, "Text": " Whenever SMS service goes out and wants to see what's on the box and who he is and what he's running that initial connection"}, {"Time_Start": 162.88, "Time_End": 165.88, "Text": " to enumerate shares and all that stuff has done as an old user as well."}, {"Time_Start": 165.88, "Time_End": 169.88, "Text": " So, I mean, this guy really has some uses."}, {"Time_Start": 169.88, "Time_End": 172.88, "Text": " All right, so who cares?"}, {"Time_Start": 172.88, "Time_End": 175.85999999999999, "Text": " I mean, everybody's heard of Restrict Anonymous and"}, {"Time_Start": 175.88, "Time_End": 177.98, "Text": " the null user and blah, blah, blah."}, {"Time_Start": 180.6, "Time_End": 190.35999999999999, "Text": " It can actually be a substantial hole that evil hackers can use to enumerate information on your network."}, {"Time_Start": 192.2, "Time_End": 193.06, "Text": " Say who?"}, {"Time_Start": 193.5, "Time_End": 194.85999999999999, "Text": " Passwords and comment fields."}, {"Time_Start": 195.4, "Time_End": 197.32, "Text": " Yes, no passwords, though."}, {"Time_Start": 198.32, "Time_End": 199.12, "Text": " What was the other one?"}, {"Time_Start": 199.28, "Time_End": 200.0, "Text": " Comment fields?"}, {"Time_Start": 201.34, "Time_End": 203.44, "Text": " Oh, yeah, passwords and comment fields."}, {"Time_Start": 203.57999999999998, "Time_End": 205.85999999999999, "Text": " Oh, I mean, I would just shoot people in, like."}, {"Time_Start": 205.88, "Time_End": 207.88, "Text": " them on fire if they did that."}, {"Time_Start": 207.88, "Time_End": 212.88, "Text": " Because if you light them on fire and then shoot them, then it's over too quick."}, {"Time_Start": 212.88, "Time_End": 217.88, "Text": " The way that you can do this, this has been in hacking and exposed and all that stuff,"}, {"Time_Start": 217.88, "Time_End": 225.88, "Text": " you can use the net command line, an NT, net use, server name slash IPC, interprocess communications resource,"}, {"Time_Start": 225.88, "Time_End": 233.88, "Text": " it's always there, IPC dollar sign, quote, quote, space, whack, user, colon, quote, quote, quote."}, {"Time_Start": 233.88, "Time_End": 235.88, "Text": " And what that does is implicit."}, {"Time_Start": 235.88, "Time_End": 242.88, "Text": " explicitly set up a null session. You're using that resource, the IPC resource, with no username and no password."}, {"Time_Start": 242.88, "Time_End": 248.88, "Text": " Well, there's programs out there, dump ACL. It's called, what, dump sec now?"}, {"Time_Start": 248.88, "Time_End": 252.88, "Text": " Back in the old days, it was dump ACL and it's kind of stuck with me. I should change it."}, {"Time_Start": 252.88, "Time_End": 265.86, "Text": " That guy uses the null user to enumerate all kinds of information, the modals, your policy information, what the guy can do, what the guy can't do, the shares that are on the machine, all the usernames, the groups,"}, {"Time_Start": 265.88, "Time_End": 267.88, "Text": " All of that stuff can be done."}, {"Time_Start": 267.88, "Time_End": 269.88, "Text": " Hey, look at there."}, {"Time_Start": 269.88, "Time_End": 274.88, "Text": " Groups, services, the services you have running can be enumerated in that manner as well."}, {"Time_Start": 274.88, "Time_End": 282.88, "Text": " All kinds of information that I can use to footprint your network as an anonymous user."}, {"Time_Start": 282.88, "Time_End": 284.88, "Text": " Okay?"}, {"Time_Start": 284.88, "Time_End": 289.88, "Text": " So, let me do a quick little demo here."}, {"Time_Start": 289.88, "Time_End": 294.88, "Text": " Part of the problem,"}, {"Time_Start": 294.88, "Time_End": 305.88, "Text": " problem with being in the middle of doing Yeagermeister shots and someone asks you to do a presentation is that some stuff is not always set up."}, {"Time_Start": 305.88, "Time_End": 312.88, "Text": " Now, I'm going to see, let me get a little VMware session. VMware is cool."}, {"Time_Start": 316.88, "Time_End": 323.88, "Text": " So for those of you that don't know what I'm doing is I'm actually instantiating a completely separate machine on the same machine."}, {"Time_Start": 323.88, "Time_End": 324.88, "Text": " So inside."}, {"Time_Start": 324.88, "Time_End": 331.88, "Text": " of my active window here. I've got a Windows 2000 machine that's running, that's got RA set to one."}, {"Time_Start": 331.88, "Time_End": 336.88, "Text": " Restrict Anonymous set to one. I'll talk about that just a sec. And he's running here."}, {"Time_Start": 336.88, "Time_End": 343.88, "Text": " And what I can do is from here. Can you all see that? I made it big and yellow."}, {"Time_Start": 343.88, "Time_End": 350.88, "Text": " So I actually thought about that. Just to show you, I have connectivity."}, {"Time_Start": 354.88, "Time_End": 359.88, "Text": " Is he 190?"}, {"Time_Start": 359.88, "Time_End": 362.88, "Text": " Just to show you I have connectivity."}, {"Time_Start": 366.88, "Time_End": 369.88, "Text": " Did I tell you about my wife yet?"}, {"Time_Start": 373.88, "Time_End": 377.88, "Text": " So as you can see, my VMware session is working beautifully."}, {"Time_Start": 377.88, "Time_End": 379.88, "Text": " I actually need to wait a second."}, {"Time_Start": 379.88, "Time_End": 381.88, "Text": " It's a win 2K."}, {"Time_Start": 381.88, "Time_End": 382.88, "Text": " Oh."}, {"Time_Start": 382.88, "Time_End": 383.88, "Text": " Oh."}, {"Time_Start": 383.88, "Time_End": 384.88, "Text": " Oh."}, {"Time_Start": 384.88, "Time_End": 393.88, "Text": " It's still loading up the..."}, {"Time_Start": 393.88, "Time_End": 399.88, "Text": " As you can imagine, a virtual disk loading up an install of Win 2K is a little big."}, {"Time_Start": 399.88, "Time_End": 403.88, "Text": " So I'm going to try this one more time and not look like an idiot, hopefully."}, {"Time_Start": 403.88, "Time_End": 406.88, "Text": " Well, other than the Gia, whatever."}, {"Time_Start": 406.88, "Time_End": 408.88, "Text": " I can't think that quick."}, {"Time_Start": 414.88, "Time_End": 419.88, "Text": " And there was much rejoicing."}, {"Time_Start": 419.88, "Time_End": 424.88, "Text": " Thank you. Thank you. Goodbye."}, {"Time_Start": 424.88, "Time_End": 430.88, "Text": " Always leave on a high note."}, {"Time_Start": 430.88, "Time_End": 435.88, "Text": " All right. So what I'm going to do is I'm going to run this dump sack program."}, {"Time_Start": 435.88, "Time_End": 437.88, "Text": " Who's familiar with it?"}, {"Time_Start": 437.88, "Time_End": 439.88, "Text": " Oh, come on."}, {"Time_Start": 439.88, "Time_End": 441.88, "Text": " Who's familiar with that?"}, {"Time_Start": 441.88, "Time_End": 442.88, "Text": " Well, where's your hand anyway?"}, {"Time_Start": 442.88, "Time_End": 443.88, "Text": " Okay."}, {"Time_Start": 443.88, "Time_End": 444.88, "Text": " So what?"}, {"Time_Start": 444.88, "Time_End": 446.88, "Text": " what dumpsec does."}, {"Time_Start": 446.88, "Time_End": 455.88, "Text": " And I'm just going to run it against my own box because my NT40 box doesn't seem to be working very well."}, {"Time_Start": 455.88, "Time_End": 458.88, "Text": " I made this kind of big too."}, {"Time_Start": 458.88, "Time_End": 462.88, "Text": " So what I'm going to do is, now in real life, this isn't how we would do it."}, {"Time_Start": 462.88, "Time_End": 465.88, "Text": " We would do a net use against the target box."}, {"Time_Start": 465.88, "Time_End": 471.88, "Text": " Once we have that net use and that null session established, then we come back here and tell it to select the computer."}, {"Time_Start": 471.88, "Time_End": 473.88, "Text": " I'm just going to use my own."}, {"Time_Start": 473.88, "Time_End": 479.88, "Text": " you know, why didn't they do 10.1-1-1-1?"}, {"Time_Start": 483.88, "Time_End": 485.88, "Text": " Okay."}, {"Time_Start": 486.88, "Time_End": 491.88, "Text": " Now, the only reason that that worked is because I'm authenticated on my own machine."}, {"Time_Start": 491.88, "Time_End": 494.88, "Text": " If I wasn't authenticated, it would come up and say, who are you?"}, {"Time_Start": 494.88, "Time_End": 495.88, "Text": " Go away."}, {"Time_Start": 495.88, "Time_End": 500.88, "Text": " If I had done a net use, then it would also have established a connection here."}, {"Time_Start": 500.88, "Time_End": 503.88, "Text": " So what I'm going to do is I'm going to dump, um, um,"}, {"Time_Start": 503.88, "Time_End": 507.88, "Text": " dump users as a column."}, {"Time_Start": 507.88, "Time_End": 511.88, "Text": " Do I want to do that on my own machine in front of all of you people?"}, {"Time_Start": 515.88, "Time_End": 517.88, "Text": " Okay."}, {"Time_Start": 517.88, "Time_End": 520.88, "Text": " If none of you figured out that my username was Thor,"}, {"Time_Start": 520.88, "Time_End": 523.88, "Text": " then you don't deserve to be here anyway."}, {"Time_Start": 523.88, "Time_End": 528.88, "Text": " So you can see I've got my IWAM user account and all these other,"}, {"Time_Start": 528.88, "Time_End": 530.88, "Text": " just a couple of users on this box."}, {"Time_Start": 530.88, "Time_End": 532.88, "Text": " All right, so this is what dumpsec"}, {"Time_Start": 532.88, "Time_End": 539.88, "Text": " does. So what I'm going to do now is I've established that connection."}, {"Time_Start": 543.88, "Time_End": 548.88, "Text": " We saw that I have connectivity with this box."}, {"Time_Start": 548.88, "Time_End": 554.88, "Text": " Let me, let me go over the registry settings."}, {"Time_Start": 554.88, "Time_End": 559.88, "Text": " Oh, come on. Okay."}, {"Time_Start": 559.88, "Time_End": 561.88, "Text": " So, so this is this one."}, {"Time_Start": 561.88, "Time_End": 562.88, "Text": " So this was."}, {"Time_Start": 562.88, "Time_End": 569.88, "Text": " was a problem at one point, okay? Let's kind of jump back to where we were. No users are out there. I can enumerate all this information."}, {"Time_Start": 569.88, "Time_End": 577.88, "Text": " So everybody gets pissed off at Microsoft, right? So, and still are."}, {"Time_Start": 577.88, "Time_End": 588.88, "Text": " The dev crew decided to introduce this new key, the new value actually, inside the HK local machine system,"}, {"Time_Start": 588.88, "Time_End": 591.88, "Text": " current control set, control LSA."}, {"Time_Start": 591.88, "Time_End": 598.88, "Text": " key, you create a value called restrict anonymous, D word, and you set it to one."}, {"Time_Start": 598.88, "Time_End": 608.88, "Text": " So what that does is supposedly make some API checks whenever these API calls are being made,"}, {"Time_Start": 608.88, "Time_End": 615.88, "Text": " it checks the context that the user is in, and if they're anonymous, it keeps them from doing that."}, {"Time_Start": 615.88, "Time_End": 621.88, "Text": " Meant to stop null session enumeration, and back in the days of C2 specification,"}, {"Time_Start": 621.88, "Time_End": 630.88, "Text": " which was the highest level of security a business could attain, right, was the C2 audit."}, {"Time_Start": 630.88, "Time_End": 634.88, "Text": " It could pass a C2 audit. It was required for that."}, {"Time_Start": 634.88, "Time_End": 643.88, "Text": " So this key being required for C2 made it seem pretty important."}, {"Time_Start": 643.88, "Time_End": 648.88, "Text": " I mean, it gave it a lot of credential. It gave it some validity."}, {"Time_Start": 648.88, "Time_End": 650.88, "Text": " But there's some problems here."}, {"Time_Start": 650.88, "Time_End": 654.88, "Text": " I'm going to show you that, hopefully."}, {"Time_Start": 654.88, "Time_End": 664.88, "Text": " So I'm going to first establish a null session to my NT 2000 box."}, {"Time_Start": 664.88, "Time_End": 668.38, "Text": " Note that it has, this box has restricted item to set the one."}, {"Time_Start": 668.38, "Time_End": 673.88, "Text": " I can show you if you want, but you know, let's start the trust model off right here."}, {"Time_Start": 673.88, "Time_End": 676.88, "Text": " That's right."}, {"Time_Start": 676.88, "Time_End": 677.88, "Text": " It is Vegas."}, {"Time_Start": 677.88, "Time_End": 679.88, "Text": " You want to see it."}, {"Time_Start": 679.88, "Time_End": 681.88, "Text": " Well, I'm not going to show you."}, {"Time_Start": 681.88, "Time_End": 684.88, "Text": " Okay, good grief."}, {"Time_Start": 684.88, "Time_End": 686.88, "Text": " Does you really want to see that it's set to one?"}, {"Time_Start": 686.88, "Time_End": 687.88, "Text": " Thank you."}, {"Time_Start": 687.88, "Time_End": 688.88, "Text": " Thank you."}, {"Time_Start": 688.88, "Time_End": 690.88, "Text": " See, we only got 15 minutes."}, {"Time_Start": 690.88, "Time_End": 692.88, "Text": " Yay!"}, {"Time_Start": 692.88, "Time_End": 696.88, "Text": " So I'm going to do a net use, whack, whack."}, {"Time_Start": 696.88, "Time_End": 698.88, "Text": " Ah."}, {"Time_Start": 698.88, "Time_End": 704.88, "Text": " Bada-bing, bada-a-a-a-d-bang."}, {"Time_Start": 704.88, "Time_End": 707.88, "Text": " IPC dollar sign."}, {"Time_Start": 707.88, "Time_End": 708.88, "Text": " It's wrapping, so."}, {"Time_Start": 708.88, "Time_End": 717.88, "Text": " wrapping, so no password. The password comes first in this context. I don't know why."}, {"Time_Start": 717.88, "Time_End": 722.88, "Text": " User, whack, whack, or bang bang, whatever you want to call it."}, {"Time_Start": 722.88, "Time_End": 724.88, "Text": " The command completed successfully."}, {"Time_Start": 724.88, "Time_End": 725.88, "Text": " Oh, wait."}, {"Time_Start": 725.88, "Time_End": 729.88, "Text": " The command completed successfully."}, {"Time_Start": 729.88, "Time_End": 733.88, "Text": " Ha ha ha ha."}, {"Time_Start": 733.88, "Time_End": 734.88, "Text": " Ha ha."}, {"Time_Start": 734.88, "Time_End": 737.88, "Text": " The command completed successfully."}, {"Time_Start": 737.88, "Time_End": 741.88, "Text": " Okay. Oh, and I'm sorry."}, {"Time_Start": 744.88, "Time_End": 747.88, "Text": " Hey, man, that thing is cool. My kids love it."}, {"Time_Start": 747.88, "Time_End": 749.88, "Text": " Huh?"}, {"Time_Start": 749.88, "Time_End": 751.88, "Text": " Oh, yeah."}, {"Time_Start": 751.88, "Time_End": 756.88, "Text": " If you don't, if you have a cat and don't have a laser pointer, you have no life."}, {"Time_Start": 756.88, "Time_End": 761.88, "Text": " I mean, little Yeager, the laser pointer, the cat, the cat."}, {"Time_Start": 761.88, "Time_End": 762.88, "Text": " Woo!"}, {"Time_Start": 762.88, "Time_End": 766.88, "Text": " Okay."}, {"Time_Start": 766.88, "Time_End": 767.88, "Text": " Okay."}, {"Time_Start": 767.88, "Time_End": 770.88, "Text": " So you'll notice that it completed successfully,"}, {"Time_Start": 770.88, "Time_End": 773.88, "Text": " even though we've told it not to let us use null session."}, {"Time_Start": 773.88, "Time_End": 775.88, "Text": " Well, it's not really what we told it."}, {"Time_Start": 775.88, "Time_End": 778.88, "Text": " We told it to restrict what an anonymous user can do."}, {"Time_Start": 778.88, "Time_End": 779.88, "Text": " So I can still link up to that guy."}, {"Time_Start": 779.88, "Time_End": 782.88, "Text": " However, let's go to my desktop."}, {"Time_Start": 782.88, "Time_End": 785.88, "Text": " Go back to dumpsec."}, {"Time_Start": 789.88, "Time_End": 790.88, "Text": " Select."}, {"Time_Start": 790.88, "Time_End": 792.88, "Text": " Ahibaba."}, {"Time_Start": 792.88, "Time_End": 799.88, "Text": " select that computer."}, {"Time_Start": 799.88, "Time_End": 801.88, "Text": " Bang."}, {"Time_Start": 801.88, "Time_End": 805.88, "Text": " So it blows up saying error in processing,"}, {"Time_Start": 805.88, "Time_End": 809.88, "Text": " error in processing, net server, get info, status 5."}, {"Time_Start": 809.88, "Time_End": 811.88, "Text": " It dies."}, {"Time_Start": 811.88, "Time_End": 814.88, "Text": " Now I got sucked into this back in the day."}, {"Time_Start": 814.88, "Time_End": 818.88, "Text": " Back when Restrict Anonymous came in, you know, I don't trust anything, right?"}, {"Time_Start": 818.88, "Time_End": 821.88, "Text": " Besides, we all have our development things that we test everything on first."}, {"Time_Start": 821.88, "Time_End": 824.88, "Text": " first, then we put it all into production."}, {"Time_Start": 824.88, "Time_End": 832.88, "Text": " So I said R-8-1, ran dumpsec, or dump ACL in this case, it died."}, {"Time_Start": 832.88, "Time_End": 833.88, "Text": " I was happy."}, {"Time_Start": 833.88, "Time_End": 835.88, "Text": " I said, great, that works."}, {"Time_Start": 835.88, "Time_End": 841.88, "Text": " So let's go over why that there are some problems."}, {"Time_Start": 841.88, "Time_End": 849.88, "Text": " I got to talking to somebody on the security-focused news group."}, {"Time_Start": 849.88, "Time_End": 851.88, "Text": " We're going back and forth about some different things that you"}, {"Time_Start": 851.88, "Time_End": 858.88, "Text": " could do. And the point made was that down here, if you look, user to Sid and"}, {"Time_Start": 858.88, "Time_End": 866.88, "Text": " Sid to User, who's familiar with that program? Real old. I'm used to bars doing that,"}, {"Time_Start": 866.88, "Time_End": 875.38, "Text": " right? It's 2 o'clock and to shut the lights off. That program still works with Restrict Anonymous"}, {"Time_Start": 875.38, "Time_End": 879.98, "Text": " Set to 1, and that got us talking about why. So I started doing a bunch of research, started testing"}, {"Time_Start": 879.98, "Time_End": 881.38, "Text": " different API calls."}, {"Time_Start": 881.38, "Time_End": 886.38, "Text": " that one could make under the context of a no user."}, {"Time_Start": 886.38, "Time_End": 890.38, "Text": " And came to find out that we had a bunch of them that we could do."}, {"Time_Start": 890.38, "Time_End": 896.38, "Text": " When you set RA to 1, it goes out there and says,"}, {"Time_Start": 896.38, "Time_End": 901.38, "Text": " okay, net server get info. Remember, that's the first thing that dump ACL died on?"}, {"Time_Start": 901.38, "Time_End": 906.38, "Text": " We set an ACL on that. If you're the no user, it dies. You can't run it."}, {"Time_Start": 906.38, "Time_End": 910.38, "Text": " You can't do it on net user, enum, which enumerates users. You can't get the users in a group."}, {"Time_Start": 910.38, "Time_End": 911.38, "Text": " You can't get the user in a group."}, {"Time_Start": 911.38, "Time_End": 913.88, "Text": " you can't get the shares, you can't get the modals."}, {"Time_Start": 915.88, "Time_End": 921.58, "Text": " User to SID and SID the user work because they use these two API calls called"}, {"Time_Start": 921.58, "Time_End": 925.38, "Text": " look up account name and look up account SID."}, {"Time_Start": 925.38, "Time_End": 930.38, "Text": " It's kind of a cheesy little program, but it works."}, {"Time_Start": 930.38, "Time_End": 936.38, "Text": " You basically say look up the account name for a given SID and it tells you the name of that account."}, {"Time_Start": 936.38, "Time_End": 940.38, "Text": " Or tell it to look up the SID of a username and it gives you it SID."}, {"Time_Start": 940.38, "Time_End": 941.36, "Text": " So if you can connect up to the SID."}, {"Time_Start": 941.38, "Time_End": 947.62, "Text": " to a box, you can say, look up account SID, guest. Well, we know guest lives on that box, right?"}, {"Time_Start": 947.62, "Time_End": 951.14, "Text": " We know it's called guests, they can't rename it, they can't delete it. We know that the name"}, {"Time_Start": 951.14, "Time_End": 958.1, "Text": " guests is a valid, that's actually a group, valid group on that box. So if we do a look up account"}, {"Time_Start": 958.1, "Time_End": 964.14, "Text": " Sid, guest, bang, we get the fully qualified SID for that domain. Well, we know that all they've"}, {"Time_Start": 964.14, "Time_End": 971.06, "Text": " done is taking the RID, which is the last portion of your SID, the last sub-authority."}, {"Time_Start": 971.38, "Time_End": 974.88, "Text": " And all we have to do is put a 500 on that."}, {"Time_Start": 975.58, "Time_End": 981.06, "Text": " Take off the guest, put a 500, re-submit that entire SID, and it tells us the name of the administrator account."}, {"Time_Start": 981.98, "Time_End": 982.34, "Text": " Right?"}, {"Time_Start": 982.42, "Time_End": 984.62, "Text": " Because 500 is always the administrator."}, {"Time_Start": 985.66, "Time_End": 988.62, "Text": " So we can always tell, who renames your administrator account?"}, {"Time_Start": 989.54, "Time_End": 991.14, "Text": " Right. It doesn't really matter."}, {"Time_Start": 992.18, "Time_End": 994.6, "Text": " Because all we have to do is say, well, look up account, Sid."}, {"Time_Start": 994.7, "Time_End": 998.12, "Text": " Bang, 500, I know what the name of your administrator is, just like that."}, {"Time_Start": 998.12, "Time_End": 999.76, "Text": " You can't stop us from doing that."}, {"Time_Start": 1001.38, "Time_End": 1003.5, "Text": " Okay? And that's old."}, {"Time_Start": 1006.42, "Time_End": 1017.78, "Text": " However, in addition, in addition, there is this, there are some that don't have proper ACLs put on them."}, {"Time_Start": 1017.78, "Time_End": 1023.92, "Text": " One of them is net server transport enum. That enumerates the transports and use on a box,"}, {"Time_Start": 1024.12, "Time_End": 1031.08, "Text": " which can be kind of cool. Back in NT4, whenever you had a RAS device, it had a really nice name of the"}, {"Time_Start": 1031.08, "Time_End": 1039.74, "Text": " transport called RAS. So you could enumerate a subnet as an anonymous user, find out all the"}, {"Time_Start": 1039.74, "Time_End": 1044.28, "Text": " transports, if they're running IP, IPX, NetBooey, RAS devices, all of this stuff, and then you"}, {"Time_Start": 1044.28, "Time_End": 1049.48, "Text": " know that people have RAS devices on their network, which is not real good, right? Rogue RAS devices"}, {"Time_Start": 1049.48, "Time_End": 1055.3799999999999, "Text": " lurking in the dark. Net user get info also doesn't have any, and that's my favorite."}, {"Time_Start": 1057.46, "Time_End": 1061.06, "Text": " Net user get info has a couple of different levels that can be called."}, {"Time_Start": 1061.08, "Time_End": 1066.6, "Text": " level zero gives you the username level one gives you the age of the"}, {"Time_Start": 1066.6, "Time_End": 1073.1999999999998, "Text": " account the home directory level two gives you even more stuff and level three I call"}, {"Time_Start": 1073.1999999999998, "Time_End": 1082.1999999999998, "Text": " it pay dirt gives you everything the password age the rid the privileges the"}, {"Time_Start": 1082.1999999999998, "Time_End": 1089.8999999999999, "Text": " role privileges of that account user flags all of this extended information you"}, {"Time_Start": 1089.8999999999999, "Time_End": 1091.06, "Text": " have to parse out the flag"}, {"Time_Start": 1091.08, "Time_End": 1094.98, "Text": " comes back as a D word though. So you have to parse that out and it's a little arduous"}, {"Time_Start": 1094.98, "Time_End": 1099.5, "Text": " to do so. But I went ahead and did it. It was like four or five white Russians and I was"}, {"Time_Start": 1099.5, "Time_End": 1111.6799999999998, "Text": " done. And it works on Windows 2000. So let me show you that. So we've got my null session"}, {"Time_Start": 1111.6799999999998, "Time_End": 1121.06, "Text": " established. We saw how dumped ACL failed. Hopefully whoever wrote that's not in the"}, {"Time_Start": 1121.08, "Time_End": 1128.08, "Text": " I'm going to get you, you master."}, {"Time_Start": 1128.08, "Time_End": 1140.08, "Text": " Okay, we've got six minutes. I'll talk quickly. So user info, the way user info works is you have to submit a name."}, {"Time_Start": 1140.08, "Time_End": 1147.08, "Text": " To get the name, you need the SID, the full SID, in order to be able to provide it with the, you need to provide it with the SID."}, {"Time_Start": 1147.08, "Time_End": 1151.06, "Text": " So I'm going to say, user info, wow."}, {"Time_Start": 1151.08, "Time_End": 1181.06, "Text": " WAC-WAC-192.168.5.190. Let's give it administrator. Do I spell it right? I'm used to doing it with two hands. Bang. So here's what user info is going to give us going to give us. Now what's the cheesy part of"}, {"Time_Start": 1181.08, "Time_End": 1187.08, "Text": " about user info. You got to know the name of an account. That kind of stinks."}, {"Time_Start": 1187.08, "Time_End": 1197.08, "Text": " I mean, you're not going to guess B Jones to see if it's a valid account. But this is a way to see if it's really the administrator."}, {"Time_Start": 1197.08, "Time_End": 1210.9199999999998, "Text": " See the user ID? We know that that's really the administrator because it's RID is 500. We know that somebody hasn't created this account called administrator. They renamed the real administrator. They have an account called administrator. And they're"}, {"Time_Start": 1210.92, "Time_End": 1215.38, "Text": " trying to screw with us. So if we try to log in, is that they know that we're trying to get in."}, {"Time_Start": 1216.46, "Time_End": 1225.26, "Text": " We see the password age. We don't have any of these system flags. But what the system flags are going to tell us are if this person is an administrator."}, {"Time_Start": 1226.8600000000001, "Time_End": 1229.44, "Text": " Actually, I'm sorry, this going to be under the operator proofs. You're kicking me out?"}, {"Time_Start": 1230.3600000000001, "Time_End": 1231.3000000000002, "Text": " I got six minutes, right?"}, {"Time_Start": 1235.18, "Time_End": 1238.0600000000002, "Text": " Okay, right. So here we got the miscellaneous info and all this other crap."}, {"Time_Start": 1240.92, "Time_End": 1251.92, "Text": " And I even have this neat little graph. You know, this was the hardest part about writing the entire program was getting these stupid little ones and zeros for the hours that they could log on and for you on this side."}, {"Time_Start": 1251.92, "Time_End": 1270.42, "Text": " Okay. So the problem here is that user info has to be presented with the name. You have to know the name of the account. So we got to thinking, well, we know look up account Sid and look up account name work. We know user info works. So what we're going to do,"}, {"Time_Start": 1270.92, "Time_End": 1278.3600000000001, "Text": " is write another program called user dump and we're going to combine look up account name look up account"}, {"Time_Start": 1278.3600000000001, "Time_End": 1285.14, "Text": " SID and get user info into one program kind of create a SID walker we'll provide it with an"}, {"Time_Start": 1285.14, "Time_End": 1291.04, "Text": " account that we know exists in my example I'm going to do I'm running guest what it's going to do is"}, {"Time_Start": 1291.04, "Time_End": 1296.76, "Text": " look up the account SID it's going to start at 500 this thing going to increment its way up from there"}, {"Time_Start": 1296.76, "Time_End": 1300.9, "Text": " and then dump the SID back out to it to get the name and then dump that name and to get user"}, {"Time_Start": 1300.92, "Time_End": 1307.92, "Text": " So what we can do."}, {"Time_Start": 1307.92, "Time_End": 1309.92, "Text": " I'm going to."}, {"Time_Start": 1309.92, "Time_End": 1325.92, "Text": " I'm going to"}, {"Time_Start": 1325.92, "Time_End": 1328.92, "Text": " a thousand. There's some"}, {"Time_Start": 1328.92, "Time_End": 1334.92, "Text": " programs that after 20 dead entries die. And I don't think that that's right."}, {"Time_Start": 1334.92, "Time_End": 1340.92, "Text": " Because we can delete massive amounts of users and then add them again. And of course the RIDS increment."}, {"Time_Start": 1340.92, "Time_End": 1348.92, "Text": " So in a single command line, I'm going to execute this guy. And so what we see going by on my"}, {"Time_Start": 1348.92, "Time_End": 1356.92, "Text": " Windows 2000 machine is every user, their privileges, if they're account operators, if their server operators, if their"}, {"Time_Start": 1356.92, "Time_End": 1365.92, "Text": " operators, if their administrators or not, if their passwords never expire, if they have to have a smart card to log on, what their log on hours are,"}, {"Time_Start": 1365.92, "Time_End": 1372.92, "Text": " everything that we need to know, the last time they changed their password, and I guess these guys don't exist and it's going to go up to 1900."}, {"Time_Start": 1372.92, "Time_End": 1382.92, "Text": " So we can dump all that information out to a text file and we already have a beautiful map of all of the users on that domain."}, {"Time_Start": 1382.92, "Time_End": 1386.9, "Text": " And it's all been done using a null user account, even"}, {"Time_Start": 1386.92, "Time_End": 1391.92, "Text": " when we've specifically said to restrict access to that information."}, {"Time_Start": 1391.92, "Time_End": 1393.92, "Text": " Tada."}, {"Time_Start": 1393.92, "Time_End": 1402.92, "Text": " Can I have 60 seconds?"}, {"Time_Start": 1402.92, "Time_End": 1404.92, "Text": " Yeah."}, {"Time_Start": 1404.92, "Time_End": 1405.92, "Text": " Yeah."}, {"Time_Start": 1405.92, "Time_End": 1407.92, "Text": " No."}, {"Time_Start": 1407.92, "Time_End": 1413.92, "Text": " Now, there's one additional program I don't have here and we don't have time to show it to you."}, {"Time_Start": 1413.92, "Time_End": 1415.92, "Text": " It's called T.S.E. Nume. It's on the Hammer of God website."}, {"Time_Start": 1415.92, "Time_End": 1416.42, "Text": " If you're interested in here, we don't have time to show it to you."}, {"Time_Start": 1416.42, "Time_End": 1421.42, "Text": " If you're interested in enumerating machines, it's a new method that we've been, Eric,"}, {"Time_Start": 1421.42, "Time_End": 1425.42, "Text": " Burke Holtz, Clinton Mudge, the guys at Foundstone, like to hide their terminal servers."}, {"Time_Start": 1425.42, "Time_End": 1427.42, "Text": " That way you don't know they're there."}, {"Time_Start": 1427.42, "Time_End": 1429.42, "Text": " And that's a bad thing because terminal service can be really dangerous."}, {"Time_Start": 1429.42, "Time_End": 1433.42, "Text": " If one of your users hides a terminal server on your network, it can open up some bad things."}, {"Time_Start": 1433.42, "Time_End": 1439.42, "Text": " So what this program does, if you're interested in it, it's called TSE NUM, you can go to the website and download it."}, {"Time_Start": 1439.42, "Time_End": 1442.42, "Text": " It will, you specify a target."}, {"Time_Start": 1442.42, "Time_End": 1445.42, "Text": " You say TSENUM, that guy."}, {"Time_Start": 1445.42, "Time_End": 1446.4, "Text": " What that guy will do,"}, {"Time_Start": 1446.42, "Time_End": 1450.42, "Text": " is ask its master browser, what machines can you see on this network?"}, {"Time_Start": 1450.42, "Time_End": 1453.42, "Text": " It will then tunnel that information back to me."}, {"Time_Start": 1453.42, "Time_End": 1456.42, "Text": " You can use that as an anonymous user."}, {"Time_Start": 1456.42, "Time_End": 1461.42, "Text": " So, a buddy of mine tested on one of his resource domains,"}, {"Time_Start": 1461.42, "Time_End": 1463.42, "Text": " and in two seconds got 598 machines."}, {"Time_Start": 1463.42, "Time_End": 1465.42, "Text": " It tells you the type of machine."}, {"Time_Start": 1465.42, "Time_End": 1467.42, "Text": " If it's a domain controller, if it's a SQL server,"}, {"Time_Start": 1467.42, "Time_End": 1470.42, "Text": " if it's a terminal server, all of that information is registered"}, {"Time_Start": 1470.42, "Time_End": 1473.42, "Text": " with the master browser when the machine boots up, right?"}, {"Time_Start": 1473.42, "Time_End": 1475.42, "Text": " He boots up to the master browser and says, hey, I'm on the"}, {"Time_Start": 1475.42, "Time_End": 1477.42, "Text": " to browse and says, hey, I'm on the network,"}, {"Time_Start": 1477.42, "Time_End": 1479.42, "Text": " and I happen to be a SQL server and a terminal server"}, {"Time_Start": 1479.42, "Time_End": 1480.42, "Text": " and a domain controller."}, {"Time_Start": 1480.42, "Time_End": 1481.42, "Text": " Thank you very much."}, {"Time_Start": 1481.42, "Time_End": 1483.42, "Text": " So then you can download all that information as well."}, {"Time_Start": 1483.42, "Time_End": 1485.42, "Text": " So they're kicking me out of here."}, {"Time_Start": 1485.42, "Time_End": 1486.42, "Text": " Thanks very much."}, {"Time_Start": 1486.42, "Time_End": 1487.42, "Text": " Thanks for putting up with me."}]}