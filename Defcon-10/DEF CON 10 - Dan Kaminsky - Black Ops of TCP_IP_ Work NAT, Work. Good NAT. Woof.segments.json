{"segments": [{"Time_Start": 0.0, "Time_End": 7.0, "Text": " Everything on in place that's happened before."}, {"Time_Start": 7.0, "Time_End": 11.5, "Text": " So I find it amusing. I actually can't use wireless giving a talk and a wireless talk."}, {"Time_Start": 11.5, "Time_End": 19.0, "Text": " But anyway, so we're here to talk about TCP IP, what we can do with it, what interesting things we can do with it."}, {"Time_Start": 19.0, "Time_End": 25.0, "Text": " One of the big deals, there is actually more you can do with messed up packets than crash machines."}, {"Time_Start": 25.0, "Time_End": 29.0, "Text": " You've got all these incredibly intelligent people and all they're doing."}, {"Time_Start": 29.0, "Time_End": 31.0, "Text": " I broke that box, I got root on it."}, {"Time_Start": 31.0, "Time_End": 32.0, "Text": " I broke it."}, {"Time_Start": 32.0, "Time_End": 36.0, "Text": " Okay, networks are, they can actually let people communicate,"}, {"Time_Start": 36.0, "Time_End": 39.0, "Text": " and that's kind of what I'm going to try to talk about here."}, {"Time_Start": 39.0, "Time_End": 43.0, "Text": " Now, where I'm coming from, last year, last F-Con,"}, {"Time_Start": 43.0, "Time_End": 49.0, "Text": " I talked about OpenSH, high-level protocol for doing really good, secure interconnectivity,"}, {"Time_Start": 49.0, "Time_End": 54.0, "Text": " getting out of networks, coming into networks, passing through them."}, {"Time_Start": 54.0, "Time_End": 59.0, "Text": " I pretty much worked SSH about as hard as I could work it and realized,"}, {"Time_Start": 59.0, "Time_End": 61.0, "Text": " If I'm going to go ahead and actually do something unique,"}, {"Time_Start": 61.0, "Time_End": 64.0, "Text": " I'm going to have to ditch SSH and go a little lower."}, {"Time_Start": 64.0, "Time_End": 67.0, "Text": " So this talk is actually going to be a lot about layer two, layer three,"}, {"Time_Start": 67.0, "Time_End": 72.0, "Text": " Mac addresses, IP addresses, dealing with these screw-ups in between them."}, {"Time_Start": 72.0, "Time_End": 76.0, "Text": " These are the interesting problems that I decided, first of all, that I could work on,"}, {"Time_Start": 76.0, "Time_End": 79.0, "Text": " and second of all, that I wanted fixed."}, {"Time_Start": 79.0, "Time_End": 82.0, "Text": " Problems. Instant port scanning."}, {"Time_Start": 82.0, "Time_End": 87.0, "Text": " Is it possible to discover instantaneously what network services have been made available,"}, {"Time_Start": 87.0, "Time_End": 89.0, "Text": " no matter how massive this?"}, {"Time_Start": 89.0, "Time_End": 95.38, "Text": " network is? Is it possible? Can I send one packet and no new networks, no new magic"}, {"Time_Start": 95.38, "Time_End": 102.08, "Text": " stuff in the middle of the net, just somehow have it get to multiple destinations? Is that possible?"}, {"Time_Start": 102.08, "Time_End": 107.88, "Text": " Natless Nat? I do a lot of work with Nat and I was curious. Is it possible to share a globally"}, {"Time_Start": 107.88, "Time_End": 113.06, "Text": " addressable IP address, something that will actually route and get somewhere without translating"}, {"Time_Start": 113.06, "Time_End": 118.98, "Text": " in the end to a private IP that Nat does. All the 10 dots, or 192, 168s, all the RFC"}, {"Time_Start": 119.0, "Time_End": 125.0, "Text": " 1818 IPs. And that being said, is it possible to get incoming connectivity into a NAT?"}, {"Time_Start": 125.0, "Time_End": 129.0, "Text": " Everyone's really happy with that when they first get it because they're like,"}, {"Time_Start": 129.0, "Time_End": 133.0, "Text": " dude, this is cool. I've got like this really great firewall. It has like no incoming connectivity."}, {"Time_Start": 133.0, "Time_End": 138.0, "Text": " There's nothing that needs to be hacked in. It barely gets out. You're not even getting in."}, {"Time_Start": 138.0, "Time_End": 142.0, "Text": " Then you realize, well, yeah, yeah, yeah, I want incoming connectivity."}, {"Time_Start": 142.0, "Time_End": 145.0, "Text": " I want to be able to do all these things that the Internet was supposed to be able to do."}, {"Time_Start": 145.0, "Time_End": 148.0, "Text": " Now how do I do it? And this talk is going to try to address that."}, {"Time_Start": 148.0, "Time_End": 149.0, "Text": " that."}, {"Time_Start": 149.0, "Time_End": 153.0, "Text": " And finally, and most fun, Nat deadlock resolution."}, {"Time_Start": 153.0, "Time_End": 160.0, "Text": " Is it possible to establish a TCP connection between two hosts that are both behind Nats?"}, {"Time_Start": 160.0, "Time_End": 163.0, "Text": " And the answer should be interesting."}, {"Time_Start": 163.0, "Time_End": 165.0, "Text": " How we're doing this?"}, {"Time_Start": 165.0, "Time_End": 168.0, "Text": " For strength-free engineering."}, {"Time_Start": 168.0, "Time_End": 170.0, "Text": " This may not be practical."}, {"Time_Start": 170.0, "Time_End": 172.0, "Text": " This probably isn't secure."}, {"Time_Start": 172.0, "Time_End": 176.0, "Text": " But right now, these techniques are quite impossible, and I want to fix that."}, {"Time_Start": 176.0, "Time_End": 178.0, "Text": " So screw the rules."}, {"Time_Start": 178.0, "Time_End": 179.0, "Text": " Let's have some fun."}, {"Time_Start": 179.0, "Time_End": 183.24, "Text": " Okay, now we're going to begin by talking about theory."}, {"Time_Start": 183.24, "Time_End": 184.76, "Text": " I know theory gets really annoying."}, {"Time_Start": 184.76, "Time_End": 186.88, "Text": " Trust me, it's only going to go on for a few minutes."}, {"Time_Start": 186.88, "Time_End": 192.18, "Text": " It's for the people out there who might not know everything about the vagaries of TCPIP."}, {"Time_Start": 192.18, "Time_End": 196.38, "Text": " Now, if you ever look at a sniffer and you're trying to learn this stuff, it's really strange"}, {"Time_Start": 196.38, "Time_End": 201.04, "Text": " because you start off and the next host it went to and it comes where it's coming back and what"}, {"Time_Start": 201.04, "Time_End": 205.56, "Text": " protocols is using to hop to the next place and what protocols can you use to get all the way across"}, {"Time_Start": 205.56, "Time_End": 206.56, "Text": " the network."}, {"Time_Start": 206.56, "Time_End": 207.98, "Text": " And now we're going to go ahead and throw in a checkseys."}, {"Time_Start": 208.0, "Time_End": 210.0, "Text": " and then where the packet came from originally."}, {"Time_Start": 210.0, "Time_End": 212.0, "Text": " We're going to go back and forth, we're going to have three checksums."}, {"Time_Start": 212.0, "Time_End": 213.0, "Text": " They're going to be all over the place."}, {"Time_Start": 213.0, "Time_End": 215.0, "Text": " There's no order it looks like."}, {"Time_Start": 215.0, "Time_End": 216.0, "Text": " Why not have it sorted at least?"}, {"Time_Start": 216.0, "Time_End": 218.0, "Text": " Why not have all the checksums together?"}, {"Time_Start": 218.0, "Time_End": 220.0, "Text": " Why not have the where it came from is together?"}, {"Time_Start": 220.0, "Time_End": 222.0, "Text": " Isn't this efficient? Isn't this redundant?"}, {"Time_Start": 222.0, "Time_End": 224.0, "Text": " Well, the first thing you should probably think."}, {"Time_Start": 224.0, "Time_End": 226.0, "Text": " Who cares?"}, {"Time_Start": 226.0, "Time_End": 228.0, "Text": " And that's actually the point."}, {"Time_Start": 228.0, "Time_End": 231.0, "Text": " Layering is not about what's being said."}, {"Time_Start": 231.0, "Time_End": 234.0, "Text": " It's about who gives a damn about the actual message."}, {"Time_Start": 234.0, "Time_End": 237.0, "Text": " You have one medium, one packet that is sent from host to host."}, {"Time_Start": 237.0, "Time_End": 241.76, "Text": " sent from host to host. But you have many different contexts in which this message is understood."}, {"Time_Start": 242.34, "Time_End": 247.08, "Text": " Listeners reconstruct a little bit of meaning that they personally need, and then the rest is"}, {"Time_Start": 247.08, "Time_End": 253.0, "Text": " random blob of data. Now, Ethernet does this. It doesn't understand IP. IP stacks"}, {"Time_Start": 253.0, "Time_End": 257.5, "Text": " understand this. It doesn't understand the nature of TCP. TCP stacks understand, they don't"}, {"Time_Start": 257.5, "Time_End": 262.12, "Text": " understand SSH. The idea is the less you need to understand, the less code you need to write,"}, {"Time_Start": 262.12, "Time_End": 266.98, "Text": " the less you need to worry about, the more likely your code's actually going to do what it's supposed to do."}, {"Time_Start": 267.0, "Time_End": 274.0, "Text": " do. The way I, the analogy I used to describe this, the post office doesn't care what you put into your letter."}, {"Time_Start": 274.0, "Time_End": 277.0, "Text": " Well, hopefully, I guess things have sort of changed."}, {"Time_Start": 277.0, "Time_End": 279.0, "Text": " The post office doesn't really care."}, {"Time_Start": 279.0, "Time_End": 283.0, "Text": " They just want to see, is there money, is there an address, is there a return address?"}, {"Time_Start": 283.0, "Time_End": 286.0, "Text": " If there's insufficient postage, it's going to get sent back to the return address."}, {"Time_Start": 286.0, "Time_End": 293.0, "Text": " Now I'm sure everyone here's familiar with the classic post office hack, you have someone you want to send mail to for free."}, {"Time_Start": 293.0, "Time_End": 296.0, "Text": " So you put their address in the return address."}, {"Time_Start": 296.0, "Time_End": 296.98, "Text": " And when you don't have sufficient postage,"}, {"Time_Start": 297.0, "Time_End": 301.0, "Text": " it goes back to where it came from, oh, that was where you wanted to send it."}, {"Time_Start": 301.0, "Time_End": 304.0, "Text": " Now it turns out that there's all sorts of protections against this hack."}, {"Time_Start": 304.0, "Time_End": 308.0, "Text": " This is rather obvious in terms of, well, where is this packet dropped?"}, {"Time_Start": 308.0, "Time_End": 310.0, "Text": " Where is this letter dropped off?"}, {"Time_Start": 310.0, "Time_End": 313.0, "Text": " I'm not returning something dropped off in San Francisco."}, {"Time_Start": 313.0, "Time_End": 315.0, "Text": " I'm not returning it to dish booty."}, {"Time_Start": 315.0, "Time_End": 317.0, "Text": " It's not going to happen."}, {"Time_Start": 317.0, "Time_End": 322.0, "Text": " Arrow recovery. Arrow recovery is interesting."}, {"Time_Start": 322.0, "Time_End": 325.0, "Text": " Layer 2. Layer 2 is the point-to-to-point layer."}, {"Time_Start": 325.0, "Time_End": 327.0, "Text": " It's where I talked to the next guy on the one."}, {"Time_Start": 327.0, "Time_End": 332.1, "Text": " wire. Errors are really quickly recoverable on layer two because the guy's right there."}, {"Time_Start": 332.1, "Time_End": 338.0, "Text": " You have a direct link to him. The problem is your error checking, your checksum,"}, {"Time_Start": 338.0, "Time_End": 342.0, "Text": " your little value that you see if it's correct and if it's correct the message got through okay."}, {"Time_Start": 342.0, "Time_End": 347.0, "Text": " Your checksums calculated at the same point that's actually creating the packet from scratch."}, {"Time_Start": 347.0, "Time_End": 349.0, "Text": " And this is problematic."}, {"Time_Start": 349.0, "Time_End": 355.0, "Text": " The example I used to explain this, anyone here familiar with the example of corporate fertilizer."}, {"Time_Start": 355.0, "Time_End": 357.0, "Text": " So bad news happens."}, {"Time_Start": 357.0, "Time_End": 359.0, "Text": " really some nasty shit happens."}, {"Time_Start": 359.0, "Time_End": 361.5, "Text": " And someone tells us someone else."}, {"Time_Start": 361.5, "Time_End": 364.0, "Text": " And the first thing that guy says, I can't say shit, I'm going to say manure."}, {"Time_Start": 364.0, "Time_End": 367.0, "Text": " And then that guy tells his boss, it's not manure anymore, it's fertilizer."}, {"Time_Start": 367.0, "Time_End": 370.0, "Text": " And then that guy tells his boss, and it's not fertilizer, it's farming supplies."}, {"Time_Start": 370.0, "Time_End": 373.0, "Text": " And then the next guy tells his boss, it's not farming supplies."}, {"Time_Start": 373.0, "Time_End": 375.0, "Text": " It's the stuff that life is made out of."}, {"Time_Start": 375.0, "Time_End": 378.0, "Text": " So by the time I guess the CEO, this original message,"}, {"Time_Start": 378.0, "Time_End": 382.0, "Text": " shit, becomes the stuff that life is made out of."}, {"Time_Start": 382.0, "Time_End": 387.0, "Text": " Each individual chain had correct messaging happening from point to point."}, {"Time_Start": 387.0, "Time_End": 390.0, "Text": " But from beginning to end, the message was quite lost."}, {"Time_Start": 390.0, "Time_End": 396.0, "Text": " So you can't actually really depend on error checking at layer two."}, {"Time_Start": 396.0, "Time_End": 398.0, "Text": " Layer 4 is what cares."}, {"Time_Start": 398.0, "Time_End": 402.0, "Text": " Layer 4 is the CEO wants to know what the guy in the field says."}, {"Time_Start": 402.0, "Time_End": 405.0, "Text": " The guy in the field said, shit, doesn't matter what happened in the middle."}, {"Time_Start": 405.0, "Time_End": 408.0, "Text": " At the end, CEO needs to hear, we're screwed."}, {"Time_Start": 408.0, "Time_End": 411.0, "Text": " Layer 3. Layer 3 is the routes."}, {"Time_Start": 411.0, "Time_End": 413.0, "Text": " It's all the people in the middle."}, {"Time_Start": 413.0, "Time_End": 416.0, "Text": " These are people who just, these are devices that just pass messages."}, {"Time_Start": 416.0, "Time_End": 418.0, "Text": " messages."}, {"Time_Start": 418.0, "Time_End": 421.0, "Text": " They're passing all tons of messages from all sorts of people."}, {"Time_Start": 421.0, "Time_End": 424.0, "Text": " They don't give a damn what they're seeing."}, {"Time_Start": 424.0, "Time_End": 427.0, "Text": " Now, in the TCP stack, they actually have a check-sum."}, {"Time_Start": 427.0, "Time_End": 430.0, "Text": " But if you look at the actual implementation of what's going on,"}, {"Time_Start": 430.0, "Time_End": 432.0, "Text": " they see, yeah, we got to check some."}, {"Time_Start": 432.0, "Time_End": 437.0, "Text": " The only modification we're doing to this packet is one document on the TTL value."}, {"Time_Start": 437.0, "Time_End": 441.0, "Text": " TTL, time to live, how many times is things allowed to hop across the network?"}, {"Time_Start": 441.0, "Time_End": 444.0, "Text": " Now we have a TTL value so that we make sure we don't get a routing loop."}, {"Time_Start": 444.0, "Time_End": 445.0, "Text": " A package just goes around and around and around."}, {"Time_Start": 445.0, "Time_End": 451.0, "Text": " goes around and around and never stops and the entire network falls over and dies, this tends to suck."}, {"Time_Start": 451.0, "Time_End": 456.0, "Text": " So you have this TTL value, it's decremented, if it ever hit zero, the packets dropped."}, {"Time_Start": 456.0, "Time_End": 459.0, "Text": " That's the only change most routers will do to a packet en route."}, {"Time_Start": 459.0, "Time_End": 466.0, "Text": " And since it's the only change, they decrement the checksum by the amount that would happen if the checksum was correct."}, {"Time_Start": 466.0, "Time_End": 469.0, "Text": " So if they have an incorrect checksum, or they'll decrement that too."}, {"Time_Start": 469.0, "Time_End": 470.0, "Text": " Why?"}, {"Time_Start": 470.0, "Time_End": 473.0, "Text": " Because they don't care about the errors, it's not personally relevant."}, {"Time_Start": 473.0, "Time_End": 474.0, "Text": " This slide intentionally left."}, {"Time_Start": 474.0, "Time_End": 476.0, "Text": " slide, intentionally left blank."}, {"Time_Start": 476.0, "Time_End": 480.0, "Text": " Oh, I should mention questions."}, {"Time_Start": 480.0, "Time_End": 482.0, "Text": " If you have a question, write it down."}, {"Time_Start": 482.0, "Time_End": 484.0, "Text": " I want your questions. I want your challenges."}, {"Time_Start": 484.0, "Time_End": 487.0, "Text": " It's a good question, you get a corona."}, {"Time_Start": 487.0, "Time_End": 490.0, "Text": " If it's a really good question,"}, {"Time_Start": 490.0, "Time_End": 492.0, "Text": " and I got a 12-back."}, {"Time_Start": 492.0, "Time_End": 496.0, "Text": " Really good question, I wrote a book or part of it, you get one of them."}, {"Time_Start": 496.0, "Time_End": 498.0, "Text": " This is hackproofing your network."}, {"Time_Start": 498.0, "Time_End": 502.0, "Text": " Thanks to Singress, they pretty much funded a lot of this work to do this research."}, {"Time_Start": 502.0, "Time_End": 503.0, "Text": " And if you stump me,"}, {"Time_Start": 503.0, "Time_End": 507.0, "Text": " stump me. I get a corona too because I'm thirsty."}, {"Time_Start": 507.0, "Time_End": 511.0, "Text": " Alright, so we've gone up a little bit of stuff about layers."}, {"Time_Start": 511.0, "Time_End": 514.0, "Text": " Let's look at what actually starts a TCP connection."}, {"Time_Start": 514.0, "Time_End": 516.0, "Text": " I know, we got to do the damn three-way handshake."}, {"Time_Start": 516.0, "Time_End": 518.0, "Text": " You can't talk about TCP at the you without doing it."}, {"Time_Start": 518.0, "Time_End": 519.0, "Text": " Really simple."}, {"Time_Start": 519.0, "Time_End": 522.0, "Text": " I send a sin, that means I want to talk to you."}, {"Time_Start": 522.0, "Time_End": 525.0, "Text": " I got a response back that's Sin Act, you want to talk to me."}, {"Time_Start": 525.0, "Time_End": 528.0, "Text": " If I get a reset act, you don't want to talk to me."}, {"Time_Start": 528.0, "Time_End": 530.0, "Text": " And finally, last phase, an act."}, {"Time_Start": 530.0, "Time_End": 531.0, "Text": " Cool, you want to talk to me?"}, {"Time_Start": 531.0, "Time_End": 532.0, "Text": " Okay, let's begin."}, {"Time_Start": 532.0, "Time_End": 533.0, "Text": " That's all we need to do."}, {"Time_Start": 533.0, "Time_End": 534.0, "Text": " do with that."}, {"Time_Start": 534.0, "Time_End": 535.0, "Text": " ports."}, {"Time_Start": 535.0, "Time_End": 537.0, "Text": " Ports are basically what app to what app."}, {"Time_Start": 537.0, "Time_End": 538.0, "Text": " Port 80's web."}, {"Time_Start": 538.0, "Time_End": 539.0, "Text": " Port 143 is IMAP."}, {"Time_Start": 539.0, "Time_End": 541.0, "Text": " Port 443 is SSL."}, {"Time_Start": 541.0, "Time_End": 545.0, "Text": " It says, hey, I went to this machine and I want this process on that machine."}, {"Time_Start": 545.0, "Time_End": 550.0, "Text": " IP handles where we're going, ports handle what we want from them."}, {"Time_Start": 550.0, "Time_End": 551.0, "Text": " Sequence numbers."}, {"Time_Start": 551.0, "Time_End": 553.0, "Text": " Sequence numbers are there for two purposes."}, {"Time_Start": 553.0, "Time_End": 555.0, "Text": " First of all, they're really not..."}, {"Time_Start": 555.0, "Time_End": 558.0, "Text": " What the but Jesus was that?"}, {"Time_Start": 558.0, "Time_End": 562.0, "Text": " No, sequence numbers are used for two things."}, {"Time_Start": 562.0, "Time_End": 563.0, "Text": " First of all,"}, {"Time_Start": 563.0, "Time_End": 567.5, "Text": " they go ahead and actually let us keep track of how the data connection is going."}, {"Time_Start": 567.5, "Time_End": 571.5, "Text": " Let us find out eventually if we've dropped packets where we are on the stream and so on."}, {"Time_Start": 571.5, "Time_End": 576.5, "Text": " They're also really, really useful to find out, is this person who's returning to me?"}, {"Time_Start": 576.5, "Time_End": 578.0, "Text": " Did I ever talk to him in the first place?"}, {"Time_Start": 578.0, "Time_End": 580.0, "Text": " Did he have the ability to respond to me?"}, {"Time_Start": 580.0, "Time_End": 582.0, "Text": " It's a security feature."}, {"Time_Start": 582.0, "Time_End": 587.0, "Text": " It's not a great one, but it has 32 bits of entry be that has to be matched, so it ain't too bad."}, {"Time_Start": 587.0, "Time_End": 592.5, "Text": " So connection summary, the flag determines the phase, the port determines the process,"}, {"Time_Start": 592.5, "Time_End": 594.5, "Text": " the sequence secures the session."}, {"Time_Start": 594.5, "Time_End": 598.5, "Text": " So, with all that in mind, let's begin on the nice, applied, useful stuff."}, {"Time_Start": 598.5, "Time_End": 599.5, "Text": " Thank you for your patience."}, {"Time_Start": 599.5, "Time_End": 600.5, "Text": " Instant port scanning."}, {"Time_Start": 600.5, "Time_End": 603.5, "Text": " Can I find out what the hell is going on now?"}, {"Time_Start": 603.5, "Time_End": 604.5, "Text": " Not later, now."}, {"Time_Start": 604.5, "Time_End": 606.5, "Text": " And the answer is yes."}, {"Time_Start": 606.5, "Time_End": 608.5, "Text": " Practically, even securely."}, {"Time_Start": 608.5, "Time_End": 609.5, "Text": " Let's check this out."}, {"Time_Start": 609.5, "Time_End": 611.5, "Text": " So you go ahead and you have some app."}, {"Time_Start": 611.5, "Time_End": 612.5, "Text": " I actually wrote this."}, {"Time_Start": 612.5, "Time_End": 613.5, "Text": " This is 100% done."}, {"Time_Start": 613.5, "Time_End": 615.5, "Text": " It'll be done as soon as I actually have net access."}, {"Time_Start": 615.5, "Time_End": 617.5, "Text": " You bastard to are destroying my net connection."}, {"Time_Start": 617.5, "Time_End": 619.5, "Text": " All right."}, {"Time_Start": 619.5, "Time_End": 620.5, "Text": " There's a fork in this thing."}, {"Time_Start": 620.5, "Time_End": 621.5, "Text": " First fork."}, {"Time_Start": 621.5, "Time_End": 622.5, "Text": " Go ahead."}, {"Time_Start": 622.5, "Time_End": 625.5, "Text": " sends a bunch of packets on the same local port."}, {"Time_Start": 625.5, "Time_End": 626.5, "Text": " That's what it does."}, {"Time_Start": 626.5, "Time_End": 628.5, "Text": " Doesn't keep track, doesn't remember,"}, {"Time_Start": 628.5, "Time_End": 630.5, "Text": " doesn't store any values that say,"}, {"Time_Start": 630.5, "Time_End": 631.5, "Text": " hey, I talk to this guy."}, {"Time_Start": 631.5, "Time_End": 633.5, "Text": " It just sends packets."}, {"Time_Start": 633.5, "Time_End": 635.5, "Text": " The other thing goes ahead."}, {"Time_Start": 635.5, "Time_End": 637.5, "Text": " It's sniffing for packets from that local port"}, {"Time_Start": 637.5, "Time_End": 639.5, "Text": " that the other process sent."}, {"Time_Start": 639.5, "Time_End": 641.5, "Text": " Because it's sniffing off a single local port,"}, {"Time_Start": 641.5, "Time_End": 645.5, "Text": " we can use LibP cap kernel acceleration of the BPF."}, {"Time_Start": 645.5, "Time_End": 648.5, "Text": " If we get a CNAQ back, we go, great, I got a Cynac."}, {"Time_Start": 648.5, "Time_End": 649.5, "Text": " Some port was up."}, {"Time_Start": 649.5, "Time_End": 650.5, "Text": " Here's the port."}, {"Time_Start": 650.5, "Time_End": 651.5, "Text": " Here's the host."}, {"Time_Start": 651.5, "Time_End": 652.5, "Text": " Yay."}, {"Time_Start": 652.5, "Time_End": 653.5, "Text": " Well, the Reset Act."}, {"Time_Start": 653.5, "Time_End": 657.5, "Text": " Well, the host was down, and the host was up, but the port was down."}, {"Time_Start": 657.5, "Time_End": 661.5, "Text": " Less, you know, you don't need to know it as much, but it's useful to know."}, {"Time_Start": 661.5, "Time_End": 665.5, "Text": " Now the first thing that should come up with this stateless approach, I can spoof a response."}, {"Time_Start": 665.5, "Time_End": 671.5, "Text": " I send a message to someone, he goes, hey, this asshole's doing a, he's doing a stateless scan."}, {"Time_Start": 671.5, "Time_End": 673.5, "Text": " I'm going to send about 800,000 responses."}, {"Time_Start": 673.5, "Time_End": 677.5, "Text": " He never made a message, he never sent a request to."}, {"Time_Start": 677.5, "Time_End": 681.5, "Text": " And because he's not keeping track of who he sent requests to, no problem."}, {"Time_Start": 681.5, "Time_End": 685.5, "Text": " He's just going to think, you know, he's going to get all these messages."}, {"Time_Start": 685.5, "Time_End": 687.5, "Text": " Maybe he's putting it into a database."}, {"Time_Start": 687.5, "Time_End": 689.5, "Text": " Maybe he's storing it then after he gets the responses back."}, {"Time_Start": 689.5, "Time_End": 691.5, "Text": " Maybe I can overflow him then."}, {"Time_Start": 691.5, "Time_End": 693.5, "Text": " Maybe I can just make a mess out of him."}, {"Time_Start": 693.5, "Time_End": 695.5, "Text": " Now there is a solution."}, {"Time_Start": 695.5, "Time_End": 698.5, "Text": " Anyone here familiar with the nice little things called sin cookies?"}, {"Time_Start": 698.5, "Time_End": 703.5, "Text": " Sin cookies were developed in 1996 by that classic DJ Bernstein"}, {"Time_Start": 703.5, "Time_End": 705.5, "Text": " when sin floods became common."}, {"Time_Start": 705.5, "Time_End": 709.5, "Text": " Well, I go ahead and I flood you with a whole bunch of connection requests."}, {"Time_Start": 709.5, "Time_End": 711.48, "Text": " You set up your kernel and say, okay, I got a bunch of"}, {"Time_Start": 711.5, "Time_End": 715.5, "Text": " connection requests, I'm going to do a bunch of responses."}, {"Time_Start": 715.5, "Time_End": 718.5, "Text": " And the responses go to nowhere."}, {"Time_Start": 718.5, "Time_End": 727.5, "Text": " Karma, karma, karma."}, {"Time_Start": 727.5, "Time_End": 729.5, "Text": " All right."}, {"Time_Start": 729.5, "Time_End": 732.5, "Text": " Who shouted out beers for everyone?"}, {"Time_Start": 732.5, "Time_End": 735.5, "Text": " All right, you up here now."}, {"Time_Start": 735.5, "Time_End": 738.5, "Text": " Someone?"}, {"Time_Start": 738.5, "Time_End": 740.5, "Text": " I think we need a beer opener up here up here."}, {"Time_Start": 740.5, "Time_End": 741.5, "Text": " I seem to have fucked up here."}, {"Time_Start": 741.5, "Time_End": 742.5, "Text": " up?"}, {"Time_Start": 742.5, "Time_End": 743.5, "Text": " Get up here."}, {"Time_Start": 743.5, "Time_End": 744.5, "Text": " You got one, too."}, {"Time_Start": 744.5, "Time_End": 745.5, "Text": " Yeah."}, {"Time_Start": 745.5, "Time_End": 746.5, "Text": " Open it up."}, {"Time_Start": 746.5, "Time_End": 747.5, "Text": " What the hell?"}, {"Time_Start": 747.5, "Time_End": 764.5, "Text": " Sweet."}, {"Time_Start": 764.5, "Time_End": 765.5, "Text": " So someone observed for all"}, {"Time_Start": 765.5, "Time_End": 768.5, "Text": " for all the bitching everyone does about Microsoft."}, {"Time_Start": 768.5, "Time_End": 770.5, "Text": " You notice everyone's running fucking PowerPoint."}, {"Time_Start": 770.5, "Time_End": 772.5, "Text": " Without exception."}, {"Time_Start": 772.5, "Time_End": 775.5, "Text": " All right, wait, wait, wait, wait."}, {"Time_Start": 775.5, "Time_End": 778.5, "Text": " Who's the speaker in here who's not running PowerPoint?"}, {"Time_Start": 778.5, "Time_End": 782.5, "Text": " Okay, meet me after, I'll buy your beers after."}, {"Time_Start": 782.5, "Time_End": 784.5, "Text": " All right, so send cookies."}, {"Time_Start": 784.5, "Time_End": 791.5, "Text": " Sim cookies go ahead, and so I send out a request, and the colonel goes ahead and says,"}, {"Time_Start": 791.5, "Time_End": 794.5, "Text": " well, I'm not going to remember who sent me this request."}, {"Time_Start": 794.5, "Time_End": 800.5, "Text": " But on the Syn Act that goes out, I'm going to put a little cryptographic signature that says,"}, {"Time_Start": 800.5, "Time_End": 802.5, "Text": " I sent a sin act to this guy."}, {"Time_Start": 802.5, "Time_End": 806.5, "Text": " When the final phase, the act comes back, it's going to get reflected back."}, {"Time_Start": 806.5, "Time_End": 810.5, "Text": " And when it gets reflected back, I go, hey, wait, this guy got my sin act,"}, {"Time_Start": 810.5, "Time_End": 814.5, "Text": " sent me back the act, I can decrypt the sequence number in the act,"}, {"Time_Start": 814.5, "Time_End": 817.5, "Text": " I can figure out who talked to me, I can get the state back,"}, {"Time_Start": 817.5, "Time_End": 821.5, "Text": " I can go ahead and actually talk to this person, and even though I forgot about him earlier."}, {"Time_Start": 821.5, "Time_End": 824.5, "Text": " It's a very elegant, very beautiful system."}, {"Time_Start": 824.5, "Time_End": 828.5, "Text": " But you know, the act reflects a value from the sin act."}, {"Time_Start": 828.5, "Time_End": 829.5, "Text": " Ah!"}, {"Time_Start": 829.5, "Time_End": 830.5, "Text": " But the sin act"}, {"Time_Start": 830.5, "Time_End": 833.5, "Text": " reflects a sequence number in the sin."}, {"Time_Start": 833.5, "Time_End": 839.5, "Text": " So instead of tracking Sin Act reflections in the Act, let's track sin reflections in the Syn Act."}, {"Time_Start": 839.5, "Time_End": 845.5, "Text": " Let's put a value in the sin when we send it out that is cryptographically matched to the"}, {"Time_Start": 845.5, "Time_End": 848.5, "Text": " host that we sent the request to or the port that we sent the request to."}, {"Time_Start": 848.5, "Time_End": 852.5, "Text": " When we get the Sin Act or the Reset Act back, we check the sequence number."}, {"Time_Start": 852.5, "Time_End": 858.5, "Text": " If it matches, we talk to this guy, we sent a request to it, it's authenticated."}, {"Time_Start": 858.5, "Time_End": 859.5, "Text": " Now here's our implement."}, {"Time_Start": 859.5, "Time_End": 860.5, "Text": " We have an implementation."}, {"Time_Start": 860.5, "Time_End": 862.5, "Text": " documentation, ScanRand 1-0."}, {"Time_Start": 862.5, "Time_End": 865.5, "Text": " There's an element of what I'm calling the Bakhetho Kairetsu."}, {"Time_Start": 865.5, "Time_End": 870.5, "Text": " It is my package of really screwed up TCP hacks that will be growing over time."}, {"Time_Start": 870.5, "Time_End": 872.5, "Text": " This thing's really, really trivial."}, {"Time_Start": 872.5, "Time_End": 874.5, "Text": " It's like 380 lines of LibNet and LibP cap."}, {"Time_Start": 874.5, "Time_End": 877.5, "Text": " It's like a trivial MD4 include, don't worry about it."}, {"Time_Start": 877.5, "Time_End": 883.5, "Text": " No state sends out 53 byte packets at 11 to 20 megabit,"}, {"Time_Start": 883.5, "Time_End": 886.5, "Text": " and it's possibly even portable from platform to platform."}, {"Time_Start": 886.5, "Time_End": 889.5, "Text": " This is a screenshot of it in action."}, {"Time_Start": 889.5, "Time_End": 895.5, "Text": " I don't know if you can see the deltas there, but this is a scan of about 20,000 ports throughout my network."}, {"Time_Start": 895.5, "Time_End": 898.5, "Text": " The last packet came in in about five seconds."}, {"Time_Start": 898.5, "Time_End": 902.5, "Text": " When I ran this in unnamed large multinational corporation."}, {"Time_Start": 902.5, "Time_End": 907.5, "Text": " Yeah, I was able to say, hey, you got a class B, nice class B you got there."}, {"Time_Start": 907.5, "Time_End": 910.5, "Text": " You have 8,303 web servers."}, {"Time_Start": 910.5, "Time_End": 912.5, "Text": " That took four seconds."}, {"Time_Start": 912.5, "Time_End": 917.5, "Text": " This is a really nice thing to have."}, {"Time_Start": 919.5, "Time_End": 926.5, "Text": " Implications, user space is cool, packet content can be overloaded,"}, {"Time_Start": 926.5, "Time_End": 929.5, "Text": " and elegant solutions can be reapplied."}, {"Time_Start": 929.5, "Time_End": 933.5, "Text": " Next up, Gorilla Multicast."}, {"Time_Start": 933.5, "Time_End": 940.5, "Text": " Is it possible to send a single packet to multiple recipients using today's multicast-free internet?"}, {"Time_Start": 940.5, "Time_End": 943.5, "Text": " Hell yes! The method's fun."}, {"Time_Start": 943.5, "Time_End": 947.5, "Text": " You go ahead, you link a Unicast IP to a broadcast Mac address."}, {"Time_Start": 947.5, "Time_End": 948.5, "Text": " All responses to that IP will be able to a broadcast Mac address."}, {"Time_Start": 948.5, "Time_End": 949.5, "Text": " All responses to that IP will be."}, {"Time_Start": 949.5, "Time_End": 951.5, "Text": " be broadcast throughout the subnet."}, {"Time_Start": 951.5, "Time_End": 954.5, "Text": " Now let me explain this a little slowly."}, {"Time_Start": 954.5, "Time_End": 960.5, "Text": " All right, there is redundancy in between the layers that are on your subnet, that are on your land."}, {"Time_Start": 960.5, "Time_End": 965.5, "Text": " At layer two, broadcasts, packets that are sent to every port, even on a switch."}, {"Time_Start": 965.5, "Time_End": 970.5, "Text": " Broadcasts are always sent to all Fs. If it hits all Fs, it's going to be sent everywhere."}, {"Time_Start": 970.5, "Time_End": 976.5, "Text": " Now it's not mentioned in this slide, but there's also an Ethernet range for multicast addresses."}, {"Time_Start": 976.5, "Time_End": 979.5, "Text": " I don't know the prefix off the top of my head I was supposed to get it."}, {"Time_Start": 979.5, "Time_End": 986.5, "Text": " But yeah, you send a packet to this MAC address, it will also get broadcast out to each port."}, {"Time_Start": 986.5, "Time_End": 989.5, "Text": " That's assuming IGMP snooping is not on, don't worry about that."}, {"Time_Start": 989.5, "Time_End": 996.5, "Text": " 0105B, with the next bit 0. Thank you much."}, {"Time_Start": 996.5, "Time_End": 998.5, "Text": " See you later."}, {"Time_Start": 998.5, "Time_End": 1002.5, "Text": " Someone opened this forum."}, {"Time_Start": 1002.5, "Time_End": 1007.5, "Text": " All right. Layer 3 operates a little differently."}, {"Time_Start": 1007.5, "Time_End": 1009.5, "Text": " Layer 2 doesn't matter your subnet."}, {"Time_Start": 1009.5, "Time_End": 1012.0, "Text": " Same damn broadcast, same damn multi-guess."}, {"Time_Start": 1012.0, "Time_End": 1016.5, "Text": " Layer 3, the broadcast is actually linked to what subnet you happen to pick."}, {"Time_Start": 1016.5, "Time_End": 1022.5, "Text": " It's the last IP of your subnet. So if your subnet's 1010101050,"}, {"Time_Start": 1022.5, "Time_End": 1028.5, "Text": " a mask, your broadcasts IP is 10.0155."}, {"Time_Start": 1028.5, "Time_End": 1032.0, "Text": " Now once upon a time we had this nice thing called directed broadcast."}, {"Time_Start": 1032.0, "Time_End": 1036.5, "Text": " I could send a packet to this directed broadcast IP and it would get to all the machines back there."}, {"Time_Start": 1036.5, "Time_End": 1039.5, "Text": " Then some idiots wrote this tool called Smurf and that got shut down."}, {"Time_Start": 1039.5, "Time_End": 1041.5, "Text": " down really, really quickly."}, {"Time_Start": 1041.5, "Time_End": 1044.5, "Text": " You sent one packet to a directed broadcast."}, {"Time_Start": 1044.5, "Time_End": 1046.5, "Text": " Source address, whoever you hate."}, {"Time_Start": 1046.5, "Time_End": 1048.5, "Text": " You send it to the directive broadcasts,"}, {"Time_Start": 1048.5, "Time_End": 1051.5, "Text": " all the machines on that subnet say, oh hey, you pinged me?"}, {"Time_Start": 1051.5, "Time_End": 1053.5, "Text": " Oh, hey, oh, hello, hello?"}, {"Time_Start": 1053.5, "Time_End": 1055.5, "Text": " Yeah, that wasn't fun."}, {"Time_Start": 1055.5, "Time_End": 1059.5, "Text": " We're kind of bringing this back only in a different way."}, {"Time_Start": 1059.5, "Time_End": 1064.5, "Text": " Anyone here know the legal fiction behind a corporation?"}, {"Time_Start": 1064.5, "Time_End": 1068.5, "Text": " It's basically lots and lots of people"}, {"Time_Start": 1068.5, "Time_End": 1071.5, "Text": " people, one legal identity."}, {"Time_Start": 1071.5, "Time_End": 1075.5, "Text": " Well, it turns out we can do something really cool with this concept of the corporation."}, {"Time_Start": 1075.5, "Time_End": 1077.5, "Text": " We apply it to IP addressing."}, {"Time_Start": 1077.5, "Time_End": 1078.5, "Text": " We go ahead."}, {"Time_Start": 1078.5, "Time_End": 1081.5, "Text": " We have a cloud of machines on a given subnet."}, {"Time_Start": 1081.5, "Time_End": 1084.5, "Text": " One of them requests an IP address."}, {"Time_Start": 1084.5, "Time_End": 1086.5, "Text": " They do it through DHCP even."}, {"Time_Start": 1086.5, "Time_End": 1091.5, "Text": " You know what MAC address we stick on that IP that we request?"}, {"Time_Start": 1091.5, "Time_End": 1094.5, "Text": " We stick broadcast or we stick multicast."}, {"Time_Start": 1094.5, "Time_End": 1097.5, "Text": " So you have a unicast IP address, normal 10."}, {"Time_Start": 1097.5, "Time_End": 1101.5, "Text": " 10120 and it's hardware address on the land."}, {"Time_Start": 1101.5, "Time_End": 1103.0, "Text": " Now that's broadcast."}, {"Time_Start": 1103.0, "Time_End": 1107.0, "Text": " So when the packets comes back, it's going to everybody."}, {"Time_Start": 1107.0, "Time_End": 1111.0, "Text": " You end up issuing layer four requests against remote hosts."}, {"Time_Start": 1111.0, "Time_End": 1113.0, "Text": " It comes back, unicasted at layer three."}, {"Time_Start": 1113.0, "Time_End": 1116.0, "Text": " The responses are broadcasted at layer two."}, {"Time_Start": 1116.0, "Time_End": 1120.0, "Text": " Ladies and gentlemen, elegance has left the building."}, {"Time_Start": 1120.0, "Time_End": 1125.5, "Text": " Firewall issues?"}, {"Time_Start": 1125.5, "Time_End": 1127.0, "Text": " Look, mom, multicast their nets."}, {"Time_Start": 1127.0, "Time_End": 1129.0, "Text": " UDP."}, {"Time_Start": 1129.0, "Time_End": 1130.0, "Text": " No problem."}, {"Time_Start": 1130.0, "Time_End": 1132.0, "Text": " We don't need to do any responses."}, {"Time_Start": 1132.0, "Time_End": 1135.0, "Text": " Once the state entries opened up in the UDP state table on that firewall,"}, {"Time_Start": 1135.0, "Time_End": 1138.0, "Text": " packets can just keep on coming in on broadcast."}, {"Time_Start": 1138.0, "Time_End": 1140.0, "Text": " No problem."}, {"Time_Start": 1140.0, "Time_End": 1142.0, "Text": " Now, I could have just stopped at UDP."}, {"Time_Start": 1142.0, "Time_End": 1144.0, "Text": " You know, you can get your data streams, build your protocol,"}, {"Time_Start": 1144.0, "Time_End": 1146.0, "Text": " build you out-of-band stuff all you want."}, {"Time_Start": 1146.0, "Time_End": 1148.0, "Text": " But that's no fun."}, {"Time_Start": 1148.0, "Time_End": 1151.0, "Text": " Let's do TCP with Gorilla Multicast."}, {"Time_Start": 1151.0, "Time_End": 1154.0, "Text": " Without any listeners, the stream dies."}, {"Time_Start": 1154.0, "Time_End": 1155.0, "Text": " There's no one to respond."}, {"Time_Start": 1155.0, "Time_End": 1156.0, "Text": " And that's what you'd want."}, {"Time_Start": 1156.0, "Time_End": 1160.0, "Text": " you'd want. If you got one listener, you want the stream to operate normally."}, {"Time_Start": 1160.0, "Time_End": 1163.0, "Text": " You know, the one listener sends back the acknowledgments as needed."}, {"Time_Start": 1163.0, "Time_End": 1167.0, "Text": " With many listeners, only one of these guys should actually acknowledge."}, {"Time_Start": 1167.0, "Time_End": 1171.0, "Text": " You don't want acknowledgments from every single listener."}, {"Time_Start": 1171.0, "Time_End": 1175.0, "Text": " It's going to flood on the way out, and you know what, the guy on the outside network is"}, {"Time_Start": 1175.0, "Time_End": 1178.0, "Text": " going to find out, hey, I've got multiple listeners here."}, {"Time_Start": 1178.0, "Time_End": 1182.0, "Text": " We want to be completely normal outside our subnet."}, {"Time_Start": 1182.0, "Time_End": 1185.0, "Text": " We just all want to cooperate, like, you know, theoretically a corporation."}, {"Time_Start": 1185.0, "Time_End": 1187.0, "Text": " a corporation cooperates."}, {"Time_Start": 1187.0, "Time_End": 1190.0, "Text": " You only have one point of contact, ideally."}, {"Time_Start": 1190.0, "Time_End": 1193.0, "Text": " Solution to this is random delays."}, {"Time_Start": 1193.0, "Time_End": 1196.0, "Text": " Now this is elegant and has some other uses as well."}, {"Time_Start": 1196.0, "Time_End": 1200.0, "Text": " So I sniff a packet that theoretically I'm supposed to respond to."}, {"Time_Start": 1200.0, "Time_End": 1203.0, "Text": " I queue the packet that I'm supposed to go ahead and respond with,"}, {"Time_Start": 1203.0, "Time_End": 1205.0, "Text": " and I wait a random amount of time."}, {"Time_Start": 1205.0, "Time_End": 1208.0, "Text": " And I see if someone else sends the response first."}, {"Time_Start": 1208.0, "Time_End": 1210.0, "Text": " Someone else says the response first,"}, {"Time_Start": 1210.0, "Time_End": 1213.0, "Text": " I go ahead and I see what response he's sent in case I need any state from it."}, {"Time_Start": 1213.0, "Time_End": 1214.0, "Text": " No one else sends a response."}, {"Time_Start": 1214.0, "Time_End": 1215.0, "Text": " No one else sends a response."}, {"Time_Start": 1215.0, "Time_End": 1227.0, "Text": " the response? I send the response. You can have a hundred people doing this random delay approach. One of them's going to come first. The other 99 are going to hear the response."}, {"Time_Start": 1227.0, "Time_End": 1231.0, "Text": " Now it turns out that you have to go ahead and send a broadcast out separate from your response."}, {"Time_Start": 1231.0, "Time_End": 1236.0, "Text": " Say, hey everyone, I already took care of that acknowledgement. You guys get the next one."}, {"Time_Start": 1236.0, "Time_End": 1239.0, "Text": " But it ends up working out pretty good."}, {"Time_Start": 1239.0, "Time_End": 1242.0, "Text": " So you're recontextualizing layer two and layer three."}, {"Time_Start": 1242.0, "Time_End": 1244.0, "Text": " Question."}, {"Time_Start": 1244.0, "Time_End": 1250.0, "Text": " You know, right in with this, we already have a situation where one IP is standing in for many, many hosts."}, {"Time_Start": 1250.0, "Time_End": 1255.0, "Text": " Do we have any other situations where one IP stands in for many, many hosts?"}, {"Time_Start": 1255.0, "Time_End": 1260.0, "Text": " Nah. Nat does that, exactly."}, {"Time_Start": 1260.0, "Time_End": 1263.0, "Text": " Get your fucking beer."}, {"Time_Start": 1263.0, "Time_End": 1268.0, "Text": " That's the cheapest beer you will ever get in your..."}, {"Time_Start": 1268.0, "Time_End": 1270.0, "Text": " Is your fucking second beer?"}, {"Time_Start": 1270.0, "Time_End": 1273.0, "Text": " Goddain!"}, {"Time_Start": 1273.0, "Time_End": 1275.0, "Text": " Fucking drunks."}, {"Time_Start": 1275.0, "Time_End": 1279.0, "Text": " NAC, splitting IPs for fun and profit."}, {"Time_Start": 1279.0, "Time_End": 1283.0, "Text": " NAP multiplex is several hosts onto one IP address by splitting on the local port."}, {"Time_Start": 1283.0, "Time_End": 1285.0, "Text": " The idea is we're already munching IPs."}, {"Time_Start": 1285.0, "Time_End": 1287.0, "Text": " We're already changing the IP value."}, {"Time_Start": 1287.0, "Time_End": 1288.0, "Text": " The host thinks is a 10 dot."}, {"Time_Start": 1288.0, "Time_End": 1290.0, "Text": " That 10 dot hits the outside world."}, {"Time_Start": 1290.0, "Time_End": 1291.0, "Text": " They ain't fucking coming back."}, {"Time_Start": 1291.0, "Time_End": 1294.0, "Text": " So we have to go ahead and put a real address that'll come back."}, {"Time_Start": 1294.0, "Time_End": 1297.0, "Text": " And they put on the firewall address."}, {"Time_Start": 1297.0, "Time_End": 1298.0, "Text": " And we split on local port."}, {"Time_Start": 1298.0, "Time_End": 1302.0, "Text": " Now it turns out, when we get the packet back, comes to a local port,"}, {"Time_Start": 1302.0, "Time_End": 1303.0, "Text": " we send it."}, {"Time_Start": 1303.0, "Time_End": 1307.0, "Text": " hopefully, we send it to the machine that sent the original packet in the first place."}, {"Time_Start": 1307.0, "Time_End": 1310.0, "Text": " There's a thing called the birthday paradox."}, {"Time_Start": 1310.0, "Time_End": 1313.0, "Text": " I'm skipping around a little, but trust me, this will make sense."}, {"Time_Start": 1313.0, "Time_End": 1318.0, "Text": " What happens when two machines behind your NAT send out a packet with the same local port?"}, {"Time_Start": 1318.0, "Time_End": 1322.0, "Text": " Now, there's a range of 65,000 ports they could pick."}, {"Time_Start": 1322.0, "Time_End": 1326.0, "Text": " What are the odds that two hosts are going to come up with the same local port"}, {"Time_Start": 1326.0, "Time_End": 1328.0, "Text": " when they hit that firewall?"}, {"Time_Start": 1328.0, "Time_End": 1330.0, "Text": " Well, the odds are pretty good, actually."}, {"Time_Start": 1330.0, "Time_End": 1333.0, "Text": " Because every time they make a random selection,"}, {"Time_Start": 1333.0, "Time_End": 1336.0, "Text": " there's another possibility for a collision."}, {"Time_Start": 1336.0, "Time_End": 1341.0, "Text": " So it turns out you have 2 to the 16, that's 65K, 2 to the 8 is 256."}, {"Time_Start": 1341.0, "Time_End": 1345.0, "Text": " One out of every 256 randomly selected local ports"}, {"Time_Start": 1345.0, "Time_End": 1350.0, "Text": " is going to have the exact same local port as some other one."}, {"Time_Start": 1350.0, "Time_End": 1351.0, "Text": " And this is..."}, {"Time_Start": 1351.0, "Time_End": 1353.0, "Text": " What?"}, {"Time_Start": 1353.0, "Time_End": 1359.0, "Text": " And they're not selected randomly because most implementations suck."}, {"Time_Start": 1359.0, "Time_End": 1365.0, "Text": " I have to stop listening to you guys."}, {"Time_Start": 1365.0, "Time_End": 1370.0, "Text": " No, you actually earned that one because you actually know a real actual trade here."}, {"Time_Start": 1370.0, "Time_End": 1375.0, "Text": " Now, we actually would like to be able to maintain same IP and same port"}, {"Time_Start": 1375.0, "Time_End": 1378.0, "Text": " because it gets closer to, we would like to maintain port"}, {"Time_Start": 1378.0, "Time_End": 1382.0, "Text": " because it gets us closer to end-to-end packet integrity."}, {"Time_Start": 1382.0, "Time_End": 1386.0, "Text": " This being the huge problem in that, you are always messing around with packets."}, {"Time_Start": 1386.0, "Time_End": 1388.0, "Text": " There are strategies."}, {"Time_Start": 1388.0, "Time_End": 1389.0, "Text": " There are strategies."}, {"Time_Start": 1389.0, "Time_End": 1391.6, "Text": " to deal with if the ports are exactly the same."}, {"Time_Start": 1391.6, "Time_End": 1396.0, "Text": " You can check sequence numbers, you can check the MTU, and later on I'll tell you about a new,"}, {"Time_Start": 1396.0, "Time_End": 1399.76, "Text": " really cool method that involves IP timestamps."}, {"Time_Start": 1399.76, "Time_End": 1401.76, "Text": " But check this out."}, {"Time_Start": 1401.76, "Time_End": 1406.64, "Text": " Is it possible to share a globally adjustable IP address without translating the private IPs"}, {"Time_Start": 1406.64, "Time_End": 1407.24, "Text": " at all?"}, {"Time_Start": 1407.24, "Time_End": 1409.7, "Text": " I was just talking about end-to-end packet correctness."}, {"Time_Start": 1409.7, "Time_End": 1412.76, "Text": " How the hell can I do that if I'm changing around the IP address?"}, {"Time_Start": 1412.76, "Time_End": 1418.84, "Text": " And the answer is, while changing around the IP address, I don't need to, because, you know,"}, {"Time_Start": 1419.0, "Time_End": 1424.6, "Text": " look at a NAT state table, a NAT state table lets you, given layer 4 information, derive"}, {"Time_Start": 1424.6, "Time_End": 1430.76, "Text": " layer 3. That same machine has an ARP state table. The ARP state table is linking layer 3,"}, {"Time_Start": 1430.76, "Time_End": 1437.16, "Text": " given layer 3 information, find me layer 2. So this is MAC address translation. Layer 4"}, {"Time_Start": 1437.16, "Time_End": 1443.32, "Text": " information gives us the combination of layer 3 and layer 2. Now it turns out you can have 100 hosts"}, {"Time_Start": 1443.32, "Time_End": 1448.92, "Text": " with the same IP address, but they'll all have different MAC addresses. And when the outgoing packet comes"}, {"Time_Start": 1449.0, "Time_End": 1454.5, "Text": " We don't just remember the IP that it claimed. We also remember the hardware address that it claimed."}, {"Time_Start": 1454.5, "Time_End": 1458.5, "Text": " And by that, we can have tons and tons of machines share the same IP."}, {"Time_Start": 1458.5, "Time_End": 1462.0, "Text": " Your cable modem provider could give you an IP 1.2.3.4."}, {"Time_Start": 1462.0, "Time_End": 1466.0, "Text": " You could have every single one of your machines in your house have that same IP address."}, {"Time_Start": 1466.0, "Time_End": 1470.5, "Text": " And assuming the local port issue was done, you'd have end-to-end packet integrity."}, {"Time_Start": 1474.5, "Time_End": 1476.5, "Text": " So I actually have an implementation of this."}, {"Time_Start": 1476.5, "Time_End": 1478.5, "Text": " It may work, but I can't test it."}, {"Time_Start": 1478.5, "Time_End": 1478.98, "Text": " Thank you."}, {"Time_Start": 1479.0, "Time_End": 1508.98, "Text": " work people. It's another part of Peketo-Kairatsu, it's called All New. Translates arbitrary local IP addresses. I don't care. Maybe you're using RFC 1918. Maybe you're not into globally routable IP addresses. And it does this by instead of just storing the IP source, like a normal NAT table does, it stores, the IP source, the Ethernet source, and just for fun, also, what Ethernet address you thought that the Gateway was. It goes ahead in ARPs for whatever gateway you wanted to ARP for. If the IP source,"}, {"Time_Start": 1509.0, "Time_End": 1512.0, "Text": " is the external IP, nothing will probably need to be changed."}, {"Time_Start": 1512.0, "Time_End": 1515.0, "Text": " Packets are going to retain their end-to-end packet integrity."}, {"Time_Start": 1515.0, "Time_End": 1521.0, "Text": " If the IP source is the RFC-1918 IP, this is what you have in your networks right now, most likely."}, {"Time_Start": 1521.0, "Time_End": 1523.0, "Text": " Just do the same thing."}, {"Time_Start": 1523.0, "Time_End": 1527.0, "Text": " We're already translating on 10 dots, we'll continue translating on 10 dots."}, {"Time_Start": 1527.0, "Time_End": 1532.0, "Text": " If your IP happens to match that of Microsoft or Yahoo or whoever the hell you want,"}, {"Time_Start": 1532.0, "Time_End": 1538.0, "Text": " just another IP that if I send it out and ain't coming back to me, the machine will handle it."}, {"Time_Start": 1538.0, "Time_End": 1539.0, "Text": " Now this actually has actually has to me."}, {"Time_Start": 1539.0, "Time_End": 1543.1, "Text": " some implications for hosting providers who need to move IPs around all the time."}, {"Time_Start": 1543.1, "Time_End": 1548.4, "Text": " You can go ahead and you can say, hey, I don't care what IP your host thinks it is."}, {"Time_Start": 1548.4, "Time_End": 1553.5, "Text": " Tell me what the gateway is that you want. I'll act like I'm it, and I will get you next."}, {"Time_Start": 1553.5, "Time_End": 1560.2, "Text": " It's kind of nice. Incoming connectivity. I call this the pizza protocol."}, {"Time_Start": 1560.2, "Time_End": 1565.6, "Text": " Pizza protocol is very simple. Guy shows up at your apartment. You got a couple people"}, {"Time_Start": 1565.6, "Time_End": 1568.9, "Text": " living in your apartment. You got one door. Anyone only only one."}, {"Time_Start": 1569.0, "Time_End": 1576.0, "Text": " pizza? Whoever responds and says, yeah, I ordered it. I'll pay for it. It was probably that guy who ordered the damn pizza."}, {"Time_Start": 1576.0, "Time_End": 1580.0, "Text": " So you just ask everyone behind your net."}, {"Time_Start": 1580.0, "Time_End": 1586.0, "Text": " Really, really easy if everyone has the same IP address, destination to that one IP that's shared,"}, {"Time_Start": 1586.0, "Time_End": 1594.0, "Text": " and you set it to broadcast Mac. So every single instantiation of that IP address gets the packet."}, {"Time_Start": 1594.0, "Time_End": 1596.0, "Text": " One of them will respond."}, {"Time_Start": 1596.0, "Time_End": 1602.5, "Text": " For traditional Nat with RFC 1918, but we actually need to know all the IPs that we're serving for."}, {"Time_Start": 1602.5, "Time_End": 1607.0, "Text": " And, gee, we've got this state table that talks about all the outgoing connections that have been going on."}, {"Time_Start": 1607.0, "Time_End": 1611.0, "Text": " Maybe we can go ahead and use that to find out what IPs we're dealing with."}, {"Time_Start": 1611.0, "Time_End": 1615.5, "Text": " Or, you know, we had that system a few minutes to go for scanning a network really quickly."}, {"Time_Start": 1615.5, "Time_End": 1621.0, "Text": " Maybe we'll just scan every host on that subnet and see, hey, all you guys, anyone hosting this packet?"}, {"Time_Start": 1621.0, "Time_End": 1623.0, "Text": " Anyone want to listen to this?"}, {"Time_Start": 1623.0, "Time_End": 1625.0, "Text": " You drop anyone who says no?"}, {"Time_Start": 1625.0, "Time_End": 1630.5, "Text": " anyone who says no because they're irrelevant, you pass everyone that says yes. That's kind of the"}, {"Time_Start": 1630.5, "Time_End": 1636.0, "Text": " stateless approach to it. There are issues when multiple hosts have a web server up. For example,"}, {"Time_Start": 1636.0, "Time_End": 1640.0, "Text": " I got a web server, you got a web server, incoming packet comes up, and we both say, oh yeah,"}, {"Time_Start": 1640.0, "Time_End": 1645.0, "Text": " we both ordered the pizza. We both have the web server. And there are various heuristics you can do."}, {"Time_Start": 1645.0, "Time_End": 1651.0, "Text": " You can give priority to the one who actually had talked to this outgoing host first."}, {"Time_Start": 1651.0, "Time_End": 1654.98, "Text": " You can talk, you can split it on port ranges, connections on 1080, you'll go to the"}, {"Time_Start": 1655.0, "Time_End": 1659.16, "Text": " this host, 2080, you'll go to this host. There's all sorts of approaches. I haven't built"}, {"Time_Start": 1659.16, "Time_End": 1664.24, "Text": " them yet, but they're coming. A state full approach is sort of necessary to do this right, though."}, {"Time_Start": 1664.24, "Time_End": 1669.0, "Text": " You actually need to keep track of who ordered the pizza the last time and continue to remember"}, {"Time_Start": 1669.0, "Time_End": 1674.92, "Text": " that, particularly with the stream management. It turns out you get a lot of nasty packet"}, {"Time_Start": 1674.92, "Time_End": 1679.48, "Text": " screw-ups if you try to do it completely statelessly. But you have a lot of fun if you say"}, {"Time_Start": 1679.48, "Time_End": 1684.76, "Text": " damn you security. TCP splicing. This is fun."}, {"Time_Start": 1685.0, "Time_End": 1686.0, "Text": " This is just fun."}, {"Time_Start": 1686.0, "Time_End": 1687.0, "Text": " Is it possible?"}, {"Time_Start": 1687.0, "Time_End": 1689.0, "Text": " TCP not-to-knat."}, {"Time_Start": 1689.0, "Time_End": 1690.0, "Text": " Can it be done?"}, {"Time_Start": 1690.0, "Time_End": 1692.0, "Text": " A big question of PDP."}, {"Time_Start": 1692.0, "Time_End": 1697.0, "Text": " It was actually done because a bunch of PDP people really, really wanted it and said it couldn't be done."}, {"Time_Start": 1697.0, "Time_End": 1699.0, "Text": " So hey, let's have some fun."}, {"Time_Start": 1699.0, "Time_End": 1701.0, "Text": " You can do it."}, {"Time_Start": 1701.0, "Time_End": 1702.0, "Text": " It is possible."}, {"Time_Start": 1702.0, "Time_End": 1703.0, "Text": " It's ugly."}, {"Time_Start": 1703.0, "Time_End": 1705.0, "Text": " It's dear God ugly."}, {"Time_Start": 1705.0, "Time_End": 1706.0, "Text": " Here's what you do."}, {"Time_Start": 1706.0, "Time_End": 1708.0, "Text": " You gotta convince each firewall."}, {"Time_Start": 1708.0, "Time_End": 1711.0, "Text": " Now in Nats, Nats are really good for outgoing connections."}, {"Time_Start": 1711.0, "Time_End": 1713.0, "Text": " They don't like incoming so much."}, {"Time_Start": 1713.0, "Time_End": 1714.0, "Text": " You got to convince each firewall that the off-goals."}, {"Time_Start": 1714.0, "Time_End": 1719.0, "Text": " fire off that the other one allowed the connection. The other one has no problem"}, {"Time_Start": 1719.0, "Time_End": 1724.0, "Text": " with incoming connections. You have to convince both of them of this at the same time."}, {"Time_Start": 1724.0, "Time_End": 1727.0, "Text": " And you do this by playing the layers against one another."}, {"Time_Start": 1727.0, "Time_End": 1731.0, "Text": " Now, this is sort of how I do this as an analogy."}, {"Time_Start": 1731.0, "Time_End": 1735.0, "Text": " Bill Gates and Larry Ellison, nice guys. They will probably never speak to me."}, {"Time_Start": 1735.0, "Time_End": 1741.0, "Text": " These guys can call anyone they damn well, please. They're quite powerful in that nature."}, {"Time_Start": 1741.0, "Time_End": 1743.0, "Text": " Their secretaries aren't going to stop them."}, {"Time_Start": 1743.0, "Time_End": 1747.0, "Text": " but I can't go ahead and call Bill Gates."}, {"Time_Start": 1747.0, "Time_End": 1750.0, "Text": " The secretary's going to tell me to screw off and die."}, {"Time_Start": 1750.0, "Time_End": 1752.0, "Text": " If Bill called me, you know what?"}, {"Time_Start": 1752.0, "Time_End": 1757.0, "Text": " He wouldn't just have a one-way connection unless he was really antisocial, which I'm sure not."}, {"Time_Start": 1757.0, "Time_End": 1760.0, "Text": " He'd actually be able to hear my voice back."}, {"Time_Start": 1760.0, "Time_End": 1765.0, "Text": " So once he actually called me, we'd have a bidirectional communication going on."}, {"Time_Start": 1765.0, "Time_End": 1769.0, "Text": " Even though I couldn't call him, he could call me and we'd have a bidirectional communication."}, {"Time_Start": 1769.0, "Time_End": 1772.0, "Text": " The only asymmetry in telephone calls is in the initiation phase."}, {"Time_Start": 1772.0, "Time_End": 1779.0, "Text": " phase. And it's actually the same way in TCP. Once you get past the handshake, it's both the same way."}, {"Time_Start": 1779.0, "Time_End": 1783.0, "Text": " So incoming is the same as outgoing. There's no way to differentiate the two."}, {"Time_Start": 1783.0, "Time_End": 1788.0, "Text": " So you do a setup. Alice and Bob, both behind Natting firewalls."}, {"Time_Start": 1788.0, "Time_End": 1792.0, "Text": " Firewall allow all outgoing sessions. They block anything coming in."}, {"Time_Start": 1792.0, "Time_End": 1796.0, "Text": " Now they block with state. Now this is sort of important."}, {"Time_Start": 1796.0, "Time_End": 1801.0, "Text": " There was a time we had stateless firewalls out there, and the idea was we'll just block all sins coming in."}, {"Time_Start": 1801.0, "Time_End": 1808.0, "Text": " coming in. That way, no one will be able to send a connection coming in, because every packet that comes in that wants to be a connection has to be a sin."}, {"Time_Start": 1808.0, "Time_End": 1815.0, "Text": " And then people realize, well, wait, I'll just start sending sin acts into a network, because then it'll think it's a response to an outgoing sin."}, {"Time_Start": 1815.0, "Time_End": 1816.0, "Text": " It'll let it in."}, {"Time_Start": 1816.0, "Time_End": 1820.0, "Text": " And I can talk to my nice little remote show that I've shoved up in this machine."}, {"Time_Start": 1820.0, "Time_End": 1821.0, "Text": " Thank you very much."}, {"Time_Start": 1821.0, "Time_End": 1826.0, "Text": " The equivalent in the real world would be me calling up Bill Gates' secretary and saying, oh yeah, Bill talk to me."}, {"Time_Start": 1826.0, "Time_End": 1827.0, "Text": " Let me speak to him again."}, {"Time_Start": 1827.0, "Time_End": 1830.98, "Text": " And the secretary going, well, if you wouldn't say that, if you didn't say that, if you did, if"}, {"Time_Start": 1831.0, "Time_End": 1833.0, "Text": " they didn't actually ever call you in the past."}, {"Time_Start": 1833.0, "Time_End": 1835.0, "Text": " So I'll let you talk to them."}, {"Time_Start": 1835.0, "Time_End": 1839.0, "Text": " So you actually have a state, you have a secretary that remembers there was an outgoing connection,"}, {"Time_Start": 1839.0, "Time_End": 1843.0, "Text": " it keeps track of all the details, the ports have to be opposite to each other,"}, {"Time_Start": 1843.0, "Time_End": 1847.0, "Text": " the sequence numbers have to be appropriate with the plus one offset and so on."}, {"Time_Start": 1847.0, "Time_End": 1850.0, "Text": " Total outgoing trust, zero incoming trust."}, {"Time_Start": 1850.0, "Time_End": 1856.0, "Text": " The attempt. Let's look really, really slowly at what happens when Alice tries to talk to Bob."}, {"Time_Start": 1856.0, "Time_End": 1858.0, "Text": " First thing, Alice is not directly connected to Bob."}, {"Time_Start": 1858.0, "Time_End": 1861.0, "Text": " Remember what I was talking about the layers, with, you know, hopping and jumping"}, {"Time_Start": 1861.0, "Time_End": 1863.0, "Text": " jumping and whatnot, the internet's big."}, {"Time_Start": 1863.0, "Time_End": 1867.0, "Text": " On average, it's going to take about 12 hops to get from here to wherever the heck you want."}, {"Time_Start": 1867.0, "Time_End": 1873.0, "Text": " First thing you do, you send a pack, Alice sends a packet to her firewall"}, {"Time_Start": 1873.0, "Time_End": 1879.0, "Text": " and says, hey, I want to talk to, not Bob, because Bob doesn't have a globally addressable IP address."}, {"Time_Start": 1879.0, "Time_End": 1883.0, "Text": " Bob's firewall has a globally addressable IP address."}, {"Time_Start": 1883.0, "Time_End": 1887.0, "Text": " So Alice says, hi, I want to talk to, oh, IP address to Bob's firewall."}, {"Time_Start": 1887.0, "Time_End": 1890.98, "Text": " Now they say, it's Alice's firewall, and Alice's firewall is like, well, you've got to"}, {"Time_Start": 1891.0, "Time_End": 1898.0, "Text": " 10 dot here. I send this out with a 10 dot, it ain't coming back to me, so I'll go ahead and I'll change it into my globally addressable IP address."}, {"Time_Start": 1898.0, "Time_End": 1902.0, "Text": " Now, this hops across the internet, hop, hop, hop, hop, hop, hop, hop, pop, pop, hop, hits Bob's firewall."}, {"Time_Start": 1902.0, "Time_End": 1908.0, "Text": " Now, Bob is listening for Alice. Bob wants to talk to Alice, Alice and Bob has their little affair going on, whatnot."}, {"Time_Start": 1908.0, "Time_End": 1910.0, "Text": " But Bob's firewall ain't involved."}, {"Time_Start": 1910.0, "Time_End": 1915.0, "Text": " Bob's firewall is the warden in this little situation, and Bob's firewall says, no, I ain't talking to you, reset act."}, {"Time_Start": 1915.0, "Time_End": 1919.0, "Text": " The reset act, hop, hop, hop, hops across the network, hits Alice's firewall."}, {"Time_Start": 1919.0, "Time_End": 1921.0, "Text": " And that little entry."}, {"Time_Start": 1921.0, "Time_End": 1925.86, "Text": " that little thing that said, hey, Alice tried to talk to Bob's firewall, we had an entry here,"}, {"Time_Start": 1926.06, "Time_End": 1931.36, "Text": " it got shut down. And Alice goes out and gets a message and says, yeah, Bob doesn't actually"}, {"Time_Start": 1931.36, "Time_End": 1935.82, "Text": " want to talk to you. Bob doesn't like you anymore. And if Bob tries to talk to Alice, Alice's"}, {"Time_Start": 1935.82, "Time_End": 1942.0, "Text": " firewall is similarly cruel. Now, if you look at this, look at this really closely. What's good, what's good"}, {"Time_Start": 1942.0, "Time_End": 1947.46, "Text": " is you had an entry in the firewall state table. I want a response from Bob's firewall. Bob had an entry"}, {"Time_Start": 1947.46, "Time_End": 1950.98, "Text": " in his firewall. I want a response from a"}, {"Time_Start": 1951.0, "Time_End": 1956.1, "Text": " Alice's firewall. So you have two machines that want to talk to each other. Until the"}, {"Time_Start": 1956.1, "Time_End": 1960.64, "Text": " packets cross each other hit each other's firewall come back dead. So good. Entry in the"}, {"Time_Start": 1960.64, "Time_End": 1966.56, "Text": " state table waiting a reply, bad. The reply is screw off and die. Can we get the former"}, {"Time_Start": 1966.56, "Time_End": 1972.62, "Text": " without the ladder? And the answer, my friends, is yes. You see, Alice's firewall's a little"}, {"Time_Start": 1972.62, "Time_End": 1978.36, "Text": " closer on the network than Bob's firewall. It's a little closer in terms of hops. So Alice goes ahead,"}, {"Time_Start": 1978.3600000000001, "Time_End": 1985.48, "Text": " sets her TTO, time to live in hops, to about four. What does this do? Packett gets out"}, {"Time_Start": 1985.48, "Time_End": 1990.8600000000001, "Text": " Alice's firewall, and it sets the entry to state table, gets into the middle of the internet, and it"}, {"Time_Start": 1990.8600000000001, "Time_End": 1997.42, "Text": " dies. And that's it? The state table entries left open. Bob's firewall never gets the chance"}, {"Time_Start": 1997.42, "Time_End": 1998.9, "Text": " to send the reset act."}, {"Time_Start": 2008.3600000000001, "Time_End": 2015.1200000000001, "Text": " Now, hang on, wait a second. We'll do it after. Now, both firewalls have a hole open for each other."}, {"Time_Start": 2015.8600000000001, "Time_End": 2021.18, "Text": " This ain't enough, because neither of them can send that sin act to each other, that connection response."}, {"Time_Start": 2021.6200000000001, "Time_End": 2038.3400000000001, "Text": " They can both send sins. They can both send acts. Neither of them can send sin acts. You've got a pretty high bar you've got to reach. You've got to agree on what ports. You've got to agree on what sequence numbers. You've got to time it right. You've got to know that this is going on that the other side is trying to do this is"}, {"Time_Start": 2038.3600000000001, "Time_End": 2042.2400000000002, "Text": " the same time. And the answer is, you have a handshake-only connection broker."}, {"Time_Start": 2042.5200000000002, "Time_End": 2046.22, "Text": " All it does is do the session set up. Once it's out of the way, it's gone."}, {"Time_Start": 2047.94, "Time_End": 2055.6200000000003, "Text": " It basically manages the two. Alice and Bob conspire with the connection broker. Say, hey,"}, {"Time_Start": 2056.2000000000003, "Time_End": 2062.26, "Text": " I sent this packet with this information. I'm sending it to you. You see how the translation happens."}, {"Time_Start": 2062.7000000000003, "Time_End": 2067.2200000000003, "Text": " Bob, I'm sending this to you connection broker. This is what I originally sent. Compare what I"}, {"Time_Start": 2067.2200000000003, "Time_End": 2071.6200000000003, "Text": " originally sent with what the connection broker, with what my firewall sent you."}, {"Time_Start": 2072.9800000000005, "Time_End": 2078.84, "Text": " Between this process, the connection broker can go ahead and learn how the firewall is doing its"}, {"Time_Start": 2078.84, "Time_End": 2084.0600000000004, "Text": " munching. Maybe it's doing the best effort. Maybe it's incrementing from a fixed counter. Maybe it's"}, {"Time_Start": 2084.0600000000004, "Time_End": 2089.88, "Text": " using random local ports and doing translation. There's all sorts of different approaches that can be done"}, {"Time_Start": 2089.88, "Time_End": 2095.26, "Text": " on the packet layer munching. Connection broker needs to find out because the connection broker"}, {"Time_Start": 2095.26, "Time_End": 2100.98, "Text": " needs to synchronize and cause Alice and Bob's firewalls to achieve port-level convergence"}, {"Time_Start": 2100.98, "Time_End": 2107.26, "Text": " and sequence-level convergence. This is the process to do it. I ain't going to explain it in detail."}, {"Time_Start": 2107.46, "Time_End": 2113.0600000000004, "Text": " Bug me later if you want the description, but it ends up actually working out. Alice and Bob can"}, {"Time_Start": 2113.0600000000004, "Time_End": 2117.96, "Text": " conspire with the connection worker to determine the pattern by which their individual firewalls are"}, {"Time_Start": 2117.96, "Time_End": 2123.6200000000003, "Text": " munching the port and sequence information. Once that happens, they can go ahead and counter the munging"}, {"Time_Start": 2123.62, "Time_End": 2128.12, "Text": " such that they achieve convergence in their ports and in their information."}, {"Time_Start": 2128.72, "Time_End": 2130.46, "Text": " Now, I will actually accept the question now. Go ahead."}, {"Time_Start": 2130.68, "Time_End": 2132.14, "Text": " I mean, come up here and speak into the mic."}, {"Time_Start": 2135.38, "Time_End": 2139.52, "Text": " Does this work even if it randomly selects the source port?"}, {"Time_Start": 2140.3199999999997, "Time_End": 2145.12, "Text": " Source port, yes. It depends on decent. Okay."}, {"Time_Start": 2145.94, "Time_End": 2152.14, "Text": " If one side, if both sides absolutely cannot be controlled for, it's problematic."}, {"Time_Start": 2152.14, "Time_End": 2155.44, "Text": " And remember I was telling you about the birthday paradox?"}, {"Time_Start": 2155.44, "Time_End": 2158.44, "Text": " You have two hosts that are trying to make random selections?"}, {"Time_Start": 2158.44, "Time_End": 2162.64, "Text": " Well, what you do is Alice makes 256 attempts to Bob."}, {"Time_Start": 2162.64, "Time_End": 2165.14, "Text": " Bob makes 256 attempts to Alice."}, {"Time_Start": 2165.14, "Time_End": 2168.14, "Text": " And even though they're both doing random local ports,"}, {"Time_Start": 2168.14, "Time_End": 2171.14, "Text": " you're going to have a collision by the birthday paradox."}, {"Time_Start": 2171.14, "Time_End": 2174.14, "Text": " And you go ahead and you embed which one had the collision,"}, {"Time_Start": 2174.14, "Time_End": 2176.14, "Text": " because you have to know which session to continue."}, {"Time_Start": 2176.14, "Time_End": 2179.14, "Text": " You embed that in the IPID field and the IP frame."}, {"Time_Start": 2179.14, "Time_End": 2182.12, "Text": " Firewall don't mess with the IPID because you go ahead and the"}, {"Time_Start": 2182.14, "Time_End": 2186.14, "Text": " because they have no reason to possibly do it until now."}, {"Time_Start": 2186.14, "Time_End": 2190.14, "Text": " Yes, both sides can do random local ports."}, {"Time_Start": 2190.14, "Time_End": 2192.64, "Text": " Randomized sequence numbers, which a few firewalls do,"}, {"Time_Start": 2192.64, "Time_End": 2195.14, "Text": " can't really be dealt with if both sides do it."}, {"Time_Start": 2195.14, "Time_End": 2199.14, "Text": " Because now you have 32 bits of entropy instead of 16."}, {"Time_Start": 2199.14, "Time_End": 2201.14, "Text": " And 2 to the 16, 65K."}, {"Time_Start": 2201.14, "Time_End": 2205.14, "Text": " You're not getting away with 65,000 packets on a regular basis."}, {"Time_Start": 2205.14, "Time_End": 2209.14, "Text": " Now, I have to say, this is really academic."}, {"Time_Start": 2209.14, "Time_End": 2211.14, "Text": " There are such easier strategies to use."}, {"Time_Start": 2211.14, "Time_End": 2217.14, "Text": " use. You can source route through the connection broker. This cleans up so, so very much."}, {"Time_Start": 2217.14, "Time_End": 2221.14, "Text": " You get absolute information on what's going on on the genuine connection."}, {"Time_Start": 2221.14, "Time_End": 2226.14, "Text": " And it turns out you don't even need to use any true packet layer stuff."}, {"Time_Start": 2226.14, "Time_End": 2229.14, "Text": " Because you can actually, as soon as the connection is established,"}, {"Time_Start": 2229.14, "Time_End": 2233.14, "Text": " both sides with normal socket options can draw the source route."}, {"Time_Start": 2233.14, "Time_End": 2236.14, "Text": " Most of you've noticed probably games work right now."}, {"Time_Start": 2236.14, "Time_End": 2240.14, "Text": " They're using UDP, using a really simple and trivial method."}, {"Time_Start": 2240.14, "Time_End": 2245.14, "Text": " they just use opposite ports, and they just fire them at each other."}, {"Time_Start": 2245.14, "Time_End": 2252.14, "Text": " And eventually, the outgoing port from the other is perceived as a response to the outgoing port from the first."}, {"Time_Start": 2252.14, "Time_End": 2255.14, "Text": " Okay, let me actually explain this for a second."}, {"Time_Start": 2255.14, "Time_End": 2258.14, "Text": " Ah, screw it."}, {"Time_Start": 2258.14, "Time_End": 2264.14, "Text": " So, Alice and Bob, imagine they get their clocks perfectly synced up."}, {"Time_Start": 2264.14, "Time_End": 2267.14, "Text": " They both send a packet out to each other's firewalls."}, {"Time_Start": 2267.14, "Time_End": 2270.14, "Text": " First thing it does, on the clock is it hits."}, {"Time_Start": 2270.14, "Time_End": 2272.14, "Text": " each of their local firewalls."}, {"Time_Start": 2272.14, "Time_End": 2274.14, "Text": " Their local firewalls say, hey, I've got an outgoing packet on UDP,"}, {"Time_Start": 2274.14, "Time_End": 2278.14, "Text": " Port 5,000, waiting for a response on Port 5,000."}, {"Time_Start": 2278.14, "Time_End": 2281.14, "Text": " They pass by each other on the net, both sides."}, {"Time_Start": 2281.14, "Time_End": 2283.14, "Text": " Hits each other firewall."}, {"Time_Start": 2283.14, "Time_End": 2286.14, "Text": " The other firewall is like, well, I was waiting for a response on Port 5,000"}, {"Time_Start": 2286.14, "Time_End": 2287.14, "Text": " from Port 5,000."}, {"Time_Start": 2287.14, "Time_End": 2288.14, "Text": " Hey, I got it."}, {"Time_Start": 2288.14, "Time_End": 2290.14, "Text": " The other side, hey, I was waiting for a response on 5,000"}, {"Time_Start": 2290.14, "Time_End": 2291.14, "Text": " from Port 5,000."}, {"Time_Start": 2291.14, "Time_End": 2292.14, "Text": " Hey, I got it."}, {"Time_Start": 2292.14, "Time_End": 2297.14, "Text": " Both sides perceive the other person's first packet as a response."}, {"Time_Start": 2297.14, "Time_End": 2300.14, "Text": " You can do this with UDP because UDP has like no complexity."}, {"Time_Start": 2300.14, "Time_End": 2301.14, "Text": " to it at all."}, {"Time_Start": 2301.14, "Time_End": 2305.14, "Text": " This is far less fun than TCP splicing, though."}, {"Time_Start": 2305.14, "Time_End": 2306.14, "Text": " New stuff."}, {"Time_Start": 2306.14, "Time_End": 2310.14, "Text": " This is News' Black Hat for those who are here who actually went to Black Hat."}, {"Time_Start": 2310.14, "Time_End": 2313.14, "Text": " TTL-based firewall analysis."}, {"Time_Start": 2313.14, "Time_End": 2316.14, "Text": " I emit a sin from my firewall."}, {"Time_Start": 2316.14, "Time_End": 2319.14, "Text": " I emit this sin, and it has a TTL of 4."}, {"Time_Start": 2319.14, "Time_End": 2321.14, "Text": " It hits my firewall and it gets translated."}, {"Time_Start": 2321.14, "Time_End": 2323.14, "Text": " It gets its source address changed."}, {"Time_Start": 2323.14, "Time_End": 2325.14, "Text": " Hopes a little bit on the internet."}, {"Time_Start": 2325.14, "Time_End": 2326.14, "Text": " Dies."}, {"Time_Start": 2326.14, "Time_End": 2329.14, "Text": " Now, I said it die, but there's actually a packet that returns."}, {"Time_Start": 2329.14, "Time_End": 2330.14, "Text": " It's nice and important."}, {"Time_Start": 2330.14, "Time_End": 2331.14, "Text": " time exceeded."}, {"Time_Start": 2331.14, "Time_End": 2334.14, "Text": " And this thing isn't just a time exceeded."}, {"Time_Start": 2334.14, "Time_End": 2339.14, "Text": " It contains a copy of the original packet that spawned the failure."}, {"Time_Start": 2339.14, "Time_End": 2343.64, "Text": " Now the firewall, when it sends the packet back to you, it's going to contain the information"}, {"Time_Start": 2343.64, "Time_End": 2345.14, "Text": " that you had."}, {"Time_Start": 2345.14, "Time_End": 2348.64, "Text": " You know, I'm 10 dot and here's my information."}, {"Time_Start": 2348.64, "Time_End": 2352.14, "Text": " So the ICMP error is going to come back to the 10 dot."}, {"Time_Start": 2352.14, "Time_End": 2357.14, "Text": " Ah, but the ICMP data, the ICMP data is not going to be translated because who's looking"}, {"Time_Start": 2357.14, "Time_End": 2358.14, "Text": " at ICMP data."}, {"Time_Start": 2358.14, "Time_End": 2360.14, "Text": " So you can actually discover how you can actually discover how you can't be translated."}, {"Time_Start": 2360.14, "Time_End": 2362.14, "Text": " your firewall is munching your data stream."}, {"Time_Start": 2362.14, "Time_End": 2365.14, "Text": " You can discover your eternal IP and come up here."}, {"Time_Start": 2365.14, "Time_End": 2373.14, "Text": " And I love the fur."}, {"Time_Start": 2373.14, "Time_End": 2375.14, "Text": " Thank you."}, {"Time_Start": 2375.14, "Time_End": 2384.14, "Text": " I don't believe that open BSD firewalls can be probed with this because it rewrites the ICMP data."}, {"Time_Start": 2384.14, "Time_End": 2387.14, "Text": " This is because Theo is a paranoid motherfucker."}, {"Time_Start": 2390.14, "Time_End": 2402.14, "Text": " All right."}, {"Time_Start": 2402.14, "Time_End": 2406.14, "Text": " God damn it, Theo."}, {"Time_Start": 2406.14, "Time_End": 2408.14, "Text": " Check this out."}, {"Time_Start": 2408.14, "Time_End": 2410.14, "Text": " So I hate stateful programming."}, {"Time_Start": 2410.14, "Time_End": 2411.14, "Text": " Stateful programming sucks."}, {"Time_Start": 2411.14, "Time_End": 2413.14, "Text": " Buffers, you got to search them."}, {"Time_Start": 2413.14, "Time_End": 2415.14, "Text": " You got to allocate them."}, {"Time_Start": 2415.14, "Time_End": 2418.14, "Text": " You got to overflow them if your name's gobbles."}, {"Time_Start": 2418.14, "Time_End": 2419.14, "Text": " Gobbles rules."}, {"Time_Start": 2419.14, "Time_End": 2420.14, "Text": " Gobbles."}, {"Time_Start": 2420.14, "Time_End": 2422.14, "Text": " Damn."}, {"Time_Start": 2422.14, "Time_End": 2424.14, "Text": " Nat normally needs to be stateful."}, {"Time_Start": 2424.14, "Time_End": 2426.14, "Text": " You got to remember when you get the packet back,"}, {"Time_Start": 2426.14, "Time_End": 2429.14, "Text": " who the hell am I supposed to return this packet to?"}, {"Time_Start": 2429.14, "Time_End": 2434.14, "Text": " In Matt, not only do you know who the IP is you're returning it to,"}, {"Time_Start": 2434.14, "Time_End": 2437.14, "Text": " you also need to know the hardware address you're returning it to."}, {"Time_Start": 2437.14, "Time_End": 2441.14, "Text": " So you actually need to know something about 10 bytes."}, {"Time_Start": 2441.14, "Time_End": 2443.14, "Text": " Stateless Nat."}, {"Time_Start": 2443.14, "Time_End": 2445.14, "Text": " Is this possible?"}, {"Time_Start": 2445.14, "Time_End": 2448.14, "Text": " Jason Spence."}, {"Time_Start": 2448.14, "Time_End": 2449.14, "Text": " He's here."}, {"Time_Start": 2449.14, "Time_End": 2450.14, "Text": " He's the guy in the red hat."}, {"Time_Start": 2450.14, "Time_End": 2454.14, "Text": " He actually proved to me that one of my random theories was right."}, {"Time_Start": 2454.14, "Time_End": 2455.14, "Text": " Yeah."}, {"Time_Start": 2455.14, "Time_End": 2457.14, "Text": " It's called IP timestamps."}, {"Time_Start": 2457.14, "Time_End": 2460.14, "Text": " So anyone in this room who actually knows what IP timestamps are?"}, {"Time_Start": 2460.14, "Time_End": 2461.14, "Text": " Okay."}, {"Time_Start": 2461.14, "Time_End": 2463.14, "Text": " Cool. You're awesome."}, {"Time_Start": 2463.14, "Time_End": 2464.14, "Text": " Check this out."}, {"Time_Start": 2464.14, "Time_End": 2467.14, "Text": " In mode 3, I create an IP option."}, {"Time_Start": 2467.14, "Time_End": 2469.14, "Text": " And yeah, I know some firewalls block them."}, {"Time_Start": 2469.14, "Time_End": 2470.14, "Text": " Screw you."}, {"Time_Start": 2470.14, "Time_End": 2471.14, "Text": " All right."}, {"Time_Start": 2471.14, "Time_End": 2473.14, "Text": " So I create an IP option."}, {"Time_Start": 2473.14, "Time_End": 2476.14, "Text": " The IP option has a 32-bit header that describes,"}, {"Time_Start": 2476.14, "Time_End": 2479.14, "Text": " 32-bit header describes what it is."}, {"Time_Start": 2479.14, "Time_End": 2480.14, "Text": " Now you can go ahead."}, {"Time_Start": 2480.14, "Time_End": 2484.14, "Text": " specify an IP, specify a space for a timestamp."}, {"Time_Start": 2484.14, "Time_End": 2485.14, "Text": " Specify another IP."}, {"Time_Start": 2485.14, "Time_End": 2487.14, "Text": " Specify another space for a timestamp."}, {"Time_Start": 2487.14, "Time_End": 2490.14, "Text": " You knew this up to four times for up to 32 bytes of data."}, {"Time_Start": 2490.14, "Time_End": 2497.14, "Text": " Now, in normal usage, if any router along the path has this IP address,"}, {"Time_Start": 2497.14, "Time_End": 2504.14, "Text": " it'll rewrite the value in the timestamp place with its actual timestamp."}, {"Time_Start": 2504.14, "Time_End": 2508.14, "Text": " And if it's not, it'll just forward it on to the next host, unmolested."}, {"Time_Start": 2508.14, "Time_End": 2509.14, "Text": " Assuming it will maybe someone else already did its rewrite."}, {"Time_Start": 2509.14, "Time_End": 2511.14, "Text": " I also already did its rewrite."}, {"Time_Start": 2511.14, "Time_End": 2514.14, "Text": " This passes all the way through to the final destination."}, {"Time_Start": 2514.14, "Time_End": 2516.14, "Text": " The final destination gets this packet."}, {"Time_Start": 2516.14, "Time_End": 2519.14, "Text": " Well, my IP doesn't match any of this stuff in the IP options."}, {"Time_Start": 2519.14, "Time_End": 2522.14, "Text": " I'm just going to send the entire batch on back."}, {"Time_Start": 2522.14, "Time_End": 2528.14, "Text": " Now if you look here, I can go ahead and specify arbitrary data"}, {"Time_Start": 2528.14, "Time_End": 2533.14, "Text": " in my IP option timestamp field up to 32 bytes worth per packet"}, {"Time_Start": 2533.14, "Time_End": 2538.14, "Text": " that will be returned with every single packet that comes back to me."}, {"Time_Start": 2538.14, "Time_End": 2542.14, "Text": " And when you look at that, I have 32 bytes, I only needed 10."}, {"Time_Start": 2542.14, "Time_End": 2550.14, "Text": " So every single packet can contain the route back through my NAT into the actual hardware machine that it needs to be on."}, {"Time_Start": 2550.14, "Time_End": 2552.14, "Text": " I have no lookups."}, {"Time_Start": 2552.14, "Time_End": 2554.14, "Text": " I can build gigabit NAT now."}, {"Time_Start": 2554.14, "Time_End": 2557.14, "Text": " No state, nothing to overflow, screw you gobbles."}, {"Time_Start": 2557.14, "Time_End": 2566.14, "Text": " Finally, it wouldn't be a talk at DefCon if I didn't have at least some attack."}, {"Time_Start": 2566.14, "Time_End": 2568.14, "Text": " All this stuff's been useful things."}, {"Time_Start": 2568.14, "Time_End": 2570.14, "Text": " you can do to build connectivity."}, {"Time_Start": 2570.14, "Time_End": 2574.14, "Text": " You can actually do something sort of nasty with the TCP splicing stuff."}, {"Time_Start": 2574.14, "Time_End": 2579.14, "Text": " You can forge arbitrary data streams into your network"}, {"Time_Start": 2579.14, "Time_End": 2582.14, "Text": " that appear to come from any IP that you want."}, {"Time_Start": 2582.14, "Time_End": 2584.14, "Text": " Now here's how you do it."}, {"Time_Start": 2584.14, "Time_End": 2591.14, "Text": " You have Alice make a TCP connection, make a TTL limited connection to quote-unquote Yahoo."}, {"Time_Start": 2591.14, "Time_End": 2594.14, "Text": " Not actually going to reach Yahoo because it's TTL limited."}, {"Time_Start": 2594.14, "Time_End": 2597.14, "Text": " But Alice is going to set the TTL low, so there's an outgoing connection."}, {"Time_Start": 2597.14, "Time_End": 2606.14, "Text": " connection. Any IDS in the way, intrusion detection system or logger or whatnot, it's going to see this and it's going to say, hey, Alice here is trying to talk to Yahoo there."}, {"Time_Start": 2606.14, "Time_End": 2614.14, "Text": " And most likely isn't going to go ahead and use the ICMP to say, that connection died because that packet never actually got there."}, {"Time_Start": 2614.14, "Time_End": 2619.14, "Text": " In normal TCP splicing, we stop the TTLing after the initial packet."}, {"Time_Start": 2619.14, "Time_End": 2621.14, "Text": " In this case, we don't."}, {"Time_Start": 2621.14, "Time_End": 2626.14, "Text": " Every single packet between Alice and quote-unquote Yahoo is going to be TTL limited."}, {"Time_Start": 2626.14, "Time_End": 2627.14, "Text": " But Alice is going to get it."}, {"Time_Start": 2627.14, "Time_End": 2631.3799999999997, "Text": " of Charlie, the connection broker from the early example, Alice is going to give Charlie"}, {"Time_Start": 2631.3799999999997, "Time_End": 2638.64, "Text": " all sorts of information about exactly how she's talking to Yahoo. And Charlie is going"}, {"Time_Start": 2638.64, "Time_End": 2645.3399999999997, "Text": " to reply with a spoofed packet, as if he was Yahoo. So Charlie can just throw in a stream"}, {"Time_Start": 2645.3399999999997, "Time_End": 2652.56, "Text": " of data on a stateful connection that looks indistinguishable from a genuine connection from"}, {"Time_Start": 2652.56, "Time_End": 2657.12, "Text": " Yahoo. And it can be any amount of data because every single time Alice responds to"}, {"Time_Start": 2657.14, "Time_End": 2664.14, "Text": " with an AC, it's TTL limited. And Charlie's kept in sync because there's a side channel over to Charlie."}, {"Time_Start": 2664.14, "Time_End": 2672.14, "Text": " It's really messy. But if your logging system and your firewall is not logging ICMP, there's no evidence."}, {"Time_Start": 2672.14, "Time_End": 2680.14, "Text": " So, bottom line, really interesting things are possible with ICMP, with TCP, with IP, with Ethernet, 802.3."}, {"Time_Start": 2680.14, "Time_End": 2686.14, "Text": " And oh, by the way, 802.11 is coming soon. So yeah, there's fun things to do."}, {"Time_Start": 2686.14, "Time_End": 2693.14, "Text": " do. Everyone, get up here, get some beer. Well, first, first thing, you got to impress me if you want the beer."}, {"Time_Start": 2693.14, "Time_End": 2699.14, "Text": " Second thing, if you really impress me, you get a book, hack proof in your network. Plug, plug, plug, plug, plug."}, {"Time_Start": 2699.14, "Time_End": 2703.14, "Text": " Who's up first? Start walking up, sit up a line right there and right there."}, {"Time_Start": 2703.14, "Time_End": 2706.14, "Text": " Because I like everyone to actually hear what's going on."}, {"Time_Start": 2716.14, "Time_End": 2718.14, "Text": " This guy's first."}, {"Time_Start": 2718.14, "Time_End": 2720.14, "Text": " Talk to the crowd."}, {"Time_Start": 2720.14, "Time_End": 2722.14, "Text": " Oh, wait."}, {"Time_Start": 2722.14, "Time_End": 2724.14, "Text": " Testing, testing."}, {"Time_Start": 2724.14, "Time_End": 2726.14, "Text": " All right."}, {"Time_Start": 2730.14, "Time_End": 2733.14, "Text": " With your multiplexed address translation,"}, {"Time_Start": 2733.14, "Time_End": 2736.14, "Text": " you said that you had to basically split up connections on incoming ports,"}, {"Time_Start": 2736.14, "Time_End": 2739.14, "Text": " like 2022, so on and so forth,"}, {"Time_Start": 2739.14, "Time_End": 2743.14, "Text": " for multiple incoming connections to multiple hosts on the inside."}, {"Time_Start": 2743.14, "Time_End": 2746.12, "Text": " However, how do you get around the fact that SSC"}, {"Time_Start": 2746.14, "Time_End": 2752.3399999999997, "Text": " is constantly keeping certificates of hosts and constantly telling you that you've got a man in the middle attack."}, {"Time_Start": 2752.3399999999997, "Time_End": 2757.46, "Text": " Ah, yes, the whole problem about the fact that SSH actually cares about hosts and not ports."}, {"Time_Start": 2757.92, "Time_End": 2760.3199999999997, "Text": " I can actually answer this because I know SSH quite well."}, {"Time_Start": 2760.64, "Time_End": 2761.7999999999997, "Text": " You use the host alias."}, {"Time_Start": 2762.44, "Time_End": 2767.14, "Text": " You say, what you never connect, you never want to attach, if you have multiple hosts at the same IP,"}, {"Time_Start": 2767.54, "Time_End": 2770.66, "Text": " the IP address is no longer an analog to the host."}, {"Time_Start": 2770.96, "Time_End": 2776.12, "Text": " So when you make your SSH connection, you say, dot-o, host alias, whatever you're looking for."}, {"Time_Start": 2776.14, "Time_End": 2781.3799999999997, "Text": " for and that will go ahead and say, in this case, I'm expecting the key for this back end host."}, {"Time_Start": 2781.3799999999997, "Time_End": 2784.3799999999997, "Text": " And I'm expecting the key for that back end host. So that'll work."}, {"Time_Start": 2784.3799999999997, "Time_End": 2787.14, "Text": " All right. You're up?"}, {"Time_Start": 2787.14, "Time_End": 2790.14, "Text": " With OpenBSD, I believe you can turn..."}, {"Time_Start": 2790.14, "Time_End": 2796.14, "Text": " With OpenBSD, I believe you can turn off the option for rewriting all the AACMP stuff with SISCTL."}, {"Time_Start": 2796.14, "Time_End": 2799.14, "Text": " As far as I remember, there is a SISCTL option for that."}, {"Time_Start": 2799.14, "Time_End": 2803.14, "Text": " If you can email it to me, I would most appreciate it."}, {"Time_Start": 2803.14, "Time_End": 2804.14, "Text": " Thank you much."}, {"Time_Start": 2804.14, "Time_End": 2805.14, "Text": " I'd rather a book."}, {"Time_Start": 2805.14, "Time_End": 2806.14, "Text": " Huh?"}, {"Time_Start": 2806.14, "Time_End": 2808.14, "Text": " I'll tell you, maybe later."}, {"Time_Start": 2808.14, "Time_End": 2810.14, "Text": " Go ahead."}, {"Time_Start": 2810.14, "Time_End": 2818.14, "Text": " When you have your net, your virtual match, with basically batting on layer two."}, {"Time_Start": 2818.14, "Time_End": 2819.14, "Text": " Yes."}, {"Time_Start": 2819.14, "Time_End": 2822.14, "Text": " So all of your hosts are sharing a globally addressable IP."}, {"Time_Start": 2822.14, "Time_End": 2823.14, "Text": " Yes."}, {"Time_Start": 2823.14, "Time_End": 2825.14, "Text": " And Windows will bitch."}, {"Time_Start": 2825.14, "Time_End": 2828.14, "Text": " How do you communicate between hosts inside of that?"}, {"Time_Start": 2828.14, "Time_End": 2830.14, "Text": " It seems like you're going to need a layer two DNS."}, {"Time_Start": 2830.14, "Time_End": 2831.14, "Text": " No, no, no."}, {"Time_Start": 2831.14, "Time_End": 2832.14, "Text": " This gets evil."}, {"Time_Start": 2832.14, "Time_End": 2835.14, "Text": " You can actually have them all have, have,"}, {"Time_Start": 2835.14, "Time_End": 2841.14, "Text": " have 10 dot addresses, but the map plot on Lute would do it."}, {"Time_Start": 2841.14, "Time_End": 2844.14, "Text": " So in other words, it would go ahead and say,"}, {"Time_Start": 2844.14, "Time_End": 2847.14, "Text": " this 64 host also has an address to 10 dot."}, {"Time_Start": 2847.14, "Time_End": 2851.14, "Text": " 10 dots outside the subnet, so it's going to go ahead and hit the machine in the middle."}, {"Time_Start": 2851.14, "Time_End": 2855.14, "Text": " The machine in the middle is going to say, well, 10 dot goes ahead and maps to this 64 dot."}, {"Time_Start": 2855.14, "Time_End": 2860.14, "Text": " So the answer is they can bounce off the guy that would normally get them to the outside world."}, {"Time_Start": 2860.14, "Time_End": 2862.14, "Text": " And it actually can work."}, {"Time_Start": 2862.14, "Time_End": 2864.14, "Text": " Could you..."}, {"Time_Start": 2864.14, "Time_End": 2865.14, "Text": " Could you..."}, {"Time_Start": 2865.14, "Time_End": 2871.14, "Text": " also instead just under Linux, say, alias them, assign multiple IPs to the same,"}, {"Time_Start": 2871.14, "Time_End": 2872.14, "Text": " even an adapter?"}, {"Time_Start": 2872.14, "Time_End": 2876.14, "Text": " It depends on whether or not you want to mess with the hosts."}, {"Time_Start": 2876.14, "Time_End": 2880.14, "Text": " See, there's a lot of situations where you are allowed to modify this machine,"}, {"Time_Start": 2880.14, "Time_End": 2881.14, "Text": " but not that one."}, {"Time_Start": 2881.14, "Time_End": 2884.14, "Text": " You are allowed to modify this network, but not that one."}, {"Time_Start": 2884.14, "Time_End": 2887.14, "Text": " Yes, an IP alias would work perfectly as well."}, {"Time_Start": 2887.14, "Time_End": 2889.14, "Text": " But if you can't modify it on that level,"}, {"Time_Start": 2889.14, "Time_End": 2893.14, "Text": " you can go ahead and modify it at the perspective of the gateway."}, {"Time_Start": 2893.14, "Time_End": 2894.14, "Text": " But good thinking."}, {"Time_Start": 2894.14, "Time_End": 2896.14, "Text": " Okay, why not?"}, {"Time_Start": 2896.14, "Time_End": 2897.14, "Text": " Thank you."}, {"Time_Start": 2897.14, "Time_End": 2898.14, "Text": " And a beer."}, {"Time_Start": 2898.14, "Time_End": 2900.14, "Text": " Sweet!"}, {"Time_Start": 2900.14, "Time_End": 2903.14, "Text": " For the connection brokering."}, {"Time_Start": 2903.14, "Time_End": 2905.14, "Text": " Okay."}, {"Time_Start": 2905.14, "Time_End": 2906.14, "Text": " Thank you."}, {"Time_Start": 2906.14, "Time_End": 2912.14, "Text": " Couldn't you have both Alice and Bob spoof as if they were the connection broker?"}, {"Time_Start": 2912.14, "Time_End": 2917.14, "Text": " The problem is that the connection broker is never supposed to actually be part of the session."}, {"Time_Start": 2917.14, "Time_End": 2922.14, "Text": " Right, he isn't after he tells both Alice and Bob, your next sequence number is."}, {"Time_Start": 2922.14, "Time_End": 2923.14, "Text": " And then both Alice and Bob take over."}, {"Time_Start": 2923.14, "Time_End": 2924.14, "Text": " Alice and Bob take over."}, {"Time_Start": 2924.14, "Time_End": 2928.14, "Text": " So you're saying, no, no, no, Alice and Bob can't spoof packets."}, {"Time_Start": 2928.14, "Time_End": 2930.14, "Text": " They're behind stateful firewalls."}, {"Time_Start": 2930.14, "Time_End": 2932.14, "Text": " They're behind things that are really checking."}, {"Time_Start": 2932.14, "Time_End": 2936.14, "Text": " Alice and Bob have to have entirely legitimate traffic."}, {"Time_Start": 2936.14, "Time_End": 2940.14, "Text": " It's just, they have two entirely legitimate streams of traffic."}, {"Time_Start": 2940.14, "Time_End": 2944.14, "Text": " One of them's going to, one of them's going to the connection broker,"}, {"Time_Start": 2944.14, "Time_End": 2948.14, "Text": " the other one's going to Bob's firewall and, you know, maybe not getting there."}, {"Time_Start": 2948.14, "Time_End": 2952.14, "Text": " And low TTLs are legitimate traffic because of trace routes."}, {"Time_Start": 2952.14, "Time_End": 2953.14, "Text": " But good things."}, {"Time_Start": 2953.14, "Time_End": 2954.14, "Text": " though."}, {"Time_Start": 2954.14, "Time_End": 2955.14, "Text": " Thank you."}, {"Time_Start": 2955.14, "Time_End": 2956.14, "Text": " All right."}, {"Time_Start": 2956.14, "Time_End": 2957.14, "Text": " You go ahead."}, {"Time_Start": 2957.14, "Time_End": 2958.14, "Text": " Oh, my apologies."}, {"Time_Start": 2958.14, "Time_End": 2965.14, "Text": " With IP address, defense, ARPS on boot up with multiple addresses of the same."}, {"Time_Start": 2965.14, "Time_End": 2968.14, "Text": " Do you have a solution for that?"}, {"Time_Start": 2968.14, "Time_End": 2970.14, "Text": " Windows will bitch."}, {"Time_Start": 2970.14, "Time_End": 2974.14, "Text": " And I think there's a registry hack that gets rid of that bitching."}, {"Time_Start": 2974.14, "Time_End": 2976.14, "Text": " If not, oh well, you can't do this with Windows."}, {"Time_Start": 2976.14, "Time_End": 2978.14, "Text": " There's another option."}, {"Time_Start": 2978.14, "Time_End": 2982.14, "Text": " You do the same thing you do when doing layer four load balancing, put a"}, {"Time_Start": 2982.14, "Time_End": 2991.14, "Text": " put a loopback, I forget the exact syntax, but you essentially put a loopback address in place mapping to that IP."}, {"Time_Start": 2991.14, "Time_End": 2995.14, "Text": " That disables ARP responses to anybody making ARP requests on that IP."}, {"Time_Start": 2995.14, "Time_End": 2997.14, "Text": " And just do that on..."}, {"Time_Start": 2997.14, "Time_End": 3000.14, "Text": " Fucking A. Talk to me after."}, {"Time_Start": 3000.14, "Time_End": 3001.14, "Text": " Fucking A."}, {"Time_Start": 3001.14, "Time_End": 3004.14, "Text": " Now you definitely would have to have your 10."}, {"Time_Start": 3004.14, "Time_End": 3008.14, "Text": " Address for interhosts communication because you wouldn't be able to communicate with anyone else on that IP."}, {"Time_Start": 3008.14, "Time_End": 3009.14, "Text": " All right."}, {"Time_Start": 3009.14, "Time_End": 3011.14, "Text": " But the host would actually think it has the external IP?"}, {"Time_Start": 3011.14, "Time_End": 3012.14, "Text": " Is what you're saying?"}, {"Time_Start": 3012.14, "Time_End": 3014.14, "Text": " Yeah, it just won't, our response to it."}, {"Time_Start": 3014.14, "Time_End": 3015.14, "Text": " Thank you."}, {"Time_Start": 3015.14, "Time_End": 3016.14, "Text": " Thank you."}, {"Time_Start": 3016.14, "Time_End": 3017.14, "Text": " Drive through."}, {"Time_Start": 3017.14, "Time_End": 3018.14, "Text": " All right."}, {"Time_Start": 3018.14, "Time_End": 3019.14, "Text": " I'm sorry."}, {"Time_Start": 3019.14, "Time_End": 3022.14, "Text": " I think I have two questions."}, {"Time_Start": 3022.14, "Time_End": 3023.14, "Text": " Oh, hell."}, {"Time_Start": 3023.14, "Time_End": 3025.14, "Text": " Now this is the man that comes prepared."}, {"Time_Start": 3025.14, "Time_End": 3026.14, "Text": " One of them's a recommendation."}, {"Time_Start": 3026.14, "Time_End": 3027.14, "Text": " All right."}, {"Time_Start": 3027.14, "Time_End": 3028.14, "Text": " I don't know."}, {"Time_Start": 3028.14, "Time_End": 3034.14, "Text": " Instead of doing a TTL die, instead of doing a TTL time to live that's going to time out."}, {"Time_Start": 3034.14, "Time_End": 3035.14, "Text": " All right."}, {"Time_Start": 3035.14, "Time_End": 3040.14, "Text": " Could you do an invalid TCP check sum to have the same packet die and get removed from the stream?"}, {"Time_Start": 3040.14, "Time_End": 3041.14, "Text": " Well, TCP's real."}, {"Time_Start": 3041.14, "Time_End": 3042.14, "Text": " Well, here's the real."}, {"Time_Start": 3042.14, "Time_End": 3044.14, "Text": " The routers don't care about the checksums, remember?"}, {"Time_Start": 3044.14, "Time_End": 3045.14, "Text": " We wanted to..."}, {"Time_Start": 3045.14, "Time_End": 3046.14, "Text": " Okay."}, {"Time_Start": 3046.14, "Time_End": 3047.14, "Text": " Ah?"}, {"Time_Start": 3047.14, "Time_End": 3055.14, "Text": " So you're saying that Bob's Firewall would get the invalid TCP checksum, and once it got the invalid"}, {"Time_Start": 3055.14, "Time_End": 3058.14, "Text": " checksum, it would send back a TCP error instead of the reset act."}, {"Time_Start": 3058.14, "Time_End": 3062.14, "Text": " And it would still drop the packet out of the session."}, {"Time_Start": 3062.14, "Time_End": 3064.14, "Text": " Yeah, yep, that would suppress it."}, {"Time_Start": 3064.14, "Time_End": 3065.14, "Text": " All right."}, {"Time_Start": 3065.14, "Time_End": 3066.14, "Text": " And..."}, {"Time_Start": 3066.14, "Time_End": 3071.14, "Text": " That's actually, uh, that's a really good thing to do with they're actually blocking low TTLs on SIN."}, {"Time_Start": 3071.14, "Time_End": 3075.14, "Text": " which will probably be a feature in a short while."}, {"Time_Start": 3075.14, "Time_End": 3077.14, "Text": " Oh, you're right."}, {"Time_Start": 3077.14, "Time_End": 3079.14, "Text": " If, uh, if, if, if, if, if, if,"}, {"Time_Start": 3079.14, "Time_End": 3082.14, "Text": " okay, so Alice's Firewall and Bob's Firewall, both participate."}, {"Time_Start": 3082.14, "Time_End": 3083.14, "Text": " I don't need a..."}, {"Time_Start": 3083.14, "Time_End": 3085.14, "Text": " I have one beer, I already had two."}, {"Time_Start": 3085.14, "Time_End": 3086.14, "Text": " This guy got two."}, {"Time_Start": 3086.14, "Time_End": 3089.14, "Text": " This guy gets the last fucking beer."}, {"Time_Start": 3089.14, "Time_End": 3090.14, "Text": " You won't make the stadium."}, {"Time_Start": 3090.14, "Time_End": 3093.14, "Text": " You can actually check the TCB checks on,"}, {"Time_Start": 3093.14, "Time_End": 3096.14, "Text": " and it's invalid, it will not make a stadium free."}, {"Time_Start": 3096.14, "Time_End": 3100.14, "Text": " Um, it's another one of those situations where you have two firewalls"}, {"Time_Start": 3100.14, "Time_End": 3101.14, "Text": " with slightly firewalls with slightly,"}, {"Time_Start": 3101.14, "Time_End": 3108.14, "Text": " different circumstances. If you have a local firewall that doesn't care and a remote firewall that does care, it works."}, {"Time_Start": 3108.14, "Time_End": 3113.14, "Text": " But the TTL solution is going to be more general. But it's still good thinking."}, {"Time_Start": 3113.14, "Time_End": 3117.14, "Text": " And I forgot the second question because I'm cocked."}, {"Time_Start": 3117.14, "Time_End": 3121.14, "Text": " All right. I brought you up here."}, {"Time_Start": 3121.14, "Time_End": 3125.14, "Text": " Sweet, I have refills. All right. Do we have any other questions?"}, {"Time_Start": 3125.14, "Time_End": 3130.14, "Text": " I have a comment. Sweet. My first comment is Theo is obviously not paranoid because he's right."}, {"Time_Start": 3130.14, "Time_End": 3135.14, "Text": " I didn't say, no, paranoid is right. He works in security. He's supposed to be paranoid."}, {"Time_Start": 3135.14, "Time_End": 3138.14, "Text": " This is a great little thing exchange I had with this guy."}, {"Time_Start": 3138.14, "Time_End": 3142.14, "Text": " It's like, security is the only industry where paranoia is a compliment."}, {"Time_Start": 3142.14, "Time_End": 3146.14, "Text": " The response I got back, I was afraid somebody would say that."}, {"Time_Start": 3146.14, "Time_End": 3150.14, "Text": " And I personally have never set up a firewall that's allowed IP options in or out,"}, {"Time_Start": 3150.14, "Time_End": 3152.14, "Text": " so I think that you're going to run in some trouble with that."}, {"Time_Start": 3152.14, "Time_End": 3155.14, "Text": " Okay, and specific things of that."}, {"Time_Start": 3155.14, "Time_End": 3157.14, "Text": " Rachel, are you in the crowd?"}, {"Time_Start": 3157.14, "Time_End": 3160.14, "Text": " Where are you? Right there. Yeah. Rachel knows about it."}, {"Time_Start": 3160.14, "Time_End": 3166.14, "Text": " this. There's TCP options, which don't get molested, and TCP options actually will,"}, {"Time_Start": 3166.14, "Time_End": 3172.14, "Text": " you have a TCP timestamp that has a reply field inside of it that match is supposed to contain"}, {"Time_Start": 3172.14, "Time_End": 3177.14, "Text": " the time of your own machine. Now it's 32 bits, so you can only put in an IP address,"}, {"Time_Start": 3177.14, "Time_End": 3181.14, "Text": " but it's enough for you to get the local IP, ARP for it, and do what you need."}, {"Time_Start": 3181.14, "Time_End": 3185.14, "Text": " So how much you want to bet by the time we all get home next week that Theo will have patched"}, {"Time_Start": 3185.14, "Time_End": 3189.14, "Text": " OpenBSD to scrub all outbound TTLs through PF?"}, {"Time_Start": 3189.14, "Time_End": 3190.12, "Text": " Well, but then he's going to break to"}, {"Time_Start": 3190.14, "Time_End": 3192.14, "Text": " Then he's going to break..."}, {"Time_Start": 3192.14, "Time_End": 3194.14, "Text": " Here's a deal."}, {"Time_Start": 3194.14, "Time_End": 3196.14, "Text": " You've got the legitimate and the illegitimate."}, {"Time_Start": 3196.14, "Time_End": 3201.14, "Text": " You have legitimate TCP trace routing that should not be messed with."}, {"Time_Start": 3201.14, "Time_End": 3204.14, "Text": " And you've got kind of some other stuff."}, {"Time_Start": 3204.14, "Time_End": 3206.14, "Text": " The legitimate's protecting the illegitimate."}, {"Time_Start": 3206.14, "Time_End": 3211.14, "Text": " I would be really pissed if it wasn't at least an option to allow the time stamping."}, {"Time_Start": 3211.14, "Time_End": 3213.14, "Text": " But you only need that..."}, {"Time_Start": 3213.14, "Time_End": 3215.14, "Text": " You only need that for ICMP."}, {"Time_Start": 3215.14, "Time_End": 3219.14, "Text": " So you could scrub TTLs on everything but ICMP and still effectively break this technique."}, {"Time_Start": 3219.14, "Time_End": 3221.14, "Text": " effectively break this technique."}, {"Time_Start": 3221.14, "Time_End": 3224.14, "Text": " Well, I mean, there's ICMP to ETL timestamp."}, {"Time_Start": 3224.14, "Time_End": 3230.14, "Text": " You can trace route and do trace route on TCP, on UDP, and on ICMP."}, {"Time_Start": 3230.14, "Time_End": 3235.14, "Text": " There's different implementations that do all three, because all three elicit a time exceeded message."}, {"Time_Start": 3235.14, "Time_End": 3236.14, "Text": " Thanks."}, {"Time_Start": 3236.14, "Time_End": 3237.14, "Text": " All right."}, {"Time_Start": 3237.14, "Time_End": 3239.14, "Text": " What's up?"}, {"Time_Start": 3239.14, "Time_End": 3240.14, "Text": " Two things."}, {"Time_Start": 3240.14, "Time_End": 3246.14, "Text": " First, you can hose the dynamic hole when you get a TTL a time exceeded."}, {"Time_Start": 3246.14, "Time_End": 3248.14, "Text": " So one thing that OpenBSD could do is..."}, {"Time_Start": 3248.14, "Time_End": 3249.14, "Text": " Yes."}, {"Time_Start": 3249.14, "Time_End": 3252.64, "Text": " when it gets the ICMP TTO, it could close the open..."}, {"Time_Start": 3252.64, "Time_End": 3253.14, "Text": " Oh, yeah."}, {"Time_Start": 3253.14, "Time_End": 3257.14, "Text": " And the information's sitting there in the ICMP data, and it's sitting everywhere."}, {"Time_Start": 3257.14, "Time_End": 3259.14, "Text": " It's really trivial."}, {"Time_Start": 3259.14, "Time_End": 3262.14, "Text": " But, to be blunt, there's been no reason to do so."}, {"Time_Start": 3262.14, "Time_End": 3263.14, "Text": " And no, no, no."}, {"Time_Start": 3263.14, "Time_End": 3267.14, "Text": " Let's talk about it from a purely theoretical security point of view."}, {"Time_Start": 3267.14, "Time_End": 3271.14, "Text": " OpenBSD already trusts machines behind the firewall"}, {"Time_Start": 3271.14, "Time_End": 3274.14, "Text": " to determine what outgoing connections they're going to make."}, {"Time_Start": 3274.14, "Time_End": 3278.14, "Text": " Whether or not some remote host is able to do incoming or not,"}, {"Time_Start": 3278.14, "Time_End": 3279.14, "Text": " is not something."}, {"Time_Start": 3279.14, "Time_End": 3282.14, "Text": " that is within the security domain of open BSD."}, {"Time_Start": 3282.14, "Time_End": 3283.14, "Text": " It can't know."}, {"Time_Start": 3283.14, "Time_End": 3285.14, "Text": " Because if it was a security issue,"}, {"Time_Start": 3285.14, "Time_End": 3290.14, "Text": " open BSD would be vulnerable every time some other guy opened up a hole in his firewall."}, {"Time_Start": 3290.14, "Time_End": 3295.14, "Text": " We're using a trait of the network to basically limit the statement."}, {"Time_Start": 3295.14, "Time_End": 3297.14, "Text": " I want to talk to this guy."}, {"Time_Start": 3297.14, "Time_End": 3299.14, "Text": " Limit it to my local side."}, {"Time_Start": 3299.14, "Time_End": 3303.14, "Text": " The remote side is so far too dumb to know,"}, {"Time_Start": 3303.14, "Time_End": 3306.14, "Text": " oh, how do we resolve the nat-to-nat issue?"}, {"Time_Start": 3306.14, "Time_End": 3308.14, "Text": " There's no knowledge to know how to do that resolution yet."}, {"Time_Start": 3308.14, "Time_End": 3309.14, "Text": " So what?"}, {"Time_Start": 3309.14, "Time_End": 3313.14, "Text": " We're telling only our local side, I want to talk to the other guy."}, {"Time_Start": 3313.14, "Time_End": 3316.14, "Text": " And this is already a trusted message."}, {"Time_Start": 3316.14, "Time_End": 3324.14, "Text": " The other comment was your stateless NAT would suffer from people using that state in the packet."}, {"Time_Start": 3324.14, "Time_End": 3325.14, "Text": " Oh, you overriding the state."}, {"Time_Start": 3325.14, "Time_End": 3326.14, "Text": " Yeah, you encrypt."}, {"Time_Start": 3326.14, "Time_End": 3327.14, "Text": " You encrypt against the key."}, {"Time_Start": 3327.14, "Time_End": 3330.14, "Text": " You certainly have enough space to do all that kind of stuff."}, {"Time_Start": 3330.14, "Time_End": 3331.14, "Text": " You encrypt against a key."}, {"Time_Start": 3331.14, "Time_End": 3332.14, "Text": " People have a choice."}, {"Time_Start": 3332.14, "Time_End": 3338.14, "Text": " Either they drop the IP option and it doesn't get anywhere or it gets to the one host it was supposed to."}, {"Time_Start": 3338.14, "Time_End": 3339.14, "Text": " That's how I use the crypto."}, {"Time_Start": 3339.14, "Time_End": 3340.14, "Text": " that."}, {"Time_Start": 3340.14, "Time_End": 3341.14, "Text": " Very good."}, {"Time_Start": 3341.14, "Time_End": 3343.14, "Text": " And of course the code is there because we're using that with our SIM scanner."}, {"Time_Start": 3343.14, "Time_End": 3345.14, "Text": " And we got next."}, {"Time_Start": 3345.14, "Time_End": 3350.14, "Text": " If you're going to use a connection broker, why don't just use a proxy?"}, {"Time_Start": 3350.14, "Time_End": 3352.14, "Text": " Oh, because the..."}, {"Time_Start": 3352.14, "Time_End": 3353.14, "Text": " Okay."}, {"Time_Start": 3353.14, "Time_End": 3356.14, "Text": " Now last year I talked about using SSH for an end-to-end secure proxy."}, {"Time_Start": 3356.14, "Time_End": 3358.14, "Text": " So the proxy would just pass with crypto packages."}, {"Time_Start": 3358.14, "Time_End": 3360.14, "Text": " I have no idea what it's doing."}, {"Time_Start": 3360.14, "Time_End": 3362.14, "Text": " It's really expensive."}, {"Time_Start": 3362.14, "Time_End": 3364.14, "Text": " There's this old story about..."}, {"Time_Start": 3364.14, "Time_End": 3368.14, "Text": " Used to be that it was illegal for phone calls to go between Jordan and Israel."}, {"Time_Start": 3368.14, "Time_End": 3374.14, "Text": " So, the guy in Jordan would call some apartment in the United States, and the guy in Israel would call some apartment in the United States,"}, {"Time_Start": 3374.14, "Time_End": 3377.14, "Text": " and their connections would be linked against each other."}, {"Time_Start": 3377.14, "Time_End": 3381.14, "Text": " Now the problem was, for this to work, the people who were running this had to rent departments,"}, {"Time_Start": 3381.14, "Time_End": 3385.14, "Text": " they had to get phone lines, they had to buy phones, they had to buy hardware,"}, {"Time_Start": 3385.14, "Time_End": 3387.14, "Text": " and you know how they got caught, by the way?"}, {"Time_Start": 3387.14, "Time_End": 3389.14, "Text": " They didn't actually pay for anything."}, {"Time_Start": 3389.14, "Time_End": 3392.14, "Text": " They just shipped it all to the next place every time their rent was due."}, {"Time_Start": 3392.14, "Time_End": 3397.14, "Text": " But yeah, I mean, the handshake, the connection broker's handshake only."}, {"Time_Start": 3397.14, "Time_End": 3398.14, "Text": " All it does."}, {"Time_Start": 3398.14, "Time_End": 3404.14, "Text": " is facilitate the connection between Alice and Bob at the asymmetric phase, at the point of the handshake."}, {"Time_Start": 3404.14, "Time_End": 3409.14, "Text": " Once the handshake's done, you have two sides that think they're talking directly to each other,"}, {"Time_Start": 3409.14, "Time_End": 3413.14, "Text": " are routing directly to each other, and therefore get a direct link."}, {"Time_Start": 3413.14, "Time_End": 3414.14, "Text": " The broker is out."}, {"Time_Start": 3414.14, "Time_End": 3419.14, "Text": " The broker exchanges a total of between 5 and 15 packets depending on the convergence algorithm"}, {"Time_Start": 3419.14, "Time_End": 3423.14, "Text": " and can pass that has facilitated an arbitrary amount of data."}, {"Time_Start": 3423.14, "Time_End": 3426.14, "Text": " So the broker just does the very beginning and then he's out."}, {"Time_Start": 3426.14, "Time_End": 3427.14, "Text": " Ding, ding, man got it."}, {"Time_Start": 3427.14, "Time_End": 3428.14, "Text": " Man got it."}, {"Time_Start": 3428.14, "Time_End": 3429.14, "Text": " Go ahead."}, {"Time_Start": 3429.14, "Time_End": 3433.14, "Text": " Would a connection broker work in a situation like this?"}, {"Time_Start": 3433.14, "Time_End": 3435.14, "Text": " You have two firewalls running that."}, {"Time_Start": 3435.14, "Time_End": 3436.14, "Text": " Okay."}, {"Time_Start": 3436.14, "Time_End": 3440.14, "Text": " The server behind one of the firewalls and it's forwarding ports to that server."}, {"Time_Start": 3440.14, "Time_End": 3441.14, "Text": " Okay."}, {"Time_Start": 3441.14, "Time_End": 3444.14, "Text": " This connection behind a firewall has no, you know, there's no ports being forwarded."}, {"Time_Start": 3444.14, "Time_End": 3449.14, "Text": " The user wants to connect to the server using the public IP address, but the server responds on a different port."}, {"Time_Start": 3449.14, "Time_End": 3453.14, "Text": " Like they want to come in on 149 and they come out, you know, it comes back on 400 or something."}, {"Time_Start": 3453.14, "Time_End": 3456.14, "Text": " You need to stay within the same TCP sessions that's going on."}, {"Time_Start": 3456.14, "Time_End": 3457.14, "Text": " Just because the user."}, {"Time_Start": 3457.14, "Time_End": 3464.14, "Text": " user makes an outgoing connection to the server, the only thing the server can do is make a response on that individual TCP session."}, {"Time_Start": 3464.14, "Time_End": 3470.14, "Text": " Got it is conceivable that this outgoing connection could be to an SSH server on the server."}, {"Time_Start": 3470.14, "Time_End": 3476.14, "Text": " And then using that, it can do a remote port forward of its own SSH server or its own web server,"}, {"Time_Start": 3476.14, "Time_End": 3479.14, "Text": " and effectively the server can tunnel in back through that SSH system."}, {"Time_Start": 3479.14, "Time_End": 3482.14, "Text": " Now that works well. I'll show you how to do it later."}, {"Time_Start": 3482.14, "Time_End": 3483.14, "Text": " Nice. Thank you."}, {"Time_Start": 3483.14, "Time_End": 3484.14, "Text": " All right."}, {"Time_Start": 3484.14, "Time_End": 3486.14, "Text": " We got anyone else?"}, {"Time_Start": 3486.14, "Time_End": 3487.14, "Text": " You up?"}, {"Time_Start": 3487.14, "Time_End": 3490.14, "Text": " All right."}, {"Time_Start": 3490.14, "Time_End": 3495.14, "Text": " With what he was saying, could you set something up so that you could have one guy on one side, one guy in the other,"}, {"Time_Start": 3495.14, "Time_End": 3503.14, "Text": " and allow somebody on this other side could open up so that he can get to his server in his own domain"}, {"Time_Start": 3503.14, "Time_End": 3507.14, "Text": " by using a packet, say that it's from this IP address, but it's not?"}, {"Time_Start": 3507.14, "Time_End": 3516.14, "Text": " You got to operate within a really restrictive domain where the only entries you're able to open up on the firewall are those from outgoing connections."}, {"Time_Start": 3516.14, "Time_End": 3517.14, "Text": " This is so far."}, {"Time_Start": 3517.14, "Time_End": 3519.14, "Text": " only method I found to do it."}, {"Time_Start": 3519.14, "Time_End": 3524.14, "Text": " Well, if this guy sends a packet out from source port 80..."}, {"Time_Start": 3524.14, "Time_End": 3528.14, "Text": " If it's a syn- if it's not part of an establishment..."}, {"Time_Start": 3528.14, "Time_End": 3529.14, "Text": " Okay."}, {"Time_Start": 3529.14, "Time_End": 3533.14, "Text": " The only type of TCP packet that you can send out that will actually..."}, {"Time_Start": 3533.14, "Time_End": 3538.14, "Text": " out of a stateful firewall that will actually reach the internet is a sin."}, {"Time_Start": 3538.14, "Time_End": 3542.14, "Text": " A sin act is a response, an act is a response after a sin,"}, {"Time_Start": 3542.14, "Time_End": 3546.14, "Text": " and the raw data flag list has to have started from a handshake."}, {"Time_Start": 3546.14, "Time_End": 3547.14, "Text": " So the only thing you're going to have started from a handshake."}, {"Time_Start": 3547.14, "Time_End": 3554.14, "Text": " can get out is the sin. That's your restriction. So this system theoretically works. Again,"}, {"Time_Start": 3554.14, "Time_End": 3561.14, "Text": " you'd use UDP. This is what the game guys do. It works quite well. We got anything else?"}, {"Time_Start": 3561.14, "Time_End": 3567.14, "Text": " Hang on, hang on. Who said that? Ah, yes, I know this question."}, {"Time_Start": 3567.14, "Time_End": 3572.14, "Text": " What if you don't have a default gateway pointing to your firewall? Ah, now this is beautiful."}, {"Time_Start": 3572.14, "Time_End": 3577.12, "Text": " The only thing the default gateway does, your system arps to the default gateway does, your system arps to the default."}, {"Time_Start": 3577.14, "Time_End": 3584.14, "Text": " default gateway sends the packet with the final destination to that gateway Mac address."}, {"Time_Start": 3584.14, "Time_End": 3594.14, "Text": " The gateway never actually needs to know what IP, the, oh, okay, long story short, the gateway response to the"}, {"Time_Start": 3594.14, "Time_End": 3598.14, "Text": " ARP request for the default gateway and says, yeah, send them to my Mac."}, {"Time_Start": 3598.14, "Time_End": 3601.14, "Text": " Oh, you're shaking your head. Why can't you do that?"}, {"Time_Start": 3601.14, "Time_End": 3604.14, "Text": " Not on your network?"}, {"Time_Start": 3604.14, "Time_End": 3606.14, "Text": " No, no, no, no, no, no, no. Come back here. I sense a little challenge."}, {"Time_Start": 3606.14, "Time_End": 3613.14, "Text": " I sense a little challenge here. Why can I not ARP for your gateway?"}, {"Time_Start": 3613.14, "Time_End": 3619.14, "Text": " Because the IP address of the firewall is not in my routing table."}, {"Time_Start": 3619.14, "Time_End": 3622.14, "Text": " The IP address of the firewall is not in the routing table."}, {"Time_Start": 3622.14, "Time_End": 3625.14, "Text": " I am talking about replacing your firewall, you know."}, {"Time_Start": 3625.14, "Time_End": 3630.14, "Text": " It's a bridge or it sits before your firewall."}, {"Time_Start": 3630.14, "Time_End": 3633.14, "Text": " It's basically replacing the NAT implementation on your firewall."}, {"Time_Start": 3633.14, "Time_End": 3635.14, "Text": " I use a proxy server."}, {"Time_Start": 3635.14, "Time_End": 3636.14, "Text": " Hmm?"}, {"Time_Start": 3636.14, "Time_End": 3637.14, "Text": " Talk to the mic."}, {"Time_Start": 3637.14, "Time_End": 3639.14, "Text": " Nobody can go out."}, {"Time_Start": 3639.14, "Time_End": 3641.14, "Text": " They all use a proxy server."}, {"Time_Start": 3641.14, "Time_End": 3644.14, "Text": " Nobody can use a proxy server."}, {"Time_Start": 3644.14, "Time_End": 3649.14, "Text": " Well, it's, you have a, remember it this way."}, {"Time_Start": 3649.14, "Time_End": 3651.14, "Text": " You have a network specifically."}, {"Time_Start": 3651.14, "Time_End": 3654.14, "Text": " If you were to install my stuff, you'd be changing the architecture of your network."}, {"Time_Start": 3654.14, "Time_End": 3659.14, "Text": " It doesn't really make sense for me to talk about how this would work in your network as is,"}, {"Time_Start": 3659.14, "Time_End": 3663.14, "Text": " because, you know, first of all, I presume direct connectivity."}, {"Time_Start": 3663.14, "Time_End": 3665.14, "Text": " And this is not what, you know, you have..."}, {"Time_Start": 3665.14, "Time_End": 3668.14, "Text": " That's really the only comment I was making when I was sitting down."}, {"Time_Start": 3668.14, "Time_End": 3670.14, "Text": " You're assuming the direct activity."}, {"Time_Start": 3670.14, "Time_End": 3671.14, "Text": " All right."}, {"Time_Start": 3671.14, "Time_End": 3672.14, "Text": " Then we both agree."}, {"Time_Start": 3672.14, "Time_End": 3673.14, "Text": " Okay."}, {"Time_Start": 3673.14, "Time_End": 3674.14, "Text": " And there is actually a proxy system."}, {"Time_Start": 3674.14, "Time_End": 3676.14, "Text": " I'm asking about it later."}, {"Time_Start": 3676.14, "Time_End": 3678.14, "Text": " Because I don't know if it's on my head, but I've written down somewhere."}, {"Time_Start": 3678.14, "Time_End": 3681.14, "Text": " I wouldn't talk about what I do on this microphone anyway."}, {"Time_Start": 3681.14, "Time_End": 3683.14, "Text": " Spot."}, {"Time_Start": 3683.14, "Time_End": 3685.14, "Text": " But anyway."}, {"Time_Start": 3685.14, "Time_End": 3687.14, "Text": " We got anything else?"}, {"Time_Start": 3687.14, "Time_End": 3688.14, "Text": " Any other challenges?"}, {"Time_Start": 3688.14, "Time_End": 3689.14, "Text": " That was actually a good question."}, {"Time_Start": 3689.14, "Time_End": 3691.14, "Text": " He's got a point there."}, {"Time_Start": 3695.14, "Time_End": 3697.14, "Text": " I'm going to give you a book for the balls."}, {"Time_Start": 3697.14, "Time_End": 3699.14, "Text": " Give me a beer."}, {"Time_Start": 3699.14, "Time_End": 3702.14, "Text": " If you want the beer to be in."}, {"Time_Start": 3702.14, "Time_End": 3705.14, "Text": " I want a beer. Where's my beer?"}, {"Time_Start": 3705.14, "Time_End": 3707.14, "Text": " You have a beer."}, {"Time_Start": 3707.14, "Time_End": 3709.14, "Text": " Sweet. All righty, everyone."}, {"Time_Start": 3709.14, "Time_End": 3711.14, "Text": " Thanks for sticking it out. Thanks for coming."}, {"Time_Start": 3711.14, "Time_End": 3715.14, "Text": " Welcome to DefCon. Have a fucking party, people."}]}